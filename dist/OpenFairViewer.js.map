{"mappings":"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","sources":["src/OpenFairViewer.js","src/import-jquery.js","src/import-jsonix.js","src/import-jsonix-geojson.js","src/vendor/jsonix/GeoJSON.js","src/import-w3c-schemas.js","src/import-ogc-schemas.js","src/vendor/ows/CSWConstraint.js","src/vendor/ows/CSWQuery.js","src/vendor/ows/Filter.js","src/vendor/ows/IsLike.js","src/vendor/ows/IsEqualTo.js","src/vendor/ows/IsNotEqualTo.js","src/vendor/ows/IsLessThan.js","src/vendor/ows/IsLessThanOrEqualTo.js","src/vendor/ows/IsGreaterThan.js","src/vendor/ows/IsGreaterThanOrEqualTo.js","src/vendor/ows/BBOX.js","src/vendor/ows/And.js","src/vendor/ows/Or.js","src/vendor/ows/Not.js","src/vendor/ows/CSW.js","src/vendor/ows/OWS.js","src/vendor/ows/CSWCapabilities.js","src/vendor/ows/CSWGetRecords.js","src/vendor/ows/CSWGetRecordById.js","src/vendor/ows/CSWGetDomain.js","src/vendor/ows/WMS.js","src/OpenFairLayerSwitcher.js","src/OpenFairShiny.js"],"sourcesContent":["/**\r\n * OpenFairViewer - a FAIR, ISO and OGC (meta)data compliant GIS data viewer\r\n * Copyright (c) 2018 Emmanuel Blondel\r\n * \r\n * Permission is hereby granted, free of charge, to any person obtaining a copy of this software \r\n * and associated documentation files (the \"Software\"), to deal in the Software without restriction, \r\n * including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, \r\n * and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, \r\n * subject to the following conditions:\r\n * \r\n * The above copyright notice and this permission notice shall be included in all copies or substantial \r\n * portions of the Software.\r\n * \r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT\r\n * LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. \r\n * IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, \r\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE \r\n * OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\r\n *\t\t   \r\n */\r\n \r\n//jquery\r\nimport './import-jquery';\r\nimport 'jquery-ui-dist/jquery-ui.css';\r\nimport 'jquery-ui-dist/jquery-ui.js';\r\n//select2\r\nimport select2 from 'select2';\r\nselect2($); //Hook up select2 to jQuery      \r\nimport 'select2/dist/css/select2.css';\r\n//jquery datetimepicker\r\nimport datetimepicker from 'jquery-datetimepicker';\r\nimport 'jquery-datetimepicker/jquery.datetimepicker.css';\r\n//datatables\r\nimport 'datatables.net-dt';\r\nimport 'datatables.net-dt/css/jquery.dataTables.css';\r\n//bootstrap\r\nimport 'bootstrap';\r\nimport 'bootstrap/dist/css/bootstrap.css';\r\n//bootstrap-slider\r\nimport 'bootstrap-slider/dist/css/bootstrap-slider.css';\r\nimport 'bootstrap-slider/dist/bootstrap-slider.js';\r\n//font awesome\r\nimport '@fortawesome/fontawesome-free/js/all.js';\r\n//academicons\r\nimport 'academicons/css/academicons.css';\r\n//jsonix\r\nimport './import-jsonix';\r\nimport './import-jsonix-geojson';\r\n//W3C schemas\r\nimport './import-w3c-schemas';\r\n//OGC schemas\r\nimport './import-ogc-schemas';\r\n//ows4js\r\n//import './import-ows';\r\nimport CSWConstraint from './vendor/ows/CSWConstraint';\r\nimport CSWQuery from './vendor/ows/CSWQuery';\r\nimport Filter from './vendor/ows/Filter';\r\nimport IsLike from './vendor/ows/IsLike';\r\nimport IsEqualTo from './vendor/ows/IsEqualTo';\r\nimport IsNotEqualTo from './vendor/ows/IsNotEqualTo';\r\nimport IsLessThan from './vendor/ows/IsLessThan';\r\nimport IsLessThanOrEqualTo from './vendor/ows/IsLessThanOrEqualTo';\r\nimport IsGreaterThan from './vendor/ows/IsGreaterThan';\r\nimport IsGreaterThanOrEqualTo from './vendor/ows/IsGreaterThanOrEqualTo';\r\nimport BBOX from './vendor/ows/BBOX';\r\nimport And from './vendor/ows/And';\r\nimport Or from './vendor/ows/Or';\r\nimport Not from './vendor/ows/Not';\r\nimport CSW from './vendor/ows/CSW';\r\nimport WMS from './vendor/ows/WMS';\r\n//bootpag\r\nimport bootpag from 'bootpag/lib/jquery.bootpag';\r\n//mustache\r\nimport mustache from 'mustache/mustache.mjs';\r\n//ol-cesium\r\n//import Cesium from 'cesium';\r\nimport OLCesium from 'olcs/OLCesium.js';\r\n//openlayers\r\nimport 'ol/ol.css';\r\nimport Map from 'ol/Map';\r\nimport {unByKey} from 'ol/Observable';\r\nimport {MousePosition, OverviewMap, Zoom, ZoomToExtent, Attribution} from 'ol/Control';\r\nimport {OSM, WMTS, TileArcGISRest, XYZ, TileWMS, ImageWMS, Vector, Cluster} from 'ol/source';\r\nimport WMTSTileGrid from 'ol/tilegrid/WMTS';\r\nimport {Group as LayerGroup, Tile as TileLayer, Image as ImageLayer, Vector as VectorLayer} from 'ol/layer';\r\nimport View from 'ol/View';\r\nimport proj4 from 'proj4';\r\nimport {register} from 'ol/proj/proj4';\r\nimport * as olExtent from 'ol/extent';\r\nimport * as olProj from 'ol/proj';\r\nimport {Circle as CircleStyle, Fill, Stroke, Text, Style, Icon} from 'ol/style';\r\nimport * as olCoordinate from 'ol/coordinate';\r\nimport * as olGeom from 'ol/geom';\r\nimport {fromExtent} from 'ol/geom/Polygon'\r\nimport * as olFormat from 'ol/format';\r\nimport Feature from 'ol/Feature';\r\nimport * as olInteraction from 'ol/interaction';\r\nimport {altKeyOnly, click, pointerMove} from 'ol/events/condition';\r\n//openlayers plugins\r\nimport LoadingPanel from 'ol-loadingpanel';\r\nimport 'ol-loadingpanel/src/ol-loadingpanel.css';\r\nimport LayerSwitcher from 'ol-layerswitcher';\r\nimport 'ol-layerswitcher/dist/ol-layerswitcher.css';\r\nimport Popup from 'ol-popup';\r\nimport 'ol-popup/src/ol-popup.css';\r\nimport ol_layer_AnimatedCluster from 'ol-ext/layer/AnimatedCluster.js'; window.AnimatedCluster = ol_layer_AnimatedCluster;\r\nimport ol_interaction_SelectCluster from 'ol-ext/interaction/SelectCluster.js'; window.SelectCluster = ol_interaction_SelectCluster;\r\n//filesaver\r\nimport saveAs from 'file-saver';\r\n//statistics\r\nimport * as stats from 'simple-statistics';\r\n//colorbrewer\r\nimport colorbrewer from 'colorbrewer/index.js';\r\nwindow.colorbrewer = colorbrewer;\r\n//ofv\r\nimport OpenFairLayerSwitcher from './OpenFairLayerSwitcher.js';\r\nimport OpenFairShiny from './OpenFairShiny.js';\r\nimport './OpenFairViewer.css';\r\n\r\n\r\n\r\nvar bootstrapButton = $.fn.button.noConflict(); // return $.fn.button to previously assigned value\r\n$.fn.bootstrapBtn = bootstrapButton ;\r\n\r\n/**\r\n * @classdesc\r\n * OpenFairViewer\r\n */\r\nclass OpenFairViewer {\r\n\t\r\n\t/**\r\n\t * @param {Object} The OpenFairViewer config.\r\n\t * @param {Object} options\r\n\t *\r\n\t */\r\n\tconstructor(config, opt_options){\r\n\t\t\r\n\t\tvar this_ = this;\r\n\t\t\r\n\t\t//version\r\n\t\tthis.versioning = {VERSION: \"2.7.8\", DATE: new Date('2022-12-01')}\r\n\t\t\r\n\t\t//protocol\r\n\t\tthis.protocol = window.origin.split(\"://\")[0];\r\n\t\tthis.secure = this.protocol == \"https\";\r\n\t\t\r\n\t\t//Cesium 3D support?\r\n\t\tthis.enable_3d = window.Cesium != undefined;\r\n\t\t\r\n\t\t//set-up application labels\r\n\t\tthis.initApplicationLanguage(config, opt_options).then(function(labels){\t\r\n\t\t\tthis_.initApplicationConfig(config, opt_options, labels);\r\n\t\t\tthis_.init(true);\r\n\t\t});\r\n\t\t\r\n\t}\r\n\t\r\n\t/**\r\n\t * @param {Object} The OpenFairViewer config.\r\n\t * @param {Object} opt_options\r\n\t * @return a Jquery promise\r\n\t */\t\r\n\tinitApplicationLanguage(config, opt_options){\r\n\t\tvar options = opt_options || {};\r\n\t\tvar this_ = this;\r\n\t\t\r\n\t\tvar language_auto = true;\r\n\t\tvar language_default = 'en';\r\n\t\tif(options.language){\r\n\t\t\tconsole.log(options.language);\r\n\t\t\tif(typeof options.language.auto != \"undefined\") language_auto = options.language.auto;\r\n\t\t\tif(options.language.default) language_default = options.language.default;\r\n\t\t}\r\n\t\t\r\n\t\tvar url = './i18n/'+language_default+'.json';\r\n\t\tif(language_auto){\r\n\t\t\tconsole.log(\"Language auto mode enabled\");\r\n\t\t\tvar lang = navigator.language || navigator.userLanguage;\r\n\t\t\tswitch(lang.substr(0,2)){\r\n\t\t\t\tcase \"fr\": url = './i18n/fr.json'; break;\r\n\t\t\t\tcase \"en\": url = './i18n/en.json'; break;\r\n\t\t\t\tcase \"es\": url = './i18n/es.json'; break;\r\n\t\t\t\tdefault: url = './i18n/'+language_default+'.json'; break;\r\n\t\t\t}\r\n\t\t\tconsole.log(\"Browser language '\"+lang+\"' detected -> Load labels from JSON file '\"+url+\"'\");\r\n\t\t}\r\n\t\tif(options.labels) if(options.labels.file) {\r\n\t\t\turl = options.labels.file;\r\n\t\t}\r\n\t\tconsole.log(\"Use language labels from JSON file: '\"+url+\"'\");\r\n\t\tvar deferred = $.Deferred();\r\n\t\t$.ajax({\r\n\t\t\ttype: 'GET',\r\n\t\t\turl: url, \r\n\t\t\tsuccess: function(labels){\r\n\t\t\t\tdeferred.resolve(labels);\r\n\t\t\t}\r\n\t\t});\r\n\t\treturn deferred.promise();\r\n\t}\r\n\t\r\n\t/**\r\n\t * @param {Object} The OpenFairViewer config.\r\n\t * @param {Object} opt_options\r\n\t * @param {Object} labels\r\n\t *\r\n\t */\r\n\tinitApplicationConfig(config, opt_options, labels){\r\n\t\t\r\n\t\tvar this_ = this;\r\n\r\n\t\t//CSW\r\n\t\tif(!config.OGC_CSW_BASEURL){\r\n\t\t\talert(\"OpenFairViewer cannot be instantiated. Missing CSW endpoint\")\r\n\t\t}\r\n\t\tthis.config = config;\r\n\t\tthis.config.OFV_ID = config.id? config.id : 'OFV';\r\n\t\tvar defaultProfile = {\r\n\t\t\tabout: 'About OpenFairViewer'\r\n\t\t};\r\n\t\tthis.config.OFV_PROFILE = config.profile? config.profile : defaultProfile;\r\n\t\tthis.config.OFV_CONTAINERID = config.containerId? config.containerId : \"body\";\r\n\t\tthis.config.OGC_CSW_VERSION = \"2.0.2\";\r\n\t\tthis.config.OGC_CSW_SCHEMA = \"http://www.isotc211.org/2005/gmd\";\r\n\t\tthis.config.OGC_CSW_MAXRECORDS = 5;\r\n\t\tthis.config.OGC_FILTER_VERSION = null;\r\n\t\tthis.config.OGC_OWS_FILTER_SCHEMAS =  [];\r\n\t\tswitch(this.config.OGC_CSW_VERSION){\r\n\t\t\tcase \"2.0.2\":\r\n\t\t\t\tthis.config.OGC_FILTER_VERSION = \"1.1.0\"; \r\n\t\t\t\tthis.config.OGC_FILTER_SCHEMAS = [CSW_2_0_2]; \r\n\t\t\t\tbreak;\r\n\t\t\tcase \"3.0.0\": \r\n\t\t\t\tthis.config.OGC_FILTER_VERSION = \"2.0\";\r\n\t\t\t\tthis.config.OGC_FILTER_SCHEMAS = [CSW_3_0];\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t\t\r\n\t\tvar options = opt_options || {};\r\n\t\tthis.options = {};\r\n\t\t\r\n\t\t//oninit\r\n\t\tif(options.oninit) this.options.oninit = options.oninit;\r\n\t\t\r\n\t\t//LABELS\r\n\t\t//--------------------------------------------------------------------------------------------------\r\n\t\tthis.options.labels = labels;\r\n\t\t//apply option labels if defined\r\n\t\tif(options.labels) if(options.labels.terms){\r\n\t\t\tObject.keys(this_.options.labels).forEach(function(label){\r\n\t\t\t\tif(options.labels[label]) this_.options.labels[label] = options.labels.terms[label];\r\n\t\t\t});\r\n\t\t}\r\n\t\t\r\n\t\t//FIND options\r\n\t\t//--------------------------------------------------------------------------------------------------\r\n\t\tthis.options.find = {};\r\n\t\tthis.options.find.maxitems = null;\r\n\t\tthis.options.find.filter = undefined;\r\n\t\tthis.options.find.filterByWMS = false;\r\n\t\tthis.options.find.datasetInfoHandler = function(metadata){\r\n\t\t\tvar datasetInfoUrl = this_.csw.url + \"?service=CSW&request=GetRecordById&Version=2.0.2&elementSetName=full&outputSchema=http://www.isotc211.org/2005/gmd&id=\" + metadata.fileIdentifier;\r\n\t\t\twindow.open(datasetInfoUrl, '_blank');\r\n\t\t}\r\n\t\tthis.options.find.facets = [];\r\n\t\tif(options.find){\r\n\t\t\tif(options.find.maxitems) this.options.find.maxitems = options.find.maxitems;\r\n\t\t\tif(options.find.filter) this.options.find.filter = options.find.filter;\r\n\t\t\tif(options.find.datasetInfoHandler) this.options.find.datasetInfoHandler = options.find.datasetInfoHandler;\r\n\t\t\tif(options.find.filterByWMS){\r\n\t\t\t\tthis.options.find.filterByWMS = options.find.filterByWMS;\r\n\t\t\t\tvar wmsFilter = new IsLike(this.config.OGC_FILTER_VERSION, this.config.OGC_FILTER_SCHEMAS, 'csw:OnlineResourceType', '%WMS%');\r\n\t\t\t\tif(typeof this.options.find.filter == \"undefined\"){\r\n\t\t\t\t\tthis.options.find.filter = wmsFilter;\r\n\t\t\t\t}else{\r\n\t\t\t\t\tthis.options.find.filter = new And(this.config.OGC_FILTER_VERSION, this.config.OGC_FILTER_SCHEMAS, [this.options.find.filter, wmsFilter]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif(options.find.facets) if(options.find.facets.length > 0){\r\n\t\t\t\tthis.options.find.facets = options.find.facets;\r\n\t\t\t\t$(\"#find-facets-title\").show();\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\t//spatial coverage vector layer params\r\n\t\tthis.options.find.defaultStyle = new Style({\r\n\t\t   fill : new Fill({color: [0, 153, 255, 0.5]}),\r\n\t\t   stroke : new Stroke({color : [0, 153, 255, 1], width: 2})\r\n\t\t});\r\n\t\tthis.options.find.selectStyle = new Style({\r\n\t\t   fill : new Fill({color: [255, 255, 255, 0.8]}),\r\n\t\t   stroke : new Stroke({color : [0, 153, 255, 1], width: 2})\r\n\t\t});\r\n\t\tthis.options.find.hoverStyle = new Style({\r\n\t\t   image: new CircleStyle({\r\n\t\t\t    radius: 3,\r\n\t\t\t\tfill : new Fill({color: [255, 255, 255, 0.2]}),\r\n\t\t\t\tstroke : new Stroke({color : [0, 153, 255, 1], width: 2})\r\n\t\t   }),\r\n\t\t   fill : new Fill({color: [255, 255, 255, 0.2]}),\r\n\t\t   stroke : new Stroke({color : [0, 153, 255, 1], width: 2})\r\n\t\t});\r\n\t\t\r\n\t\t//QUERY options\r\n\t\t//--------------------------------------------------------------------------------------------------\r\n\t\t\r\n\t\t//Access\r\n\t\tthis.options.access = {};\r\n\t\tthis.options.access.columns = 2;\r\n\t\tthis.options.access.time = 'datePicker';\r\n\t\tthis.options.access.values_to_exclude_for = null;\r\n\t\tif(options.access){\r\n\t\t\tif(options.access.columns){\r\n\t\t\t\tif([1,2].indexOf(options.access.columns) != -1) this.options.access.columns = options.access.columns;\r\n\t\t\t}\r\n\t\t\tif(options.access.time) this.options.access.time = options.access.time;\r\n\t\t\tif(options.access.values_to_exclude_for) this.options.access.values_to_exclude_for = options.access.values_to_exclude_for;\r\n\t\t}\r\n\t\t\r\n\t\t//dashboard\r\n\t\tthis.options.access.dashboard = {};\r\n\t\tthis.options.access.dashboard.enabled = true;\r\n\t\t//Set default handlers\r\n\t\tthis.options.access.dashboard.handlers = new Array();\r\n\t\t//handler option\r\n\t\tif(options.access) if(options.access.dashboard) {\r\n\t\t\tif(options.access.dashboard.enabled) this.options.access.dashboard.enabled = options.access.dashboard.enabled;\r\n\t\t\tif(options.access.dashboard.handlers) this.options.access.dashboard.handlers = options.access.dashboard.handlers;\r\n\t\t}\r\n\t\t\r\n\r\n\t\t//MAP options\r\n\t\t//--------------------------------------------------------------------------------------------------\r\n\t\tthis.options.map = {};\r\n\t\t//mode\r\n\t\tthis.options.map.mode = '2D';\r\n\t\t//controls\r\n\t\tthis.options.map.control_options = {};\r\n\t\tthis.options.map.control_options.loadingpanel = {widget: 'progressbar'};\r\n\t\tif(options.map) if(options.map.control_options){\r\n\t\t\tif(options.map.control_options.loadingpanel) this.options.map.control_options.loadingpanel = options.map.control_options.loadingpanel;\r\n\t\t}\r\n\t\t//watermark\r\n\t\tthis.options.map.attribution = null;\r\n\t\tif(options.map) this.options.map.attribution = options.map.attribution? options.map.attribution : null;\r\n\t\t//projections\r\n\t\tthis.options.map.projection = 'EPSG:4326';\r\n\t\tthis.options.map.proj4defs = [\r\n\t\t\t{epsgcode: \"EPSG:4326\", proj4string: \"+proj=longlat +datum=WGS84 +no_defs\"},\r\n\t\t\t{epsgcode: \"EPSG:3031\", proj4string: \"+proj=stere +lat_0=-90 +lat_ts=-71 +lon_0=0 +k=1 +x_0=0 +y_0=0 +datum=WGS84 +units=m +no_defs\"},\r\n\t\t\t{epsgcode: \"EPSG:2154\", proj4string: \"+proj=lcc +lat_1=49 +lat_2=44 +lat_0=46.5 +lon_0=3 +x_0=700000 +y_0=6600000 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs\"}\r\n\t\t];\r\n\t\tif(options.map) {\r\n\t\t\tif(options.map.mode) if(['2D', '3D'].indexOf(options.map.mode) != -1) this.options.map.mode = options.map.mode;\r\n\t\t\tif(options.map.projection) this.options.map.projection = options.map.projection;\r\n\t\t\tif(options.map.proj4defs) for(var p = 0; p < options.map.proj4defs.length; p++) this.options.map.proj4defs.push(options.map.proj4defs[p]);\r\n\t\t\tfor(var i=0;i<this.options.map.proj4defs.length;i++){\r\n\t\t\t\tvar proj4def = this.options.map.proj4defs[i];\r\n\t\t\t\tproj4.defs(proj4def.epsgcode, proj4def.proj4string);\r\n\t\t\t}\r\n\t\t\tregister(proj4);\r\n\t\t}\r\n\t\t//vectorizing/clustering\r\n\t\tthis.options.map.point_vectorizing = false;\r\n\t\tthis.options.map.point_clustering = false;\r\n\t\tthis.options.map.point_clustering_options = {\r\n\t\t\tdistance: 50,\r\n\t\t\tpointRadius : 15,\r\n\t\t\tradiusFactor: 1.3,\r\n\t\t\tspiral : true,\r\n\t\t\tcircleMaxObjects : 10,\r\n\t\t\tanimate : true, \r\n\t\t\tanimationDuration: 700,\r\n\t\t\tstyle: function(feature, resolution){\r\n\t\t\t\tvar styleText = feature.get('features')? (feature.get('features').length == 1? '' : feature.get('features').length.toString()) : '';\r\n\t\t\t\treturn new Style({\r\n\t\t\t\t\timage: new CircleStyle ({\r\n\t\t\t\t\t  stroke: new Stroke({ color: \"rgba(0,0,192,0.5)\", width:2 }),\r\n\t\t\t\t\t  fill: new Fill({ color: \"rgba(0,0,192,0.3)\" }),\r\n\t\t\t\t\t  radius: (styleText == ''? 5 : 8)\r\n\t\t\t\t\t}),\r\n\t\t\t\t\ttext: new Text({\r\n\t\t\t\t\t\ttext: styleText,\r\n\t\t\t\t\t\t//font: 'bold 12px comic sans ms',\r\n\t\t\t\t\t\t//textBaseline: 'top',\r\n\t\t\t\t\t\tfill: new Fill({\r\n\t\t\t\t\t\t  color: '#fff'\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t})\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\tselectClusterFeatureStyle: function(feature, resolution){\t\t\t\t\t\r\n\t\t\t\tvar styles = [\r\n\t\t\t\t\tnew Style({\r\n\t\t\t\t\t   image: new CircleStyle({\r\n\t\t\t\t\t\t\tradius: 3,\r\n\t\t\t\t\t\t\tfill : new Fill({color: [255, 255, 255, 0.2]}),\r\n\t\t\t\t\t\t\tstroke : new Stroke({color : \"orange\", width: 3})\r\n\t\t\t\t\t   }),\r\n\t\t\t\t\t   fill : new Fill({color: [255, 255, 255, 0.2]}),\r\n\t\t\t\t\t   stroke : new Stroke({color : \"gray\", width: 1, lineDash: [4,4]})\r\n\t\t\t\t\t})\r\n\t\t\t\t];\r\n\t\t\t\treturn styles;\r\n\t\t\t},\r\n\t\t\tselectClusterStyle: function(feature, resolution){\r\n\t\t\t\tvar styleText = feature.get('features')? (feature.get('features').length == 1? '' : feature.get('features').length.toString()) : '';\r\n\t\t\t\treturn [\r\n\t\t\t\t\tnew Style({\r\n\t\t\t\t\t\timage: new CircleStyle ({\r\n\t\t\t\t\t\t  stroke: new Stroke({ color: \"rgba(0,0,192,0.5)\", width:2 }),\r\n\t\t\t\t\t\t  fill: new Fill({ color: \"rgba(0,0,192,0.3)\" }),\r\n\t\t\t\t\t\t  radius: (styleText == ''? 5 : 8)\r\n\t\t\t\t\t\t}),\r\n\t\t\t\t\t\ttext: new Text({\r\n\t\t\t\t\t\t\ttext: styleText,\r\n\t\t\t\t\t\t\t//font: 'bold 12px comic sans ms',\r\n\t\t\t\t\t\t\t//textBaseline: 'top',\r\n\t\t\t\t\t\t\tfill: new Fill({\r\n\t\t\t\t\t\t\t  color: '#fff'\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t})\r\n\t\t\t\t];\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(options.map){\r\n\t\t\tif(options.map.point_vectorizing) this.options.map.point_vectorizing = options.map.point_vectorizing;\r\n\t\t\tif(options.map.point_clustering) this.options.map.point_clustering = options.map.point_clustering;\r\n\t\t\tif(options.map.point_clustering_options) {\r\n\t\t\t\tif(options.map.point_clustering_options.distance) this.options.map.point_clustering_options.distance = options.map.point_clustering_options.distance;\r\n\t\t\t\tif(options.map.point_clustering_options.pointRadius) this.options.map.point_clustering_options.pointRadius = options.map.point_clustering_options.pointRadius;\r\n\t\t\t\tif(options.map.point_clustering_options.radiusFactor) this.options.map.point_clustering_options.radiusFactor = options.map.point_clustering_options.radiusFactor;\r\n\t\t\t\tif(options.map.point_clustering_options.spiral) this.options.map.point_clustering_options.spiral = options.map.point_clustering_options.spiral;\r\n\t\t\t\tif(options.map.point_clustering_options.circleMaxObjects) this.options.map.point_clustering_options.circleMaxObjects = options.map.point_clustering_options.circleMaxObjects;\r\n\t\t\t\tif(options.map.point_clustering_options.animate) this.options.map.point_clustering_options.animate = options.map.point_clustering_options.animate ;\r\n\t\t\t\tif(options.map.point_clustering_options.animationDuration) this.options.map.point_clustering_options.animationDuration = options.map.point_clustering_options.animationDuration;\r\n\t\t\t\tif(options.map.point_clustering_options.style) this.options.map.point_clustering_options.style = options.map.point_clustering_options.style;\r\n\t\t\t\tif(options.map.point_clustering_options.selectClusterFeatureStyle) this.options.map.point_clustering_options.selectClusterFeatureStyle = options.map.point_clustering_options.selectClusterFeatureStyle;\r\n\t\t\t\tif(options.map.point_clustering_options.selectClusterStyle) this.options.map.point_clustering_options.selectClusterStyle = options.map.point_clustering_options.selectClusterStyle;\r\n\t\t\t}\r\n\t\t}\r\n\t\t\t\r\n\t\t//zoom\r\n\t\tthis.options.map.zoom = 3;\r\n\t\tif(options.map) this.options.map.zoom = options.map.zoom? options.map.zoom : 3;\r\n\t\t//extent\r\n\t\tthis.options.map.extent = undefined;\r\n\t\tif(options.map) if(options.map.extent){\r\n\t\t\tif(!(options.map.extent instanceof Array)){\r\n\t\t\t\tconsole.error(\"Map extent should be an array\");\r\n\t\t\t}else{\r\n\t\t\t\tif(options.map.extent.length != 4){\r\n\t\t\t\t\tconsole.error(\"Map extent array should be of length 4\");\r\n\t\t\t\t}else{\r\n\t\t\t\t\tthis.options.map.extent = options.map.extent;\t\r\n\t\t\t\t}\r\n\t\t\t}\t\r\n\t\t}\r\n\t\t//layergroups\r\n\t\tthis.options.map.baselayergroup = {name: this_.options.labels.basemaps, fold: 'open'};\r\n\t\tif(options.map) if(options.map.baselayergroup) {\r\n\t\t\tthis.options.map.baselayergroup = options.map.baselayergroup;\r\n\t\t}\r\n\t\tthis.options.map.layergroups = [{name: \"Base overlays\", fold: 'open'},{name: \"Statistical maps\", fold: 'open'}];\r\n\t\tif(options.map) if(options.map.layergroups){\r\n\t\t\tthis.options.map.layergroups = options.map.layergroups;\r\n\t\t}\r\n\t\t//statistics layergroup\r\n\t\tthis.options.map.mainlayergroup = this.options.map.layergroups.length-1;\r\n\t\tif(options.map) if(options.map.mainlayergroup){\r\n\t\t\tthis.options.map.mainlayergroup = options.map.mainlayergroup;\r\n\t\t}\r\n\t\t//baselayers\r\n\t\tthis.options.map.baselayers = [\r\n\t\t\tnew TileLayer({\r\n\t\t\t\ttitle: \"EMODnet Bathymetry World baselayer\",\r\n\t\t\t\t//extent: [-180,-90,180,90],\r\n\t\t\t\ttype: 'base',\r\n\t\t\t\tsource : new WMTS({\r\n\t\t\t\t\turl : 'https://tiles.emodnet-bathymetry.eu/2020/{Layer}/{TileMatrixSet}/{TileMatrix}/{TileCol}/{TileRow}.png',\r\n\t\t\t\t\tlayer : 'baselayer',\r\n\t\t\t\t\trequestEncoding : 'REST',\r\n\t\t\t\t\tmatrixSet : 'inspire_quad',\r\n\t\t\t\t\tformat : 'image/png',\r\n\t\t\t\t\tprojection : \"EPSG:4326\",\r\n\t\t\t\t\ttileGrid : this_.inspireWgs84Grid(12, '')\r\n\t\t\t\t})\r\n\t\t\t}),\r\n\t\t\tnew TileLayer({\r\n\t\t\t\ttitle : \"UN Clear Map (Dark)\",\r\n\t\t\t\ttype: 'base',\r\n\t\t\t\tsource : new TileArcGISRest({\t\t\t\t\t\t\t\r\n\t\t\t\t\turl: 'https://geoservices.un.org/arcgis/rest/services/ClearMap_Dark/MapServer',\r\n\t\t\t\t\tcrossOrigin: 'anonymous',\r\n\t\t\t\t\twrapX: true\r\n\t\t\t\t})\r\n\t\t\t}),\r\n\t\t\tnew TileLayer({\r\n\t\t\t\ttitle : \"UN Clear Map\",\r\n\t\t\t\ttype: 'base',\r\n\t\t\t\tsource : new TileArcGISRest({\t\t\t\t\t\t\t\r\n\t\t\t\t\turl: 'https://geoservices.un.org/arcgis/rest/services/ClearMap_Topo/MapServer',\r\n\t\t\t\t\tcrossOrigin: 'anonymous',\r\n\t\t\t\t\twrapX: true\r\n\t\t\t\t})\r\n\t\t\t}),\r\n\t\t\tnew TileLayer({\r\n\t\t\t\ttitle: \"OpenStreetMaps\",\r\n\t\t\t\ttype: 'base',\r\n\t\t\t\tsource: new OSM()\r\n\t\t\t}),\r\n\t\t\tnew TileLayer({\r\n\t\t\t\ttitle : \"World Imagery\",\r\n\t\t\t\ttype: 'base',\r\n\t\t\t\tsource : new XYZ({\r\n\t\t\t\t\tprojection: olProj.get(this_.options.map.projection),\r\n\t\t\t\t\turl: 'https://wi.maptiles.arcgis.com/arcgis/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}',\r\n\t\t\t\t\ttileSize: 256, // the tile size supported by the ArcGIS tile service\r\n\t\t\t\t\tmaxResolution: 180 / 256, // Esri's tile grid fits 180 degrees on one 512 px tile\r\n\t\t\t\t\tcrossOrigin: 'anonymous',\r\n\t\t\t\t\twrapX: true\r\n\t\t\t\t})\r\n\t\t\t})\r\n\t\t];\r\n\t\tif(options.map) if(options.map.baselayers) this.options.map.baselayers = options.map.baselayers;\r\n\t\t//overlays\r\n\t\tthis.options.map.overlays = [];\r\n\t\tif(options.map) if(options.map.overlays) this.options.map.overlays = options.map.overlays;\r\n\t\t//layer_options\r\n\t\tthis.options.map.layer_options = {};\r\n\t\tthis.options.map.layer_options.tiled = true;\r\n\t\tthis.options.map.layer_options.opacity = 0.9;\r\n\t\tif(options.map) if(options.map.layer_options){\r\n\t\t\tif(options.map.layer_options.tiled) this.options.map.layer_options.tiled = options.map.layer_options.tiled;\r\n\t\t\tif(options.map.layer_options.opacity) this.options.map.layer_options.opacity = options.map.layer_options.opacity;\r\n\t\t}\t\r\n\r\n\t\t//thematic options\r\n\t\tthis.options.map.thematicmapping_options = {\r\n\t\t\tbreaks: [\"\",\" to \",\"\"],\r\n\t\t\tthresholding : true,\r\n\t\t\tthreshold : \"> 0\"\r\n\t\t}\r\n\t\tif(options.map) if(options.map.thematicmapping_options){\r\n\t\t\t//breaks\r\n\t\t\tif(options.map.thematicmapping_options.breaks){\r\n\t\t\t\tif(!(options.map.thematicmapping_options.breaks instanceof Array)){\r\n\t\t\t\t\tconsole.error(\"Styling breaks should be an array\");\r\n\t\t\t\t}else{\r\n\t\t\t\t\tif(options.map.thematicmapping_options.breaks.length != 3){\r\n\t\t\t\t\t\tconsole.error(\"Styling breaks array should be of length 3\");\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\tthis.options.map.thematicmapping_options.breaks = options.map.thematicmapping_options.breaks;\t\t\r\n\t\t\t\t\t}\r\n\t\t\t\t}\t\t\t\r\n\t\t\t}\r\n\t\t\t//threshold\r\n\t\t\tif(options.map.thematicmapping_options.thresholding) this.options.map.thematicmapping_options.thresholding = options.map.thematicmapping_options.thresholding;\r\n\t\t\tif(options.map.thematicmapping_options.threshold) this.options.map.thematicmapping_options.threshold = options.map.thematicmapping_options.threshold;\r\n\t\t}\r\n\t\t\r\n\t\t//popup\r\n\t\tthis.options.map.popup = {};\r\n\t\tthis.options.map.popup.mode = 'map';\r\n\t\tthis.options.map.popup.enabled = true;\t\r\n\t\tthis.options.map.popup.onopen = function(layer, features){};\r\n\t\tthis.options.map.popup.onclose = function(layer, features){};\r\n\t\t\r\n\t\t//default handlers\r\n\t\tthis.options.map.popup.DEFAULT_HANDLER = function(layer, features){\r\n\t\t\tconsole.log(layer);\r\n\t\t\tconsole.log(features);\r\n\t\t\tconsole.log(\"Inherit DSD from layer in popup\");\r\n\t\t\tconsole.log(layer.dsd);\r\n\t\t\t\r\n\t\t\t//patterns\r\n\t\t\tvar regexps = {\r\n\t\t\t  DATE: new RegExp(\"^([1-9][0-9]{3})-(1[0-2]|0[1-9])-(3[01]|0[1-9]|[12][0-9])?$\"),\r\n\t\t\t  DATETIME: new RegExp(\"^(-?(?:[1-9][0-9]*)?[0-9]{4})-(1[0-2]|0[1-9])-(3[01]|0[1-9]|[12][0-9])T(2[0-3]|[01][0-9]):([0-5][0-9]):([0-5][0-9])(.[0-9]+)?(Z)?$\")\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t//featureHandler\r\n\t\t\tvar featureHandler = function(layer, feature){\r\n\t\t\t\tvar props = feature.getProperties();\r\n\t\t\t\tconsole.log(props);\r\n\t\t\t\tvar html = '<table class=\"table table-condensed\">';\r\n\t\t\t\tvar propNames = Object.keys(props);\r\n\t\t\t\t//text fields\r\n\t\t\t\tfor(var i=0;i<propNames.length;i++){\r\n\t\t\t\t\tvar propName = propNames[i];\r\n\t\t\t\t\tif(propName == \"boundedBy\") continue;\r\n\t\t\t\t\tvar prop = props[propName];\r\n\t\t\t\t\tif(prop){\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t  var propFromDsd = null;\r\n\t\t\t\t\t\r\n\t\t\t\t\t  //propName\r\n\t\t\t\t\t  var propNameLabel = '<b>'+propName+'</b>';\r\n\t\t\t\t\t  if(layer.dsd) {\r\n\t\t\t\t\t\tpropFromDsd = layer.dsd.filter(function(item){if(item.primitiveCode == propName) return item});\r\n\t\t\t\t\t\tif(propFromDsd.length > 0) {\r\n\t\t\t\t\t\t\tpropFromDsd = propFromDsd[0];\r\n\t\t\t\t\t\t\tpropNameLabel = '<b>' + propFromDsd.name + '</b> <span class=\"dsd-ui-item-code\">['+propFromDsd.primitiveCode+']</span>';\r\n\t\t\t\t\t\t\tif(propFromDsd.definition) if(propFromDsd.definition.length > 0) propNameLabel += ' <span class=\"glyphicon glyphicon-info-sign attribute-info\" title=\"'+propFromDsd.definition+'\"></span>'\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t  }\r\n\t\t\t\t\t\r\n\t\t\t\t\t  if(typeof prop == \"string\") if(prop.indexOf(\"http\")==0){\r\n\t\t\t\t\t\tprop = '<a href=\"'+prop+'\" target=\"_blank\" style=\"color:#337ab7\">Link</a>';\r\n\t\t\t\t\t  }\r\n\r\n\t\t\t\t\t  var isBase64 = false; if(typeof prop == \"string\") isBase64 = prop.startsWith('base64:') || prop.startsWith('data:image/png;base64,');\r\n\t\t\t\t\t  var isDate = false; if(typeof prop == \"string\") isDate = prop.match(regexps.DATE) != null;\r\n\t\t\t\t\t  var isDateTime = false; if(typeof prop == \"string\") isDateTime = prop.match(regexps.DATETIME) != null;\r\n\t\t\t\t\t  if(typeof prop != \"undefined\" && !(prop instanceof olGeom.Geometry)) if(!isBase64) {\r\n\t\t\t\t\t\tvar propToDisplay = prop;\r\n\t\t\t\t\t\tif(isDateTime){\r\n\t\t\t\t\t\t\tvar date = new Date(Date.parse(prop));\r\n\t\t\t\t\t\t\tpropToDisplay = date.toISOString().split(\"T\")[0] + 'T' + date.toLocaleTimeString();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\thtml += '<tr><td>' + propNameLabel + \"</td><td>\" + propToDisplay;\r\n\t\t\t\t\t\tif(propFromDsd) if(propFromDsd.uom) {\r\n\t\t\t\t\t\t\thtml += ' '+ propFromDsd.uom;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif(isDate || isDateTime){\r\n\t\t\t\t\t\t\thtml += '<button style=\"margin: 0px 10px;font-size:inherit;\" class=\"btn btn-xs\" ';\r\n\t\t\t\t\t\t\thtml += 'onclick=\"'+this_.config.OFV_ID+'.getNextFeatureInfoInTime(\\''+layer.id+'\\',\\''+layer.baseDataUrl+'\\',\\'1.0.0\\',\\''+layer.getSource().getParams().LAYERS+'\\',\\''+propName+'\\',\\''+prop+'\\')\">Next</button>';\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\thtml += \"</td></tr>\";\r\n\t\t\t\t\t  }\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\t//image fields\r\n\t\t\t\tvar imgPropNames = propNames.filter(function(propName){\r\n\t\t\t\t\tvar prop = props[propName];\r\n\t\t\t\t\tif(typeof prop == 'undefined') return false;\r\n\t\t\t\t\tvar isBase64 = false;\r\n\t\t\t\t\tif(typeof prop == \"string\") isBase64 = prop.startsWith('base64:') || prop.startsWith('data:image/png;base64,');\r\n\t\t\t\t\tif(isBase64) return propName;\r\n\t\t\t\t});\r\n\t\t\t\tif(imgPropNames.length>0){\r\n\t\t\t\t  html += \"<tr><td><b>Images</b></td><td>\";\r\n\t\t\t\t  for(var i=0;i<imgPropNames.length;i++){\r\n\t\t\t\t\tvar imgPropName = imgPropNames[i];\r\n\t\t\t\t\tvar prop = props[imgPropName];\r\n\t\t\t\t\tif(prop.startsWith('base64:')) prop = 'data:image/png;base64,' + prop.split('base64:')[1];\r\n\t\t\t\t\thtml += '<img src=\"'+prop+'\" width=\"45%\" style=\"margin:2px;\" alt=\"'+imgPropName+'\" title=\"'+imgPropName+'\"/>';\r\n\t\t\t\t  }\r\n\t\t\t\t  html += '</td></tr>';\r\n\t\t\t\t}\r\n\t\t\t\thtml += '</table>';\r\n\t\t\t\treturn html;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif(features.length == 1){\r\n\t\t\t\treturn featureHandler(layer, features[0]);\r\n\t\t\t}else{\r\n\t\t\t\treturn features.map(function(item){return featureHandler(layer, item)}).join('<br>');\r\n\t\t\t}\r\n\t\t\t\r\n\t\t} \r\n\t\t\r\n\t\t//Set default handler\r\n\t\tthis.options.map.popup.handler = this.options.map.popup.DEFAULT_HANDLER;\r\n\t\t//popup handler option\r\n\t\tif(options.map) if(options.map.popup) {\r\n\t\t\tif(options.map.popup.mode) this.options.map.popup.mode = options.map.popup.mode;\r\n\t\t\tif(options.map.popup.enabled) this.options.map.popup.enabled = options.map.popup.enabled;\r\n\t\t\tif(options.map.popup.handler) this.options.map.popup.handler = options.map.popup.handler;\r\n\t\t\tif(options.map.popup.onopen) this.options.map.popup.onopen = options.map.popup.onopen;\r\n\t\t\tif(options.map.popup.onclose) this.options.map.popup.onclose = options.map.popup.onclose;\r\n\t\t}\r\n\t\t\r\n\t\t//cesium\r\n\t\tthis.options.cesium = {};\r\n\t\tthis.options.cesium.defaultAccessToken = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiI1ZWY1NmQzZS1hNzMyLTRlNDMtOTI3Yi1kZWY5ZWZlM2Q0NDUiLCJpZCI6MzcyMTgsImlhdCI6MTYwNDY3NDAyN30.9tFv8RqF2p-oYLTrp-b5AIg5u721Ohh9psMgSJFMY3s';\r\n\t\tif(options.cesium) if(options.cesium.accessToken) this.options.cesium.defaultAccessToken = options.cesium.accessToken;\r\n\t\t\r\n\t\t//events\r\n\t\tthis.mapEvents = new Array();\r\n\r\n\t\t//panels\r\n\t\tthis.options.panel = {}\r\n\t\tif(options.panel) {\r\n\t\t\t\tthis.options.panel.welcome = options.panel.about? options.panel.about : 'aboutDialog2';\t\t\t\t\r\n\t\t}\r\n\t\t\r\n\t\t//datasets caching\r\n\t\tthis.datasets = new Array();\r\n\t\t\r\n\t\t//dataset access export (managed at the end to support config conditions\r\n\t\t//export methods\r\n\t\tthis.options.access.defaultExports = [\r\n\t\t\t{\r\n\t\t\t\t'id': 'data-table',\r\n\t\t\t\t'main': true,\r\n\t\t\t\t'enabled': true,\r\n\t\t\t\t'services': ['wms','wfs'],\r\n\t\t\t\t'title': this.options.labels.tabulardata_title,\r\n\t\t\t\t'handler': this.displayDataTable,\r\n\t\t\t\t'class': 'data-table'\r\n\t\t\t},\r\n\t\t\t/*{\r\n\t\t\t\t'id': 'data-dashboard',\r\n\t\t\t\t'main': true,\r\n\t\t\t\t'enabled': (this.options.access.dashboard.enabled && this.options.access.dashboard.handlers.length > 0),\r\n\t\t\t\t'services': ['wms', 'wfs'],\r\n\t\t\t\t'title': this.options.labels.dashboard_title,\r\n\t\t\t\t'handler': this.displayDashboard,\r\n\t\t\t\t'class': 'data-dashboard'\r\n\t\t\t},*/\r\n\t\t\t{\r\n\t\t\t\t'id': 'data-csv-raw',\r\n\t\t\t\t'main': true,\r\n\t\t\t\t'enabled': true,\r\n\t\t\t\t'services': ['wfs'],\r\n\t\t\t\t'title': this.options.labels.download_data,\r\n\t\t\t\t'handler': this.exportToCSV,\r\n\t\t\t\t'class': 'data-csv-raw'\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\t'id': 'data-png-map',\r\n\t\t\t\t'main': true,\r\n\t\t\t\t'enabled': true,\r\n\t\t\t\t'services': ['wms'],\r\n\t\t\t\t'title': this.options.labels.download_map,\r\n\t\t\t\t'handler': this.exportToPNG,\r\n\t\t\t\t'class': 'data-png-map'\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\t'id': 'data-wfs',\r\n\t\t\t\t'main': false,\r\n\t\t\t\t'enabled': true,\r\n\t\t\t\t'services': ['wfs'],\r\n\t\t\t\t'title': this.options.labels.download_wfs,\r\n\t\t\t\t'handler': this.exportToWFS,\r\n\t\t\t\t'class': 'data-wfs'\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\t'id': 'data-rscript',\r\n\t\t\t\t'main': false,\r\n\t\t\t\t'enabled': true,\r\n\t\t\t\t'services': ['wfs'],\r\n\t\t\t\t'title': this.options.labels.download_rscript,\r\n\t\t\t\t'handler': this.exportToRScript,\r\n\t\t\t\t'class': 'data-rscript'\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\t'id': 'data-jupyter-notebook',\r\n\t\t\t\t'main': false,\r\n\t\t\t\t'enabled': true,\r\n\t\t\t\t'services': ['wfs'],\r\n\t\t\t\t'title': this.options.labels.download_jupyter,\r\n\t\t\t\t'handler': this.exportToRJupyterNotebook,\r\n\t\t\t\t'class': 'data-jupyter-notebook'\r\n\t\t\t}\r\n\t\t];\r\n\t\tthis.options.access.exports = this.options.access.defaultExports;\r\n\t\tif(options.access) if(options.access.exports) {\r\n\t\t\t//overwrite default methods in case they are declared from config\r\n\t\t\tthis.options.access.exports = this.options.access.exports.map(function(item){\r\n\t\t\t\tvar export_method = item;\r\n\t\t\t\toptions.access.exports.forEach(function(added_method){\r\n\t\t\t\t\tif(item.id == added_method.id) export_method = added_method;\r\n\t\t\t\t});\r\n\t\t\t\treturn export_method;\r\n\t\t\t});\r\n\t\t\t//add extra methods?\r\n\t\t\tconsole.log(this_.options.access.exports.map(function(method){return method.id;}));\r\n\t\t\toptions.access.exports.forEach(function(toadd){\r\n\t\t\t\tif(this_.options.access.exports.map(function(method){return method.id;}).indexOf(toadd.id) == -1){\r\n\t\t\t\t\tthis_.options.access.exports.push(toadd);\r\n\t\t\t\t}\r\n\t\t\t});\t\t\t\r\n\t\t}\r\n\t\t\r\n\t\t//main OFV instance object\r\n\t\twindow[this.config.OFV_ID] = this;\r\n\t}\r\n\t\r\n\t\r\n\t/**\r\n\t * OpenFairViewer.prototype.initMarkup\r\n\t *\r\n\t */\r\n\tinitMarkup(intro){\r\n\t\tvar this_ = this;\r\n\t\tvar deferred = $.Deferred();\r\n\t\tthis.loadTemplate('templates/main.tpl.html', 'mainTpl').then(function(template){\r\n\t\t\tvar main = mustache.render(template, {OFV_ID : this_.config.OFV_ID, OFV_PROFILE: this_.config.OFV_PROFILE, labels: this_.options.labels, mode: (this_.options.map.mode == '2D'? '3D':'2D')});\r\n\t\t\tif(this_.config.OFV_CONTAINERID == 'body') main = '<div class=\"wrapper\">' + main + '</div>';\r\n\t\t\tif(intro) $(this_.config.OFV_CONTAINERID == 'body'? 'body' : \"#\"+this_.config.OFV_CONTAINERID).append(main);\r\n\t\t\tthis_.initFindFacets();\r\n\t\t\tdeferred.resolve();\r\n\t\t});\r\n\t\treturn deferred.promise();\r\n\t}\r\n\t\r\n\t/**\r\n\t * init\r\n\t */\r\n\tinit(intro){\r\n\t\tvar this_ = this;\r\n\t\tthis.initMarkup(intro).then(function(){\r\n\t\t\r\n\t\t\tthis_.selection = new Array();\r\n\t\t\tthis_.initBrowseCatalogue();\r\n\t\t\tthis_.initBrowseAdvancedSettings();\r\n\t\t\tthis_.initBrowsePagination();\r\n\t\t\t\t\r\n\t\t\tthis_.initDataViewer();\r\n\t\t\r\n\t\t\t//event on page number selection\r\n\t\t\t$(\"select[id='datasets_length']\").on('change', function() {\r\n\t\t\t  var maxrecords = parseInt(this.value);\r\n\t\t\t  console.log('Browsing '+maxrecords+' records...');\r\n\t\t\t  this_.displayDatasets(maxrecords);\r\n\t\t\t});\r\n\t\t\r\n\t\t\t//get Datasets from CSW\r\n\t\t\tthis_.displayDatasets(this_.config.OGC_CSW_MAXRECORDS);\r\n\t\t\t$(\"#dataset-form\").submit(function(e) {\r\n\t\t\t\te.preventDefault();\r\n\t\t\t\tvar maxrecords = parseInt($(\"select[id='datasets_length']\").val());\r\n\t\t\t\tif($(\"#dataset-search-bbox-on-search\").prop(\"checked\") && $(\"#dataset-search-bbox-on-mapinteraction\").prop(\"checked\")){\r\n\t\t\t\t\tvar bbox = this_.map.getView().calculateExtent(this_.map.getSize());\r\n\t\t\t\t\tthis_.displayDatasets(maxrecords, bbox); \r\n\t\t\t\t}else{\r\n\t\t\t\t\tthis_.displayDatasets(maxrecords); \r\n\t\t\t\t}\r\n\t\t\t\treturn false;\r\n\t\t\t});\r\n\t\t\t\t\t\r\n\t\t\t//init widgets\r\n\t\t\tthis_.initDialog(\"aboutDialog\", this_.options.labels.about,{\"ui-dialog\": \"about-dialog\", \"ui-dialog-title\": \"dialog-title\"}, null, 0);\r\n\t\t\tthis_.initDialog(\"findDialog\", this_.options.labels.find, {\"ui-dialog\": \"find-dialog\", \"ui-dialog-title\": \"dialog-title\"}, { my: \"left top\", at: \"left center\", of: window }, 1);\r\n\t\t\tthis_.initDialog(\"accessDialog\", this_.options.labels.access, {\"ui-dialog\": \"access-dialog\", \"ui-dialog-title\": \"dialog-title\"}, { my: \"left top\", at: \"left center\", of: window }, 2);\r\n\t\t\tthis_.initDialog(\"infoDialog\", this_.options.labels.info, {\"ui-dialog\": \"info-dialog\", \"ui-dialog-title\": \"dialog-title\"}, { my: \"left top\", at: \"left center\", of: window }, 3);\r\n\t\t\tthis_.initDialog(\"dataDialog\", this_.options.labels.tabulardata, {\"ui-dialog\": \"data-dialog\", \"ui-dialog-title\": \"dialog-title\"}, { my: \"left top\", at: \"left center\", of: window }, 4);\r\n\t\t\tthis_.initDialog(\"dashboardDialog\", this_.options.labels.dashboard, {\"ui-dialog\": \"dashboard-dialog\", \"ui-dialog-title\": \"dialog-title\"}, { my: \"left top\", at: \"left center\", of: window }, 5, function(){}, function(){\r\n\t\t\t\t$(\"#dashboard-selector\").val(\"\").trigger(\"change\");\r\n\t\t\t});\r\n\t\t\tthis_.initDialog(\"featureDialog\", this_.options.labels.featureinfo, {\"ui-dialog\": \"feature-dialog\", \"ui-dialog-title\": \"dialog-title\"}, { my: \"right bottom\", at: \"right bottom\", of: window }, 6, function(){}, function(){}, true, true);\r\n\r\n\t\t\tthis_.closeAccessDialog();\r\n\t\t\tthis_.closeDataDialog();\r\n\t\t\tthis_.closeDashboardDialog();\r\n\t\t\tthis_.closeInfoDialog();\r\n\t\t\tthis_.closeFeatureDialog();\r\n\t\t\tthis_.openFindDialog();\r\n\t\t\t\r\n\t\t\tif(intro) this_.openAboutDialog();\r\n\t\t\t\r\n\t\t\t//resolve viewer from URL\r\n\t\t\tthis_.resolveViewer();\r\n\t\t\t\r\n\t\t\t//message listener\r\n\t\t\tthis_.enableMessageListener();\r\n\t\t\t\r\n\t\t\tthis_._copyright();\r\n\t\t\t\r\n\t\t\t//on init\r\n\t\t\tthis_.oninit();\r\n\t\t});\r\n\t}\r\n\t\r\n\toninit(){\r\n\t\tif(this.options.oninit) this.options.oninit();\r\n\t}\r\n\t\r\n\t/**\r\n\t * reset\r\n\t */\r\n\treset(){\r\n\t\tvar mainpage = document.location.href.split('?')[0];\r\n\t\tif(window.history.replaceState){\r\n\t\t\twindow.history.replaceState('', '', mainpage);\r\n\t\t}else{\r\n\t\t\tdocument.location.href = mainpage;\r\n\t\t}\r\n\t\tthis.init(false);\r\n\t}\r\n\t\r\n\t/**\r\n\t * rewriteURL\r\n\t * @param {String} url\r\n\t */\r\n\trewriteURL(url){\r\n\t\tif(window.location.origin.startsWith(\"https\")){\r\n\t\t\turl = url.replace(/^http:\\/\\//i, 'https://');\r\n\t\t}\r\n\t\treturn url;\r\n\t}\r\n\t\r\n\t/**\r\n\t * OpenFairViewer.prototype.getAllUrlParams util function to get URL param valus\r\n\t * Here the primary use is to be able to grab a security token that would be\r\n\t * passed from within a i-Marine VRE portlet\r\n\t * @param url\r\n\t * @returns an object with all parameter values\r\n\t */\r\n\tgetAllUrlParams(url) {\r\n\t\tvar queryString = url ? url.split('?')[1] : window.location.search.slice(1);\r\n\r\n\t\tvar obj = {};\r\n\t\tif (queryString) {\r\n\t\t\tqueryString = queryString.split('#')[0];\r\n\t\t\tvar arr = queryString.split('&');\r\n\t\t\tfor (var i=0; i<arr.length; i++) {\r\n\t\t\t  var a = arr[i].split('=');\r\n\t\t\t  var paramNum = undefined;\r\n\t\t\t  var paramName = a[0].replace(/\\[\\d*\\]/, function(v) {\r\n\t\t\t\tparamNum = v.slice(1,-1);\r\n\t\t\t\treturn '';\r\n\t\t\t  });\r\n\t\t\t  var paramValue = typeof(a[1])==='undefined' ? true : a[1];\r\n\r\n\t\t\t  if (obj[paramName]) {\r\n\t\t\t\tif (typeof obj[paramName] === 'string') {\r\n\t\t\t\t  obj[paramName] = [obj[paramName]];\r\n\t\t\t\t}\r\n\t\t\t\tif (typeof paramNum === 'undefined') {\r\n\t\t\t\t  obj[paramName].push(paramValue);\r\n\t\t\t\t}else {\r\n\t\t\t\t  obj[paramName][paramNum] = paramValue;\r\n\t\t\t\t}\r\n\t\t\t  }else {\r\n\t\t\t\tobj[paramName] = paramValue;\r\n\t\t\t  }\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn obj;\r\n\t}\r\n\t\r\n\t/**\r\n\t * setEmbedLink\r\n\t */\r\n\tsetEmbedLink(){\r\n\t\tif ( ! ( document.getElementById ) ) return void(0);\r\n\t\tvar url = location.href.replace(/#.*$/,'').replace(/\\?.*$/,'');\r\n\t\turl += '?';\r\n\t\t\r\n\t\tvar ofv_params = ['mode', 'dataset', 'baseview', 'views', 'extent', 'center', 'zoom', 'popup_id', 'popup_coords']\r\n\t\tvar custom_params = Object.keys(this.getAllUrlParams()).filter(function(item){if(ofv_params.indexOf(item)<0 && item != '') return item;});\r\n\t\tif(custom_params.length > 0){\r\n\t\t\tfor(var i=0;i<custom_params.length;i++){\r\n\t\t\t\turl += (i==0? '' : '&') + custom_params[i] + '=' + this.getAllUrlParams()[custom_params[i]];\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\t//dataset on query\r\n\t\tif(this.dataset_on_query) url += (url.endsWith('?')? '': '&') + 'dataset=' + this.dataset_on_query.pid;\r\n\t\t\r\n\t\t//mode\r\n\t\turl += (url.endsWith('?')? '': '&') + 'mode=' + (this.enable_3d? (this.ol3d.getEnabled()? '3D' : '2D') : '2D');\r\n\t\t\r\n\t\t//baseview\r\n\t\tvar baseview = this.map.getLayers().getArray()[0].getLayersArray().filter(function(item){return item.getVisible()})[0];\r\n\t\turl += '&baseview=' + encodeURIComponent(baseview.getProperties().title);\r\n\r\n\t\t//views\r\n\t\tvar encoded_views = new Array();\r\n\t\tvar viewlayers = this.layers.overlays[this.options.map.mainlayergroup].getLayers().getArray().filter(function(item){if(item.id != \"ofv-csw-spatial-coverages\" && typeof item.strategy != \"undefined\") return item});\r\n\t\tviewlayers.sort((a, b) => { return ((a.getZIndex() - b.getZIndex()) > 0 ? 1 : -1);  });\r\n\t\tconsole.log(viewlayers);\r\n\t\tfor(var i=0;i<viewlayers.length;i++){\r\n\t\t\tvar encoded_view = \"\";\r\n\t\t\tvar viewlayer = viewlayers[i];\r\n\t\t\t//if(!viewlayer.getSource().getParams) continue;\r\n\t\t\tvar params = viewlayer.params;\r\n\t\t\tvar pid = viewlayer.pid;\r\n\t\t\tvar lyr = viewlayer.id;\r\n\t\t\tvar strategy = viewlayer.strategy;\r\n\t\t\tencoded_view += 'pid=' + pid + ',';\r\n\t\t\tencoded_view += 'lyr=' + lyr + ',';\r\n\t\t\tencoded_view += 'strategy=' + strategy + ',';\r\n\t\t\t\r\n\t\t\tswitch(strategy){\r\n\t\t\t\tcase \"ogc_filters\":\r\n\t\t\t\t\tconsole.log(\"Setting embed link for view with strategy 'ogc_filters'\");\r\n\t\t\t\t\tif(viewlayer.dsd){\r\n\t\t\t\t\t\tif(params['CQL_FILTER']) encoded_view += 'par=' + params['CQL_FILTER'] +',';\r\n\t\t\t\t\t\t//map options\r\n\t\t\t\t\t\tif(viewlayer.variable) encoded_view += 'var=' + viewlayer.variable +',';\r\n\t\t\t\t\t\tif(viewlayer.envfun) encoded_view += 'fun=' + viewlayer.envfun + ',';\r\n\t\t\t\t\t\tif(viewlayer.envmaptype) encoded_view += 'maptype=' + viewlayer.envmaptype + ',';\r\n\t\t\t\t\t\tif(viewlayer.envmaptype) encoded_view += 'env=' + params['env'] + ',';\r\n\t\t\t\t\t\tif(viewlayer.envcolscheme) encoded_view += 'cs=' + viewlayer.envcolscheme + ',';\r\n\t\t\t\t\t\tif(viewlayer.count) encoded_view += 'count=' + viewlayer.count + ',';\r\n\t\t\t\t\t\tif(params['STYLES']) encoded_view += 'style=' + params['STYLES'] + ',';\r\n\t\t\t\t\t\tif(viewlayer.geom) encoded_view += 'geom=' + viewlayer.geom + ',';\r\n\t\t\t\t\t\tif(viewlayer.geomtype) encoded_view += 'geomtype=' + viewlayer.geomtype + ',';\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"ogc_dimensions\":\r\n\t\t\t\t\tconsole.log(\"Setting embed link for view with strategy 'ogc_dimensions'\");\r\n\t\t\t\t\tif(params['TIME'] != null | params['ELEVATION'] != null) encoded_view += 'par=';\r\n\t\t\t\t\tif(params['TIME']){\r\n\t\t\t\t\t\tencoded_view += 'TIME:' + params['TIME'];\r\n\t\t\t\t\t\tif(params['ELEVATION']){\r\n\t\t\t\t\t\t\tencoded_view += ';';\r\n\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\tencoded_view += ',';\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif(params['ELEVATION']) encoded_view += 'ELEVATION:' + params['ELEVATION'] +',';\r\n\t\t\t\t\t//map options\r\n\t\t\t\t\tif(viewlayer.variable) encoded_view += 'var=' + viewlayer.variable +',';\r\n\t\t\t\t\tif(viewlayer.envfun) encoded_view += 'fun=' + viewlayer.envfun + ',';\r\n\t\t\t\t\tif(viewlayer.envmaptype) encoded_view += 'maptype=' + viewlayer.envmaptype + ',';\r\n\t\t\t\t\tif(viewlayer.envmaptype) encoded_view += 'env=' + params['env'] + ',';\r\n\t\t\t\t\tif(viewlayer.envcolscheme) encoded_view += 'cs=' + viewlayer.envcolscheme + ',';\r\n\t\t\t\t\tif(viewlayer.count) encoded_view += 'count=' + viewlayer.count + ',';\r\n\t\t\t\t\tif(params['STYLES']) encoded_view += 'style=' + params['STYLES'] + ',';\r\n\t\t\t\t\tif(viewlayer.geom) encoded_view += 'geom=' + viewlayer.geom + ',';\r\n\t\t\t\t\tif(viewlayer.geomtype) encoded_view += 'geomtype=' + viewlayer.geomtype + ',';\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"ogc_viewparams\":\r\n\t\t\t\t\tconsole.log(\"Setting embed link for view with strategy 'ogc_viewparams'\");\r\n\t\t\t\t\tif(params['VIEWPARAMS']) encoded_view += 'par=' + params['VIEWPARAMS'] + ',';\r\n\t\t\t\t\t//map options\r\n\t\t\t\t\tif(viewlayer.variable) encoded_view += 'var=' + viewlayer.variable +',';\r\n\t\t\t\t\tif(viewlayer.envfun) encoded_view += 'fun=' + viewlayer.envfun + ',';\r\n\t\t\t\t\tif(viewlayer.envmaptype) encoded_view += 'maptype=' + viewlayer.envmaptype + ',';\r\n\t\t\t\t\tif(viewlayer.envmaptype) encoded_view += 'env=' + params['env'] + ',';\r\n\t\t\t\t\tif(viewlayer.envcolscheme) encoded_view += 'cs=' + viewlayer.envcolscheme + ',';\r\n\t\t\t\t\tif(viewlayer.count) encoded_view += 'count=' + viewlayer.count + ',';\r\n\t\t\t\t\tif(params['STYLES']) encoded_view += 'style=' + params['STYLES'] + ',';\r\n\t\t\t\t\tif(viewlayer.geom) encoded_view += 'geom=' + viewlayer.geom + ',';\r\n\t\t\t\t\tif(viewlayer.geomtype) encoded_view += 'geomtype=' + viewlayer.geomtype + ',';\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\t\r\n\t\t\t\r\n\t\t\tif(this.dataset_on_query) if(this.dataset_on_query.pid == pid){\r\n\t\t\t\tencoded_view += 'q=true';\r\n\t\t\t}else{\r\n\t\t\t\tencoded_view += 'q=false';\r\n\t\t\t}\r\n\t\t\tencoded_views.push(encoded_view);\r\n\t\t}\r\n\t\tconsole.log(\"viewlayers\");\r\n\t\tconsole.log(viewlayers);\r\n\t\tif(viewlayers.length > 0) url += '&views=' + encodeURIComponent(JSON.stringify(encoded_views));\r\n\t\t\r\n\t\t//extent, center, zoom\r\n\t\turl += '&extent=' + this.map.getView().calculateExtent(this.map.getSize()).join(',');\r\n\t\turl += \"&center=\" + this.map.getView().getCenter().join(',');\r\n\t\turl += \"&zoom=\" + this.map.getView().getZoom();\r\n\r\n\t\t//popup coords\r\n\t\tif(this.popup) {\r\n\t\t\tif(this.popup.id) url += '&popup_id=' + this.popup.id; \r\n\t\t\tif(this.popup.coords) url += '&popup_coords=' + this.popup.coords.join(',');\r\n\t\t}\r\n\r\n\t\tdocument.getElementById('OpenFairViewer-link').value = url;\r\n\t}\r\n\t\r\n\t//===========================================================================================\r\n\t//CATALOGUE\r\n\t//===========================================================================================\r\n\t\r\n\t/**\r\n\t * initBrowseCatalogue\r\n\t */\r\n\tinitBrowseCatalogue(){\r\n\t\tthis.cswConfig = [\r\n\t\t\t[\r\n\t\t\t\tOWS_1_0_0,\r\n\t\t\t\tDC_1_1,\r\n\t\t\t\tDCT,\r\n\t\t\t\tXLink_1_0,\r\n\t\t\t\tSMIL_2_0,\r\n\t\t\t\tSMIL_2_0_Language,\r\n\t\t\t\tGML_3_1_1,\r\n\t\t\t\tFilter_1_1_0,\r\n\t\t\t\tCSW_2_0_2,\r\n\t\t\t\tGML_3_2_0,\r\n\t\t\t\tGML_3_2_1,\r\n\t\t\t\tISO19139_GCO_20060504,\r\n\t\t\t\tISO19139_GMD_20060504,\r\n\t\t\t\tISO19139_GTS_20060504,\r\n\t\t\t\tISO19139_GSS_20060504,\r\n\t\t\t\tISO19139_GSR_20060504,\r\n\t\t\t\tISO19139_GMX_20060504,\r\n\t\t\t\tISO19139_GCO_20070417,\r\n\t\t\t\tISO19139_GMD_20070417,\r\n\t\t\t\tISO19139_GTS_20070417,\r\n\t\t\t\tISO19139_GSS_20070417,\r\n\t\t\t\tISO19139_GSR_20070417,\r\n\t\t\t\tISO19139_GMX_20070417,\r\n\t\t\t\tISO19139_SRV_20060504,\r\n\t\t\t\tISO19139_2_GMI_1_0\r\n\t\t\t],\r\n\t\t\t{\r\n\t\t\t\tnamespacePrefixes: {\r\n\t\t\t\t\t\"http://www.opengis.net/cat/csw/2.0.2\": \"csw\",\r\n\t\t\t\t\t\"http://www.opengis.net/ogc\": 'ogc',\r\n\t\t\t\t\t\"http://www.opengis.net/gml\": \"gml\",\r\n\t\t\t\t\t\"http://purl.org/dc/elements/1.1/\":\"dc\",\r\n\t\t\t\t\t\"http://purl.org/dc/terms/\":\"dct\",\r\n\t\t\t\t\t\"http://www.isotc211.org/2005/gmd\" : \"gmd\",\r\n\t\t\t\t\t\"http://www.isotc211.org/2005/gmi\" : \"gmi\",\r\n\t\t\t\t\t\"http://www.isotc211.org/2005/gco\" : \"gco\",\r\n\t\t\t\t},\r\n\t\t\t\tmappingStyle : 'standard'\r\n\t\t\t}\r\n\t\t];\r\n\t\tthis.csw = new CSW(this.config.OGC_CSW_BASEURL, this.config.OGC_CSW_VERSION, this.cswConfig);\r\n\t\t//this.csw.GetCapabilities();\r\n\t\t//this.csw.GetRecordById(['fao-species-map-grn'], this.config.OGC_CSW_SCHEMA);\r\n\t\t//this.csw.GetRecords(1, this.config.OGC_CSW_MAXRECORDS, undefined, this.config.OGC_CSW_SCHEMA);\r\n\t\treturn this.csw;\r\n\t}\r\n\t\r\n\t/**\r\n\t * initBrowseAdvancedSettings\r\n\t */\r\n\tinitBrowseAdvancedSettings(){\r\n\t\tvar this_ = this;\r\n\t\t//spatial coverage layer visibility\r\n\t\t$('#dataset-spatial-coverage-visible').change(function() {\r\n\t\t\tvar layer = this_.getLayerByProperty(\"ofv-csw-spatial-coverages\", \"id\");\r\n\t\t\tlayer.setVisible(this.checked);\r\n\t\t});\r\n\t\t//spatial coverage layer extended or not\r\n\t\t$('#dataset-spatial-coverage-extended').change(function() {\r\n\t\t\tthis_.setSpatialCoverageLayer(this_.records_on_find, this.checked, $('#dataset-spatial-coverage-visible').is(\":checked\"));\r\n\t\t});\r\n\t}\r\n\t\r\n\t/**\r\n\t * initBrowsePagination\r\n\t */\r\n\tinitBrowsePagination(){\r\n\t\tvar this_ = this;\r\n\t\t//Set paginated browsing operated by OGC CSW protocol\r\n\t\t$(\"#dataset-pages\").bootpag({\r\n\t\t\tpage: 1,\r\n\t\t\ttotal: 5,\r\n\t\t\tmaxVisible: 5,\r\n\t\t\tleaps: true,\r\n\t\t\tfirstLastUse: true,\r\n\t\t\tfirst: '←',\r\n\t\t\tlast: '→',\r\n\t\t}).on(\"page\", function(event, num){\r\n\t\t\tvar maxrecords = parseInt($(\"select[id='datasets_length']\").val());\r\n\t\t\tthis_.getDatasetsFromCSWPage(maxrecords, num);\r\n\t\t});\r\n\t}\r\n\t\r\n\tlightenMetadata(inObj) {\r\n\t\tvar obj = inObj;\r\n\t\tif(obj instanceof Array){\r\n\t\t\tvar newObj = new Array();\r\n\t\t\tfor(var i=0;i<obj.length;i++) {\r\n\t\t\t   var newObjItem = this.lightenMetadata(obj[i]);\r\n\t\t\t   newObj.push(newObjItem);\r\n\t\t\t}\r\n\t\t\tobj = newObj;\r\n\t\r\n\t\t}else{\r\n\t\r\n\t\t\tif(typeof obj === 'object'){\r\n\t\t\t\tif (obj['TYPE_NAME']){\r\n\t\t\t\t\tdelete obj['TYPE_NAME'];\r\n\t\t\t\t};\r\n\r\n\t\t\t\tif(typeof obj.name != \"undefined\"){\r\n\t\t\t\t  if(typeof obj.name.CLASS_NAME != \"undefined\"){\r\n\t\t\t\t\tif(obj.name.CLASS_NAME == 'Jsonix.XML.QName'){\r\n\t\t\t\t\t\tobj = this.lightenMetadata(obj.value);  \r\n\t\t\t\t\t}\r\n\t\t\t\t  }\r\n\t\t\t\t}\r\n\r\n\t\t\tif(typeof obj === 'object'){\t\r\n\t\t\t\t  var keys = Object.keys(obj);\r\n\t\t\t\t  for(var i=0;i<keys.length;i++) {\r\n\t\t\t\t\tvar p = keys[i];\r\n\t\t\t\t\tif( [\"characterString\", \"integer\", \"real\", \"decimal\", \"_boolean\"].indexOf(p) != -1 || p.startsWith(\"abstract\")){\r\n\t\t\t\t\t  var newobj = obj[p];\r\n\t\t\t\t\t  if(p==\"abstractRing\") {\r\n\t\t\t\t\t\tnewobj = {\r\n\t\t\t\t\t\t\tvalue: {\r\n\t\t\t\t\t\t\t\tring: {\r\n\t\t\t\t\t\t\t\t\tvalue: obj[p]\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t  }\r\n\t\t\t\t\t  obj = this.lightenMetadata(newobj);\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t  if(typeof obj != \"string\") obj[p] = this.lightenMetadata(obj[p]);\r\n\t\t\t\t\t}\r\n\t\t\t\t  }\r\n\t\t\t\t}\r\n\t\t\t \r\n\t\t\t}\r\n\t\t}\r\n\t\treturn obj;\r\n\t}\r\n\t\r\n\t/**\r\n\t * getDataProtocolsFromMetadataEntry\r\n\t * @param md_entry\r\n\t * @param service\r\n\t * @param layerSuffix\r\n\t * @returns a WFS base URL\r\n\t */\r\n\tgetDataProtocolsFromMetadataEntry(md_entry, service, layerSuffix){\r\n\t\tvar out = new Array();\r\n\t\tif(!md_entry.metadata.distributionInfo.mdDistribution.transferOptions) return out;\r\n\t\tif(!md_entry.metadata.distributionInfo.mdDistribution.transferOptions[0].mdDigitalTransferOptions.onLine) return out;\r\n\t\tvar onLines = md_entry.metadata.distributionInfo.mdDistribution.transferOptions[0].mdDigitalTransferOptions.onLine.filter(\r\n\t\t   function(item){\r\n\t\t\tvar url = item.ciOnlineResource.linkage.url; if(!url) return;\r\n\t\t\tvar protocol = item.ciOnlineResource.protocol; if(!protocol) return;\r\n\t\t\tvar urlFilter = url.indexOf(service)!=-1 | url.indexOf(service.toLowerCase())!=-1;\r\n\t\t\tvar protocolFilter = (service == \"wms\")? protocol.startsWith(\"OGC:\"+service.toUpperCase()) : true;  \r\n\t\t\tvar layerFilter = layerSuffix? item.ciOnlineResource.name.endsWith(layerSuffix) : true;\r\n\t\t\tvar filter = urlFilter && protocolFilter && layerFilter;\r\n\t\t\tif(filter) return item;\r\n\t\t   }\r\n\t\t);\r\n\t\t//if(onLines.length == 0) console.warn(\"No Dataset URL from metadata entry\");\r\n\t\tif(onLines.length > 0){\r\n\t\t\tfor(var i=0;i<onLines.length;i++){\r\n\t\t\t\t//layerUrl\r\n\t\t\t\tvar layerUrl = onLines[i].ciOnlineResource.linkage.url;\r\n\t\t\t\tif(layerUrl.indexOf(\"ows?\")>0) layerUrl = layerUrl.split(\"ows?\")[0] + \"ows?service=\"+ service;\r\n\t\t\t\tif(layerUrl.indexOf(service.toLowerCase()+\"?\")>0) layerUrl = layerUrl.split(service.toLowerCase()+\"?\")[0] + \"ows?service=\" + service;\r\n\t\t\t\t//layerName\r\n\t\t\t\tvar layerName = onLines[i].ciOnlineResource.name;\r\n\t\t\t\tif(layerSuffix) layerName = layerName + layerSuffix;\r\n\t\t\t\t//layerDescription\r\n\t\t\t\tvar layerDescription = onLines[i].ciOnlineResource.description;\r\n\t\t\t\t//serviceVersion\r\n\t\t\t\tvar serviceVersion = null;\r\n\t\t\t\tvar url = onLines[i].ciOnlineResource.linkage.url;\r\n\t\t\t\tif(url.indexOf(\"&version=\") > 0) serviceVersion = url.split(\"&version=\")[1].split(\"&\")[0];\r\n\t\t\t\tif(url.indexOf(\"&VERSION=\") > 0) serviceVersion = url.split(\"&VERSION=\")[1].split(\"&\")[0];\r\n\t\t\t\t//protocol\r\n\t\t\t\tvar protocol = onLines[i].ciOnlineResource.protocol;\r\n\t\t\t\tif(serviceVersion == null) switch(protocol){\r\n\t\t\t\t\tcase \"OGC:WMS\": serviceVersion = \"1.1.0\"; break;\r\n\t\t\t\t\tcase \"OGC:WMS-1.1.0-http-get-map\": serviceVersion = \"1.1.0\"; break;\r\n\t\t\t\t\tcase \"OGC:WMS-1.1.1-http-get-map\": serviceVersion = \"1.1.1\"; break;\r\n\t\t\t\t\tcase \"OGC:WMS-1.3.0-http-get-map\": serviceVersion = \"1.3.0\"; break;\r\n\t\t\t\t\tcase \"OGC:WFS\": serviceVersion = \"2.0.0\"; break;\r\n\t\t\t\t\tcase \"OGC:WFS-1.0.0-http-get-feature\": serviceVersion = \"1.0.0\"; break;\r\n\t\t\t\t\tcase \"OGC:WFS-1.1.0-http-get-feature\": serviceVersion = \"1.1.0\"; break;\r\n\t\t\t\t\tcase \"OGC:WFS-2.0.0-http-get-feature\": serviceVersion = \"2.0.0\"; break;\r\n\t\t\t\t\tcase \"OGC:WCS\": serviceVersion = \"2.0.1\"; break;\r\n\t\t\t\t\tcase \"OGC:WCS-1.0.0-http-get-coverage\": serviceVersion = \"1.0.0\"; break;\r\n\t\t\t\t\tcase \"OGC:WCS-1.1-http-get-coverage\": serviceVersion = \"1.1\"; break;\r\n\t\t\t\t\tcase \"OGC:WCS-1.1.0-http-get-coverage\": serviceVersion = \"1.1.0\"; break;\r\n\t\t\t\t\tcase \"OGC:WCS-1.1.1-http-get-coverage\": serviceVersion = \"1.1.1\"; break;\r\n\t\t\t\t\tcase \"OGC:WCS-2.0.1-http-get-coverage\": serviceVersion = \"2.0.1\"; break;\r\n\t\t\t\t\tcase \"OGC:WCS-2.1.0-http-get-coverage\": serviceVersion = \"2.1.0\"; break;\t\t\t\t\t\r\n\t\t\t\t}\t\t\t\t\r\n\t\t\t\tout.push({url : layerUrl, version: serviceVersion, name: layerName, description: layerDescription});\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn out;\r\n\t}\r\n\t\r\n\t/**\r\n\t * getDatasetGeometryComponent\r\n\t * @param dataset\r\n\t */\r\n\tgetDatasetGeometryComponent(dataset){\r\n\t\tif(!dataset.dsd) return;\r\n\t\tvar geom_component = dataset.dsd.filter(function(item){if(item.primitiveType.startsWith(\"gml\")) return item});\r\n\t\tif(geom_component.length==0) return;\r\n\t\treturn geom_component[0];\r\n\t}\r\n\t\r\n\t/**\r\n\t * buildDynamicStylename\r\n\t * @param\r\n\t */\r\n\tbuildDynamicStylename(dataset, variable, maptype, classnb){\r\n\t\tif(!variable) return null;\r\n\t\tvar geom_component = this.getDatasetGeometryComponent(dataset);\r\n\t\tvar geom = null;\r\n\t\tswitch(geom_component.primitiveType){\r\n\t\t\tcase \"gml:PointPropertyType\": geom = \"point\"; break;\r\n\t\t\tcase \"gml:MultiPointPropertyType\": geom=\"point\"; break;\r\n\t\t\tcase \"gml:LineStringPropertyType\": geom = \"linestring\"; break;\r\n\t\t\tcase \"gml:MultiLineStringPropertyType\": geom = \"linestring\"; break;\r\n\t\t\tcase \"gml:PolygonPropertyType\": geom = \"polygon\"; break;\r\n\t\t\tcase \"gml:MultiPolygonPropertyType\": geom = \"polygon\"; break;\r\n\t\t}\r\n\t\tif(!geom) console.warn(\"No 'geom' type set for builing dynamic stylename. Check DSD geometry type\");\r\n\t\treturn \"dyn_geom-\"+geom+\"_map-\"+maptype+\"_class-\"+classnb;\r\n\t}\r\n\t\r\n\t/**\r\n\t * OpenFairViewer.prototype.getDatasetFeatures\r\n\t * @param layerUrl\r\n\t * @param serviceVersion\r\n\t * @param layerName\r\n\t * @param queryparams\r\n\t * @param cql_filter\r\n\t * @param propertyNames\r\n\t * @param format\r\n\t * @param projection\r\n\t * @returns a Jquery promise\r\n\t */\r\n\tgetDatasetFeatures(layerUrl, serviceVersion, layerName, strategy, queryparams, cql_filter, propertyNames, format, projection){\r\n\t\tif(!format) format = 'json';\r\n\t    var wfsRequest = this.getDatasetWFSLink(layerUrl, serviceVersion, layerName, strategy, queryparams, cql_filter, propertyNames, format, projection);\r\n\t    var deferred = $.Deferred();\r\n\t    $.ajax({\r\n                url: wfsRequest,\r\n                contentType: 'application/json',\r\n                type: 'GET',\r\n                success: function(response){\r\n\t\t\tvar features = response.features;\t\t\t\r\n\t\t\tdeferred.resolve(features);\r\n\t\t},\r\n\t\terror: function(error){\r\n\t\t\tconsole.error(error);\r\n\t\t\tdeferred.reject(error);\r\n\t\t}\r\n\t    });\r\n\t    return deferred.promise();\r\n\t}\r\n\t\r\n\t/**\r\n\t * OpenFairViewer.prototype.getGeometryColumn\r\n\t * @param dsd\r\n\t */\t\r\n\tgetGeometryColumn(dsd){\r\n\t\tif(!dsd) return null;\r\n\t\tvar gmlProperty = dsd.filter(function(item){if(item.primitiveType.startsWith(\"gml\")) return item});\r\n\t\tif(gmlProperty.length == 0) return null;\r\n\t\treturn gmlProperty[0].primitiveCode;\r\n\t}\r\n\r\n\t/**\r\n\t * OpenFairViewer.prototype.getGeometryType\r\n\t * @param dsd\r\n\t */\t\r\n\tgetGeometryType(dsd){\r\n\t\tif(!dsd) return null;\r\n\t\tvar gmlProperty = dsd.filter(function(item){if(item.primitiveType.startsWith(\"gml\")) return item});\r\n\t\tif(gmlProperty.length == 0) return null;\r\n\t\treturn gmlProperty[0].primitiveType;\r\n\t}\r\n\t\r\n\t/**\r\n\t * OpenFairViewer.prototype.getFeatureInfos\r\n\t * @param layers\r\n\t * @param coords\r\n\t */\r\n\tgetFeatureInfos(layers, coords){\r\n\t\tvar this_ = this;\r\n\t\t\r\n\t\t//feature info requests\r\n\t\tvar featureinfo_promises = new Array();\r\n\t\tfor(var i=0;i<layers.length;i++){\r\n\t\t\tvar layerid = layers[i];\r\n\t\t\tvar layer = this.getLayerByProperty(layerid, 'id');\r\n\t\t\tfeatureinfo_promises.push( this.getWMSFeatureInfo(layer, coords) );\r\n\t\t}\r\n\t\t//$(\"#\"+layerid+\"_featureinfo\")\r\n\t\tPromise.all(featureinfo_promises).then(values => {\r\n\t\t\tif(values.length > 0){\r\n\t\t\t\tvar total_features = values.map(function(item){return item.features.length}).reduce((a, b) => a + b, 0);\r\n\t\t\t\tif(total_features > 0){\r\n\t\t\t\t\t\r\n\t\t\t\t\tconsole.log(\"Total feature infos fetched => \"+total_features);\r\n\t\t\t\t\tconsole.log(values);\r\n\t\t\t\t\t\r\n\t\t\t\t\t//html\r\n\t\t\t\t\tvar div = $(\"<div id='featureinfo-tabs' style='font-size:9px;'>\");\r\n\t\t\t\t\tvar ul = $(\"<ul>\");\r\n\t\t\t\t\tfor(var i=0;i<layers.length;i++){\r\n\t\t\t\t\t\tvar layerid = layers[i];\r\n\t\t\t\t\t\tvar layer = this.getLayerByProperty(layerid, 'id');\r\n\t\t\t\t\t\tvar featureinfos = values.filter(function(item){if(item.id == layerid) return item});\r\n\t\t\t\t\t\tif(featureinfos[0].features.length > 0){\r\n\t\t\t\t\t\t\tul.append($(\"<li><a href='#\"+layerid+\"_featureinfo'>\"+layerid+\"</a></li>\"));\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tdiv.append(ul);\r\n\t\t\t\t\tfor(var i=0;i<layers.length;i++){\r\n\t\t\t\t\t\tvar layerid = layers[i];\r\n\t\t\t\t\t\tvar layer = this.getLayerByProperty(layerid, 'id');\r\n\t\t\t\t\t\tvar layer_tab = $(\"<div id='\"+layerid+\"_featureinfo'></div>\");\r\n\t\t\t\t\t\tdiv.append(layer_tab);\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\tif(this_.options.map.popup.mode == 'map'){\r\n\t\t\t\t\t\tvar popup = this_.map.getOverlayById('featureinfos');\r\n\t\t\t\t\t\tpopup.show(coords, div.prop('outerHTML'));\r\n\t\t\t\t\t\t//this.options.map.popup.onopen(layer, feature); //TODO HOW TO DEAL WITH THAT\r\n\t\t\t\t\t\tthis_.popup = {id: 'featureinfos', coords: coords};\r\n\t\t\t\t\t}else if(this_.options.map.popup.mode == 'dialog'){\r\n\t\t\t\t\t\t$(\"#datasetFeatureInfo\").html(div.prop('outerHTML'));\r\n\t\t\t\t\t\tthis_.openFeatureDialog();\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\tfor(var i=0;i<layers.length;i++){\r\n\t\t\t\t\t\tvar layerid = layers[i];\r\n\t\t\t\t\t\tvar layer = this.getLayerByProperty(layerid, 'id');\r\n\t\t\t\t\t\tvar layer_tab = $(\"<div id='\"+layerid+\"_featureinfo'></div>\");\r\n\t\t\t\t\t\tvar featureinfos = values.filter(function(item){if(item.id == layerid) return item});\r\n\t\t\t\t\t\tconsole.log(featureinfos);\r\n\t\t\t\t\t\tif(featureinfos[0].features.length > 0){\r\n\t\t\t\t\t\t\t$(\"#\"+layerid+\"_featureinfo\").append(this_.options.map.popup.handler(layer, featureinfos[0].features));\r\n\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\t$(\"#\"+layerid+\"_featureinfo\").remove();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\t$( \"#featureinfo-tabs\" ).tabs();\r\n\t\t\t\t\t\r\n\t\t\t\t}else{\r\n\t\t\t\t\tif(this_.options.map.popup.mode == 'map'){\r\n\t\t\t\t\t\tvar popup = this_.map.getOverlayById('featureinfos');\r\n\t\t\t\t\t\tpopup.hide();\r\n\t\t\t\t\t\tthis_.popup = {};\r\n\t\t\t\t\t}\r\n\t\t\t\t\t/*else if(this_.options.map.popup.mode == 'dialog'){\r\n\t\t\t\t\t\t$(\"#datasetFeatureInfo\").html(\"No feature info\");\r\n\t\t\t\t\t\tthis_.closeFeatureDialog();\r\n\t\t\t\t\t}*/\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t\t\r\n\t}\r\n\t\r\n\t/**\r\n\t * OpenFairViewer.prototype.getWMSFeatureInfo\r\n\t * @param layer\r\n\t * @param coords\r\n\t */\r\n\tgetWMSFeatureInfo(layer, coords){\r\n\t\t\r\n\t\tconsole.log(\"Get WMS FeatureInfo on layer = \"+layer.id);\r\n\t\t\r\n\t\tvar this_ = this;\r\n\t\t\r\n\t\tvar viewResolution = this_.map.getView().getResolution();\r\n\t\tvar viewProjection = this_.map.getView().getProjection().getCode();\r\n\r\n\t\tvar default_info_format = \"application/vnd.ogc.gml\";\r\n\t\tif(layer.getSource().getUrl) if(layer.getSource().getUrl().indexOf(\"thredds\") != -1) default_info_format = \"text/xml\";\r\n\t\tif(layer.getSource().getUrls) if(layer.getSource().getUrls()[0].indexOf(\"thredds\") != -1) default_info_format = \"text/xml\";\r\n\t\tvar featureInfoUrl = layer.getSource().getFeatureInfoUrl(coords, viewResolution, viewProjection, {'INFO_FORMAT': default_info_format});\r\n\t\tif(this.secure) featureInfoUrl = featureInfoUrl.replace(\"http://\", \"https://\");\r\n\t\tvar featureInfoParams = featureInfoUrl.split('?')[1].split(\"&\").map(function(item){return item.split('=')});\r\n\r\n\t\tvar deferred = $.Deferred();\r\n\t\t\r\n\t\t$.ajax({\r\n\t\t\turl: featureInfoUrl,\r\n\t\t\tcrossOrigin: true,\r\n\t\t\ttype: 'GET',\r\n\t\t\tsuccess: function(response){\r\n\t\t\t\tvar parser = new olFormat.WMSGetFeatureInfo();\r\n\t\t\t\tvar features = parser.readFeatures(response);\r\n\t\t\t\tif(featureInfoUrl.indexOf(\"thredds\") != -1){\r\n\t\t\t\t\tvar featureinfo = $(response.childNodes[0].childNodes).filter(function(idx,item){if(item.nodeName == \"FeatureInfo\") return item;});\r\n\t\t\t\t\tconst props = featureinfo.children().map(function(i,item){ var obj = new Object(); obj[item.nodeName] = item.textContent; return obj});\r\n\t\t\t\t\tconst feature_props = new Object();\r\n\t\t\t\t\tfor(var i=0;i<props.length;i++){\r\n\t\t\t\t\t\tvar key = Object.keys(props[i])[0];\r\n\t\t\t\t\t\tfeature_props[key] = props[i][key];\r\n\t\t\t\t\t}\r\n\t\t\t\t\tconst fi = new Feature();\r\n\t\t\t\t\tfi.setProperties(feature_props);\r\n\t\t\t\t\tfeatures = [fi];\r\n\t\t\t\t}\r\n\t\t\t\tconsole.log(features);\r\n\t\t\t\tvar feature = null;\r\n\t\t\t\tif(features.length > 0){\r\n\t\t\t\t\tconsole.log(\"Nb of features on layer \"+layer.id+\": \"+features.length);\r\n\t\t\t\t\tfeatures = features.map(function(item){\r\n\t\t\t\t\t\tfeature = item;\r\n\t\t\t\t\t\tfeature.geometry_column = feature.getGeometryName();\r\n\t\t\t\t\t\tfeature.popup_coordinates = coords;\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t//TODO investigate how to deal with similar in shiny popup when layer is vector\r\n\t\t\t\t\t\t//(for now shiny popups limited to WMS layers)\r\n\t\t\t\t\t\tfeature.info = {\r\n\t\t\t\t\t\t\tx: featureInfoParams.filter(function(item){if(item[0]== (layer.getSource().getParams().VERSION == \"1.3.0\"? \"I\" :\"X\") ) return item;})[0][1],\r\n\t\t\t\t\t\t\ty: featureInfoParams.filter(function(item){if(item[0]== (layer.getSource().getParams().VERSION == \"1.3.0\"? \"J\" :\"Y\")  ) return item;})[0][1],\r\n\t\t\t\t\t\t\twidth: featureInfoParams.filter(function(item){if(item[0]==\"WIDTH\") return item;})[0][1],\r\n\t\t\t\t\t\t\theight: featureInfoParams.filter(function(item){if(item[0]==\"HEIGHT\") return item;})[0][1],\r\n\t\t\t\t\t\t\tbbox: featureInfoParams.filter(function(item){if(item[0]==\"BBOX\") return item;})[0][1]\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\treturn feature;\r\n\t\t\t\t\t});\r\n\t\t\t\t\t\r\n\t\t\t\t\tdeferred.resolve({ id: layer.id, features: features});\r\n\t\t\t\t}else{\r\n\t\t\t\t\tdeferred.resolve({id: layer.id, features: []});\r\n\t\t\t\t\t\r\n\t\t\t\t\t//TODO review this case\r\n\t\t\t\t\t//in case feature markers are highlighted we remove them\r\n\t\t\t\t\t/*\r\n\t\t\t\t\tvar markersId = 'ofv-feature-marker';\r\n\t\t\t\t\tvar markers = this_.getLayerByProperty(markersId, 'id');\r\n\t\t\t\t\tif(markers){\r\n\t\t\t\t\t\tvar source = new Vector({ features: [] });\r\n\t\t\t\t\t\tmarkers.setSource(source);\r\n\t\t\t\t\t}*/\r\n\t\t\t\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t}\r\n\t\t});\r\n\t\treturn deferred;\r\n\t}\r\n\t\r\n\t\r\n\t/**\r\n\t * OpenFairViewer.prototype.getVectorFeatureInfo\r\n\t * @param layer\r\n\t * @param feature\r\n\t * @param coords\r\n\t */\r\n\tgetVectorFeatureInfo(layer, feature, coords){\r\n\t\tvar this_ = this;\r\n\t\tvar popup = this.map.getOverlayById(layer.id);\r\n\t\tif(feature){\r\n\t\t\tif(!coords){\r\n\t\t\t\tvar geom = feature.getGeometry();\r\n\t\t\t\tcoords = olExtent.getCenter(geom.getExtent());\r\n\t\t\t\tif(geom instanceof olGeom.LineString ||\r\n\t\t   \t   \t   geom instanceof olGeom.MultiLineString ||\r\n\t \t   \t   \t   geom instanceof olGeom.MultiPoint){\r\n\t\t\t\t\tcoords = geom.getCoordinates()[0][Math.floor(geom.getCoordinates()[0].length/2)];\r\n\t\t\t\t}\r\n\t\t\t\tif(geom instanceof olGeom.Point) coords = geom.getCoordinates();\t\r\n\t\t\t}\r\n\t\t\tfeature.geometry_column = feature.getGeometryName();\r\n\t\t\tfeature.popup_coordinates = coords;\r\n\t\t\t\r\n\t\t\t//if(this.options.map.popup.mode == 'map'){\r\n\t\t\t\tpopup.show(coords, this_.options.map.popup.handler(layer, [feature]));\t\t\r\n\t\t\t\tthis_.options.map.popup.onopen(layer, [feature]);\r\n\t\t\t\tthis_.popup = {id: layer.id, coords: coords};\r\n\t\t\t//}\r\n\t\t\t/*else if(this.options.map.popup.mode == 'dialog'){\r\n\t\t\t\t$(\"#datasetFeatureInfo\").html(this_.options.map.popup.handler(layer, [feature]));\r\n\t\t\t\tthis.openFeatureDialog();\r\n\t\t\t}*/\r\n\t\t}else{\r\n\t\t\t//if(this.options.map.popup.mode == 'map'){\r\n\t\t\t\tpopup.hide();\r\n\t\t\t\tthis_.popup = {};\r\n\t\t\t\tthis_.options.map.popup.onclose(layer, [feature]);\r\n\t\t\t//}\r\n\t\t\t/*else if(this.options.map.popup.mode == 'dialog'){\r\n\t\t\t\t$(\"#datasetFeatureInfo\").html(\"\");\r\n\t\t\t\tthis.closeFeatureDialog();\r\n\t\t\t}*/\r\n\t\t\t//in case feature markers are highlighted we remove them\r\n\t\t\tvar markersId = 'ofv-feature-marker';\r\n\t\t\tvar markers = this_.getLayerByProperty(markersId, 'id');\r\n\t\t\tif(markers){\r\n\t\t\t\tvar source = new Vector({ features: [] });\r\n\t\t\t\tmarkers.setSource(source);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * OpenFairViewer.prototype.getDatasetNextFeatureInTime\r\n\t * @param layerUrl\r\n\t * @param serviceVersion\r\n\t * @param layerName\r\n\t * @param propertyName\r\n\t * @param propertyValue\r\n\t * @returns a Jquery promise\r\n\t */\r\n\tgetDatasetNextFeatureInTime(layerUrl, serviceVersion, layerName, propertyName, propertyValue){\r\n\t\tvar this_ = this;\r\n\t\tvar projection = this_.map.getView().getProjection().getCode();\r\n\t    var wfsRequest = this.getDatasetWFSLink(layerUrl, serviceVersion, layerName, 'ogc_filters', null, propertyName + ' > ' + propertyValue, null, 'json', projection);\r\n\t    wfsRequest += '&sortBy='+propertyName+'&maxFeatures=1';\r\n\t    var deferred = $.Deferred();\r\n\t    $.ajax({\r\n                url: wfsRequest,\r\n                contentType: 'application/json',\r\n                type: 'GET',\r\n                success: function(response){\r\n\t\t\tvar geojson = new olFormat.GeoJSON();\r\n\t\t\tvar features = geojson.readFeatures(response);\t\t\t\r\n\t\t\tdeferred.resolve(features);\r\n\t\t},\r\n\t\terror: function(error){\r\n\t\t\tconsole.error(error);\r\n\t\t\tdeferred.reject(error);\r\n\t\t}\r\n\t    });\r\n\t    return deferred.promise();\r\n\t}\r\n\t\r\n\t/**\r\n\t * OpenFairViewer.prototype.getNextFeatureInfoInTime\r\n\t * @param pid\r\n\t * @param layerUrl\r\n\t * @param serviceVersion\r\n\t * @param layerName\r\n\t * @param propertyName\r\n\t * @param propertyValue\r\n\t */\r\n   getNextFeatureInfoInTime(pid, layerUrl, serviceVersion, layerName, propertyName, propertyValue){\r\n\t\tvar this_ = this;\r\n\t\tvar layer = this.getLayerByProperty(pid, \"id\");\r\n\t\tvar viewResolution = this_.map.getView().getResolution();\r\n\t\tvar viewProjection = this_.map.getView().getProjection().getCode();\r\n\r\n\t\tthis.getDatasetNextFeatureInTime(layerUrl, serviceVersion, layerName, propertyName, propertyValue).then(function(nextresponse){\r\n\t\t\t\r\n\t\t\tvar nextfeature = null;\r\n\t\t\tvar coords = null;\r\n\t\t\tif(nextresponse.length > 0){\r\n\t\t\t\tnextfeature = nextresponse[0];\r\n\t\t\t\tvar geom = nextfeature.getGeometry();\r\n\t\t\t\tcoords = olExtent.getCenter(geom.getExtent());\r\n\t\t\t\tif(geom instanceof olGeom.LineString ||\r\n\t\t   \t   \t   geom instanceof olGeom.MultiLineString ||\r\n\t \t   \t   \t   geom instanceof olGeom.MultiPoint){\r\n\t\t\t\t\tcoords = geom.getCoordinates()[0][Math.floor(geom.getCoordinates()[0].length/2)];\r\n\t\t\t\t}\r\n\t\t\t\tif(geom instanceof olGeom.Point) coords = geom.getCoordinates();\t\t\t\r\n\t\t\t\tconsole.log(\"Feature In Time\");\r\n\t\t\t\tconsole.log(coords);\r\n\t\t\t}\r\n\t\t\t//popup handling\r\n\t\t\tthis_.getVectorFeatureInfo(layer, nextfeature, coords);\r\n\t\t});\r\n\t}\r\n\t\r\n\t/**\r\n\t * registerFeatureInfoLayer\r\n\t * @param layer\r\n\t */\r\n    registerFeatureInfoLayer(layer){\r\n\t\tthis.layers_with_featureinfo.push(layer.id);\r\n\t}\r\n\t\r\n\t/**\r\n\t * unregisterFeatureInfoLayer\r\n\t * @param layer\r\n\t */\r\n    unregisterFeatureInfoLayer(layer){\r\n\t\tconst index = this.layers_with_featureinfo.indexOf(layer.id);\r\n\t\tif (index > -1) this.layers_with_featureinfo.splice(index, 1);\r\n\t}\r\n\t\r\n\t/**\r\n\t * addVectorLayerPopup\r\n\t * @param layer\r\n\t */\r\n    addVectorLayerPopup(layer){\r\n\r\n\t\tvar this_ = this;\r\n\t\t//configure popup\r\n\t\tvar popup = new Popup({id: layer.id});\r\n\t\tthis.map.addOverlay(popup);\r\n\t}\r\n\t\r\n\r\n    /**\r\n\t * removeLayerByProperty Util method to remove a layer by property\r\n\t * @param layerProperty the property value\r\n\t * @param by the property \r\n\t */\r\n    removeLayerByProperty(layerProperty, by){\r\n\t\tconsole.log(\"Remove layer dataset with property \"+by+\" = \" + layerProperty);\r\n\t\tvar removed = false;\r\n\t\tif(!by) byTitle = false;\r\n\t\tvar target = undefined;\r\n\t\tvar layerGroups = this.map.getLayers().getArray();\r\n\t\tfor(var i=0;i<layerGroups.length;i++){\r\n\t\t\tvar layerGroup = layerGroups[i];\r\n\t\t\tvar layers = layerGroup.getLayers().getArray();\r\n\t\t\tfor(var j=0;j<layers.length;j++){\r\n\t\t\t\tvar layer = layers[j];\r\n\t\t\t\tvar condition  = by? (layer.get(by) === layerProperty) : (layer.getSource().getParams()[\"LAYERS\"] === layerProperty);\r\n\t\t\t\tif(condition){\r\n\t\t\t\t\tthis.layers.overlays[i-1].getLayers().remove(layer);\r\n\t\t\t\t\tthis.unregisterFeatureInfoLayer(layer);\r\n\t\t\t\t\tthis.renderMapLegend();\r\n\t\t\t\t\tremoved = true;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn removed;\r\n\t}\r\n\t\r\n\t\r\n\t/**\r\n\t * OpenFairViewer.prototype.getDatasetValues\r\n\t * @param an array of features\r\n\t * @param propertyName\r\n\t * @returns a array of values\r\n\t */\r\n\tgetDatasetValues(features, propertyName){\r\n\t\tvar values = new Array();\r\n\t\tif(features.length > 0){\r\n\t\t\tvalues = features.map(function(f){\r\n\t\t\t\treturn (propertyName? f.properties[propertyName] : f.properties)\r\n\t\t\t});\r\n\t\t}\r\n\t\treturn values;\r\n\t}\r\n\r\n\t/**\r\n     * OpenFairViewer.prototype.calculateBreaks\r\n\t * @param values an array of numeric values\r\n\t * @param classType the type of classification to apply\r\n\t * @param classNb the number N of class breaks\r\n\t * @returns an array of N+1 class breaks\r\n     */\r\n\tcalculateBreaks(values, classType, classNb){\r\n\t    var breaks =  new Array();\r\n\t    switch(classType){\r\n\t\t//CKmeans\r\n\t\tcase \"ckmeans\":\r\n\t\t    var clusters = stats.ckmeans(values, classNb);\r\n\t\t    breaks = new Array();\r\n\t\t    for(var i=0;i<clusters.length;i++){\r\n\t\t\tvar cluster = clusters[i];\r\n\t\t\tbreaks.push(stats.min(cluster));\r\n\t\t\tif(i==clusters.length-1) breaks.push(stats.max(cluster));\r\n\t\t    }\r\n\t\t    break;\r\n\t\t//Equal intervals\r\n\t\tcase \"equal\":\r\n\t\t    breaks = stats.equalIntervalBreaks(values, classNb);\r\n\t\t    break;\r\n\t\t//quantiles\r\n\t\tcase \"quantile\":\r\n\t\t    var qpt = 1/classNb;\r\n\t\t    breaks = new Array();\r\n\t\t    breaks.push(stats.min(values));\r\n\t\t    for(var i=1;i<=classNb;i++){\r\n\t\t\tbreaks.push(stats.quantile(values,qpt*i));\r\n\t\t    }\r\n\t\t    breaks;\t\t\t\t\t\r\n\t    }\r\n\t    return breaks;\r\n\t}\r\n\r\n\t/**\r\n\t * OpenFairViewer.prototype.buildEnvParams\r\n\t * @param geom\r\n\t * @param variable\r\n\t * @param breaks\r\n\t * @param colors\r\n\t */\r\n\tbuildEnvParams(geom, variable, breaks, colors){\r\n\t    var envparams = \"geom:\"+ geom +\";var:\"+variable+\";\";\r\n\t    for(var i=1;i<=breaks.length;i++){\r\n\t\t\tenvparams += \"v\"+ i +\":\"+ breaks[i-1] + \";\";\r\n\t    }\r\n\t\tfor(var i=1;i<=colors.length;i++){\r\n\t\t\tenvparams += \"c\"+ i +\":\"+ colors[i-1] + \";\";\r\n\t\t}\r\n\t    return envparams;\r\n\t}\r\n\t\r\n\t/**\r\n\t * OpenFairViewer.prototype.getDatasetViewTitle\r\n\t * @param uuid\r\n\t * @param dataset\r\n\t * @param strategyparams\r\n\t * @param from_query_form\r\n\t */\r\n\tgetDatasetViewTitle(dataset, strategyparams, from_query_form){\r\n\t\tvar this_ = this;\r\n\t\t\r\n\t\tvar layer = undefined;\r\n\t\tif(from_query_form){\r\n\t\t\tlayer = this_.getStrategyLayer();\r\n\t\t}else{\r\n\t\t\tlayer = dataset.lyr? dataset.lyr : dataset.entry.wms[0].name;\r\n\t\t}\r\n\t\tconsole.log(layer);\r\n\t\tvar lyr = dataset.entry.wms.filter(function(item){return item.name == layer})[0];\r\n\t\tvar layerTitle = '<button class=\"btn btn-xs dataset-button dataset-button-remove\" data-pid=\"'+dataset.pid+'\" data-lyr=\"'+lyr.name+'\" title=\"'+this_.options.labels.dataset_remove+'\" onclick=\"'+this_.config.OFV_ID+'.unselectDatasetView(this)\"> X </button>';\r\n\t\tlayerTitle += '<span>'+dataset.entry.title+'</span>';\r\n\t\tlayerTitle += '</br>';\r\n\t\tlayerTitle += '<p style=\"font-weight:normal !important;font-size:90%;\"><span class=\"glyphicon glyphicon-pushpin\"></span><b style=\"margin-left:4px;\">'+this_.options.labels.layer+'</b>: '+lyr.description+ ' ['+lyr.name+']';\r\n\t\t\r\n\t\tif(strategyparams) if(strategyparams instanceof Array) if(strategyparams.length > 0){\r\n\t\t\tvar strategyName;\r\n\t\t\tswitch(dataset.strategy){\r\n\t\t\t\tcase \"ogc_filters\": strategyName = this.options.labels.ogc_filters; break;\r\n\t\t\t\tcase \"ogc_dimensions\": strategyName = this.options.labels.ogc_dimensions; break;\r\n\t\t\t\tcase \"ogc_viewparams\": strategyName = this.options.labels.ogc_viewparams; break;\r\n\t\t\t}\r\n\t\t\tlayerTitle += '</br>';\r\n\t\t\tlayerTitle += '<p style=\"font-weight:normal !important;font-size:90%;overflow-wrap:break-word;\"><span class=\"glyphicon glyphicon-pushpin\"></span><b style=\"margin-left:4px;\">'+strategyName+':</b></br>';\r\n\t\t\tswitch(dataset.strategy){\r\n\t\t\t  case \"ogc_filters\":\r\n\t\t\t\tif(strategyparams[0].CQL_FILTER){\r\n\t\t\t\t\tlayerTitle += strategyparams[0].CQL_FILTER;\r\n\t\t\t\t}else{\r\n\t\t\t\t\tfor(var i=0;i<strategyparams.length;i++){\r\n\t\t\t\t\t\tvar strategyparam = strategyparams[i];\r\n\t\t\t\t\t\tvar key = Object.keys(strategyparam)[0];\r\n\t\t\t\t\t\tvar component = strategyparam[key];\r\n\t\t\t\t\t\tif(!(component.content instanceof Array)) component.content = [component.content];\r\n\t\t\t\t\t\tvar component_info;\r\n\t\t\t\t\t\tswitch(component.type){\r\n\t\t\t\t\t\t\tcase \"list\": component_info = component.content.join(','); break;\r\n\t\t\t\t\t\t\tcase \"range\": component_info = component.content[0]; if(component.content.length>1) component_info += \" – \" + component.content[component.content.length-1]; break;\r\n\t\t\t\t\t\t\tcase \"timeperiod\": component_info = component.content.join('/'); break;\r\n\t\t\t\t\t\t\tdefault: component.content.join('/'); break;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tlayerTitle += '&#8226; ' + key + ': '+ component_info + '</br>';\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\t  case \"ogc_dimensions\":\r\n\t\t\t\tfor(var i=0;i<strategyparams.length;i++){\r\n\t\t\t\t\tvar strategyparam = strategyparams[i];\r\n\t\t\t\t\tvar key = Object.keys(strategyparam)[0];\r\n\t\t\t\t\tlayerTitle += '&#8226; ' + key + ': '+ strategyparam[key].content[0] + '</br>';\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\t  case \"ogc_viewparams\":\r\n\t\t\t\tfor(var i=0;i<strategyparams.length;i++){\r\n\t\t\t\t\tvar strategyparam = strategyparams[i];\r\n\t\t\t\t\tvar key = Object.keys(strategyparam)[0];\r\n\t\t\t\t\tvar component = strategyparam[key];\r\n\t\t\t\t\tif(!(component.content instanceof Array)) component.content = [component.content];\r\n\t\t\t\t\tvar component_info;\r\n\t\t\t\t\tswitch(component.type){\r\n\t\t\t\t\t\tcase \"list\": component_info = component.content.join(','); break;\r\n\t\t\t\t\t\tcase \"range\": component_info = component.content[0]; if(component.content.length>1) component_info += \" – \" + component.content[component.content.length-1]; break;\r\n\t\t\t\t\t\tcase \"timeperiod\": component_info = component.content.join('/'); break;\r\n\t\t\t\t\t\tdefault: component.content.join('/'); break;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tlayerTitle += '&#8226; ' + key + ': '+ component_info + '</br>';\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn layerTitle;\r\n\t}\r\n\t\r\n\tgetDatasetDOILink(md_entry){\r\n\t\tvar ident = md_entry.metadata.identificationInfo; if(!ident) return null;\r\n\t\tvar identifiers = ident[0].citation.ciCitation.identifier; if(!identifiers) return null;\r\n\t\tvar doi_identifiers = identifiers.filter(function(identifier){\r\n\t\t\tvar hasDOI = false;\r\n\t\t\tif(identifier.mdIdentifier.code.href) if(identifier.mdIdentifier.code.href.indexOf(\"dx.doi.org\")!=-1) hasDOI = true;\r\n\t\t\tif(!hasDOI) if(identifier.mdIdentifier.code.value) if(identifier.mdIdentifier.code.value.startsWith(\"doi:\")!=-1) hasDOI = true;\r\n\t\t\tif(hasDOI) return identifier;\r\n\t\t});\r\n\t\tif(doi_identifiers.length == 0) return null;\r\n\t\tvar doi = null;\r\n\t\tvar doi_identifier = doi_identifiers[0].mdIdentifier;\r\n\t\tif(doi_identifier.code.href){\r\n\t\t\tdoi = doi_identifier.code.href.split(\"dx.doi.org/\")[1];\r\n\t\t}else{\r\n\t\t\tdoi = doi_identifier.code.value.split(\"doi:\")[1];\r\n\t\t}\r\n\t\treturn doi;\r\n\t}\r\n        \r\n\t/**\r\n\t * createMetadataEntry\r\n\t * @param value\r\n\t */\r\n\tcreateMetadataEntry(value){\r\n\t\tvar this_ = this;\r\n\t\tvar md_entry = new Object();\r\n\t\tmd_entry.metadata = this_.lightenMetadata(value);\r\n\r\n\t\t//delete csw_result.value;\r\n\t\tmd_entry.pid = md_entry.metadata.fileIdentifier;\r\n\t\tmd_entry.pidinfo = md_entry.pid;\r\n\t\t//title\r\n\t\tmd_entry.title = md_entry.metadata.identificationInfo[0].citation.ciCitation.title;\r\n\t\tmd_entry.title_tooltip = md_entry.title;\r\n\t\t//graphic overviews\r\n\t\tvar graphicOverviews = md_entry.metadata.identificationInfo[0].graphicOverview\r\n\t\tif(graphicOverviews) if(graphicOverviews.length > 0) md_entry.graphic_overview = graphicOverviews[0].mdBrowseGraphic.fileName;\r\n\t\tmd_entry._abstract = md_entry.metadata.identificationInfo[0]._abstract;\r\n\t\t//extents\r\n\t\tvar extents = md_entry.metadata.identificationInfo[0].extent; \r\n\t\tif(extents) {\r\n\t\t\tif(extents[0].exExtent.temporalElement) if(extents[0].exExtent.temporalElement.length >=0) if(extents[0].exExtent.temporalElement[0].exTemporalExtent){                          \r\n\t\t\t\tvar temporalExtent = extents[0].exExtent.temporalElement[0].exTemporalExtent.extent;\r\n\t\t\t\tif(temporalExtent.beginPosition) md_entry.time_start = temporalExtent.beginPosition.value[0];\r\n\t\t\t\tif(temporalExtent.endPosition) md_entry.time_end = temporalExtent.endPosition.value[0];\r\n\t\t\t\tif(temporalExtent.timePosition) md_entry.time_position = temporalExtent.timePosition.value; //TODO to see how to deal with that\r\n\t\t\t}\r\n\t\t}\r\n\t\t//projection\r\n\t\tmd_entry.projection = new olProj.get('EPSG:4326');\r\n\t\tif(md_entry.metadata.referenceSystemInfo) {\r\n\t\t\tvar srs = md_entry.metadata.referenceSystemInfo[0].mdReferenceSystem.referenceSystemIdentifier.rsIdentifier;\r\n\t\t\tvar srs_proj = new olProj.get(srs.codeSpace + ':' + srs.code);\r\n\t\t\tif(srs_proj.code_) md_entry.projection = srs_proj;\r\n\t\t}\r\n\t\t//spatial representation\r\n\t\tmd_entry.dataModel = \"vector\";\r\n\t\tif(md_entry.metadata.spatialRepresentationInfo){\r\n\t\t\tif(md_entry.metadata.spatialRepresentationInfo[0].geometryObjects){\r\n\t\t\t\tmd_entry.dataModel = \"vector\";\r\n\t\t\t}else if(md_entry.metadata.spatialRepresentationInfo[0].axisDimensionProperties){\r\n\t\t\t\tmd_entry.dataModel = \"grid\";\r\n\t\t\t}\r\n\t\t}\r\n\t\t//content information\r\n\t\tmd_entry.dsd = false;\r\n\t\tmd_entry.dsdModel = \"none\";\r\n\t\tif(md_entry.metadata.contentInfo) {\r\n\t\t\tif(md_entry.metadata.contentInfo[0].featureCatalogueCitation) if(md_entry.metadata.contentInfo[0].featureCatalogueCitation[0].uuidref){\r\n\t\t\t\t//build fc_url, adding patch to encode isotc211 namespace in case full rewriting of url components to https is done on server\r\n\t\t\t\tvar fc_url = this_.csw.url + \"?service=CSW&request=GetRecordById&Version=2.0.2&elementSetName=full&outputSchema= \" + encodeURIComponent(\"http://www.isotc211.org\") + \"/2005/gfc&id=\" + md_entry.metadata.contentInfo[0].featureCatalogueCitation[0].uuidref;\r\n\t\t\t\tmd_entry.dsd = this_.rewriteURL(fc_url);\r\n\t\t\t\tmd_entry.dsdModel = \"FeatureCatalogue\";\r\n\t\t\t}\r\n\t\t\tif(md_entry.metadata.contentInfo[0].dimension){\r\n\t\t\t\tmd_entry.dsd = true;\r\n\t\t\t\tmd_entry.dsdModel = \"CoverageDescription\";\r\n\t\t\t}\r\n\t\t}\r\n\t\t//distribution information\r\n\t\tmd_entry.csw = [{url: this.csw.url, version: this.csw.version}];\r\n\t\tmd_entry.wms = this.getDataProtocolsFromMetadataEntry(md_entry, \"WMS\");\r\n\t\tmd_entry.wfs = this.getDataProtocolsFromMetadataEntry(md_entry, \"WFS\");\r\n\t\tmd_entry.queryable = md_entry.wms.length > 0;\r\n\t\t//doi\r\n\t\tmd_entry.doi = this.getDatasetDOILink(md_entry);\r\n\r\n\t\treturn md_entry;\r\n\t}\r\n\t\r\n\t      \r\n\t/**\r\n\t * buildSpatialCoverageFeature\r\n\t * @param dataset\r\n\t * @param extended\r\n\t */\r\n\tbuildSpatialCoverageFeature(dataset, extended){\r\n\t\tvar this_ = this;\r\n\t\tvar idents = dataset.metadata.identificationInfo;\r\n\t\tif(!idents) return; if(idents.length == 0) return;\r\n\t\tvar extents = idents[0].extent;\r\n\t\tif(!extents) return; if(extents.length == 0) return;\r\n\t\tvar geo_extents = extents[0].exExtent.geographicElement;\r\n\t\tif(!geo_extents) return; if(geo_extents.length == 0) return;\r\n\t\t\r\n\t\tvar geometries = new Array();\r\n\t\tfor(var i=0;i<geo_extents.length;i++){\r\n\t\t\tvar geo_extent = geo_extents[i];\r\n\t\t\tvar geo_keys = Object.keys(geo_extent);\r\n\t\t\tvar is_bbox = geo_keys.indexOf(\"westBoundLongitude\")!=-1 && geo_keys.indexOf(\"eastBoundLongitude\")!=-1 && \r\n\t\t\t\t\t\t  geo_keys.indexOf(\"southBoundLatitude\")!=-1 && geo_keys.indexOf(\"northBoundLatitude\")!=-1;\r\n\t\t\tif(is_bbox){\r\n\t\t\t\t//case of bounding box\r\n\t\t\t\tvar coords = [\r\n\t\t\t\t\tgeo_extent.westBoundLongitude, geo_extent.southBoundLatitude,\r\n\t\t\t\t\tgeo_extent.eastBoundLongitude, geo_extent.northBoundLatitude\r\n\t\t\t\t]\r\n\t\t\t\tvar polyCoords = [\r\n\t\t\t\t\t[coords[0],coords[1]],\r\n\t\t\t\t\t[coords[0],coords[3]],\r\n\t\t\t\t\t[coords[2],coords[3]],\r\n\t\t\t\t\t[coords[2],coords[1]],\r\n\t\t\t\t\t[coords[0],coords[1]]\r\n\t\t\t\t];\r\n\t\t\t\tvar polyCoordsGeom = new olGeom.LineString(polyCoords);\r\n\t\t\t\t//reproject if needed\r\n\t\t\t\tvar srs_data = dataset.projection;\r\n\t\t\t\tvar srs_map = this.map.getView().getProjection();\r\n\t\t\t\tconsole.log(srs_data);\r\n\t\t\t\tif(srs_data) if(srs_data.getCode() != srs_map.getCode()){\r\n\t\t\t\t\tpolyCoordsGeom.transform(srs_data, srs_map);\r\n\t\t\t\t}\r\n\t\t\t\tgeometries.push(polyCoordsGeom);\r\n\t\t\t}else{\r\n\t\t\t\t//case of bounding polygons\r\n\t\t\t\tif(extended) if(geo_keys.length == 1 && geo_keys[0]==\"polygon\"){\r\n\t\t\t\t\tvar polygons = geo_extent.polygon;\r\n\t\t\t\t\t//jsonix to Geojson\r\n\t\t\t\t\tvar geomConverter = new GML_V_3_1_1.GeoJSON.ForwardGeometryConverter();\t\r\n\t\t\t\t\tpolygons.forEach(function(polygon){\r\n\t\t\t\t\t\tvar geojson_geom = geomConverter.createGeometry(polygon);\r\n\t\t\t\t\t\tconsole.log(\"Convert JSONIX to GeoJSON\");\r\n\t\t\t\t\t\tconsole.log(\"from JSONIX = \"+JSON.stringify(polygon));\r\n\t\t\t\t\t\tconsole.log(\"to GeoJSON = \"+JSON.stringify(geojson_geom));\r\n\t\t\t\t\t\tconsole.log(geojson_geom);\r\n\t\t\t\t\t\tvar ol_geom_handler = null;\r\n\t\t\t\t\t\tswitch(geojson_geom.type){\r\n\t\t\t\t\t\t\tcase \"Point\": ol_geom_handler = olGeom.Point; break;\r\n\t\t\t\t\t\t\tcase \"MultiPoint\": ol_geom_handler = olGeom.MultiPoint; break;\r\n\t\t\t\t\t\t\tcase \"LineString\":  ol_geom_handler = olGeom.LineString; break;\r\n\t\t\t\t\t\t\tcase \"MultiLineString\":  ol_geom_handler = olGeom.MultiLineString; break;\r\n\t\t\t\t\t\t\tcase \"Polygon\":  ol_geom_handler = olGeom.Polygon; break;\r\n\t\t\t\t\t\t\tcase \"MultiPolygon\":  ol_geom_handler = olGeom.MultiPolygon; break;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tvar geom = new ol_geom_handler(geojson_geom.coordinates);\r\n\t\t\t\t\t\t//reproject if needed\r\n\t\t\t\t\t\tvar srs_data = dataset.projection;\r\n\t\t\t\t\t\tvar srs_map = this_.map.getView().getProjection();\r\n\t\t\t\t\t\tif(srs_data) if(srs_data.getCode() != srs_map.getCode()){\r\n\t\t\t\t\t\t\tgeom.transform(srs_data, srs_map);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif(ol_geom_handler) geometries.push( geom );\r\n\t\t\t\t\t});\r\n\t\t\t\t\t\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tvar feature_geom = null;\r\n\t\tif(geometries.length==1){\r\n\t\t\tfeature_geom = geometries[0];\r\n\t\t}else{\r\n\t\t\tfeature_geom = new olGeom.GeometryCollection();\r\n\t\t\tfeature_geom.setGeometriesArray(geometries);\r\n\t\t}\r\n\t\tconst feature = new Feature({\r\n\t\t\tgeometry: feature_geom,\r\n\t\t\tstyle : this_.options.find.defaultStyle\r\n\t\t});\r\n\t\tfeature.setId(dataset.pid);\r\n\t\tfeature.ol_uid = dataset.pid;\r\n\t\t\r\n\t\treturn feature;\r\n\t}\r\n\t\r\n\t/**\r\n\t * buildSpatialCoverageDataset\r\n\t * @param datasets\r\n\t */\r\n\tbuildSpatialCoverageDataset(datasets, extended){\r\n\t\tvar this_ = this;\r\n\t\tvar features = datasets.map(function(dataset,i){return this_.buildSpatialCoverageFeature(dataset, extended)});\r\n\t\tfeatures = features.filter(function(feature){if(typeof feature != \"undefined\") return feature;});\r\n\t\treturn features;\r\n\t}\r\n\t\r\n\t/**\r\n\t * setSpatialCoverageLayer\r\n\t * @param datasets\r\n\t */\r\n\tsetSpatialCoverageLayer(datasets, extended, visible){\r\n\t\tvar this_ = this;\r\n\t\t\r\n\t\tvar features = this_.buildSpatialCoverageDataset(datasets, extended);\r\n\t\t\r\n\t\tvar layerId = 'ofv-csw-spatial-coverages';\r\n\t\tvar layer = this.getLayerByProperty(layerId, 'id');\r\n\t\tvar source = new Vector({features: features});\r\n\t\tif(!layer){\r\n\t\t\tvar layer = new VectorLayer({\r\n\t\t\t\tid: undefined, title: undefined,\r\n\t\t\t\tsource: source,\r\n\t\t\t\tvisible: visible\r\n\t\t\t});\r\n\t\t\tlayer.id = layerId;\r\n\t\t\tthis.layers.overlays[this_.options.map.mainlayergroup+1].getLayers().push(layer);\r\n\t\t\tvar layerPointer = new olInteraction.Select({\r\n\t\t\t\tcondition: pointerMove,\r\n\t\t\t\tlayers: [layer]\r\n\t\t\t});\r\n\r\n\t\t\tlayerPointer.on('select', function(evt){\r\n\t\t\t\tif(evt.selected) if(evt.selected.length>0){\r\n\t\t\t\t\tevt.selected.forEach(function(feature){\r\n\t\t\t\t\t\tfeature.setStyle(this_.options.find.hoverStyle);\r\n\t\t\t\t\t\t$(\"#\"+feature.getId()).addClass(\"hovered\");\r\n\t\t\t\t\t});\r\n\t\t\t\t\t\r\n\t\t\t\t}\r\n\t\t\t\tif(evt.deselected) if(evt.deselected.length>0){\r\n\t\t\t\t\tevt.deselected.forEach(function(feature){\r\n\t\t\t\t\t\tfeature.setStyle(null);\r\n\t\t\t\t\t\t$(\"#\"+feature.getId()).removeClass(\"hovered\");\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tthis.map.addInteraction(layerPointer);\r\n\t\t}else{\r\n\t\t\tlayer.setSource(source);\r\n\t\t}\r\n\t}\r\n\t\r\n\t/**\r\n\t * getRecords\r\n\t * @param maxrecords\r\n\t * @param page\r\n\t * @param filter\r\n\t */\r\n\tgetRecords(maxrecords, page, filter){\r\n\t\tvar deferred = $.Deferred();\r\n\t\tvar this_ = this;\r\n\t\tvar last = page * maxrecords;\r\n\t\tvar first = last - maxrecords + 1;\r\n\t\tconsole.log(\"Get CSW Records for page \"+page+\" [from index \"+first+\" to \"+last+\"] ...\");\r\n\t\tthis.csw.GetRecords(first, maxrecords, filter, this.config.OGC_CSW_SCHEMA).then(function(result){\t\t\t\t \r\n\t\t\tvar csw_results = result.value.searchResults.any;\r\n\t\t\tvar datasets = new Array();\t\r\n\t\t\t//post-process results\r\n\t\t\tif(csw_results) for(var i=0;i<csw_results.length;i++){\r\n\t\t\t\tvar csw_result = csw_results[i];    \r\n\t\t\t\tvar md_entry = this_.createMetadataEntry(csw_result.value);\r\n\t\t\t\tdatasets.push(md_entry);\r\n\t\t\t}                       \r\n\t\t\t  \r\n\t\t\tdeferred.resolve(datasets);\r\n\t\t});\r\n\t\treturn deferred.promise();\r\n\t };\r\n\t\t\r\n\t/**\r\n\t * createFilter\r\n\t * @param bbox\r\n\t */\r\n\tcreateFilter(bbox){\r\n\t\tvar this_ = this;\r\n\t\t//base filter\r\n\t\t//on all dc types\r\n\t\tvar dctypes = ['dataset', 'nonGeographicDataset', 'sensor', 'sensorSeries', 'platformSeries', 'productionSeries', 'series', 'transferAggregate', 'otherAggregate'];\r\n\t\tvar filter = new Or(this.config.OGC_FILTER_VERSION, this.config.OGC_FILTER_SCHEMAS, dctypes.map(function(dctype){\r\n\t\t\treturn new IsLike(this_.config.OGC_FILTER_VERSION, this_.config.OGC_FILTER_SCHEMAS, 'dc:type', dctype);\r\n\t\t}));\r\n\t\t\r\n\t\t//add config filters?\r\n\t\tif(typeof this.options.find.filter != 'undefined'){\r\n\t\t\tfilter = new And(this.config.OGC_FILTER_VERSION, this.config.OGC_FILTER_SCHEMAS, [filter, this.options.find.filter]);\r\n\t\t}\r\n\t\t\r\n\t\t//add free text filter?\r\n\t\tvar txt = $(\"#dataset-search-text\").val();\r\n\t\tif(txt != \"\"){\r\n\t\t\ttxt = '%'+txt+'%';\r\n\t\t\tvar txtFilter = new Or(\r\n\t\t\t\tthis.config.OGC_FILTER_VERSION, this.config.OGC_FILTER_SCHEMAS, [\r\n\t\t\t\t\tnew IsLike(this.config.OGC_FILTER_VERSION, this.config.OGC_FILTER_SCHEMAS, 'dc:title', txt),\r\n\t\t\t\t\tnew IsLike(this.config.OGC_FILTER_VERSION, this.config.OGC_FILTER_SCHEMAS, 'dc:subject', txt)\r\n\t\t\t\t]\r\n\t\t\t)\r\n\t\t\tif(typeof filter == 'undefined'){\r\n\t\t\t\tfilter = txtFilter;\r\n\t\t\t}else{\r\n\t\t\t\tfilter = new And(this.config.OGC_FILTER_VERSION, this.config.OGC_FILTER_SCHEMAS, [filter, txtFilter]);\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\t//add spatial filter?\r\n\t\tif(bbox){\r\n\t\t\tfilter = new And(this.config.OGC_FILTER_VERSION, this.config.OGC_FILTER_SCHEMAS, [\r\n\t\t\t\tfilter, new BBOX(this.config.OGC_FILTER_VERSION, this.config.OGC_FILTER_SCHEMAS, bbox[1], bbox[0], bbox[3], bbox[2], 'urn:x-ogc:def:crs:EPSG:6.11:4326')\r\n\t\t\t]);\r\n\t\t}\r\n\t\t\r\n\t\t//category filter\r\n\t\tif($('.dataset-facetitem.selected').length > 0){\r\n\t\t\tvar facet_item_filters = new Array();\r\n\t\t\t$('.dataset-facetitem.selected').each(function(i, item){\r\n\t\t\t\tvar facet_item = $(item).attr('id').split('_facet_item')[0];\r\n\t\t\t\tvar facetitems = [].concat.apply([], this_.options.find.facets.map(function(facet){return facet.items}));\r\n\t\t\t\tvar filter_on_facetitem = facetitems.filter(function(item){if(item.id == facet_item) return item;})[0].filter;\r\n\t\t\t\tfacet_item_filters.push( filter_on_facetitem );\r\n\t\t\t});\r\n\t\t\tvar facet_item_filter = null;\r\n\t\t\tif(facet_item_filters.length == 1){\r\n\t\t\t\tfacet_item_filter = facet_item_filters[0];\r\n\t\t\t}else{\r\n\t\t\t\tfacet_item_filter = new Or(this.config.OGC_FILTER_VERSION, this.config.OGC_FILTER_SCHEMAS, facet_item_filters);\r\n\t\t\t}\r\n\t\t\tfilter = new And(this.config.OGC_FILTER_VERSION, this.config.OGC_FILTER_SCHEMAS, [filter, facet_item_filter]);\r\n\t\t\t$(\"#find-facets-reset\").show();\r\n\t\t}else{\r\n\t\t\t$(\"#find-facets-reset\").hide();\r\n\t\t}\r\n\t\t\r\n\t\treturn filter;\r\n\t}\r\n\t\r\n\t/**\r\n\t * loadTemplate\r\n\t * @param {String} path\r\n\t * @param {String} id\r\n\t */\r\n\tloadTemplate(path, id){\r\n\t\tvar deferred = $.Deferred();\r\n\t\t$.get(path, function(template, textStatus, jqXhr) {\r\n\t\t\tvar template = $(template).filter('#'+id).html();\r\n            deferred.resolve(template);\r\n        });\r\n\t\treturn deferred.promise();\r\n\t}\r\n\t\r\n\t/**\r\n\t * initFindFacets\r\n\t */\r\n\tinitFindFacets(){\r\n\t\tvar this_ = this;\r\n\t\t$(\"#find-facets\").empty();\r\n\t\tthis.loadTemplate('templates/facet_item_tag.tpl.html', 'facetItemTagTpl').then(function(template){\r\n\t\t\tvar dataHtml = '';\r\n\t\t\tfor(var i=0;i<this_.options.find.facets.length;i++){\r\n\t\t\t\tvar facet = this_.options.find.facets[i];\r\n\t\t\t\tdataHtml += '<h6 style=\"font-weight:bold; margin-top:10px;margin-bottom:0px;\">'+ facet.title +'</h6><hr style=\"margin:4px;\">';\r\n\t\t\t\t//facet 'tag' type\r\n\t\t\t\tif(facet.type = 'tag'){\r\n\t\t\t\t\tfor(var j=0;j<facet.items.length;j++){\r\n\t\t\t\t\t\tvar item = facet.items[j];\r\n\t\t\t\t\t\titem.withIcon = item.icon? true : false;\r\n\t\t\t\t\t\tvar item_html = mustache.render(template, {OFV_ID : this_.config.OFV_ID, item: item});\r\n\t\t\t\t\t\tdataHtml += item_html;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t$(\"#find-facets\").html(dataHtml);\r\n\t\t});\r\n\t}\r\n\t\r\n\t/**\r\n\t * getDatasetsFromCSWPage\r\n\t * @param maxrecords\r\n\t * @param page\r\n\t */\r\n\tgetDatasetsFromCSWPage(maxrecords, page){\r\n\t\tvar this_ = this;\r\n\t\t$(\"#dataset-articles\").empty();\r\n\t\t$(\"#dataset-articles\").html('<p id=\"dataset-loader\" class=\"loader-generic loader-generic-wide\"><br /><br /><br />'+this_.options.labels.datasets_loader+'</p>');\r\n\t\t$(\"#dataset-loader\").show();\r\n\t\t\r\n\t\tvar thebbox = null;\r\n\t\tif($(\"#dataset-search-bbox-on-search\").prop(\"checked\")){\r\n\t\t\tthebbox = this_.map.getView().calculateExtent(this_.map.getSize());\r\n\t\t}\r\n\t\t\r\n\t\tvar thefilter = this_.createFilter(thebbox);\r\n\t\tconsole.log(\"OGC Filter:\");\r\n\t\tconsole.log(thefilter);\r\n\t\t\r\n\t\t//display based on templates\r\n\t\tthis.loadTemplate('templates/dataset.tpl.html', 'datasetTpl').then(function(template){\r\n\t\t\r\n\t\t  //get CSW records for page\r\n\t\t  this_.getRecords(maxrecords, page, thefilter).then(function(records){\r\n\t\t\t\r\n\t\t\tthis_.records_on_find = records;\r\n\t\t\t\r\n\t\t\t$(\"#dataset-loader\").hide();\r\n\t\t\t\r\n\t\t\tvar dataHtml = '<section class=\"col-xs-12 col-sm-12 col-md-12\">';\r\n\t\t\tconsole.log(records);\r\n\t\t\tfor(var i=0;i<records.length;i++){\r\n\t\t\t  var record = records[i];\r\n\t\t\t  record.OFV_ID = this_.config.OFV_ID;\r\n\t\t\t  record.labels = this_.options.labels;\r\n\t\t\t  this_.cacheDataset(record);\r\n\t\t\t  var item_html = mustache.render(template, record);\r\n\t\t\t  dataHtml += item_html;\r\n\t\t\t}\r\n\t\t\tdataHtml += '</section>';\r\n\t\t\t$(\"#dataset-articles\").html(dataHtml);\r\n\t\t\tthis_.displayGraphicOverviews();\r\n\t\t\t\r\n\t\t\t//spatial coverage\r\n\t\t\tvar extended = $(\"#dataset-spatial-coverage-extended\").is(\":checked\");\r\n\t\t\tvar visible = $(\"#dataset-spatial-coverage-visible\").is(\":checked\");\r\n\t\t\tthis_.setSpatialCoverageLayer(records, extended, visible);\r\n\t\t\t$(\"article\").each(function(i,item){$(item).on('mouseenter', function(evt){\r\n\t\t\t\tvar vectorLayer = this_.getLayerByProperty(\"ofv-csw-spatial-coverages\", \"id\");\r\n\t\t\t\tvar vectorFeature = vectorLayer.getSource().getFeatureById($(item)[0].id);\r\n\t\t\t\tif(vectorFeature && $(\"#dataset-spatial-coverage-visible\").is(\":checked\")){\r\n\t\t\t\t\tvar select = this_.map.getInteractions().getArray().filter(function(item){return item instanceof olInteraction.Select});\r\n\t\t\t\t\tif(select.length>0) select = select[0];\r\n\t\t\t\t\tvectorFeature.setStyle(this_.options.find.hoverStyle);\r\n\t\t\t\t\tselect.getFeatures().push(vectorFeature);\r\n\t\t\t\t\tselect.dispatchEvent('select');\r\n\t\t\t\t}\r\n\t\t\t})});\r\n\t\t\t$(\"article\").each(function(i,item){$(item).on('mouseleave', function(evt){\r\n\t\t\t\tvar vectorLayer = this_.getLayerByProperty(\"ofv-csw-spatial-coverages\", \"id\");\r\n\t\t\t\tvar vectorFeature = vectorLayer.getSource().getFeatureById($(item)[0].id);\r\n\t\t\t\tif(vectorFeature && $(\"#dataset-spatial-coverage-visible\").is(\":checked\")){\r\n\t\t\t\t\tvar select = this_.map.getInteractions().getArray().filter(function(item){return item instanceof olInteraction.Select});\r\n\t\t\t\t\tif(select.length>0) select = select[0];\r\n\t\t\t\t\tvectorFeature.setStyle(null);\r\n\t\t\t\t\tselect.getFeatures().remove(vectorFeature);\r\n\t\t\t\t\tselect.dispatchEvent('select');\t\t\t\t\t\r\n\t\t\t\t}\r\n\t\t\t})});\r\n\t\t  });\r\n\t\t  \r\n\t\t});\r\n\t}\r\n\t\t\r\n\t/**\r\n\t * getDatasetsFromCSW\r\n\t * @param maxrecords\r\n\t * @param bbox\r\n\t */\r\n\tgetDatasetsFromCSW(maxrecords, bbox){\r\n\r\n\t\t$(\"#dataset-count\").empty();\r\n\t\t$(\"#dataset-articles\").empty();\r\n\t\t$(\"#dataset-articles\").html('<p id=\"dataset-loader\" class=\"loader-generic loader-generic-wide\"><br /><br /><br />Fetching datasets...</p>');\r\n\t\t$(\"#dataset-loader\").show();\r\n\t\t\r\n\t\t//business logic\r\n\t\tvar this_ = this;\r\n\t\tvar deferred = $.Deferred();\r\n\t\tif(!this.csw) deferred.reject(\"CSW endpoint is not instantiated!\");\r\n\t\tif(this.csw){\r\n\t\t\t\r\n\t\t\t//filter\r\n\t\t\tvar filter = this.createFilter(bbox);\r\n\t\t\tconsole.log(\"OGC Filter:\");\r\n\t\t\tconsole.log(filter);\r\n\t\t\t\r\n\t\t\t//get 1st record to get numberOfRecordsMatched\r\n\t\t\tthis.csw.GetRecords(1,1, filter, this.config.OGC_CSW_SCHEMA).then(function(response){\r\n\t\t\t\t\r\n\t\t\t\t//manage maxNb\r\n\t\t\t\tvar numberOfRecordsMatched = response.value.searchResults.numberOfRecordsMatched;\r\n\t\t\t\tconsole.log(\"CSW GetRecords matched \"+numberOfRecordsMatched+\" records\");\r\n\t\t\t\tvar maxNb = numberOfRecordsMatched;\r\n\t\t\t\tif(this_.options.find.maxitems && numberOfRecordsMatched > this_.options.find.maxitems){\r\n\t\t\t\t\tconsole.log(\"Max items option set. Restraining number of records retrieved to \"+this_.options.find.maxitems+\" records\");\r\n\t\t\t\t\tmaxNb = this_.options.find.maxitems;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t//add datasets counting\r\n\t\t\t\t$(\"#dataset-count\").html(maxNb + \" \" + this_.options.labels.datasets);\r\n\t\t\t\t//Set paginated browsing operated by OGC CSW protocol\r\n\t\t\t\t$(\"#dataset-pages\").bootpag({\r\n\t\t\t\t\ttotal: Math.ceil(maxNb / maxrecords)\r\n\t\t\t\t}).trigger(\"page\", 1);\r\n\t\t\t});\r\n\t\t}\r\n\t\treturn deferred.promise();\r\n\t}\r\n        \r\n        \r\n\t/**\r\n\t * displayDatasets\r\n\t * @param maxrecords\r\n\t * @param bbox\r\n\t * @param facetItem\r\n\t */\r\n\tdisplayDatasets(maxrecords, bbox, facetItem){\r\n\t\tvar this_ = this;\r\n\t\tif($(\"#dataset-search-bbox-on-search\").prop(\"checked\") && !bbox){\r\n\t\t\tbbox = this.map.getView().calculateExtent(this.map.getSize());\r\n\t\t}\r\n\t\tthis.getDatasetsFromCSW(maxrecords, bbox, facetItem);\r\n\t}\r\n\t \r\n\t/**\r\n\t * displayGraphicOverviews\r\n\t */\r\n\tdisplayGraphicOverviews(){\r\n\t\tvar imgs = $(\"img.graphic_overview\");\r\n\t\t$.each(imgs, function () {\r\n\t\t\tvar $this = $(this);\r\n\t\t\tvar im = new Image();\r\n\t\t\tim.onload = function () {\r\n\t\t\t\tvar theImage = $this;\r\n\t\t\t\t$this.hide();\r\n\t\t\t\ttheImage[0].src = im.src;\r\n\t\t\t\t$this.removeClass(\"loader-generic\");\r\n\t\t\t\t$this.show();\r\n\t\t\t};\r\n\t\t\tim.onerror = function(){\r\n\t\t\t\tvar theImage = $this;\r\n\t\t\t\t$this.hide();\r\n\t\t\t\t$this.removeAttr(\"alt\");\r\n\t\t\t\t$this[0].src = \"img/loading-error.svg\";\r\n\t\t\t\t$this.show();\r\n\t\t\t}\r\n\t\t\t$this.addClass(\"loader-generic\");\r\n\t\t\tim.src = $this.attr(\"src\");\r\n\t\t});\r\n\t}\r\n  \r\n\t/**\r\n\t * displayDatasetMetadata\r\n\t * Display the metadata associated to a dataset\r\n\t * @param elm\r\n\t *\r\n\t **/\r\n\tdisplayDatasetMetadata(elm){  \r\n\t\tvar pid = elm.getAttribute('data-pid');\r\n\t\tconsole.log(\"Display metadata dataset with pid = \" + pid);\r\n\t\tvar dataset = null;\r\n\t\tif(this.dataset_on_query){\r\n\t\t\tif(pid == this.dataset_on_query.pid) dataset = this.dataset_on_query.entry;\r\n\t\t}\r\n\t\tif(!dataset){\r\n\t\t\tdataset = this.datasets.filter(function(data){if(data.pid == pid){return data}})[0];\r\n\t\t}\r\n\t\tif(!dataset){\r\n\t\t\tconsole.warn(\"displayDatasetMetadata disabled, can't find dataset for pid '\"+pid+\"'\");\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis.options.find.datasetInfoHandler(dataset.metadata);\r\n\t}\r\n\t  \r\n\t/**\r\n\t * displayDatasetQueryForm\r\n\t * Displays a dataset query form\r\n\t * @param elm\r\n\t *\r\n\t **/  \r\n\tdisplayDatasetQueryForm(elm){\r\n\t\tvar pid = elm.getAttribute('data-pid');\r\n\t\tconsole.log(\"Display query form dataset with pid = \" + pid);\r\n\t\tvar dataset = this.datasets.filter(function(data){if(data.pid == pid){return data}});\r\n\t\tif(dataset.length>0) dataset = dataset[0];\r\n\t\tthis.handleQueryForm(dataset, false);\r\n\t}\r\n\t\r\n\t/**\r\n\t * zoomToExtent\r\n\t * Zooms to dataset extent\r\n\t * @param elm\r\n\t *\r\n\t **/  \r\n\tzoomToExtent(elm){\r\n\t\tvar pid = elm.getAttribute('data-pid');\r\n\t\tconsole.log(\"Zoom to dataset with pid = \" + pid);\r\n\t\tvar dataset = null\r\n\t\tif(this.dataset_on_query){\r\n\t\t\tif(pid == this.dataset_on_query.pid) dataset = this.dataset_on_query.entry;\r\n\t\t}\r\n\t\tif(!dataset){\r\n\t\t\tdataset = this.datasets.filter(function(data){if(data.pid == pid){return data}});\r\n\t\t\tif(dataset.length>0) dataset = dataset[0];\r\n\t\t}\r\n\t\tif(!dataset){\r\n\t\t\tconsole.warn(\"zoomToExtent disabled, no dataset identified from pid '\"+pid+\"'\");\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\tvar idents = dataset.metadata.identificationInfo;\r\n\t\tif(!idents) return; if(idents.length == 0) return;\r\n\t\tvar extents = idents[0].extent;\r\n\t\tif(!extents) return; if(extents.length == 0) return;\r\n\t\tvar geo_extents = extents[0].exExtent.geographicElement;\r\n\t\tif(!geo_extents) return; if(geo_extents.length == 0) return;\r\n\r\n\t\tvar geo_extent = geo_extents[0];\r\n\t\tvar geo_keys = Object.keys(geo_extent);\r\n\t\tvar is_bbox = geo_keys.indexOf(\"westBoundLongitude\")!=-1 && geo_keys.indexOf(\"eastBoundLongitude\")!=-1 && \r\n\t\t\t\t\t  geo_keys.indexOf(\"southBoundLatitude\")!=-1 && geo_keys.indexOf(\"northBoundLatitude\")!=-1;\r\n\t\t\r\n\t\t//bounding box coords\r\n\t\tvar coords = undefined;\r\n\t\tif(is_bbox){\r\n\t\t\t//case of bounding box\r\n\t\t\tcoords = [\r\n\t\t\t\tgeo_extent.westBoundLongitude, geo_extent.southBoundLatitude,\r\n\t\t\t\tgeo_extent.eastBoundLongitude, geo_extent.northBoundLatitude\r\n\t\t\t]\r\n\t\t}else{\r\n\t\t\t//TODO get bounding box from bounding polygon - not implemented\r\n\t\t}\r\n\t\t\r\n\t\t//projection\r\n\t\tvar srs_data = dataset.projection;\r\n\t\tvar srs_map = this.map.getView().getProjection();\r\n\t\tif(srs_data) if(srs_data.getCode() != srs_map.getCode()){\r\n\t\t\tconsole.log(\"Dataset projection:\");\r\n\t\t\tconsole.log(srs_data);\r\n\t\t\tconsole.log(\"Map projection:\");\r\n\t\t\tconsole.log(srs_map);\r\n\t\t\tconsole.log(\"Dataset projection ('\"+srs_data+\"') differs from map projection ('\"+srs_map+\"'). Reprojecting bounding box!\");\r\n\t\t\tconsole.log(\"Coordinates (source) = [\"+ coords + \"]\")\r\n\t\t\tvar extentGeom = fromExtent(coords);\r\n\t\t\textentGeom.transform(srs_data, srs_map);\r\n\t\t\tcoords = extentGeom.getExtent();\r\n\t\t\tconsole.log(\"Coordinates (reprojected) = [\"+ coords + \"]\")\r\n\t\t}\r\n\t\t\r\n\t\t//zoom\r\n\t\tif(coords) this.map.getView().fit(coords,this.map.getSize());\r\n\t}\r\n\t  \r\n\t/**\r\n\t * cacheDataset\r\n\t * Cache a dataset\r\n\t * @param dataset\r\n\t *\r\n\t **/\r\n\tcacheDataset(dataset){\r\n\t\tvar pid = dataset.pid;\r\n\t\tconsole.log(\"Cache dataset with pid = \" + pid);\r\n\t\tvar out =false;\r\n\t\tif(this.datasets.map(function(i){return i.pid}).indexOf(pid) == -1){\r\n\t\t\tthis.datasets.push(dataset);\r\n\t\t\tout = true;   \r\n\t\t}\r\n\t\treturn out;\r\n\t}\t  \r\n\t  \r\n\t/**\r\n\t * selectDatasetView\r\n\t * Selects a dataset\r\n\t * @param dataset\r\n\t * @param lyr\r\n\t *\r\n\t **/\r\n\tselectDatasetView(dataset, lyr){\r\n\t\tconsole.log(\"Select dataset with pid = \" + dataset.pid + \", lyr = \"+lyr);\r\n\t\tvar out =false;\r\n\t\tif(this.selection.map(function(i){return i.lyr}).indexOf(lyr) == -1){\r\n\t\t\tdataset.lyr = lyr;\r\n\t\t\tthis.selection.push(dataset);\r\n\t\t\tout = true;   \r\n\t\t}\r\n\t\treturn out;\r\n\t}\r\n         \r\n\t/**\r\n\t * unselectDatasetView\r\n\t * Unselects a dataset\r\n\t * @param elm\r\n\t**/\r\n\tunselectDatasetView(elm){\r\n\t\tvar this_ = this;\r\n\t\tvar lyr = elm.getAttribute('data-lyr');\r\n\t\tconsole.log(\"Unselect dataset view with lyr = \" + lyr);\r\n\t\t//var thepid = null;\r\n\t\t//if(this.dataset_on_query) thepid = this.dataset_on_query.pid;\r\n\t\tvar out = false;\r\n\t\tvar len1 = this.selection.length;\r\n\t\tthis.selection = this.selection.filter(function(i,data){if(data.lyr != lyr){return data}});\r\n\t\tvar len2 =  this.selection.length;\r\n\t\tout = len2<len1;\r\n\r\n\t\t//clear dsd interface in case selected dataset\r\n\t\t//if(this.dataset_on_query) if(this.dataset_on_query.pid == pid){\r\n\t\t//\t$(\"#dsd-ui\").empty();\r\n\t\t//\tthis.dataset_on_query = null;\r\n\t\t//}\r\n\t\t\r\n\t\tthis.removeLayerByProperty(lyr, \"id\");\r\n\t\tthis.map.changed();\r\n\t\tthis_.renderMapLegend();\r\n\t\t//if(pid == thepid) this.openFindDialog();\r\n\r\n\t\treturn out;\r\n\t}\r\n\t\r\n\t\r\n\tresolveDatasetDOI(elm){\r\n\t\tvar pid = elm.getAttribute('data-pid');\r\n\t\tconsole.log(\"Resove DOI for dataset pid = \" + pid);\r\n\t\tvar the_dataset = null;\r\n\t\tif(this.dataset_on_query){\r\n\t\t\tif(pid == this.dataset_on_query.pid) the_dataset = this.dataset_on_query.entry;\r\n\t\t}\r\n\t\tif(!the_dataset){\r\n\t\t\tthe_dataset = this.datasets.filter(function(item){if(item.pid == pid) return item});\r\n\t\t\tif(the_dataset.length > 0) the_dataset = the_dataset[0];\r\n\t\t}\r\n\t\tif(!the_dataset){\r\n\t\t\tconsole.warn(\"resolveDatasetDOI disabled, can't find dataset for pid '\"+pid+\"'\");\r\n\t\t\treturn;\r\n\t\t}\r\n\t\twindow.open(\"//dx.doi.org/\" + the_dataset.doi,'_blank');\r\n\t}\r\n\r\n\t\r\n\t/**\r\n\t * getCSWRecord\r\n\t * @param pid\r\n\t * @returns a promise\r\n\t */\r\n\tgetCSWRecord(pid){\r\n\t\tconsole.log(\"Fetching metadata record from CSW for pid = '\"+pid+\"'\");\r\n\t\tvar this_ = this;\r\n\t\tvar deferred = $.Deferred();\r\n\t\tvar pidFilter =  new IsLike(this.config.OGC_FILTER_VERSION, this.config.OGC_FILTER_SCHEMAS, 'dc:identifier', pid);\r\n\t\tthis_.csw.GetRecords(1, 1, pidFilter, this_.config.OGC_CSW_SCHEMA).then(function(result){\r\n\t\t\tvar md_entry = new Object();\r\n\t\t\tif(result.value.searchResults.numberOfRecordsMatched > 0){                 \r\n                var csw_results = result.value.searchResults.any;\r\n\t\t\t\tmd_entry = this_.createMetadataEntry(csw_results[0].value);\r\n\t\t\t}\r\n\t\t\tdeferred.resolve(md_entry);\r\n\t\t});\r\n\t\treturn deferred.promise();\r\n\t}\r\n\t\r\n\t//===========================================================================================\r\n\t//QUERY\r\n\t//===========================================================================================\r\n\t\r\n\t/**\r\n\t * OpenFairViewer.prototype.parseFeatureCatalogue\r\n\t * @param {#document} response from a Get request over the FeatureCatalogue ISO 19110 XML\r\n\t * @returns {Object} a DSD json object\r\n\t */\r\n\tparseFeatureCatalogue(response){\r\n\t\r\n\t\t//artisanal parsing of feature catalog XML\r\n\t\t//TODO keep investigating ogc-schemas extension for gfc.xsd with jsonix!!!!\r\n\t\tvar dsd = { strategy: undefined, components: new Array() };\r\n\t\tvar featureCatalogue = $(response.childNodes[0].childNodes).filter(function(idx,item){if(item.nodeName == \"gfc:FC_FeatureCatalogue\") return item;})\r\n\t\tif(featureCatalogue.length == 0){\r\n\t\t\tconsole.warn(\"No feature catalogue!\")\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\t//inherit feature catalogue scopes to define query strategy\r\n\t\t//Note: code maintained for backward compatibility for old files produced by geoflow. Next this will be inherited from ISO 19115/ ServiceIdentification\r\n\t\tvar strategy = \"ogc_filters\";\r\n\t\tvar scopes = $(featureCatalogue[0].childNodes).filter(function(i,item){if(item.nodeName == \"gmx:scope\") return item});\r\n\t\tif(scopes.length == 0) {\r\n\t\t\tconsole.warn(\"No feature catalogue scope, setting default strategy to 'ogc_filters'\");\r\n\t\t}else{\r\n\t\t\tvar ofv_scopes = scopes.filter(function(i,item){if(item.children[0].textContent.startsWith(\"openfairviewer\")) return item});\r\n\t\t\tif(ofv_scopes.length > 0){\r\n\t\t\t\tstrategy = ofv_scopes[0].children[0].textContent.split(\":\")[1];\r\n\t\t\t\tconsole.log(\"OpenFairViewer Strategy read from Feature catalogue scope: \"+strategy);\r\n\t\t\t}\r\n\t\t}\r\n\t\tdsd.strategy = strategy;\r\n\t\t\r\n\t\t//get feature types\r\n\t\tvar featureTypes = $(featureCatalogue[0].childNodes).filter(function(idx,item){if(item.nodeName == \"gfc:featureType\") return item;});\r\n\t\r\n\t\tvar ft = featureTypes[0];\r\n\t\t//get carrier of characteristics\r\n\t\tvar characteristics = $(ft.childNodes[1].childNodes).filter(function(idx,item){ if(item.nodeName == \"gfc:carrierOfCharacteristics\") return item;});\r\n\t\tfor(var i=0;i<characteristics.length;i++){\r\n\t\t\tvar characteristic = characteristics[i];\r\n\t\t\tvar featureAttribute = characteristic.childNodes[1];\r\n\t\t\t//name\r\n\t\t\tvar fatName = $(featureAttribute.childNodes).filter(function(i,item){if(item.nodeName == \"gfc:memberName\") return item;}); \r\n\t\t\tif(fatName.length > 0) fatName = fatName[0].childNodes[1].textContent;\r\n\t\t\t//def\r\n\t\t\tvar fatDef = $(featureAttribute.childNodes).filter(function(i,item){if(item.nodeName == \"gfc:definition\") return item;});\r\n\t\t\tif(fatDef.length > 0) if(fatDef[0].childNodes.length > 0) {\r\n\t\t\t\tfatDef = fatDef[0].childNodes[1].textContent;\r\n\t\t\t}else{\r\n\t\t\t\tfatDef = null;\r\n\t\t\t}\r\n\t\t\t//code\r\n\t\t\tvar fatCode = $(featureAttribute.childNodes).filter(function(i,item){if(item.nodeName == \"gfc:code\") return item;});\r\n\t\t\tif(fatCode.length > 0) fatCode = fatCode[0].childNodes[1].textContent;\r\n\t\t\t//primitive type\r\n\t\t\tvar fatType = $(featureAttribute.childNodes).filter(function(i,item){if(item.nodeName == \"gfc:valueType\") return item;});\r\n\t\t\tvar fatColType = null;\r\n\t\t\tvar fatPrimType = null;\t\r\n\t\t\tif(fatType.length > 0){\r\n\t\t\t\tvar fatChildNode = fatType[0].childNodes[1].childNodes[1].childNodes[1];\r\n\t\t\t\tfatPrimType = fatChildNode.textContent;\r\n\t\t\t\tif(fatChildNode.hasAttribute(\"xlink:href\")){\r\n\t\t\t\t\tfatColType = fatChildNode.getAttribute(\"xlink:href\");\r\n\t\t\t\t}else{\r\n\t\t\t\t\tconsole.warn(\"No attribute/variable href defined as column type for attribute \"+fatCode+\" - default set to 'attribute'\");\r\n\t\t\t\t\tfatColType = \"attribute\";\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t//cardinality\r\n\t\t\tvar minOccurs = 0;\r\n\t\t\tvar maxOccurs = 1;\r\n\t\t\tvar fatCardinality = $(featureAttribute.childNodes).filter(function(i,item){if(item.nodeName == \"gfc:cardinality\") return item;});\r\n\t\t\tif(fatCardinality.length > 0) {\r\n\t\t\t\tfatCardinality = fatCardinality[0].childNodes[1].childNodes[1].childNodes[1].childNodes;\r\n\t\t\t\tminOccurs = parseInt(fatCardinality[1].childNodes[1].textContent);\r\n\t\t\t\tif(fatCardinality[3].childNodes[1].getAttribute(\"isInfinite\") == \"true\"){\r\n\t\t\t\t\tmaxOccurs = Infinity;\r\n\t\t\t\t}else{\r\n\t\t\t\t\tmaxOccurs = parseInt(fatCardinality[3].childNodes[1].textContent);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t//measurementUnit\r\n\t\t\tvar gmlUnitIdentifier = null;\r\n\t\t\tvar gmlUnitName = null;\r\n\t\t\tvar fatMeasurementUnit = $(featureAttribute.childNodes).filter(function(i,item){if(item.nodeName == \"gfc:valueMeasurementUnit\") return item;});\r\n\t\t\tif(fatMeasurementUnit.length > 0){\r\n\t\t\t\tif(fatMeasurementUnit[0].childNodes.length > 0){\r\n\t\t\t\t\tvar gmlUnit = $(fatMeasurementUnit[0].childNodes[1]);\r\n\t\t\t\t\tvar gmlUnitIdentifierXml = gmlUnit.children().filter(function(i,item){if(item.nodeName == \"gml:identifier\") return item;});\r\n\t\t\t\t\tif(gmlUnitIdentifierXml.length > 0) gmlUnitIdentifier = gmlUnitIdentifierXml[0].textContent;\r\n\t\t\t\t\tvar gmlUnitNameXml = gmlUnit.children().filter(function(i,item){if(item.nodeName == \"gml:name\") return item;});\r\n\t\t\t\t\tif(gmlUnitNameXml.length > 0) gmlUnitName = gmlUnitNameXml[0].textContent;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t//featureAttributeModel\r\n\t\t\tvar featureAttributeModel = {\r\n\t\t\t\tname : fatName, definition : fatDef, primitiveCode: fatCode, primitiveType: fatPrimType, columnType: fatColType, \r\n\t\t\t\tminOccurs: minOccurs, maxOccurs: maxOccurs,\r\n\t\t\t\tuom : gmlUnitIdentifier, uomLabel: gmlUnitName,\r\n\t\t\t\tvalues: null\r\n\t\t\t};\r\n\t\t\t//values\r\n\t\t\tvar listedValues = $(featureAttribute.childNodes).filter(function(i,item){if(item.nodeName == \"gfc:listedValue\") return item;});\r\n\t\t\tif(listedValues.length > 0){\r\n\t\t\t\tfeatureAttributeModel.values = new Array();\r\n\t\t\t\tfor(var j=0;j<listedValues.length;j++){\r\n\t\t\t\t\tvar listedValue = listedValues[j];\r\n\t\t\t\t\tvar props = listedValue.childNodes[1].childNodes;\r\n\t\t\t\t\tvar clCode = props[3].childNodes[1].textContent;\r\n\t\t\t\t\tvar clLabel = props[1].childNodes.length > 0? props[1].childNodes[1].textContent : \"\";\r\n\t\t\t\t\tvar clDefinition = undefined;\r\n\t\t\t\t\tif(props[5]) if(props[5].childNodes.length > 0) clDefinition = props[5].childNodes[1].textContent;\r\n\t\t\t\t\tvar clHref = props[3].childNodes[1].getAttribute('xlink:href');\r\n\t\t\t\t\tvar clItem = {id: clCode, text: clLabel, alternateText: (clDefinition? clDefinition : null), codelist: featureAttributeModel.primitiveCode, href: clHref};\r\n\t\t\t\t\tfeatureAttributeModel.values.push(clItem);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tdsd.components.push(featureAttributeModel);\r\n\t\t}\r\n\t\tconsole.log(dsd);\r\n\t\treturn dsd;\r\n\t}\r\n\t\r\n\r\n\t\r\n\t/**\r\n\t * OpenFairViewer.prototype.parseCoverageDescription\r\n\t * @param dataset\r\n\t * @returns {Object} a DSD json object\r\n\t */\r\n\tparseCoverageDescription(dataset){\r\n\t\t\r\n\t\tvar this_ = this;\r\n\t\tvar pid = dataset.pid;\r\n\t\tvar lyr = dataset.lyr;\r\n\t\tvar entry = dataset.entry? dataset.entry : dataset;\r\n\t\tvar dsd = { strategy: this.getStrategy(dataset), components: new Array() };\r\n\t\t\r\n\t\tvar serviceContentInfo = entry.metadata.contentInfo.filter(function(item){\r\n\t\t\treturn item.attributeDescription.recordType.value == \"service\";\r\n\t\t});\r\n\t\tif(serviceContentInfo.length > 0){\r\n\t\t\tserviceContentInfo = serviceContentInfo[0];\r\n\t\t\tif(serviceContentInfo.dimension) if(serviceContentInfo.dimension.length > 0){\r\n\t\t\t\tdsd.components = serviceContentInfo.dimension.map(function(item){\r\n\t\t\t\t\t\r\n\t\t\t\t\tvar name = item.mdRangeDimension.sequenceIdentifier.memberName.aName;\r\n\t\t\t\t\tvar primitiveType = item.mdRangeDimension.sequenceIdentifier.memberName.attributeType.typeName.aName;\r\n\t\t\t\t\t\r\n\t\t\t\t\tvar dimensionModel = {\r\n\t\t\t\t\t\tname : name, definition : null, \r\n\t\t\t\t\t\tprimitiveCode: name, primitiveType: primitiveType, \r\n\t\t\t\t\t\tcolumnType: \"attribute\", minOccurs: null, maxOccurs: null,\r\n\t\t\t\t\t\tuom : null, uomLabel: null,\r\n\t\t\t\t\t\tvalues: null\r\n\t\t\t\t\t};\r\n\t\t\t\t\t\r\n\t\t\t\t\tif(serviceContentInfo.rangeElementDescription){\r\n\t\t\t\t\t\tvar rangeElementDesc = serviceContentInfo.rangeElementDescription.filter(function(rangedesc){\r\n\t\t\t\t\t\t\tconsole.log(rangedesc);\r\n\t\t\t\t\t\t\tif(rangedesc.miRangeElementDescription.name == name) return rangedesc;\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\tif(rangeElementDesc.length > 0){\r\n\t\t\t\t\t\t\trangeElementDesc = rangeElementDesc[0].miRangeElementDescription;\r\n\t\t\t\t\t\t\tif(rangeElementDesc.rangeElement) if(rangeElementDesc.rangeElement.length > 0){\r\n\t\t\t\t\t\t\t\tdimensionModel.minOccurs = rangeElementDesc.rangeElement[0].record.content[0];\r\n\t\t\t\t\t\t\t\tdimensionModel.maxOccurs = rangeElementDesc.rangeElement[rangeElementDesc.rangeElement.length-1].record.content[0];\r\n\t\t\t\t\t\t\t\tdimensionModel.values = rangeElementDesc.rangeElement.map(function(rangeElem){\r\n\t\t\t\t\t\t\t\t\treturn {id: rangeElem.record.content[0], text: \"\", alternateText: null, codelist: name, href: null};\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn dimensionModel;\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\treturn dsd;\r\n\t}\r\n\t\r\n\t\r\n\t/**\r\n\t * parseLayerDescription\r\n\t * @param dataset\r\n\t * @param ogclayer\r\n\t * @returns {Object} a DSD json object\r\n\t */\r\n\tparseLayerDescription(dataset, ogclayer){\r\n\t\tvar this_ = this;\r\n\t\tvar pid = dataset.pid;\r\n\t\tvar lyr = dataset.lyr;\r\n\t\tvar entry = dataset.entry? dataset.entry : dataset;\r\n\t\tvar dsd = { strategy: this.getStrategy(dataset), components: new Array() };\r\n\t\tvar ogc_layers = dataset.capabilities.capability.layer.layer[0].layer.filter(function(item){if(item.name == ogclayer) return ogclayer;});\r\n\t\tif(ogc_layers.length > 0){\r\n\t\t\tvar ogc_layer = ogc_layers[0];\r\n\t\t\tvar ogc_dims = ogc_layer.dimension;\r\n\t\t\tif(ogc_dims.length > 0){\r\n\t\t\t\tdsd.components = ogc_dims.map(function(item){\r\n\t\t\t\t\tvar primitiveType = null;\r\n\t\t\t\t\tvar name = item.name.toUpperCase();\r\n\t\t\t\t\tswitch(name){\r\n\t\t\t\t\t\tcase \"TIME\": primitiveType = \"xsd:datetime\"; break;\r\n\t\t\t\t\t\tcase \"ELEVATION\": primitiveType = \"xsd:decimal\"; break;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tvar dimensionModel = {\r\n\t\t\t\t\t\tname : name, definition : null, \r\n\t\t\t\t\t\tprimitiveCode: name, primitiveType: primitiveType, \r\n\t\t\t\t\t\tcolumnType: \"attribute\", minOccurs: null, maxOccurs: null,\r\n\t\t\t\t\t\tuom : null, uomLabel: null,\r\n\t\t\t\t\t\tvalues: null\r\n\t\t\t\t\t};\r\n\t\t\t\t\tvar dimension_values = item.value.replaceAll(' ','').replace('\\n', '').split(',');\r\n\t\t\t\t\tdimensionModel.values = dimension_values.map(function(value){\r\n\t\t\t\t\t\treturn {id: value, text: \"\", alternateText: null, codelist: name, href: null};\r\n\t\t\t\t\t});;\r\n\t\t\t\t\tdimensionModel.minOccurs = dimension_values[0];\r\n\t\t\t\t\tdimensionModel.maxOccurs = dimension_values[dimension_values.length-1];\r\n\t\t\t\t\treturn dimensionModel;\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t}\r\n\t\tconsole.log(dsd);\r\n\t\treturn dsd;\r\n\t}\r\n\t\r\n\t/**\r\n\t * handleQueryForm\r\n\t * @param {Object} dataset\r\n\t * @param {Boolean} dsdOnly\r\n\t */\r\n\thandleQueryForm(dataset, dsdOnly){\r\n\t\tconsole.log(dataset);\r\n\t\t$(\"#dsd-ui\").empty();\r\n\t\tvar entry = dataset.entry? dataset.entry : dataset;\r\n\t\tif(entry.dsdModel == \"FeatureCatalogue\"){\r\n\t\t\tconsole.log(\"Handle DSD Query Form from FeatureCatalogue (ISO 19110) for dataset with pid = \" + dataset.pid );\r\n\t\t\treturn this.handleDSDFromFeatureCatalogue(dataset, dsdOnly);\r\n\t\t}else if(entry.dsdModel == \"CoverageDescription\"){\r\n\t\t\tconsole.log(\"Handle DSD Query Form from CoverageDescription (ISO 19115-2) for dataset with pid = \" + dataset.pid );\r\n\t\t\treturn this.handleDSDFromCoverageDescription(dataset, dsdOnly);\r\n\t\t}else if(entry.dsdModel == \"none\"){ \r\n\t\t\tconsole.log(\"Handle Filter Query Form for dataset with pid = \" + dataset.pid );\r\n\t\t\treturn this.handleFilter(dataset);\r\n\t\t};\t\t\r\n\t}\r\n\t\r\n\t/**\r\n\t * Enable the query and map button\r\n\t * @param columnIdx\r\n\t */\r\n\thandleQueryAndMapButton(columnIdx){\r\n\t\t$(\"#dsd-ui-col-\"+columnIdx).append('<br><br>');\r\n\t\t$(\"#dsd-ui-col-\"+columnIdx).append('<button type=\"submit\" id=\"datasetMapper\" style=\"width:90%;\" title=\"'+this.options.labels.dataset_query_map_title+'\" data-loading-text=\"<span class=\\'query-loader\\'></span>\" class=\"btn btn-primary\">'+this.options.labels.dataset_query_map+'</button>');\r\n\t\t$(\"#dsd-ui-col-\"+columnIdx).append('<br><span class=\"query-nodata\" style=\"display:none;\">'+this.options.labels.nodata+'</span>');\r\n\t}\r\n\r\n\t/**\r\n\t * handleQueryFormButtons\r\n\t * @param columnIdx\r\n\t */\r\n\thandleQueryFormButtons(columnIdx){\r\n\t\tvar this_ = this;\r\n\t\t\r\n\t\tvar layerName = this_.dataset_on_query.pid;\r\n\t\tvar layer = this_.getLayerByProperty(this_.dataset_on_query.pid, 'id');\r\n\t\t\t\t\r\n\t\t//main export methods\r\n\t\t//------------------------------\r\n\t\t$(\"#dsd-ui-col-\"+columnIdx).append('<div id=\"dsd-ui-export-methods1\" style=\"margin: 0 auto;width: 90%;text-align: center !important;\"><p style=\"margin:0;\"></div>');\r\n\t\tthis.options.access.exports.filter(function(item){if(item.main) return item;}).forEach(function(export_method){\r\n\t\t\tvar services_are_available = true;\r\n\t\t\tif(export_method.services) if(export_method.services.length > 0){\r\n\t\t\t\tservices_are_available = export_method.services.filter(function(item){\r\n\t\t\t\t\tvar service_is_available = false;\r\n\t\t\t\t\tif(this_.dataset_on_query.entry[item]) if(this_.dataset_on_query.entry[item].length > 0) service_is_available = true;\r\n\t\t\t\t\treturn service_is_available;\r\n\t\t\t\t}).length == export_method.services.length;\r\n\t\t\t}\r\n\t\t\tvar add = export_method.enabled && services_are_available;\r\n\t\t\tif(export_method.id == \"data-dashboard\") add = add && this_.hasDashboards(this_.dataset_on_query);\r\n\t\t\tif(add){\r\n\t\t\t\tvar button_id = \"dsd-ui-button-\"+export_method.id;\r\n\t\t\t\tvar button_class = \"btn data-action-button \"+export_method[\"class\"];\r\n\t\t\t\tvar button_export_method = '<button type=\"button\" id=\"'+button_id+'\" class=\"'+button_class+'\" title=\"'+export_method.title+'\" onclick=\"'+this_.config.OFV_ID+'.triggerExport(\\''+export_method.id+'\\')\"></button>';\r\n\t\t\t\t$(\"#dsd-ui-export-methods1\").append(button_export_method);\r\n\t\t\t}\r\n\t\t});\r\n\t\t\r\n\t\t//additional export buttons\r\n\t\t$(\"#dsd-ui-col-\"+columnIdx).append('<div id=\"dsd-ui-export-methods2\" style=\"padding:0px 15px;text-align: left !important;\"></div>');\r\n\t\tvar export_more = '<a data-toggle=\"collapse\" href=\"#dataset-export-methods2\" role=\"button\" aria-expanded=\"false\" aria-controls=\"dataset-export-methods2\">'+this_.options.labels.export_options_more+'</a><br>';\r\n\t\texport_more += '<div class=\"collapse multi-collapse\" id=\"dataset-export-methods2\">';\r\n\t\texport_more += '<fieldset style=\"border: 1px #ccc solid;border-radius:4px;padding:4px;\">';\r\n\t\texport_more += '<div class=\"data-export-buttons\">';\r\n\t\tvar exports_added = new Array();\r\n\t\tthis.options.access.exports.filter(function(item){if(!item.main) return item;}).forEach(function(export_method){\r\n\t\t\tvar services_are_available = true;\r\n\t\t\tif(export_method.services) if(export_method.services.length > 0){\r\n\t\t\t\tservices_are_available = export_method.services.filter(function(item){\r\n\t\t\t\t\tvar service_is_available = false;\r\n\t\t\t\t\tif(this_.dataset_on_query.entry[item]) if(this_.dataset_on_query.entry[item].length > 0) service_is_available = true;\r\n\t\t\t\t\treturn service_is_available;\r\n\t\t\t\t}).length == export_method.services.length;\r\n\t\t\t}\r\n\t\t\tvar add = export_method.enabled && services_are_available;\r\n\t\t\t//if(export_method.id == \"data-dashboard\") add = add && this_.hasDashboards(this_.dataset_on_query);\r\n\t\t\tif(add){\r\n\t\t\t\tvar button_id = \"dsd-ui-button-\"+export_method.id;\r\n\t\t\t\tvar button_class = \"btn data-action-button \"+export_method[\"class\"];\r\n\t\t\t\tvar button_export_method = '<button type=\"button\" id=\"'+button_id+'\" class=\"'+button_class+'\" title=\"'+export_method.title+'\" onclick=\"'+this_.config.OFV_ID+'.triggerExport(\\''+export_method.id+'\\')\"></button>';\r\n\t\t\t\texport_more += button_export_method;\r\n\t\t\t}\r\n\t\t\tif(add) exports_added.push(export_method);\r\n\t\t});\r\n\t\texport_more += '</div>';\r\n\t\texport_more += '</fieldset>';\r\n\t\texport_more += '</div>';\r\n\t\tif(exports_added.length > 0) $(\"#dsd-ui-export-methods2\").append(export_more);\r\n\t\t\r\n\t\t//export options\r\n\t\tif(this_.dataset_on_query.entry.wfs.length > 0){\r\n\t\t\t$(\"#dsd-ui-col-\"+columnIdx).append('<div id=\"dsd-ui-export-options\" style=\"padding:0px 15px;text-align: left !important;display:none;\"></div>');\r\n\t\t\tvar export_options = '<a data-toggle=\"collapse\" href=\"#dataset-export-options\" role=\"button\" aria-expanded=\"false\" aria-controls=\"dataset-export-options\">'+this_.options.labels.export_options+'</a><br>';\r\n\t\t\texport_options += '<div class=\"collapse multi-collapse\" id=\"dataset-export-options\">';\r\n\t\t\texport_options += '<fieldset style=\"border: 1px #ccc solid;border-radius:4px;padding:4px;\">';\r\n\t\t\t//option to prettify column names\r\n\t\t\texport_options += '<div class=\"form-check\" style=\"float:left;margin-right:20px;\"><label class=\"form-check-label\" style=\"font-weight:100\"><input id =\"dataset-export-option-colnames\" type=\"checkbox\" class=\"form-check-input\">'+this_.options.labels.export_options_prettify+'</label></div>';\r\n\t\t\t//option to enrich with data labels\r\n\t\t\texport_options += '<div class=\"form-check\" ><label class=\"form-check-label\" style=\"font-weight:100\"><input id =\"dataset-export-option-labels\" type=\"checkbox\" class=\"form-check-input\">'+this_.options.labels.export_options_labels+'</label></div>';\r\n\t\t\texport_options += '</fieldset>';\r\n\t\t\texport_options += '</div>';\r\n\t\t\t$(\"#dsd-ui-export-options\").append(export_options);\r\n\t\t}\r\n\t\t\r\n\t\tif(layer){\r\n\t\t\tthis_.enableQueryFormButtons();\r\n\t\t\t$(\"#dsd-ui-export-options\").show();\r\n\t\t\tthis_.enableDashboardOptions();\r\n\t\t}else{\r\n\t\t\tthis_.disableQueryFormButtons();\r\n\t\t\t$(\"#dsd-ui-export-options\").hide();\r\n\t\t\tthis_.disableDashboardOptions();\r\n\t\t}\t\r\n\t}\r\n\t\r\n\t/**\r\n\t * disableQueryFormButtons\r\n\t */\r\n\tdisableQueryFormButtons(){\r\n\t\t$(\".data-action-button\").each(function(i,item){$(item).prop('disabled', true);})\r\n\t}\r\n\t\r\n\t/**\r\n\t * enableQueryFormButtons\r\n\t */\r\n\tenableQueryFormButtons(){\r\n\t\t$(\".data-action-button\").each(function(i,item){$(item).prop('disabled', false);})\r\n\t}\r\n\t\r\n\t/**\r\n\t * handleQueryThematicMappingOptions\r\n\t * @param {String} geomtype\r\n\t * @param {Integer} columnIdx\r\n\t */\r\n\thandleQueryThematicMappingOptions(geomtype, columnIdx){\t\t\r\n\t\tvar this_ = this;\r\n\t\t//id\r\n\t\tvar map_type_id = \"map-type-selector\";\r\n\t\t//html\r\n\t\t$(\"#dsd-ui-col-\"+columnIdx).append('<select id = \"'+map_type_id+'\" class=\"dsd-ui-dimension\" title=\"'+this_.options.labels.maptype_selector_title+'\"></select>');\r\n\t\t//jquery widget\r\n\t\tvar formatMaptype = function(item) {\r\n\t\t\tif (!item.id) { return item.text; }\r\n\t\t\tvar $item = $('<span class=\"dsd-ui-item-label\" >' + item.text + '</span>');\r\n\t\t\treturn $item;\r\n\t\t};\r\n\t\tvar map_type_placeholder = this_.options.labels.maptype_selector;\r\n\t\t\r\n\t\t//map types\r\n\t\tvar choropleth = {id:'choropleth', text: this_.options.labels.maptype_choropleth};\r\n\t\tvar graduated = {id:'graduated', text: this_.options.labels.maptype_graduated};\r\n\t\tvar has_choropleth = ['gml:PolygonPropertyType','gml:MultiPolygonPropertyType'].indexOf(geomtype) != -1\r\n\t\tvar map_types = [choropleth, graduated];\r\n\t\tif(!has_choropleth) map_types = [graduated];\r\n\t\t\r\n\t\t$(\"#\" + map_type_id).select2({\r\n\t\t\ttheme: 'classic',\r\n\t\t\tallowClear: false,\r\n\t\t\tplaceholder: map_type_placeholder,\r\n\t\t\tdata: map_types,\r\n\t\t\ttemplateResult: formatMaptype,\r\n\t\t\ttemplateSelection: formatMaptype\r\n\t\t});\r\n\t\t$(\"#\" + map_type_id).val(map_types[0].id).trigger(\"change\");\r\n\r\n\t\t//6. Map classifications\r\n\t\t//Classification type\r\n\t\t//-------------------\r\n\t\t//id\r\n\t\tvar map_classtype_id = \"map-classtype-selector\";\r\n\t\t//html\r\n\t\t$(\"#dsd-ui-col-\"+columnIdx).append('<select id = \"'+map_classtype_id+'\" class=\"dsd-ui-dimension\" title=\"'+this_.options.labels.class_selector_title+'\"></select>');\r\n\t\t//jquery widget\r\n\t\tvar formatClasstype = function(item) {\r\n\t\t\tif (!item.id) { return item.text; }\r\n\t\t\tvar $item = $('<span class=\"dsd-ui-item-label\" >' + item.text + '</span>');\r\n\t\t\treturn $item;\r\n\t\t};\r\n\t\tvar map_classtype_placeholder = this_.options.labels.class_selector;\r\n\t\t$(\"#\" + map_classtype_id).select2({\r\n\t\t\ttheme: 'classic',\r\n\t\t\tallowClear: false,\r\n\t\t\tplaceholder: map_classtype_placeholder,\r\n\t\t\tdata: [{id:'ckmeans', text: this_.options.labels.class_ckmeans},{id:'equal', text: this_.options.labels.class_equal},{id:'quantile', text: this_.options.labels.class_quantile}],\r\n\t\t\ttemplateResult: formatClasstype,\r\n\t\t\ttemplateSelection: formatClasstype\r\n\t\t});\r\n\t\t$(\"#\" + map_classtype_id).val(\"ckmeans\").trigger(\"change\");\r\n\t\t\r\n\t\t//Number of class intervals\r\n\t\t//-------------------------\r\n\t\t//id\r\n\t\tvar map_classnb_id = \"map-classnb-selector\";\r\n\t\t//html\r\n\t\t$(\"#dsd-ui-col-\"+columnIdx).append('<select id = \"'+map_classnb_id+'\" class=\"dsd-ui-dimension\" title=\"'+this_.options.labels.classnb_selector_title+'\"></select>');\r\n\t\t//jquery widget\r\n\t\tvar formatClassnb = function(item) {\r\n\t\t\tif (!item.id) { return item.text; }\r\n\t\t\tvar $item = $('<span class=\"dsd-ui-item-label\" >' + item.text + '</span>');\r\n\t\t\treturn $item;\r\n\t\t};\r\n\t\tvar map_classnb_placeholder = this_.options.labels.classnb_selector;\r\n\t\t$(\"#\" + map_classnb_id).select2({\r\n\t\t\ttheme: 'classic',\r\n\t\t\tallowClear: false,\r\n\t\t\tplaceholder: map_classnb_placeholder,\r\n\t\t\tdata: [{id: '3', text: '3'},{id: '4', text: '4'}, {id: '5', text: '5'}],\r\n\t\t\ttemplateResult: formatClassnb,\r\n\t\t\ttemplateSelection: formatClassnb\r\n\t\t});\r\n\t\t$(\"#\" + map_classnb_id).val(\"5\").trigger(\"change\");\r\n\t\t\r\n\t\t//Color palettes\r\n\t\t//-------------------\r\n\t\t//id\r\n\t\tvar map_colorscheme_id = \"map-colorscheme-selector\";\r\n\t\t//html\r\n\t\tif(has_choropleth) $(\"#dsd-ui-col-\"+columnIdx).append('<select id = \"'+map_colorscheme_id+'\" class=\"dsd-ui-dimension\" title=\"'+this_.options.labels.colorscheme_selector_title+'\"></select>');\r\n\t\t//jquery widget\r\n\t\tvar formatColorscheme = function(item){\r\n\t\t\tif(!item.id) { return item.text; };\r\n\t\t\tvar $item = $('<span title=\"'+item.text+'\">'+item.svg+' <em>('+item.text+')</em></span>');\r\n\t\t\treturn $item;\r\n\t\t};\r\n\t\tvar map_colorscheme_placeholder = this_.options.labels.colorscheme_selector;\r\n\t\tvar getPaletteAsSVG = function(id){\r\n\t\t\tvar classnb = parseInt($(\"#map-classnb-selector\").val());\r\n\t\t\tvar colors = colorbrewer[id][classnb];\t\t\r\n\t\t\tvar sq_width = 15;\r\n\t\t\tvar sq_height = 15;\r\n\t\t\tvar svg = '<svg width=\"'+sq_width*classnb+'\" height=\"'+sq_height+'\" style=\"vertical-align:middle;\">';\r\n\t\t\tvar colorHeight = 0;\r\n\t\t\tcolors.forEach(function(color){ \r\n\t\t\t\tsvg += '<rect fill=\"'+color+'\" width=\"'+sq_width+'\" height=\"'+sq_height+'\" x=\"'+colorHeight+'\"></rect>';\r\n\t\t\t\tcolorHeight = colorHeight + sq_width;\r\n\t\t\t});\r\n\t\t\tsvg += '</svg>';\r\n\t\t\treturn svg;\r\n\t\t}\r\n\t\tvar initColorschemeSelector = function(){\r\n\t\t\t$(\"#\"+ map_colorscheme_id).select2({\r\n\t\t\t\ttheme: 'classic',\r\n\t\t\t\tallowClear: false,\r\n\t\t\t\tplaceholder: map_colorscheme_placeholder,\r\n\t\t\t\tdata: Object.keys(colorbrewer.schemeGroups).splice(0,3).map(function(schemeGroup){\r\n\t\t\t\t\treturn { \r\n\t\t\t\t\t\ttext: this_.options.labels['colorscheme_' + schemeGroup], \r\n\t\t\t\t\t\tchildren: colorbrewer.schemeGroups[schemeGroup].map(function(item){\r\n\t\t\t\t\t\t\treturn {id: item, text: item, svg: getPaletteAsSVG(item)}\r\n\t\t\t\t\t\t}) \r\n\t\t\t\t\t} \r\n\t\t\t\t}),\r\n\t\t\t\ttemplateResult: formatColorscheme,\r\n\t\t\t\ttemplateSelection: formatColorscheme\r\n\t\t\t});\r\n\t\t}\r\n\t\tif(has_choropleth){\r\n\t\t\tinitColorschemeSelector();\r\n\t\t\t$(\"#\" + map_colorscheme_id).val(\"Reds\").trigger(\"change\");\r\n\t\t\t//events related to colorscheme selection\r\n\t\t\t$(\"#\" + map_classnb_id).on('select2:select', function (e) { \r\n\t\t\t\tinitColorschemeSelector();\r\n\t\t\t});\r\n\t\t\t$(\"#\" + map_type_id).on('select2:select', function(e) {\r\n\t\t\t\tif(e.target.value == 'choropleth'){\r\n\t\t\t\t\t$(\"#\" + map_colorscheme_id).next(\".select2-container\").show();\r\n\t\t\t\t}else{\r\n\t\t\t\t\t$(\"#\" + map_colorscheme_id).next(\".select2-container\").hide();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\t\r\n\t\r\n\t/**\r\n\t * handleQueryStylingOptions\r\n\t * @param {Integer} columnIdx\r\n\t */\r\n\thandleQueryStylingOptions(columnIdx){\r\n\t\t\r\n\t\tvar this_ = this;\r\n\t\t//id\r\n\t\tvar map_style_id = \"map-style-selector\";\r\n\t\t//html\r\n\t\t$(\"#dsd-ui-col-\"+columnIdx).append('<select id = \"'+map_style_id+'\" class=\"dsd-ui-dimension\" title=\"'+this_.options.labels.styling_selector_title+'\"></select>');\r\n\t\t//jquery widget\r\n\t\tvar formatMapstyle = function(item) {\r\n\t\t\tif (!item.id) { return item.text; }\r\n\t\t\tvar $item = $('<span class=\"dsd-ui-item-label\" >' + item.text + '</span>');\r\n\t\t\treturn $item;\r\n\t\t};\r\n\t\tvar map_style_placeholder = this_.options.labels.styling_selector;\r\n\t\t\r\n\t\t//map styles\r\n\t\tvar map_layers = this.dataset_on_query.capabilities.capability.layer.layer[0].layer;\r\n\t\tvar map_styles = new Array();\r\n\t\tvar map_ogclayer = null;\r\n\t\tvar map_ogclayer_filter = map_layers.filter(function(layer){if(layer.name == this_.dataset_on_query.lyr) return layer});\r\n\t\tif(map_ogclayer_filter.length > 0) map_ogclayer = map_ogclayer_filter[0];\r\n\t\tif(map_ogclayer){\r\n\t\t\tmap_styles = map_ogclayer.style.map(function(style){\r\n\t\t\t\treturn {id: style.name, text: style.title, alternateText: style._abstract, href: style.legendURL[0].onlineResource.href};\r\n\t\t\t});\r\n\t\t}\r\n\t\t\r\n\t\t$(\"#\" + map_style_id).select2({\r\n\t\t\ttheme: 'classic',\r\n\t\t\tallowClear: true,\r\n\t\t\tplaceholder: map_style_placeholder,\r\n\t\t\tdata: map_styles,\r\n\t\t\ttemplateResult: formatMapstyle,\r\n\t\t\ttemplateSelection: formatMapstyle\r\n\t\t});\r\n\t\t$(\"#ui-ogc_layer\").trigger(\"change\");\r\n\t\tif(map_styles.length > 0) $(\"#\" + map_style_id).val(map_styles[0].id).trigger(\"change\");\r\n\t\t$(\"#ui-ogc_layer\").on('select2:select', function(e){\r\n\t\t\t\t\r\n\t\t\tvar map_ogclayer = null;\r\n\t\t\tvar map_ogclayer_filter = map_layers.filter(function(layer){if(layer.name == e.target.value) return layer});\r\n\t\t\tif(map_ogclayer_filter.length > 0) map_ogclayer = map_ogclayer_filter[0];\r\n\t\t\tif(map_ogclayer){\r\n\t\t\t\tvar styles = map_ogclayer.style.map(function(style){\r\n\t\t\t\t\treturn {id: style.name, text: style.title, alternateText: style._abstract, href: style.legendURL[0].onlineResource.href};\r\n\t\t\t\t});\r\n\t\t\t\t$(\"#\" + map_style_id).select2().empty();\r\n\t\t\t\t$(\"#\" + map_style_id).select2({data: styles});\r\n\t\t\t\t$(\"#\" + map_style_id).val(styles[0].id).trigger(\"change\");\r\n\t\t\t}\r\n\t\t\r\n\t\t});\r\n\t\r\n\t}\r\n\t\r\n\t/**\r\n\t * handleDashboardOptions\r\n\t * @param {Integer} columnIdx\r\n\t */\r\n\thandleDashboardOptions(columnIdx){\t\t\r\n\t\tvar this_ = this;\r\n\t\t//id\r\n\t\tvar dashboard_id = \"dashboard-selector\";\r\n\t\t//header\r\n\t\tvar html = $('<div id=\"dashboard-options\" style=\"display:none;\">');\r\n\t\thtml.append('<div style=\"margin: 0px;margin-top: 10px;width: 90%;text-align: left !important;\"><p style=\"margin:0;font-variant: petite-caps;font-size:110%;\"><span class=\"glyphicon glyphicon-blackboard\"></span><label style=\"margin-left:4px;\">'+ this_.options.labels.dashboard_options+'</label></p><hr style=\"margin:0px;\"></div>');\r\n\t\t\r\n\t\t//html\r\n\t\thtml.append('<select id = \"'+dashboard_id+'\" class=\"dsd-ui-dimension\" title=\"'+this_.options.labels.dashboard_selector_title+'\"><option></option></select>');\r\n\t\t$(\"#dsd-ui-col-\"+columnIdx).append(html);\r\n\t\t//jquery widget\r\n\t\tvar formatDashboard = function(item) {\r\n\t\t\tif (!item.id) { return item.text; }\r\n\t\t\tvar $item = $('<span class=\"dsd-ui-item-label\" >' + item.text + '</span>');\r\n\t\t\treturn $item;\r\n\t\t};\r\n\t\tvar dashboard_placeholder = this_.options.labels.dashboard_selector;\r\n\t\t$(\"#\" + dashboard_id).select2({\r\n\t\t\ttheme: 'classic',\r\n\t\t\tallowClear: true,\r\n\t\t\tplaceholder: dashboard_placeholder,\r\n\t\t\tdata: this_.getDashboards(this_.dataset_on_query).map(function(item){return {id: item.name, text: item.name}}),\r\n\t\t\ttemplateResult: formatDashboard,\r\n\t\t\ttemplateSelection: formatDashboard\r\n\t\t});\r\n\r\n\t\t//event related to selection\r\n\t\t$(\"#\" + dashboard_id).on('select2:select', function(e) {\r\n\t\t\tthis_.displayDashboard(e.target.value);\r\n\t\t});\r\n\t\t$(\"#\" + dashboard_id).on('select2:clear', function(e) {\r\n\t\t\tthis_.closeDashboardDialog();\r\n\t\t});\r\n\t}\r\n\t\r\n\t/**\r\n\t * enableDashboardOptions\r\n\t */\r\n\tenableDashboardOptions(){\r\n\t\t$(\"#dashboard-options\").show();\r\n\t}\r\n\t\r\n\t/**\r\n\t * disableDashboardOptions\r\n\t */\r\n\tdisableDashboardOptions(){\r\n\t\t$(\"#dashboard-options\").hide();\r\n\t}\r\n\t\r\n\t/**\r\n\t * getStrategy\r\n\t * @param dataset\r\n\t */\r\n\tgetStrategy(dataset){\r\n\t\tvar strategy = \"ogc_filters\";\r\n\t\tvar entry = dataset.entry? dataset.entry : dataset;\r\n\t\tvar idents = entry.metadata.identificationInfo;\r\n\t\tif(idents.length > 0){\r\n\t\t\tvar srv_idents = idents.filter(function(item){\r\n\t\t\t\tif(item.containsOperations) return(item);\r\n\t\t\t});\r\n\t\t\tif(srv_idents.length > 0){\r\n\t\t\t\tfor(var j=0;j<srv_idents.length;j++){\r\n\t\t\t\t\tvar item = srv_idents[j];\r\n\t\t\t\t\tif(item.containsOperations) if(item.containsOperations.length > 0){\r\n\t\t\t\t\t\tfor(var i=0;i<item.containsOperations.length;i++){\r\n\t\t\t\t\t\t\tvar op = item.containsOperations[i];\r\n\t\t\t\t\t\t\tif(op.svOperationMetadata.parameters) if(op.svOperationMetadata.parameters.length > 0) if(typeof op.svOperationMetadata.parameters[0].nilReason == \"undefined\"){\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tvar op_params = op.svOperationMetadata.parameters.map(function(item){return item.svParameter.name.aName;});\r\n\t\t\t\t\t\t\t\tif(op_params.indexOf(\"TIME\") >= 0 || op_params.indexOf(\"ELEVATION\") >= 0){\r\n\t\t\t\t\t\t\t\t\tstrategy = \"ogc_dimensions\";\r\n\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tif(op_params.indexOf(\"VIEWPARAMS\") >= 0){\r\n\t\t\t\t\t\t\t\t\tstrategy = \"ogc_viewparams\";\r\n\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t}\r\n\t\t\t\t};\t\t\t\t\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn strategy;\r\n\t}\r\n\t\r\n\t/**\r\n\t * getDatasetServiceCouplingType\r\n\t * @param dataset\r\n\t */\r\n\tgetDatasetServiceCouplingType(dataset){\r\n\t\tvar couplingType = \"loose\";\r\n\t\tvar entry = dataset.entry? dataset.entry : dataset;\r\n\t\tvar idents = entry.metadata.identificationInfo;\r\n\t\tif(idents.length > 0){\r\n\t\t\tvar srv_idents = idents.filter(function(item){\r\n\t\t\t\tif(item.containsOperations) return(item);\r\n\t\t\t});\r\n\t\t\tif(srv_idents.length > 0){\r\n\t\t\t\tvar srv_ident = srv_idents[0];\r\n\t\t\t\tif(srv_ident.couplingType) couplingType = srv_ident.couplingType.svCouplingType.codeListValue;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn couplingType;\r\n\t}\r\n\r\n\t/**\r\n\t * handleDatasetServiceCapabilities\r\n\t * @param dataset\r\n\t */\r\n\thandleDatasetServiceCapabilities(dataset){\r\n\t\tvar deferred = $.Deferred();\r\n\t\tvar this_ = this;\r\n\t\tvar pid = dataset.pid;\r\n\t\tvar entry = dataset.entry? dataset.entry : dataset;\r\n\t\t\r\n\t\tvar wmsConfig = [\r\n\t\t\t[\r\n\t\t\t\tDC_1_1,\r\n\t\t\t\tDCT,\r\n\t\t\t\tXLink_1_0,\r\n\t\t\t\tSMIL_2_0,\r\n\t\t\t\tSMIL_2_0_Language,\r\n\t\t\t\tOWS_1_0_0,\r\n\t\t\t\tOWS_1_1_0,\r\n\t\t\t\tWMS_1_1_1,\r\n\t\t\t\tWMS_1_3_0\r\n\t\t\t],\r\n\t\t\t{\r\n\t\t\t\tnamespacePrefixes : {\r\n\t\t\t\t\t\"http://www.opengis.net/wms\": \"wms\",\r\n\t\t\t\t\t\"http://www.w3.org/2001/XMLSchema-instance\": \"xsi\"\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t];\r\n\t\t\r\n\t\t//find wms caps url\r\n\t\tvar wms_caps_url = null;\r\n\t\t//first look at service Identification\r\n\t\tvar idents = entry.metadata.identificationInfo;\r\n\t\tif(idents.length > 0){\r\n\t\t\tvar srv_idents = idents.filter(function(item){\r\n\t\t\t\tif(item.containsOperations) return(item);\r\n\t\t\t});\r\n\t\t\tif(srv_idents.length > 0){\r\n\t\t\t\tfor(var j=0;j<srv_idents.length;j++){\r\n\t\t\t\t\tvar item = srv_idents[j];\r\n\t\t\t\t\tif(item.containsOperations) if(item.containsOperations.length > 0){\r\n\t\t\t\t\t\tfor(var i=0;i<item.containsOperations.length;i++){\r\n\t\t\t\t\t\t\tvar op = item.containsOperations[i];\r\n\t\t\t\t\t\t\tif(op.svOperationMetadata.operationName == \"GetCapabilities\"){\r\n\t\t\t\t\t\t\t\tif(op.svOperationMetadata.connectPoint) if(op.svOperationMetadata.connectPoint.length > 0){\r\n\t\t\t\t\t\t\t\t\twms_caps_url = op.svOperationMetadata.connectPoint[0].ciOnlineResource.linkage.url.split('?')[0];\r\n\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(!wms_caps_url){\r\n\t\t\t//if null then look at online resources\r\n\t\t\twms_caps_url = entry.wms[0].url.split('?')[0];\r\n\t\t}\r\n\t\t\r\n\t\tvar wms_service = new WMS(wms_caps_url, entry.wms[0].version, wmsConfig);\r\n\t\twms_service.GetCapabilities().then(function(capabilities){\r\n\t\t\tdeferred.resolve(this_.lightenMetadata(capabilities));\r\n\t\t});\r\n\t\treturn deferred.promise();\r\n\t}\r\n\t\r\n\t/**\r\n\t * handleFilter\r\n\t * @param {String} pid\r\n\t */\r\n\thandleFilter(dataset){\r\n\t\t\r\n\t\tvar deferred = $.Deferred();\r\n\t\t\r\n\t\tvar this_ = this;\r\n\t\tvar pid = dataset.pid;\r\n\t\tvar entry = dataset.entry? dataset.entry : dataset;\r\n\t\tthis.dataset_on_query = {\r\n\t\t\tpid: pid,\r\n\t\t\tlayer: dataset.layer,\r\n\t\t\tentry: entry, \r\n\t\t\tstrategy: \"ogc_filters\",\r\n\t\t\tdsd: null, \r\n\t\t\tquery: null, \r\n\t\t\tthematicmapping: false,\r\n\t\t\tpoint_vectorizing: false,\r\n\t\t\tpoint_clustering: false //for simple filter no way to know if it is a point layer?\r\n\t\t};\r\n\t\t\r\n\t\t//build UI\r\n\t\tvar bootstrapClass = \"col-md-\" + 12/this_.options.access.columns;\r\n\t\t$(\"#dsd-ui\").append('<div id=\"dsd-ui-header\"></div>');\r\n\t\t$(\"#dsd-ui-header\").append('<div class=\"alert alert-info\" style=\"padding:6px;margin:6px;text-align:left;\"><h5><b>'+entry.title+' <small><em>['+entry.pid+']</em></small></b></h5></div>');\r\n\r\n\t\t$(\"#dsd-ui\").append('<form id=\"dsd-ui-body\" onsubmit=\"'+this_.config.OFV_ID+'.mapDatasetView('+this_.config.OFV_ID+'.dataset_on_query, true);return false\"></form>');\r\n\t\t$(document).on('submit', '#dsd-ui-body', function(event) {\r\n\t\t\tevent.preventDefault();\r\n\t\t});\r\n\t\t\t\t\r\n\t\t$(\"#dsd-ui\").append('<input type=\"text\" autofocus=\"autofocus\" style=\"display:none\" />'); //Avoid autofocus on query inputs\r\n\t\t$(\"#dsd-ui-body\").append('<div id=\"dsd-ui-col-1\" class=\"'+bootstrapClass+'\"></div>');\r\n\r\n\t\t//ogc layer\r\n\t\tvar ogclayers = entry.wms.map(function(item){return {id: item.name, text: (item.description? item.description : item.name), url: item.url}});\r\n\t\tconsole.log(ogclayers);\r\n\t\t//ogc layer id\r\n\t\tvar ogclayer_id = \"ui-ogc_layer\";\r\n\t\t//html\r\n\t\t$(\"#dsd-ui-col-1\").append('<div style=\"margin: 0px;margin-top: 10px;width: 90%;text-align: left !important;\"><p style=\"margin:0;font-variant: petite-caps;font-size:110%;\"><span class=\"glyphicon glyphicon-th-list\"></span><label style=\"margin-left:4px;\">'+ this_.options.labels.layer_selection+'</label></p><hr style=\"margin:0px;\"></div>');\r\n\t\t$(\"#dsd-ui-col-1\").append('<select id = \"'+ogclayer_id+'\" class=\"dsd-ui-dimension\" title=\"'+this_.options.labels.layer_selection_title+'\" required></select><span style=\"color:red;font-weight:bold;margin-left:2px;font-size:14px;\">*</span>');\r\n\t\t//jquery widget\r\n\t\tvar formatLayer = function(item) {\r\n\t\t\tif (!item.id) { return item.text; }\r\n\t\t\tvar txt = item.text;\r\n\t\t\tvar $item = $('<span class=\"dsd-ui-item-label\" >' + item.text + ' <span class=\"dsd-ui-item-code\">['+item.id+']</span>' + '</span>');\r\n\t\t\treturn $item;\r\n\t\t};\r\n\t\tvar ogclayer_placeholder = this_.options.labels.layer_selection_placeholder;\r\n\t\t$(\"#\" + ogclayer_id).select2({\r\n\t\t\ttheme: 'classic',\r\n\t\t\tallowClear: false,\r\n\t\t\tplaceholder: ogclayer_placeholder,\r\n\t\t\tdata: ogclayers,\r\n\t\t\ttemplateResult: formatLayer,\r\n\t\t\ttemplateSelection: formatLayer\r\n\t\t});\r\n\t\tif(ogclayers.length == 1){\r\n\t\t\t$(\"#\" + ogclayer_id).val(ogclayers[0].id).trigger(\"change\");\r\n\t\t}\r\n\t\t\r\n\t\t//ogc filter id\r\n\t\tvar ogcfilter_component_id = \"ui-ogc_filter\";\r\n\t\t//ogc filter html\r\n\t\t$(\"#dsd-ui-col-1\").append('<div style=\"margin: 0px;margin-top: 10px;width: 90%;text-align: left !important;\"><p style=\"margin:0;font-variant: petite-caps;font-size:110%;\"><span class=\"glyphicon glyphicon-filter\"></span><label style=\"margin-left:4px;\">'+ this_.options.labels.filtering+'</label style=\"margin-left:4px;\"></p><hr style=\"margin:0px;\"></div>');\r\n\t\t$(\"#dsd-ui-col-1\").append('<input type=\"text\" id=\"'+ogcfilter_component_id+'\" class=\"dsd-ui-dimension\" style=\"margin-left:10px;\" title=\"'+this_.options.labels.filtering_title+'\" autofocus=\"true\" ></select>');\r\n\t\t\r\n\t\t//query form buttons\r\n\t\tthis.handleQueryAndMapButton(1);\r\n\t\tthis.handleQueryFormButtons(1);\r\n\t\t\r\n\t\t//query service capabilities\r\n\t\tconsole.log(this_.getDatasetServiceCouplingType(this_.dataset_on_query));\r\n\t\tif(this_.getDatasetServiceCouplingType(this_.dataset_on_query) == \"tight\"){\r\n\t\t\tthis_.handleDatasetServiceCapabilities(this_.dataset_on_query).then(function(capabilities){\r\n\t\t\t\tconsole.log(strategy);\r\n\t\t\t\tif(strategy == \"ogc_dimensions\") {\r\n\t\t\t\t\tthis_.dataset_on_query.capabilities = capabilities;\r\n\t\t\t\t\tvar ogc_dsd = this_.parseLayerDescription(this_.dataset_on_query, entry.wms[0].name);\r\n\t\t\t\t\tconsole.log(ogc_dsd);\r\n\t\t\t\t\tthis_.dataset_on_query.dsd = ogc_dsd.components;\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\t//build UI\r\n\t\t\t\t$(\"#dsd-loader\").hide();\r\n\t\t\t\tdeferred.resolve(this_.dataset_on_query);\r\n\t\t\t});\r\n\t\t}else{\r\n\t\t\t$(\"#dsd-loader\").hide();\r\n\t\t\tdeferred.resolve(this_.dataset_on_query);\r\n\t\t}\r\n\t\t\r\n\t\treturn deferred.promise();\r\n\t}\r\n\r\n\t\r\n\t/**\r\n\t * handleDSDUserInterface\r\n\t * @param dataset\r\n\t */\r\n\thandleDSDUserInterface(dataset){\r\n\t\t\r\n\t\tvar this_ = this;\r\n\t\t\r\n\t\tvar this_ = this;\r\n\t\tvar pid = dataset.pid;\r\n\t\tvar lyr = dataset.lyr;\r\n\t\tvar strategy = this.getStrategy(dataset);\r\n\t\tvar entry = dataset.entry? dataset.entry : dataset;\r\n\t\t\r\n\t\tvar bootstrapClass = \"col-md-\" + 12/this_.options.access.columns;\r\n\t\t$(\"#dsd-ui\").append('<div id=\"dsd-ui-header\"></div>');\r\n\t\t//acccess dataset header\r\n\t\tvar accessHeader = '<div class=\"row\" style=\"padding:6px;margin:6px;text-align:left;background-color: #d9edf7;color: #31708f;\"><div class=\"col-md-10\"><h5><b>'+entry.title+' <small><em>['+entry.pid+']</em></small></b></h5></div>'; accessHeader += '<div class=\"col-md-2\">';\r\n\t\t//button-->doi\r\n\t\tif(entry.doi){\r\n\t\t\taccessHeader += '<button class=\"btn btn-xs dataset-button dataset-button-doi\" style=\"top:10px;\" data-pid=\"'+entry.pid+'\" title=\"'+this_.options.labels.dataset_access_doi+'\" onclick=\"'+this_.config.OFV_ID+'.resolveDatasetDOI(this)\"><span class=\"ai ai-doi\" style=\"font-size:120%;\"></span></button>';\r\n\t\t}\r\n\t\t//button-->info (metadata)\r\n\t\taccessHeader += '<button class=\"btn btn-xs dataset-button dataset-button-info\" style=\"top:10px;\" data-pid=\"'+entry.pid+'\" title=\"'+this_.options.labels.dataset_access_metadata+'\" onclick=\"'+this_.config.OFV_ID+'.displayDatasetMetadata(this)\"><span class=\"glyphicon glyphicon-info-sign\"></span></button>';\r\n\t\t//button-->zoom\r\n\t\taccessHeader += '<button class=\"btn btn-xs dataset-button dataset-button-zoom\" style=\"top:10px;\" data-pid=\"'+entry.pid+'\" title=\"'+this_.options.labels.dataset_zoom_extent+'\" onclick=\"'+this_.config.OFV_ID+'.zoomToExtent(this)\"><span class=\"glyphicon glyphicon-zoom-in\"></span></button>';\r\n\t\taccessHeader += '</div></div>';\r\n\t\t$(\"#dsd-ui-header\").append(accessHeader);\r\n\r\n\t\t//access dataset query form\r\n\r\n\t\t$(\"#dsd-ui\").append('<form id=\"dsd-ui-body\" onsubmit=\"'+this_.config.OFV_ID+'.mapDatasetView('+this_.config.OFV_ID+'.dataset_on_query, true);return false\"></form>');\r\n\t\t$(document).on('submit', '#dsd-ui-body', function(event) {\r\n\t\t\tevent.preventDefault();\r\n\t\t});\r\n\t\t\r\n\t\t$(\"#dsd-ui\").append('<input type=\"text\" autofocus=\"autofocus\" style=\"display:none\" />'); //Avoid autofocus on query inputs\r\n\t\t$(\"#dsd-ui-body\").append('<div id=\"dsd-ui-col-1\" class=\"'+bootstrapClass+'\"></div>');\r\n\t\t\r\n\t\t//0. Add layer selection (required for multi-layer metadata)\r\n\t\t//-------------------------------------------\r\n\t\t//ogc layer\r\n\t\tvar ogclayers = entry.wms.map(function(item){return {id: item.name, text: (item.description? item.description : item.name), url: item.url}});\r\n\t\tconsole.log(ogclayers);\r\n\t\t//ogc layer id\r\n\t\tvar ogclayer_id = \"ui-ogc_layer\";\r\n\t\t//html\r\n\t\t$(\"#dsd-ui-col-1\").append('<div style=\"margin: 0px;margin-top: 10px;width: 90%;text-align: left !important;\"><p style=\"margin:0;font-variant: petite-caps;font-size:110%;\"><span class=\"glyphicon glyphicon-th-list\"></span><label style=\"margin-left:4px;\">'+ this_.options.labels.layer_selection+'</label style=\"margin-left:4px;\"></p><hr style=\"margin:0px;\"></div>');\r\n\t\t$(\"#dsd-ui-col-1\").append('<select id = \"'+ogclayer_id+'\" class=\"dsd-ui-dimension\" title=\"'+this_.options.labels.layer_title+'\" required></select><span style=\"color:red;font-weight:bold;margin-left:2px;font-size:14px;\">*</span>');\r\n\t\t//jquery widget\r\n\t\tvar formatLayer = function(item) {\r\n\t\t\tif (!item.id) { return item.text; }\r\n\t\t\tvar txt = item.text;\r\n\t\t\tvar $item = $('<span class=\"dsd-ui-item-label\" >' + item.text + ' <span class=\"dsd-ui-item-code\">['+item.id+']</span>' + '</span>');\r\n\t\t\treturn $item;\r\n\t\t};\r\n\t\tvar ogclayer_placeholder = this_.options.labels.layer_placeholder;\r\n\t\t$(\"#\" + ogclayer_id).select2({\r\n\t\t\ttheme: 'classic',\r\n\t\t\tallowClear: false,\r\n\t\t\tplaceholder: ogclayer_placeholder,\r\n\t\t\tdata: ogclayers,\r\n\t\t\ttemplateResult: formatLayer,\r\n\t\t\ttemplateSelection: formatLayer\r\n\t\t});\r\n\t\tif(ogclayers.length == 1){\r\n\t\t\t$(\"#\" + ogclayer_id).val(ogclayers[0].id).trigger(\"change\");\r\n\t\t}else{\r\n\t\t\t$(\"#\" + ogclayer_id).val(\"\").trigger(\"change\");\r\n\t\t}\r\n\t\t\r\n\t\t//1. Build UI from ATTRIBUTES filtering\r\n\t\t//-------------------------------------------\r\n\t\tvar attributes = this_.dataset_on_query.dsd.filter(function(item){if(item.columnType == \"attribute\") return item});\r\n\t\tif(attributes.length > 0){\r\n\t\t\t$(\"#dsd-ui-col-1\").append('<div style=\"margin: 0px;margin-top: 10px;width: 90%;text-align: left !important;\"><p style=\"margin:0;font-variant: petite-caps;font-size:110%;\"><span class=\"glyphicon glyphicon-filter\"></span><label style=\"margin-left:4px;\">'+ this_.options.labels.filtering+'</label style=\"margin-left:4px;\"></p><hr style=\"margin:0px;\"></div>');\r\n\t\t\tvar attributeMatcher = function(params, data){\r\n\t\t\t\tparams.term = params.term || '';\r\n\t\t\t\tif ($.trim(params.term) === '') {\r\n\t\t\t\t  return data;\r\n\t\t\t\t}  \r\n\t\t\t\t\r\n\t\t\t\tvar term = params.term.toUpperCase();\r\n\t\t\t\tvar altText = data.alternateText? data.alternateText : '';\r\n\t\t\t\tif (data.text.toUpperCase().indexOf(term) > -1  |\r\n\t\t\t\t\tdata.id.toUpperCase().indexOf(term) > -1    |\r\n\t\t\t\t\taltText.toUpperCase().indexOf(term) > -1    ) {\r\n\t\t\t\t\treturn data;\r\n\t\t\t\t}\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\r\n\t\t\t$(\"#dsd-ui-col-1\").append('<div style=\"margin: 0px;margin-top: 10px;width: 90%;text-align: left !important;\"><p style=\"margin:0;\"><label>'+ this_.options.labels.attributes+'</label></p></div>');\r\n\t\t\tvar dsd = this_.dataset_on_query.dsd;\r\n\t\t\tfor(var i=0;i<this_.dataset_on_query.dsd.length;i++){\r\n\t\t\t\tvar dsd_component = this_.dataset_on_query.dsd[i];\r\n\t\t\t\tif(dsd_component.columnType == \"attribute\"){\r\n\t\t\t\t\t\r\n\t\t\t\t\t//attribute with list values --> DROPDOWNLISTS\r\n\t\t\t\t\tif(dsd_component.values){\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tvar withNames = dsd_component.values.map(function(item){return item.text}).every(function(element, index, array){return element != null && element != \"\"});\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t//id\r\n\t\t\t\t\t\tvar dsd_component_id = \"dsd-ui-dimension-attribute-\" + dsd_component.primitiveCode;\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\tvar isRequired = dsd_component.minOccurs == 1? true : false;\r\n\t\t\t\t\t\tvar isMultiple = dsd_component.maxOccurs == Infinity? true : false; \t\t\t\t\t\t\t\t\r\n\r\n\t\t\t\t\t\tif(dsd_component.primitiveType == \"xsd:string\" || withNames){\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t//html\r\n\t\t\t\t\t\t\t$(\"#dsd-ui-col-1\").append('<select id = \"'+dsd_component_id+'\" '\r\n\t\t\t\t\t\t\t\t+ (isMultiple? 'multiple=\"multiple\"' : '')\r\n\t\t\t\t\t\t\t\t+ (isRequired? 'required' : '')\r\n\t\t\t\t\t\t\t\t+' class=\"dsd-ui-dimension dsd-ui-dimension-attribute\" data-dimension-code=\"'+dsd_component.primitiveCode+'\" title=\"'+this_.options.labels.filtering_on+' '+dsd_component.name+'\">'+(isMultiple? '' : '<option></option>')+'</select>'\r\n\t\t\t\t\t\t\t\t+ (isRequired? '<span style=\"color:red;font-weight:bold;margin-left:2px;font-size:14px;\">*</span>' : ''));\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t//jquery widget\r\n\t\t\t\t\t\t\tvar attributeItemSelection = function(item) {\r\n\t\t\t\t\t\t\t  if (!item.id) { return item.text; }\r\n\t\t\t\t\t\t\t  //TODO vocabulary stuff for countries\r\n\t\t\t\t\t\t\t  if([\"flag\", \"flagstate\", \"country\"].filter(function(el){return item.codelist.toLowerCase().match(el)}).length > 0){\r\n\t\t\t\t\t\t\t\t  var $item = $(\r\n\t\t\t\t\t\t\t\t\t'<img src=\"img/flags/' + item.id.toLowerCase() + '.gif\" class=\"img-flag\" />' +\r\n\t\t\t\t\t\t\t\t\t'<span class=\"dsd-ui-item-label\" >' + item.text + ' <span class=\"dsd-ui-item-code\">['+item.id+']</span>' + '</span>'\r\n\t\t\t\t\t\t\t\t  );\r\n\t\t\t\t\t\t\t  }else{\r\n\t\t\t\t\t\t\t\t  if(item.alternateText){\r\n\t\t\t\t\t\t\t\t\t  var $item = $(\r\n\t\t\t\t\t\t\t\t\t\t'<span class=\"dsd-ui-item-label\" >' + \r\n\t\t\t\t\t\t\t\t\t\t\titem.text + \r\n\t\t\t\t\t\t\t\t\t\t\t' <span class=\"dsd-ui-item-code\">['+item.id+']</span>' + \t\r\n\t\t\t\t\t\t\t\t\t\t'</span>'+\r\n\t\t\t\t\t\t\t\t\t\t'<br><span class=\"dsd-ui-item-sublabel\"> ' + item.alternateText + '</span>' +\r\n\t\t\t\t\t\t\t\t\t\t(item.href? ' <a href=\"'+item.href+'\" target=\"_blank\" style=\"color:blue;\">'+this_.options.labels.listedvalue_href_placeholder+'</a>' : '' )\r\n\t\t\t\t\t\t\t\t\t  );\r\n\t\t\t\t\t\t\t\t  }else{\r\n\t\t\t\t\t\t\t\t\t  var $item = $(\r\n\t\t\t\t\t\t\t\t\t\t'<span class=\"dsd-ui-item-label\" >' + \r\n\t\t\t\t\t\t\t\t\t\t\titem.text + \r\n\t\t\t\t\t\t\t\t\t\t\t' <span class=\"dsd-ui-item-code\">['+item.id+']</span>' + \r\n\t\t\t\t\t\t\t\t\t\t'</span>' +\r\n\t\t\t\t\t\t\t\t\t\t(item.href? '<br><a href=\"'+item.href+'\" target=\"_blank\" style=\"color:blue;\">'+this_.options.labels.listedvalue_href_placeholder+'</a>' : '' )\r\n\t\t\t\t\t\t\t\t\t  );\r\n\t\t\t\t\t\t\t\t  }\r\n\t\t\t\t\t\t\t  }\r\n\t\t\t\t\t\t\t  return $item;\r\n\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t\tvar attributeItemResult = function(item) {\r\n\t\t\t\t\t\t\t  if (!item.id) { return item.text; }\r\n\t\t\t\t\t\t\t  //TODO vocabulary stuff for countries\r\n\t\t\t\t\t\t\t  if([\"flag\", \"flagstate\", \"country\"].filter(function(el){return item.codelist.toLowerCase().match(el)}).length > 0){\r\n\t\t\t\t\t\t\t\t  var $item = $(\r\n\t\t\t\t\t\t\t\t\t'<img src=\"img/flags/' + item.id.toLowerCase() + '.gif\" class=\"img-flag\" />' +\r\n\t\t\t\t\t\t\t\t\t'<span class=\"dsd-ui-item-label\" >' + item.text + ' <span class=\"dsd-ui-item-code\">['+item.id+']</span>' + '</span>'\r\n\t\t\t\t\t\t\t\t  );\r\n\t\t\t\t\t\t\t  }else{\r\n\t\t\t\t\t\t\t\t  if(item.alternateText){\r\n\t\t\t\t\t\t\t\t\t  var $item = $(\r\n\t\t\t\t\t\t\t\t\t\t'<span class=\"dsd-ui-item-label\" >' + item.text + ' <span class=\"dsd-ui-item-code\">['+item.id+']</span>' + '</span>'+\r\n\t\t\t\t\t\t\t\t\t\t'<br><span class=\"dsd-ui-item-sublabel\"> ' + item.alternateText + '</span>'\r\n\t\t\t\t\t\t\t\t\t  );\r\n\t\t\t\t\t\t\t\t  }else{\r\n\t\t\t\t\t\t\t\t\t  var $item = $(\r\n\t\t\t\t\t\t\t\t\t\t'<span class=\"dsd-ui-item-label\" >' + item.text + ' <span class=\"dsd-ui-item-code\">['+item.id+']</span>' + '</span>'\r\n\t\t\t\t\t\t\t\t\t  );\r\n\t\t\t\t\t\t\t\t  }\r\n\t\t\t\t\t\t\t  }\r\n\t\t\t\t\t\t\t  return $item;\r\n\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t\tvar dsd_component_placeholder = dsd_component.name;\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t$(\"#\" + dsd_component_id).select2({\r\n\t\t\t\t\t\t\t\ttheme: 'classic',\r\n\t\t\t\t\t\t\t\tallowClear: true,\r\n\t\t\t\t\t\t\t\tplaceholder: dsd_component_placeholder,\r\n\t\t\t\t\t\t\t\tdata: dsd_component.values.filter(function(item){\r\n\t\t\t\t\t\t\t\t\tif(!this_.options.access.values_to_exclude_for) return item;\r\n\t\t\t\t\t\t\t\t\tif(this_.options.access.values_to_exclude_for){\r\n\t\t\t\t\t\t\t\t\t\tvar values_to_exclude = this_.options.access.values_to_exclude_for[dsd_component.primitiveCode];\r\n\t\t\t\t\t\t\t\t\t\tif(values_to_exclude){\r\n\t\t\t\t\t\t\t\t\t\t\tif(values_to_exclude.indexOf(item.id) == -1) return item;\r\n\t\t\t\t\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\t\t\t\t\treturn item;\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\t\t\t\treturn item;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}),\r\n\t\t\t\t\t\t\t\ttemplateResult: attributeItemResult,\r\n\t\t\t\t\t\t\t\ttemplateSelection: attributeItemSelection,\r\n\t\t\t\t\t\t\t\tmatcher: attributeMatcher\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t//add info button\r\n\t\t\t\t\t\t\tif(dsd_component.definition) if(dsd_component.definition.length > 0){\r\n\t\t\t\t\t\t\t\t$(\"#dsd-ui-col-1\").append('<span class=\"glyphicon glyphicon-info-sign attribute-info\" title=\"'+dsd_component.definition+'\"></span>');\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}else if((dsd_component.primitiveType == \"xsd:int\" ||\r\n\t\t\t\t\t\t\t\t dsd_component.primitiveType == \"xsd:decimal\") && !withNames){\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tvar values = dsd_component.values.map(function(item){return parseInt(item.id)});\r\n\t\t\t\t\t\t\tvar values_min = Math.min.apply(Math, values);\r\n\t\t\t\t\t\t\tvar values_max = Math.max.apply(Math, values);\t\t\t\t\t\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t//html\r\n\t\t\t\t\t\t\tvar dsd_component_id_range = dsd_component_id + \"-range\";\r\n\t\t\t\t\t\t\tvar dsd_component_id_slider = dsd_component_id + \"-slider\";\r\n\t\t\t\t\t\t\tvar dsd_component_slider_html = '<div id=\"'+dsd_component_id+'\" class=\"dsd-ui-dimension dsd-ui-dimension-attribute dsd-ui-dimension-slider\" data-dimension-code=\"'+dsd_component.primitiveCode+'\">' +\r\n\t\t\t\t\t\t\t'<p><label for=\"'+dsd_component_id_range+'\">'+dsd_component.name+': </label>' +\r\n\t\t\t\t\t\t\t'<input type=\"text\" id=\"'+dsd_component_id_range+'\" readonly style=\"margin-left:5px; border:0; color:#f6931f; font-weight:bold;\"></p>' +\r\n\t\t\t\t\t\t\t'<input id=\"'+dsd_component_id_slider+'\" type=\"text\" data-slider-min=\"'+values_min+'\" data-slider-max=\"'+values_max+'\" data-slider-value=\"'+(isMultiple? \"[\"+values_min+\", \"+values_max+\"]\" : values_max)+'\"/>' +\r\n\t\t\t\t\t\t\t'</div>';\r\n\t\t\t\t\t\t\t$(\"#dsd-ui-col-1\").append(dsd_component_slider_html);\r\n\t\t\t\t\t\t\tconsole.log(dsd_component_id_slider);\r\n\t\t\t\t\t\t\t//jquery widget\r\n\t\t\t\t\t\t\t/*$(\"#\"+dsd_component_id_slider).slider({\r\n\t\t\t\t\t\t\t  range: isMultiple, min: values_min, max: values_max,\r\n\t\t\t\t\t\t\t  values: (isMultiple? [ values_min, values_max ] : values_min),\r\n\t\t\t\t\t\t\t  slide: function( event, ui ) {\r\n\t\t\t\t\t\t\t\tvar value = ui.values? ui.values[ 0 ] + \" - \" + ui.values[ 1 ] : ui.value;\r\n\t\t\t\t\t\t\t\t$(\"#\"+event.target.id.split(\"-slider\")[0]+\"-range\").val(value);\r\n\t\t\t\t\t\t\t  },\r\n\t\t\t\t\t\t\t  change: function( event, ui ) {\r\n\t\t\t\t\t\t\t\tvar value = ui.values? ui.values[ 0 ] + \" - \" + ui.values[ 1 ] : ui.value;\r\n\t\t\t\t\t\t\t\t$(\"#\"+event.target.id.split(\"-slider\")[0]+\"-range\").val(value); \r\n\t\t\t\t\t\t\t  }\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\tvar value = isMultiple? $(\"#\"+dsd_component_id_slider).slider( \"values\", 0 ) + \" - \" +  $(\"#\"+dsd_component_id_slider).slider( \"values\", 1 ) : $(\"#\"+dsd_component_id_slider).slider( \"value\");\r\n\t\t\t\t\t\t\t$(\"#\"+dsd_component_id_range).val(value);*/\r\n\t\t\t\t\t\t\t$(\"#\"+dsd_component_id_slider).bootstrapSlider({\r\n\t\t\t\t\t\t\t  id: dsd_component_id_slider + '_widget',\r\n\t\t\t\t\t\t\t  range: isMultiple,\r\n\t\t\t\t\t\t\t  min: values_min, \r\n\t\t\t\t\t\t\t  max: values_max,\r\n\t\t\t\t\t\t\t  value: (isMultiple? [ values_min, values_max ] : values_max),\r\n\t\t\t\t\t\t\t  ticks: dsd_component.values.map(function(instant){return parseFloat(instant.id)}),\r\n\t\t\t\t\t\t\t  lock_to_ticks: true\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t$(\"#\"+dsd_component_id_slider).on(\"slide\", function(event) {\r\n\t\t\t\t\t\t\t\tconsole.log(event);\r\n\t\t\t\t\t\t\t\tconsole.log(event.value);\r\n\t\t\t\t\t\t\t\tvar value = event.value instanceof Array? event.value[ 0 ] + \" - \" + event.value[ 1 ] : event.value;\r\n\t\t\t\t\t\t\t\t$(\"#\"+event.target.id.split(\"-slider\")[0]+\"-range\").val(value);\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t$(\"#\"+dsd_component_id_slider).on(\"change\", function(event) {\r\n\t\t\t\t\t\t\t\tvar evt_value = event.value.newValue;\r\n\t\t\t\t\t\t\t\tvar value = evt_value instanceof Array? evt_value[ 0 ] + \" - \" + evt_value[ 1 ] : evt_value;\r\n\t\t\t\t\t\t\t\t$(\"#\"+event.target.id.split(\"-slider\")[0]+\"-range\").val(value);\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\tvar value = isMultiple? $(\"#\"+dsd_component_id_slider).data('bootstrapSlider').getValue()[0] + \" - \" + $(\"#\"+dsd_component_id_slider).data('bootstrapSlider').getValue()[1] : $(\"#\"+dsd_component_id_slider).data('bootstrapSlider').getValue();\r\n\t\t\t\t\t\t\t$(\"#\"+dsd_component_id_range).val(value);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\t//attribute with time --> datepicker / datetimepicker or slider\r\n\t\t\t\t\tif(dsd_component.primitiveType == \"xsd:date\" || dsd_component.primitiveType == \"xsd:datetime\"){\r\n\t\t\t\t\t\tif(!dsd_component.values){\r\n\t\t\t\t\t\t\t//indicates local tzone but required to display well the original date\r\n\t\t\t\t\t\t\tvar entry_time_start = entry.time_start; if(entry_time_start.length == 4) entry_time_start = entry_time_start + \"-01-01\";\r\n\t\t\t\t\t\t\tvar time_start_local = new Date(Date.parse(entry_time_start.split('Z')[0]));\r\n\t\t\t\t\t\t\tvar time_start_local_offset = time_start_local.getTimezoneOffset()*60000;\r\n\t\t\t\t\t\t\tvar time_start = new Date(time_start_local.getTime() + time_start_local_offset);\r\n\t\t\t\t\t\t\tvar entry_time_end = entry.time_end; if(entry_time_end.length == 4) entry_time_end = entry_time_end + \"-12-31\";\r\n\t\t\t\t\t\t\tvar time_end_local = new Date(Date.parse(entry_time_end.split('Z')[0]));\r\n\t\t\t\t\t\t\tvar time_end_local_offset = time_end_local.getTimezoneOffset()*60000;\r\n\t\t\t\t\t\t\tvar time_end = new Date(time_end_local.getTime() + time_end_local_offset);\r\n\r\n\t\t\t\t\t\t\t//id\r\n\t\t\t\t\t\t\tvar dsd_component_id_start = \"dsd-ui-dimension-time-start-\"+dsd_component.primitiveCode;\r\n\t\t\t\t\t\t\tvar dsd_component_id_end = \"dsd-ui-dimension-time-end-\"+dsd_component.primitiveCode;\r\n\t\t\t\t\t\t\t//html\r\n\t\t\t\t\t\t\tvar dsd_component_time_html = '<div class=\"dsd-ui-dimension-time\" style=\"text-align:left;margin-left:0px;margin-bottom:5px;\">';\r\n\t\t\t\t\t\t\tdsd_component_time_html += '<label style=\"width:120px;font-weight:normal;\">'+dsd_component.name+ '</label><br> <input type=\"text\" id=\"'+dsd_component_id_start+'\" class=\"dsd-ui-dimension-datepicker\" autocomplete=\"off\" >'\r\n\t\t\t\t\t\t\tif(strategy==\"ogc_filters\") dsd_component_time_html += '<input type=\"text\" id=\"'+dsd_component_id_end+'\" class=\"dsd-ui-dimension-datepicker\" autocomplete=\"off\">'\r\n\t\t\t\t\t\t\tdsd_component_time_html += '</div>';\r\n\t\t\t\t\t\t\t$(\"#dsd-ui-col-1\").append(dsd_component_time_html);\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tvar startRange = $(\"#\"+dsd_component_id_start);\r\n\t\t\t\t\t\t\tvar endRange = $(\"#\"+dsd_component_id_end);\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t//jquery widget\r\n\t\t\t\t\t\t\tif(dsd_component.primitiveType == \"xsd:date\"){\r\n\t\t\t\t\t\t\t\tswitch(strategy){\r\n\t\t\t\t\t\t\t\t\tcase \"ogc_filters\":\r\n\t\t\t\t\t\t\t\t\t\tstartRange.datetimepicker({\r\n\t\t\t\t\t\t\t\t\t\t\tminDate: time_start, maxDate: time_end,\r\n\t\t\t\t\t\t\t\t\t\t\tformatDate:'Y-d-m',\r\n\t\t\t\t\t\t\t\t\t\t\tformatTime: 'HH:mm:ss',\r\n\t\t\t\t\t\t\t\t\t\t\ttimepicker:false,\r\n\t\t\t\t\t\t\t\t\t\t\tonShow:function( ct ){\r\n\t\t\t\t\t\t\t\t\t\t\t\tthis.setOptions({\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tmaxDate:endRange.val()?endRange.val():false\r\n\t\t\t\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t\t\t//startRange.val(time_start.toISOString().split('T')[0]);\r\n\t\t\t\t\t\t\t\t\t\tendRange.datetimepicker({\r\n\t\t\t\t\t\t\t\t\t\t\tminDate: time_start, maxDate: time_end,\r\n\t\t\t\t\t\t\t\t\t\t\tformatDate:'Y-d-m',\r\n\t\t\t\t\t\t\t\t\t\t\tformatTime: 'HH:mm:ss',\r\n\t\t\t\t\t\t\t\t\t\t\ttimepicker:false,\r\n\t\t\t\t\t\t\t\t\t\t\tonShow:function( ct ){\r\n\t\t\t\t\t\t\t\t\t\t\t\tthis.setOptions({\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tminDate:startRange.val()?startRange.val():false\r\n\t\t\t\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t\t\t//endRange.val(time_end.toISOString().split('T')[0]);\r\n\t\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t\tcase \"ogc_viewparams\":\r\n\t\t\t\t\t\t\t\t\t\tstartRange.datetimepicker({\r\n\t\t\t\t\t\t\t\t\t\t\tminDate: time_start, maxDate: time_end,\r\n\t\t\t\t\t\t\t\t\t\t\tyearStart: time_start.getFullYear(), yearEnd: time_end.getFullYear(),\r\n\t\t\t\t\t\t\t\t\t\t\tformat:'Y-d-m', timepicker:false\r\n\t\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t\t\t//startRange.val(time_start.toISOString().split('T')[0]); break;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}else if(dsd_component.primitiveType == \"xsd:datetime\"){\r\n\t\t\t\t\t\t\t\tswitch(strategy){\r\n\t\t\t\t\t\t\t\t\tcase \"ogc_filters\":\r\n\t\t\t\t\t\t\t\t\t\tstartRange.datetimepicker({\r\n\t\t\t\t\t\t\t\t\t\t\tminDate: time_start, maxDate: time_end,\r\n\t\t\t\t\t\t\t\t\t\t\tformatDate:'Y-d-m',\r\n\t\t\t\t\t\t\t\t\t\t\tformatTime: 'HH:mm:ss',\r\n\t\t\t\t\t\t\t\t\t\t\tonShow:function( ct ){\r\n\t\t\t\t\t\t\t\t\t\t\t\tthis.setOptions({\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tmaxDate:endRange.val()?endRange.val():false\r\n\t\t\t\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t\t\t//startRange.val(time_start.toISOString().replace('T', ' '));\r\n\t\t\t\t\t\t\t\t\t\tendRange.datetimepicker({\r\n\t\t\t\t\t\t\t\t\t\t\tminDate: time_start, maxDate: time_end,\r\n\t\t\t\t\t\t\t\t\t\t\tformatDate:'Y-d-m',\r\n\t\t\t\t\t\t\t\t\t\t\tformatTime: 'HH:mm:ss',\r\n\t\t\t\t\t\t\t\t\t\t\tonShow:function( ct ){\r\n\t\t\t\t\t\t\t\t\t\t\t\tthis.setOptions({\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tminDate:startRange.val()?startRange.val():false\r\n\t\t\t\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t\t\t//endRange.val(time_end.toISOString().replace('T', ' '));\r\n\t\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t\tcase \"ogc_viewparams\":\r\n\t\t\t\t\t\t\t\t\t\tstartRange.datetimepicker({\r\n\t\t\t\t\t\t\t\t\t\t\tminDate: time_start, maxDate: time_end,\r\n\t\t\t\t\t\t\t\t\t\t\tformatDate:'Y-d-m',\r\n\t\t\t\t\t\t\t\t\t\t\tformatTime: 'HH:mm:ss'\r\n\t\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t\t\t//startRange.val(time_start.toISOString().replace('T', ' ')); break;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t//html\r\n\t\t\t\t\t\t\t/*$(\"#dsd-ui-col-1\").append('<select id = \"'+dsd_component_id+'\" '\r\n\t\t\t\t\t\t\t\t+ (isMultiple? 'multiple=\"multiple\"' : '')\r\n\t\t\t\t\t\t\t\t+ (isRequired? 'required' : '')\r\n\t\t\t\t\t\t\t\t+' class=\"dsd-ui-dimension dsd-ui-dimension-attribute\" data-dimension-code=\"'+dsd_component.primitiveCode+'\" title=\"'+this_.options.labels.filtering_on+' '+dsd_component.name+'\">'+(isMultiple? '' : '<option></option>')+'</select>'\r\n\t\t\t\t\t\t\t\t+ (isRequired? '<span style=\"color:red;font-weight:bold;margin-left:2px;font-size:14px;\">*</span>' : ''));\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t//jquery widget\r\n\t\t\t\t\t\t\tvar attributeItemSelection = function(item) {\r\n\t\t\t\t\t\t\t  if (!item.id) { return item.text; }\r\n\t\t\t\t\t\t\t  //TODO vocabulary stuff for countries\r\n\t\t\t\t\t\t\t  if([\"flag\", \"flagstate\", \"country\"].filter(function(el){return item.codelist.toLowerCase().match(el)}).length > 0){\r\n\t\t\t\t\t\t\t\t  var $item = $(\r\n\t\t\t\t\t\t\t\t\t'<img src=\"img/flags/' + item.id.toLowerCase() + '.gif\" class=\"img-flag\" />' +\r\n\t\t\t\t\t\t\t\t\t'<span class=\"dsd-ui-item-label\" >' + item.text + ' <span class=\"dsd-ui-item-code\">['+item.id+']</span>' + '</span>'\r\n\t\t\t\t\t\t\t\t  );\r\n\t\t\t\t\t\t\t  }else{\r\n\t\t\t\t\t\t\t\t  if(item.alternateText){\r\n\t\t\t\t\t\t\t\t\t  var $item = $(\r\n\t\t\t\t\t\t\t\t\t\t'<span class=\"dsd-ui-item-label\" >' + \r\n\t\t\t\t\t\t\t\t\t\t\titem.text + \r\n\t\t\t\t\t\t\t\t\t\t\t' <span class=\"dsd-ui-item-code\">['+item.id+']</span>' + \t\r\n\t\t\t\t\t\t\t\t\t\t'</span>'+\r\n\t\t\t\t\t\t\t\t\t\t'<br><span class=\"dsd-ui-item-sublabel\"> ' + item.alternateText + '</span>' +\r\n\t\t\t\t\t\t\t\t\t\t(item.href? ' <a href=\"'+item.href+'\" target=\"_blank\" style=\"color:blue;\">'+this_.options.labels.listedvalue_href_placeholder+'</a>' : '' )\r\n\t\t\t\t\t\t\t\t\t  );\r\n\t\t\t\t\t\t\t\t  }else{\r\n\t\t\t\t\t\t\t\t\t  var $item = $(\r\n\t\t\t\t\t\t\t\t\t\t'<span class=\"dsd-ui-item-label\" >' + \r\n\t\t\t\t\t\t\t\t\t\t\titem.text + \r\n\t\t\t\t\t\t\t\t\t\t\t' <span class=\"dsd-ui-item-code\">['+item.id+']</span>' + \r\n\t\t\t\t\t\t\t\t\t\t'</span>' +\r\n\t\t\t\t\t\t\t\t\t\t(item.href? '<br><a href=\"'+item.href+'\" target=\"_blank\" style=\"color:blue;\">'+this_.options.labels.listedvalue_href_placeholder+'</a>' : '' )\r\n\t\t\t\t\t\t\t\t\t  );\r\n\t\t\t\t\t\t\t\t  }\r\n\t\t\t\t\t\t\t  }\r\n\t\t\t\t\t\t\t  return $item;\r\n\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t\tvar attributeItemResult = function(item) {\r\n\t\t\t\t\t\t\t  if (!item.id) { return item.text; }\r\n\t\t\t\t\t\t\t  //TODO vocabulary stuff for countries\r\n\t\t\t\t\t\t\t  if([\"flag\", \"flagstate\", \"country\"].filter(function(el){return item.codelist.toLowerCase().match(el)}).length > 0){\r\n\t\t\t\t\t\t\t\t  var $item = $(\r\n\t\t\t\t\t\t\t\t\t'<img src=\"img/flags/' + item.id.toLowerCase() + '.gif\" class=\"img-flag\" />' +\r\n\t\t\t\t\t\t\t\t\t'<span class=\"dsd-ui-item-label\" >' + item.text + ' <span class=\"dsd-ui-item-code\">['+item.id+']</span>' + '</span>'\r\n\t\t\t\t\t\t\t\t  );\r\n\t\t\t\t\t\t\t  }else{\r\n\t\t\t\t\t\t\t\t  if(item.alternateText){\r\n\t\t\t\t\t\t\t\t\t  var $item = $(\r\n\t\t\t\t\t\t\t\t\t\t'<span class=\"dsd-ui-item-label\" >' + item.text + ' <span class=\"dsd-ui-item-code\">['+item.id+']</span>' + '</span>'+\r\n\t\t\t\t\t\t\t\t\t\t'<br><span class=\"dsd-ui-item-sublabel\"> ' + item.alternateText + '</span>'\r\n\t\t\t\t\t\t\t\t\t  );\r\n\t\t\t\t\t\t\t\t  }else{\r\n\t\t\t\t\t\t\t\t\t  var $item = $(\r\n\t\t\t\t\t\t\t\t\t\t'<span class=\"dsd-ui-item-label\" >' + item.text + ' <span class=\"dsd-ui-item-code\">['+item.id+']</span>' + '</span>'\r\n\t\t\t\t\t\t\t\t\t  );\r\n\t\t\t\t\t\t\t\t  }\r\n\t\t\t\t\t\t\t  }\r\n\t\t\t\t\t\t\t  return $item;\r\n\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t\tvar dsd_component_placeholder = dsd_component.name;\r\n\r\n\t\t\t\t\t\t\t$(\"#\" + dsd_component_id).select2({\r\n\t\t\t\t\t\t\t\ttheme: 'classic',\r\n\t\t\t\t\t\t\t\tallowClear: true,\r\n\t\t\t\t\t\t\t\tplaceholder: dsd_component_placeholder,\r\n\t\t\t\t\t\t\t\tdata: dsd_component.values,\r\n\t\t\t\t\t\t\t\ttemplateResult: attributeItemResult,\r\n\t\t\t\t\t\t\t\ttemplateSelection: attributeItemSelection,\r\n\t\t\t\t\t\t\t\tmatcher: attributeMatcher\r\n\t\t\t\t\t\t\t});*/\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t//slider when they are listed values\r\n\t\t\t\t\t\t\tvar values_min = new Date(dsd_component.minOccurs).getTime() / 1000;\r\n\t\t\t\t\t\t\tvar values_max = new Date(dsd_component.maxOccurs).getTime() / 1000;\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t//html\r\n\t\t\t\t\t\t\tvar dsd_component_id_range = dsd_component_id + \"-range\";\r\n\t\t\t\t\t\t\tvar dsd_component_id_slider = dsd_component_id + \"-slider\";\r\n\t\t\t\t\t\t\tvar dsd_component_slider_html = '<div id=\"'+dsd_component_id+'\" class=\"dsd-ui-dimension dsd-ui-dimension-attribute dsd-ui-dimension-slider\" data-dimension-code=\"'+dsd_component.primitiveCode+'\">' +\r\n\t\t\t\t\t\t\t'<p><label for=\"'+dsd_component_id_range+'\">'+dsd_component.name+': </label>' +\r\n\t\t\t\t\t\t\t'<input type=\"text\" id=\"'+dsd_component_id_range+'\" readonly style=\"margin-left:5px; border:0; color:#f6931f; font-weight:bold;\"></p>' +\r\n\t\t\t\t\t\t\t'<input id=\"'+dsd_component_id_slider+'\" type=\"text\" data-slider-min=\"'+values_min+'\" data-slider-max=\"'+values_max+'\" data-slider-value=\"'+(isMultiple? \"[\"+values_min+\", \"+values_max+\"]\" : values_max)+'\"/>' +\r\n\t\t\t\t\t\t\t'</div>';\r\n\t\t\t\t\t\t\t$(\"#dsd-ui-col-1\").append(dsd_component_slider_html);\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tconsole.log(\"TIME\");\r\n\t\t\t\t\t\t\tconsole.log(dsd_component_id_slider);\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t//jquery widget\r\n\t\t\t\t\t\t\tconsole.log(isMultiple);\r\n\t\t\t\t\t\t\t$(\"#\"+dsd_component_id_slider).bootstrapSlider({\r\n\t\t\t\t\t\t\t  range: isMultiple,\r\n\t\t\t\t\t\t\t  min: values_min, \r\n\t\t\t\t\t\t\t  max: values_max,\r\n\t\t\t\t\t\t\t  value: (isMultiple? [ values_min, values_max ] : values_max),\r\n\t\t\t\t\t\t\t  ticks: dsd_component.values.map(function(instant){return new Date(instant.id).getTime()/1000;}),\r\n\t\t\t\t\t\t\t  lock_to_ticks: true\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t$(\"#\"+dsd_component_id_slider).on(\"slide\", function(event) {\r\n\t\t\t\t\t\t\t\tconsole.log(event)\r\n\t\t\t\t\t\t\t\tvar value = event.value instanceof Array? new Date(event.value[ 0 ]*1000).toISOString() + \" - \" + new Date(event.value[ 1 ]*1000).toISOString() : new Date(event.value*1000).toISOString();\r\n\t\t\t\t\t\t\t\t$(\"#\"+event.target.id.split(\"-slider\")[0]+\"-range\").val(value);\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t$(\"#\"+dsd_component_id_slider).on(\"change\", function(event) {\r\n\t\t\t\t\t\t\t\tvar evt_value = event.value.newValue;\r\n\t\t\t\t\t\t\t\tvar value = evt_value instanceof Array? new Date(evt_value[ 0 ]*1000).toISOString() + \" - \" + new Date(evt_value[ 1 ]*1000).toISOString() : new Date(evt_value*1000).toISOString();\r\n\t\t\t\t\t\t\t\t$(\"#\"+event.target.id.split(\"-slider\")[0]+\"-range\").val(value);\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\tvar value = isMultiple? new Date($(\"#\"+dsd_component_id_slider).data('bootstrapSlider').getValue()[0]*1000).toISOString() + \" - \" +  new Date($(\"#\"+dsd_component_id_slider).data('bootstrapSlider').getValue()[1]*1000).toISOString() : new Date($(\"#\"+dsd_component_id_slider).data('bootstrapSlider').getValue()*1000).toISOString();\r\n\t\t\t\t\t\t\t$(\"#\"+dsd_component_id_range).val(value);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\t// Next follow UI for variables\r\n\t\tvar variables = this_.dataset_on_query.dsd.filter(function(item){if(item.columnType == \"variable\") return item});\r\n\t\t\r\n\t\t//2. Build UI from VARIABLES filtering\r\n\t\t//-------------------------------------------\r\n\t\t/*if(variables.length > 0) {\r\n\t\t\t\t$(\"#dsd-ui-col-1\").append('<div style=\"margin: 0px;margin-top: 10px;width: 90%;text-align: left !important;\"><p style=\"margin:0;\"><label>'+ this_.options.labels.variables+'</label></p></div>');\r\n\t\t\t\t$(\"#dsd-ui-col-1\").append('<p><em>Coming Soon!</em></p>');\r\n\t\t}*/\r\n\t\t\r\n\t\t//3. Build UI for THEMATIC MAPPING on Variables\r\n\t\t//---------------------------------------------\t\r\n\t\t$(\"#dsd-ui-body\").append('<div id=\"dsd-ui-col-2\" class=\"'+bootstrapClass+'\"></div>');\r\n\t\tif(this_.dataset_on_query.thematicmapping) {\r\n\t\t\t\r\n\t\t\t//VARIABLES handling as drop-down list\r\n\t\t\t//------------------------------------\r\n\t\t\t//variable matcher\r\n\t\t\tvar variableMatcher = function(params, data){\r\n\t\t\t\tparams.term = params.term || '';\r\n\t\t\t\tif ($.trim(params.term) === '') {\r\n\t\t\t\t  return data;\r\n\t\t\t\t}  \r\n\t\t\t\tvar term = params.term.toUpperCase();\r\n\t\t\t\tvar altText = data.alternateText? data.alternateText : '';\r\n\t\t\t\tif (data.text.toUpperCase().indexOf(term) > -1  |\r\n\t\t\t\t\tdata.id.toUpperCase().indexOf(term) > -1    |\r\n\t\t\t\t\taltText.toUpperCase().indexOf(term) > -1    ) {\r\n\t\t\t\t\treturn data;\r\n\t\t\t\t}\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\t\t\t//variableItem\r\n\t\t\tvar variableItem = function(item, alternate) {\r\n\t\t\t  if (!item.id) { return item.text; }\t\t\t \r\n\t\t\t  if(alternate && item.alternateText){\r\n\t\t\t\t  var $item = $(\r\n\t\t\t\t\t'<span class=\"dsd-ui-item-label\" >' + item.text + ' <span class=\"dsd-ui-item-code\">['+item.id+']</span>' + '</span>'+\r\n\t\t\t\t\t'<br><span class=\"dsd-ui-item-sublabel\"> ' + item.alternateText + '</span>'\r\n\t\t\t\t  );\r\n\t\t\t  }else{\r\n\t\t\t\t  var $item = $(\r\n\t\t\t\t\t'<span class=\"dsd-ui-item-label\" >' + item.text + ' <span class=\"dsd-ui-item-code\">['+item.id+']</span>' + '</span>'\r\n\t\t\t\t  );\r\n\t\t\t  }\r\n\t\t\t  return $item;\r\n\t\t\t};\r\n\t\t\tvar variableItemSelection = function(item){\r\n\t\t\t\treturn variableItem(item, false);\r\n\t\t\t}\r\n\t\t\tvar variableItemResult = function(item){\r\n\t\t\t\treturn variableItem(item, true);\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t$(\"#dsd-ui-col-2\").append('<div style=\"margin: 0px;margin-top: 10px;width: 90%;text-align: left !important;\"><p style=\"margin:0;font-variant:petite-caps;font-size:110%;\"><span class=\"glyphicon glyphicon-globe\"></span><label style=\"margin-left:4px;\">'+ this_.options.labels.thematicmapping+'</label></p><hr style=\"margin:0px;\"></div>');\r\n\t\t\t\r\n\t\t\t$(\"#dsd-ui-col-2\").append('<div style=\"margin: 0px;margin-top: 10px;width: 90%;text-align: left !important;\"><p style=\"margin:0;\"><label style=\"font-weight:normal;\">'+ this_.options.labels.thematicmapping_variable+'</label></p></div>');\r\n\t\t\t\r\n\t\t\t//prepare dropdownlist items\r\n\t\t\tvar variable_items = new Array();\r\n\t\t\tfor(var i=0;i<variables.length;i++){\r\n\t\t\t\tvar dsd_variable = variables[i];\r\n\t\t\t\tvariable_items.push( {\r\n\t\t\t\t\tid: dsd_variable.primitiveCode, \r\n\t\t\t\t\ttext: dsd_variable.name, \r\n\t\t\t\t\talternateText: dsd_variable.definition, \r\n\t\t\t\t\ttype: dsd_variable.primitiveType\r\n\t\t\t\t} );\r\n\t\t\t}\r\n\t\t\t//init selector\r\n\t\t\t//id\r\n\t\t\tvar dsd_variables_id = \"dsd-ui-dimension-variable\";\r\n\t\t\t//html\r\n\t\t\t$(\"#dsd-ui-col-2\").append('<select id = \"'+dsd_variables_id+'\" class=\"dsd-ui-dimension dsd-ui-dimension-variable\" title=\"'+this_.options.labels.thematicmapping_variable+'\"><option></option></select>');\r\n\t\t\t$(\"#\" + dsd_variables_id).select2({\r\n\t\t\t\ttheme: 'classic',\r\n\t\t\t\tallowClear: true,\r\n\t\t\t\tdata: variable_items,\r\n\t\t\t\ttemplateResult: variableItemResult,\r\n\t\t\t\ttemplateSelection: variableItemSelection,\r\n\t\t\t\tmatcher: variableMatcher,\r\n\t\t\t\tplaceholder: this_.options.labels.thematicmapping_variable\r\n\t\t\t});\r\n\t\t\t\r\n\t\t\t//VARIABLES OPTIONS\r\n\t\t\t//------------------------------------\r\n\t\t\t$(\"#dsd-ui-col-2\").append('<div style=\"margin: 0px;margin-top: 10px;width: 90%;text-align: left !important;\"><p style=\"margin:0;\"><label style=\"font-weight:normal;\">'+ this_.options.labels.thematicmapping_options+'</label></p></div>');\r\n\t\t\tvar geomtype = this_.getGeometryType(this_.dataset_on_query.dsd);\r\n\t\t\tthis_.handleQueryThematicMappingOptions(geomtype, 2);\r\n\t\t}\r\n\t\t\r\n\t\t//4. Build UI for styling options (if service capabilities available with dataset)\r\n\t\t//--------------------------------------------------------------------------------\r\n\t\tif(this_.dataset_on_query.capabilities) {\r\n\t\t\t$(\"#dsd-ui-col-2\").append('<div style=\"margin: 0px;margin-top: 10px;width: 90%;text-align: left !important;\"><p style=\"margin:0;font-variant:petite-caps;font-size:110%;\"><span class=\"glyphicon glyphicon-globe\"></span><label style=\"margin-left:4px;\">'+ this_.options.labels.thematicmapping+'</label></p><hr style=\"margin:0px;\"></div>');\r\n\t\t\t$(\"#dsd-ui-col-2\").append('<div style=\"margin: 0px;margin-top: 10px;width: 90%;text-align: left !important;\"><p style=\"margin:0;\"><label style=\"font-weight:normal;\">'+ this_.options.labels.styling_options+'</label></p></div>');\r\n\t\t\tthis_.handleQueryStylingOptions(2);\r\n\t\t}\r\n\t\t\r\n\t\t//query & map button\r\n\t\tthis_.handleQueryAndMapButton(2);\r\n\t\t\r\n\t\t//query form buttons\r\n\t\t$(\"#dsd-ui-col-2\").append('<div style=\"margin: 0px;margin-top: 10px;width: 90%;text-align: left !important;\"><p style=\"margin:0;font-variant: petite-caps;font-size:110%;\"><span class=\"glyphicon glyphicon-download-alt\"></span><label style=\"margin-left:4px;\">'+this_.options.labels.download_options+'</label></p><hr style=\"margin:0px;\"></div>');\r\n\t\tthis_.handleQueryFormButtons(2);\r\n\t\t\r\n\t\t//ANALYTICS (if any dashboard associated to the dataset)\r\n\t\tif(this_.hasDashboards(this_.dataset_on_query)){\r\n\t\t\tthis_.handleDashboardOptions(2);\r\n\t\t}\r\n\t\t\r\n\t}\r\n\t\r\n\t/**\r\n\t * handleDSDFromFeatureCatalogue\r\n\t * @param {Object} dataset\r\n\t * @param {Boolean} dsdOnly\r\n\t */\r\n\thandleDSDFromFeatureCatalogue(dataset, dsdOnly){\r\n\r\n\t    var deferred = $.Deferred();\t\r\n          \r\n\t\t$(\"#dsd-loader\").show();\r\n\t  \r\n\t\tvar this_ = this;\r\n\t\tvar pid = dataset.pid;\r\n\t\tvar lyr = dataset.lyr;\r\n\t\tvar strategy = this.getStrategy(dataset);\r\n\t\tvar entry = dataset.entry? dataset.entry : dataset;\r\n\t\t$.ajax({\r\n\t\t\turl: dataset.dsd,\r\n\t\t\tcontentType: 'application/xml',\r\n\t\t\ttype: 'GET',\r\n\t\t\tsuccess: function(response){\r\n\t\t\t\t\r\n\t\t\t\t//parse DSD\r\n\t\t\t\tvar dsd = this_.parseFeatureCatalogue(response);\r\n\t\t\t\tconsole.log(dsd);\r\n\t\t\t\t/*if(!dsd){\r\n\t\t\t\t\tconsole.warn(\"No feature catalogue available although referenced in metadata. Delegate to simple filter form\");\r\n\t\t\t\t\tthis_.handleFilter(dataset);\r\n\t\t\t\t\t$(\"#dsd-loader\").hide();\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}*/\r\n\t\t\t\tif(dsd.strategy) strategy = dsd.strategy; //Backward compatibility for datasets having their OFV strategy set-up in feature catalogues\r\n\t\t\t\tthis_.dataset_on_query = { \r\n\t\t\t\t\tpid: pid,\r\n\t\t\t\t\tlyr: lyr,\r\n\t\t\t\t\tentry: entry, \r\n\t\t\t\t\tstrategy: strategy, \r\n\t\t\t\t\tdsd: dsd.components, \r\n\t\t\t\t\tquery: null, \r\n\t\t\t\t\tthematicmapping: dsd.components.filter(function(item){if(item.columnType == \"variable\") return item}).length > 0,\r\n\t\t\t\t\tpoint_vectorizing: this_.options.map.point_vectorizing && dsd.components.filter(function(item){if(item.primitiveType == \"gml:PointPropertyType\") return item;}).length > 0,\r\n\t\t\t\t\tpoint_clustering: this_.options.map.point_vectorizing && this_.options.map.point_clustering && dsd.components.filter(function(item){if(item.primitiveType == \"gml:PointPropertyType\") return item;}).length > 0\r\n\t\t\t\t};\r\n\t\t\t\t\r\n\t\t\t\tif(this_.dataset_on_query.point_vectorizing) this_.dataset_on_query.thematicmapping = false;\r\n\t\t\t\tif(this_.dataset_on_query.point_clustering) this_.dataset_on_query.thematicmapping = false;\r\n\t\t\t\t\r\n\t\t\t\t\r\n\t\t\t\t\r\n\t\t\t\t//query service capabilities\r\n\t\t\t\tconsole.log(this_.getDatasetServiceCouplingType(this_.dataset_on_query));\r\n\t\t\t\tif(this_.getDatasetServiceCouplingType(this_.dataset_on_query) == \"tight\"){\r\n\t\t\t\t\tthis_.handleDatasetServiceCapabilities(this_.dataset_on_query).then(function(capabilities){\r\n\t\t\t\t\t\tconsole.log(strategy);\r\n\t\t\t\t\t\tif(strategy == \"ogc_dimensions\") {\r\n\t\t\t\t\t\t\tthis_.dataset_on_query.capabilities = capabilities;\r\n\t\t\t\t\t\t\tvar ogc_dsd = this_.parseLayerDescription(this_.dataset_on_query, entry.wms[0].name);\r\n\t\t\t\t\t\t\tconsole.log(ogc_dsd);\r\n\t\t\t\t\t\t\tthis_.dataset_on_query.dsd = ogc_dsd.components;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t//build UI\r\n\t\t\t\t\t\t$(\"#dsd-loader\").hide();\r\n\t\t\t\t\t\tif(!dsdOnly) this_.handleDSDUserInterface(this_.dataset_on_query);\r\n\t\t\t\t\t\tdeferred.resolve(this_.dataset_on_query);\r\n\t\t\t\t\t});\r\n\t\t\t\t}else{\r\n\t\t\t\t\t$(\"#dsd-loader\").hide();\r\n\t\t\t\t\tif(!dsdOnly) this_.handleDSDUserInterface(this_.dataset_on_query);\r\n\t\t\t\t\tdeferred.resolve(this_.dataset_on_query);\r\n\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t}\r\n\t\t});\r\n\t\r\n\t\treturn deferred.promise();\r\n\r\n\t}\r\n\t\r\n\t\r\n\t/**\r\n\t * handleDSDFromCoverageDescription\r\n\t * @param {Object} dataset\r\n\t * @param {Boolean} dsdOnly\t \r\n\t */\r\n\thandleDSDFromCoverageDescription(dataset, dsdOnly){\r\n\t\t\r\n\t\t var deferred = $.Deferred();\t\r\n          \r\n\t\t$(\"#dsd-loader\").show();\r\n\t  \r\n\t\tvar this_ = this;\r\n\t\tvar pid = dataset.pid;\r\n\t\tvar lyr = dataset.lyr;\r\n\t\tvar entry = dataset.entry? dataset.entry : dataset;\r\n\t\t\r\n\t\tvar strategy = this.getStrategy(dataset);\r\n\t\tvar dsd = this_.parseCoverageDescription(dataset);\r\n\t\tconsole.log(dsd);\r\n\t\t/*if(!dsd){\r\n\t\t\tconsole.warn(\"No coverage description available. Delegate to simple filter form\");\r\n\t\t\tthis_.handleFilter(dataset);\r\n\t\t\t$(\"#dsd-loader\").hide();\r\n\t\t\treturn;\r\n\t\t}*/\r\n\t\tif(dsd.strategy) strategy = dsd.strategy;\r\n\t\tthis_.dataset_on_query = { \r\n\t\t\tpid: pid,\r\n\t\t\tlyr: lyr,\r\n\t\t\tentry: entry, \r\n\t\t\tstrategy: strategy, \r\n\t\t\tdsd: (dsd.components? dsd.components : null), \r\n\t\t\tquery: null, \r\n\t\t\tthematicmapping: false,\r\n\t\t\tpoint_vectorizing: false,\r\n\t\t\tpoint_clustering: false\r\n\t\t};\r\n\t\t\r\n\t\t//query service capabilities\r\n\t\tconsole.log(this_.getDatasetServiceCouplingType(this_.dataset_on_query));\r\n\t\tif(this_.getDatasetServiceCouplingType(this_.dataset_on_query) == \"tight\"){\r\n\t\t\tthis_.handleDatasetServiceCapabilities(this_.dataset_on_query).then(function(capabilities){\r\n\t\t\t\tconsole.log(strategy);\r\n\t\t\t\tif(strategy == \"ogc_dimensions\") {\r\n\t\t\t\t\tthis_.dataset_on_query.capabilities = capabilities;\r\n\t\t\t\t\tvar ogc_dsd = this_.parseLayerDescription(this_.dataset_on_query, entry.wms[0].name);\r\n\t\t\t\t\tconsole.log(ogc_dsd);\r\n\t\t\t\t\tthis_.dataset_on_query.dsd = ogc_dsd.components;\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\t//build UI\r\n\t\t\t\t$(\"#dsd-loader\").hide();\r\n\t\t\t\tif(!dsdOnly) this_.handleDSDUserInterface(this_.dataset_on_query);\t\r\n\t\t\t\tdeferred.resolve(this_.dataset_on_query);\r\n\t\t\t});\r\n\t\t}else{\r\n\t\t\t$(\"#dsd-loader\").hide();\r\n\t\t\tif(!dsdOnly) this_.handleDSDUserInterface(this_.dataset_on_query);\r\n\t\t\tdeferred.resolve(this_.dataset_on_query);\r\n\t\t}\r\n\t\t\r\n\t\treturn deferred.promise();\r\n\t\t\r\n\t}\r\n\t\r\n\t/**\r\n\t * stringifyStrategyParams\r\n\t * @param {Object} dataset\r\n\t * @param {Object} strategyparams\r\n\t */\r\n\tstringifyStrategyParams(dataset, strategyparams){\r\n\t\tvar strategyparams_str = null;\r\n\t\tswitch(dataset.strategy){\r\n\t\t\t case \"ogc_filters\":\r\n\t\t\t\tif(dataset.dsd){\r\n\t\t\t\t\tconsole.log(\"Stringify 'ogc_filters' strategy params - with DSD\")\r\n\t\t\t\t\tconsole.log(strategyparams);\r\n\t\t\t\t\tif(strategyparams) strategyparams_str = strategyparams.map(function(item){\r\n\t\t\t\t\t\tvar fieldname = Object.keys(item);\r\n\t\t\t\t\t\tvar item_component = item[fieldname];\r\n\t\t\t\t\t\tvar item_values = item_component.content;\r\n\t\t\t\t\t\tvar filter = null\r\n\t\t\t\t\t\tswitch(item_component.type){\r\n\t\t\t\t\t\t\tcase \"list\":\r\n\t\t\t\t\t\t\t\tif(!(item_values instanceof Array)) item_values = [item_values];\r\n\t\t\t\t\t\t\t\tvar item_values_str = item_values.map(function(item){return encodeURIComponent(item)}).join(',');\r\n\t\t\t\t\t\t\t\tfilter = '(' + fieldname + ' IN(' + item_values_str + '))';\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase \"range\":\r\n\t\t\t\t\t\t\t\tif(!(item_values instanceof Array)) item_values = [item_values];\r\n\t\t\t\t\t\t\t\tvar item_values_str = item_values.map(function(item){return encodeURIComponent(item)}).join(',');\r\n\t\t\t\t\t\t\t\tfilter = '(' + fieldname + ' IN(' + item_values_str + '))';\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase \"timeperiod\":\r\n\t\t\t\t\t\t\t\tfilter = '(' + fieldname +' AFTER '+ item_values[0] + ' AND ' + fieldname + ' BEFORE ' + item_values[1] +')';\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\treturn filter;\r\n\t\t\t\t\t}).join(' AND ');\r\n\t\t\t\t}else{\r\n\t\t\t\t\tconsole.log(\"Stringify 'ogc_filters' strategy params - with Filter\");\r\n\t\t\t\t\tif(strategyparams) strategyparams_str = strategyparams.map(function(item){return Object.keys(item) + ':' + item[Object.keys(item)]}).join(';');\t\t\t\t\t\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tcase  \"ogc_dimensions\":\r\n\t\t\t\tconsole.info(\"No strategy params stringify implementation for strategy 'ogc_dimensions': TIME/ELEVATION managed directly through strategy params\");\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"ogc_viewparams\":\r\n\t\t\t\tconsole.log(\"Stringify 'ogc_viewparams' strategy params\");\r\n\t\t\t\tconsole.log(strategyparams);\r\n\t\t\t\tif(strategyparams) strategyparams_str = strategyparams.map(function(item){\r\n\t\t\t\t\tvar fieldname = Object.keys(item);\r\n\t\t\t\t\tvar item_component = item[fieldname];\r\n\t\t\t\t\tvar item_values = item_component.content\r\n\t\t\t\t\tvar viewparam = null;\r\n\t\t\t\t\tswitch(item_component.type){\r\n\t\t\t\t\t\tcase \"list\":\r\n\t\t\t\t\t\t\tif(!(item_values instanceof Array)) item_values = [item_values];\r\n\t\t\t\t\t\t\tviewparam = Object.keys(item) + ':' + item_values.join('+');\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase \"range\":\r\n\t\t\t\t\t\t\tif(!(item_values instanceof Array)) item_values = [item_values];\r\n\t\t\t\t\t\t\tviewparam = Object.keys(item) + ':' + item_values.join('+');\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase \"timeinstant\":\r\n\t\t\t\t\t\t\tviewparam = fieldname + ':' + item_values[0];\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn viewparam;\r\n\t\t\t\t}).join(';');\r\n\t\t\t\tbreak;\t\r\n\t\t}\r\n\t\treturn strategyparams_str;\r\n\t};\r\n\t\r\n\t/**\r\n\t * getStrategyLayer\r\n\t */\r\n\tgetStrategyLayer(){\r\n\t\treturn $(\"#ui-ogc_layer\").val();\r\n\t}\r\n\t\r\n\t/**\r\n\t * getStrategyParams\r\n\t * @param {Object} dataset\r\n\t * @param {Boolean} stringify\r\n\t */\r\n\t getStrategyParams(dataset, stringify){\r\n\t\t//TODO refactor getStrategyParams? Apart from the case of ogc_filters without dsd, all cases seems the same business logic code\r\n\t\t// (Common User interface to query the data, whatever the strategy considered = objective of OFV)\r\n\t\tvar this_ = this;\r\n\t\tvar data_query = new Array();\r\n\t\tconsole.log(\"Getting '\"+dataset.strategy+\"' strategy params for dataset '\"+dataset.pid+\"'\");\r\n\t\tswitch(dataset.strategy){\r\n\t\t    case \"ogc_filters\":\r\n\t\t\t\t//Get params according to 'filters' strategy\r\n\t\t\t\t//2 cases: simple filter vs. featurecatalogue\r\n\t\t\t\tif(dataset.dsd){\r\n\t\t\t\t\t$.each($(\".dsd-ui-dimension-attribute\"), function(i,item){\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tvar clazz = $(\"#\"+item.id).attr('class');\r\n\t\t\t\t\t\tvar dim = dataset.dsd.filter(function(comp){if(comp.primitiveCode == $(\"#\"+item.id).data().dimensionCode) return comp})[0];\r\n\t\t\t\t\t\tvar widget = null;\r\n\t\t\t\t\t\tif(clazz.indexOf(\"select2\")>0) widget = \"select2\";\r\n\t\t\t\t\t\tif(clazz.indexOf(\"slider\")>0) widget = \"slider\";\r\n\t\t\t\t\t\tvar type = null;\r\n\t\t\t\t\t\tvar values = null;\r\n\t\t\t\t\t\tswitch(widget){\r\n\t\t\t\t\t\t\tcase \"select2\": \r\n\t\t\t\t\t\t\t\ttype = \"list\";\r\n\t\t\t\t\t\t\t\tvalues = $(\"#\"+item.id).val(); \r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase \"slider\": \r\n\t\t\t\t\t\t\t\ttype = \"range\";\r\n\t\t\t\t\t\t\t\tvar slide = $(\"#\"+item.id+\"-slider\");\r\n\t\t\t\t\t\t\t\tvar slide_data = slide.data('bootstrapSlider').getValue();\r\n\t\t\t\t\t\t\t\tif(slide_data instanceof Array){\r\n\t\t\t\t\t\t\t\t\t//multiple values\r\n\t\t\t\t\t\t\t\t\tvar min = slide_data[0];\r\n\t\t\t\t\t\t\t\t\tvar max = slide_data[1];\r\n\t\t\t\t\t\t\t\t\tif(dim.primitiveType == \"xsd:decimal\" || dim.primitiveType == \"xsd:int\"){\r\n\t\t\t\t\t\t\t\t\t\tvalues = Array.apply(null, {length: max + 1 - min}).map(function(_, idx) { return idx + min; });\r\n\t\t\t\t\t\t\t\t\t}else if(dim.primitiveType == \"xsd:datetime\"){\r\n\t\t\t\t\t\t\t\t\t\tvar instants = dim.values.map(function(item){return item.id});\r\n\t\t\t\t\t\t\t\t\t\t//TODO manage period/list of dates \r\n\t\t\t\t\t\t\t\t\t\tvalues = [new Date(min*1000).toISOString(),new Date(max*1000).toISOString()];\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\t\t\t//single value\r\n\t\t\t\t\t\t\t\t\tvar value = slide_data;\r\n\t\t\t\t\t\t\t\t\tif(dim.primitiveType == \"xsd:decimal\" || dim.primitiveType == \"xsd:int\"){\r\n\t\t\t\t\t\t\t\t\t\tvalues = [value];\r\n\t\t\t\t\t\t\t\t\t}else if(dim.primitiveType == \"xsd:datetime\"){\r\n\t\t\t\t\t\t\t\t\t\tvalues = [new Date(value*1000).toISOString()];\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t//old code from Jquery UI slider\r\n\t\t\t\t\t\t\t\t/*var slide = $($(\"#\"+item.id).find(\".ui-slider\")[0]);\r\n\t\t\t\t\t\t\t\tif(slide.slider('values').length > 0){\r\n\t\t\t\t\t\t\t\t\t//multiple values\r\n\t\t\t\t\t\t\t\t\tvar min = slide.slider('values', 0);\r\n\t\t\t\t\t\t\t\t\tvar max = slide.slider('values', 1);\r\n\t\t\t\t\t\t\t\t\tvalues = Array.apply(null, {length: max + 1 - min}).map(function(_, idx) { return idx + min; });\r\n\t\t\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\t\t\t//single value\r\n\t\t\t\t\t\t\t\t\tvar value = slide.slider('value');\r\n\t\t\t\t\t\t\t\t\tvalues = [value];\r\n\t\t\t\t\t\t\t\t}*/\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif(values) if(values.length > 0){\r\n\t\t\t\t\t\t\tvar data_component_query = new Object();\r\n\t\t\t\t\t\t\tvar attribute = item.id.split('dsd-ui-dimension-attribute-')[1];\r\n\t\t\t\t\t\t\tvar attributeDef = dataset.dsd.filter(function(component){if(component.primitiveCode==attribute) return component})[0];\r\n\t\t\t\t\t\t\tif(attributeDef.primitiveType == \"xsd:string\"){\r\n\t\t\t\t\t\t\t\tif(values instanceof Array){\r\n\t\t\t\t\t\t\t\t\tvalues = values.map(function(item){return \"'\"+item.replace(/[\\']/g, \"''\")+\"'\"});\r\n\t\t\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\t\t\tvalues = \"'\"+values.replace(/[\\']/g, \"''\")+\"'\";\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tdata_component_query[attribute] = {\r\n\t\t\t\t\t\t\t\ttype: type, \r\n\t\t\t\t\t\t\t\tcontent: values\r\n\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t\tdata_query.push(data_component_query);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t\t$.each($(\".dsd-ui-dimension-time\"), function(i,item){\r\n\t\t\t\t\t\tvar inputs = $(item).find(\"input\");\r\n\t\t\t\t\t\tvar val_start = $(inputs[0]).val();\r\n\t\t\t\t\t\tvar val_end = $(inputs[1]).val();\r\n\t\t\t\t\t\tif(val_start != \"\" && val_end != \"\"){\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tvar attribute = inputs[0].id.split('dsd-ui-dimension-time-start-')[1];\r\n\t\t\t\t\t\t\tvar attributeDef = dataset.dsd.filter(function(component){if(component.primitiveCode==attribute) return component})[0];\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tvar date_start = new Date(Date.parse(val_start+ (attributeDef.primitiveType == \"xsd:datetime\"? 'Z' : '')));\r\n\t\t\t\t\t\t\tvar date_end = new Date(Date.parse(val_end+ (attributeDef.primitiveType == \"xsd:datetime\"? 'Z' : '')));\r\n\t\t\t\t\t\t\tvar data_component_query = new Object();\r\n\t\t\t\t\t\t\tdata_component_query[attribute] = {\r\n\t\t\t\t\t\t\t\ttype: \"timeperiod\", \r\n\t\t\t\t\t\t\t\tcontent: [date_start.toISOString().split(attributeDef.primitiveType == \"xsd:datetime\"? \".000Z\" : \"T\")[0], date_end.toISOString().split(attributeDef.primitiveType == \"xsd:datetime\"? \".000Z\" : \"T\")[0]]\r\n\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t\tdata_query.push(data_component_query);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}else{\r\n\t\t\t\t\tvar filter = $(\"#ui-ogc_filter\").val();\r\n\t\t\t\t\tif(filter) data_query.push({CQL_FILTER : filter});\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\r\n\t\t    case \"ogc_dimensions\":\r\n\t\t\t\t//Get params according to 'dimensions' strategy\r\n\t\t\t\t$.each($(\".dsd-ui-dimension-attribute\"), function(i,item){ \r\n\t\t\t\t\tvar clazz = $(\"#\"+item.id).attr('class');\r\n\t\t\t\t\tvar dim = dataset.dsd.filter(function(comp){if(comp.primitiveCode == $(\"#\"+item.id).data().dimensionCode) return comp})[0];\r\n\t\t\t\t\tvar widget = null;\r\n\t\t\t\t\tif(clazz.indexOf(\"select2\")>0) widget = \"select2\";\r\n\t\t\t\t\tif(clazz.indexOf(\"slider\")>0) widget = \"slider\";\r\n\t\t\t\t\tvar type = null;\r\n\t\t\t\t\tvar values = null;\r\n\t\t\t\t\tswitch(widget){\r\n\t\t\t\t\t\tcase \"select2\":\r\n\t\t\t\t\t\t\ttype = \"list\";\r\n\t\t\t\t\t\t\tvalues = $(\"#\"+item.id).val(); \r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase \"slider\": \r\n\t\t\t\t\t\t\ttype = \"range\";\r\n\t\t\t\t\t\t\tvar slide = $(\"#\"+item.id+\"-slider\");\r\n\t\t\t\t\t\t\tvar slide_data = slide.data('bootstrapSlider').getValue();\r\n\t\t\t\t\t\t\tif(slide_data instanceof Array){\r\n\t\t\t\t\t\t\t\t//multiple values\r\n\t\t\t\t\t\t\t\tvar min = slide_data[0];\r\n\t\t\t\t\t\t\t\tvar max = slide_data[1];\r\n\t\t\t\t\t\t\t\tif(dim.primitiveType == \"xsd:decimal\" || dim.primitiveType == \"xsd:int\"){\r\n\t\t\t\t\t\t\t\t\tvalues = Array.apply(null, {length: max + 1 - min}).map(function(_, idx) { return idx + min; });\r\n\t\t\t\t\t\t\t\t}else if(dim.primitiveType == \"xsd:datetime\"){\r\n\t\t\t\t\t\t\t\t\tvar instants = dim.values.map(function(item){return item.id});\r\n\t\t\t\t\t\t\t\t\t//TODO manage period/list of dates \r\n\t\t\t\t\t\t\t\t\tvalues = [new Date(min*1000).toISOString(),new Date(max*1000).toISOString()];\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\t\t//single value\r\n\t\t\t\t\t\t\t\tvar value = slide_data;\r\n\t\t\t\t\t\t\t\tif(dim.primitiveType == \"xsd:decimal\" || dim.primitiveType == \"xsd:int\"){\r\n\t\t\t\t\t\t\t\t\tvalues = [value];\r\n\t\t\t\t\t\t\t\t}else if(dim.primitiveType == \"xsd:datetime\"){\r\n\t\t\t\t\t\t\t\t\tvalues = [new Date(value*1000).toISOString()];\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t//old code from Jquery UI slider\r\n\t\t\t\t\t\t\t/*var slide = $($(\"#\"+item.id).find(\".ui-slider\")[0]);\r\n\t\t\t\t\t\t\tif(slide.slider('values').length > 0){\r\n\t\t\t\t\t\t\t\t//multiple values\r\n\t\t\t\t\t\t\t\tvar min = slide.slider('values', 0);\r\n\t\t\t\t\t\t\t\tvar max = slide.slider('values', 1);\r\n\t\t\t\t\t\t\t\tvalues = Array.apply(null, {length: max + 1 - min}).map(function(_, idx) { return idx + min; });\r\n\t\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\t\t//single value\r\n\t\t\t\t\t\t\t\tvar value = slide.slider('value');\r\n\t\t\t\t\t\t\t\tvalues = [value];\r\n\t\t\t\t\t\t\t}*/\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif(values) if(values.length > 0){\r\n\t\t\t\t\t\tvar data_component_query = new Object();\r\n\t\t\t\t\t\tvar attribute = item.id.split('dsd-ui-dimension-attribute-')[1];\r\n\t\t\t\t\t\tdata_component_query[attribute] = {\r\n\t\t\t\t\t\t\ttype: type, \r\n\t\t\t\t\t\t\tcontent: values\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t\tdata_query.push(data_component_query);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\tif($(\".dsd-ui-dimension-time\").length > 0){\r\n\t\t\t\t\t$.each($(\".dsd-ui-dimension-time\"), function(i,item){\r\n\t\t\t\t\t\tvar inputs = $(item).find(\"input\");\r\n\t\t\t\t\t\tvar val_start = $(inputs[0]).val();\r\n\t\t\t\t\t\tif(val_start != \"\"){\r\n\t\t\t\t\t\t\tvar attribute = inputs[0].id.split('dsd-ui-dimension-time-start-')[1];\r\n\t\t\t\t\t\t\tvar attributeDef = dataset.dsd.filter(function(component){if(component.primitiveCode==attribute) return component})[0];\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tvar date_start = new Date(Date.parse(val_start+ (attributeDef.primitiveType == \"xsd:datetime\"? 'Z' : '')));\r\n\t\t\t\t\t\t\tvar data_component_query = new Object();\r\n\t\t\t\t\t\t\tdata_component_query[attribute] = {\r\n\t\t\t\t\t\t\t\ttype: \"timeinstant\", \r\n\t\t\t\t\t\t\t\tcontent: [date_start.toISOString().split(attributeDef.primitiveType == \"xsd:datetime\"? \".000Z\" : \"T\")[0]]\r\n\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t\tdata_query.push(data_component_query);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\r\n\t\t\t\tbreak;\r\n\t\t\r\n\t\t    case \"ogc_viewparams\":\r\n\t\t\t\t//Get params according to 'viewparams' strategy\r\n\t\t\t\t//grab codelist values (including extra time codelists)\r\n\t\t\t\t$.each($(\".dsd-ui-dimension-attribute\"), function(i,item){ \r\n\t\t\t\t\tvar clazz = $(\"#\"+item.id).attr('class');\r\n\t\t\t\t\tvar dim = dataset.dsd.filter(function(comp){if(comp.primitiveCode == $(\"#\"+item.id).data().dimensionCode) return comp})[0];\r\n\t\t\t\t\tvar widget = null;\r\n\t\t\t\t\tif(clazz.indexOf(\"select2\")>0) widget = \"select2\";\r\n\t\t\t\t\tif(clazz.indexOf(\"slider\")>0) widget = \"slider\";\r\n\t\t\t\t\tvar type = null;\r\n\t\t\t\t\tvar values = null;\r\n\t\t\t\t\tswitch(widget){\r\n\t\t\t\t\t\tcase \"select2\":\r\n\t\t\t\t\t\t\ttype = \"list\";\r\n\t\t\t\t\t\t\tvalues = $(\"#\"+item.id).val(); \r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase \"slider\": \r\n\t\t\t\t\t\t\ttype = \"range\";\r\n\t\t\t\t\t\t\tvar slide = $(\"#\"+item.id+\"-slider\");\r\n\t\t\t\t\t\t\tvar slide_data = slide.data('bootstrapSlider').getValue();\r\n\t\t\t\t\t\t\tif(slide_data instanceof Array){\r\n\t\t\t\t\t\t\t\t//multiple values\r\n\t\t\t\t\t\t\t\tvar min = slide_data[0];\r\n\t\t\t\t\t\t\t\tvar max = slide_data[1];\r\n\t\t\t\t\t\t\t\tif(dim.primitiveType == \"xsd:decimal\" || dim.primitiveType == \"xsd:int\"){\r\n\t\t\t\t\t\t\t\t\tvalues = Array.apply(null, {length: max + 1 - min}).map(function(_, idx) { return idx + min; });\r\n\t\t\t\t\t\t\t\t}else if(dim.primitiveType == \"xsd:datetime\"){\r\n\t\t\t\t\t\t\t\t\tvar instants = dim.values.map(function(item){return item.id});\r\n\t\t\t\t\t\t\t\t\t//TODO manage period/list of dates \r\n\t\t\t\t\t\t\t\t\tvalues = [new Date(min*1000).toISOString(),new Date(max*1000).toISOString()];\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\t\t//single value\r\n\t\t\t\t\t\t\t\tvar value = slide_data;\r\n\t\t\t\t\t\t\t\tif(dim.primitiveType == \"xsd:decimal\" || dim.primitiveType == \"xsd:int\"){\r\n\t\t\t\t\t\t\t\t\tvalues = [value];\r\n\t\t\t\t\t\t\t\t}else if(dim.primitiveType == \"xsd:datetime\"){\r\n\t\t\t\t\t\t\t\t\tvalues = [new Date(value*1000).toISOString()];\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t//old code from Jquery UI slider\r\n\t\t\t\t\t\t\t/*var slide = $($(\"#\"+item.id).find(\".ui-slider\")[0]);\r\n\t\t\t\t\t\t\tif(slide.slider('values').length > 0){\r\n\t\t\t\t\t\t\t\t//multiple values\r\n\t\t\t\t\t\t\t\tvar min = slide.slider('values', 0);\r\n\t\t\t\t\t\t\t\tvar max = slide.slider('values', 1);\r\n\t\t\t\t\t\t\t\tvalues = Array.apply(null, {length: max + 1 - min}).map(function(_, idx) { return idx + min; });\r\n\t\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\t\t//single value\r\n\t\t\t\t\t\t\t\tvar value = slide.slider('value');\r\n\t\t\t\t\t\t\t\tvalues = [value];\r\n\t\t\t\t\t\t\t}*/\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif(values) if(values.length > 0){\r\n\t\t\t\t\t\tvar data_component_query = new Object();\r\n\t\t\t\t\t\tvar attribute = item.id.split('dsd-ui-dimension-attribute-')[1];\r\n\t\t\t\t\t\tdata_component_query[attribute] = {\r\n\t\t\t\t\t\t\ttype: type, \r\n\t\t\t\t\t\t\tcontent: values\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t\tdata_query.push(data_component_query);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\tif($(\".dsd-ui-dimension-time\").length > 0){\r\n\t\t\t\t\t$.each($(\".dsd-ui-dimension-time\"), function(i,item){\r\n\t\t\t\t\t\tvar inputs = $(item).find(\"input\");\r\n\t\t\t\t\t\tvar val_start = $(inputs[0]).val();\r\n\t\t\t\t\t\tif(val_start != \"\"){\r\n\t\t\t\t\t\t\tvar attribute = inputs[0].id.split('dsd-ui-dimension-time-start-')[1];\r\n\t\t\t\t\t\t\tvar attributeDef = dataset.dsd.filter(function(component){if(component.primitiveCode==attribute) return component})[0];\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tvar date_start = new Date(Date.parse(val_start+ (attributeDef.primitiveType == \"xsd:datetime\"? 'Z' : '')));\r\n\t\t\t\t\t\t\tvar data_component_query = new Object();\r\n\t\t\t\t\t\t\tdata_component_query[attribute] = {\r\n\t\t\t\t\t\t\t\ttype: \"timeinstant\", \r\n\t\t\t\t\t\t\t\tcontent: [date_start.toISOString().split(attributeDef.primitiveType == \"xsd:datetime\"? \".000Z\" : \"T\")[0]]\r\n\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t\tdata_query.push(data_component_query);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\r\n\t\t\t\tbreak;\r\n\r\n\t\t}\r\n\r\n\t\tif(stringify) data_query = this_.stringifyStrategyParams(dataset, data_query);\r\n\r\n\t\treturn data_query;\r\n\t}\r\n\t\r\n\t/**\r\n\t * OgetStrategyVariable\r\n\t */\r\n\tgetStrategyVariable(){\r\n\t\tvar variable = $(\"#dsd-ui-dimension-variable\").val();\r\n\t\tif(variable == \"\") variable = null;\r\n\t\treturn variable;\r\n\t}\r\n\t\r\n\t/**\r\n\t * OpenFairViewer.prototype.mapDatasetView\r\n\t * @param dataset\r\n\t * @param from_query_form\r\n\t */\r\n\tmapDatasetView(dataset, from_query_form){\r\n\t\tvar this_ = this;\r\n\r\n\t\tvar opacity = this_.options.map.layer_options.opacity;\r\n\t\tvar tiled = this_.options.map.layer_options.tiled;\r\n\t\t\r\n\t\tvar pid = dataset.pid;\r\n\t\t\r\n\t\t$(\"#datasetMapper\").prop('disabled', true);\r\n\t\t$(\"#datasetMapper\").bootstrapBtn('loading');\r\n\t\t$(\".query-nodata\").hide();\r\n\r\n\t    //layer properties\r\n\t\tvar baseWfsUrl = undefined;\r\n\t\tvar baseWmsUrl = undefined;\r\n\t\tvar layerName = undefined;\r\n\t\tvar layerDescription = undefined;\r\n\t\tvar wfsVersion = undefined;\r\n\t\tvar wmsVersion = undefined;\r\n\t\tif(dataset.entry.wfs.length > 0){\r\n\t\t\tvar baseWFS = dataset.entry.wfs;\r\n\t\t\tif(baseWFS.length>0){ baseWFS = dataset.entry.wfs[0] };\r\n\t\t\tif(this.secure) baseWFS.url = baseWFS.url.replace(\"http://\", \"https://\");\r\n\t\t\tbaseWfsUrl = baseWFS.url;\r\n\t\t\twfsVersion = baseWFS.version;\r\n\t\t}\r\n\t\tif(dataset.entry.wms.length > 0){\r\n\t\t\t//var baseWMS = dataset.entry.wms;\r\n\t\t\t//if(baseWMS.length>0){ baseWMS = dataset.entry.wms[0] };\r\n\t\t\tvar layerid = undefined;\r\n\t\t\tif(from_query_form){\r\n\t\t\t\tvar layerid = this_.getStrategyLayer();\r\n\t\t\t}else{\r\n\t\t\t\tvar layerid = dataset.lyr? dataset.lyr : dataset.entry.wms[0].name; \r\n\t\t\t}\r\n\t\t\tvar baseWMS = dataset.entry.wms.filter(function(item){return item.name == layerid})[0];\r\n\t\t\tconsole.log(baseWMS);\r\n\t\t\tbaseWmsUrl = baseWMS.url;\r\n\t\t\tlayerName = baseWMS.name;\r\n\t\t\tlayerDescription = baseWMS.description;\r\n\t\t\twmsVersion = baseWMS.version;\r\n\t\t\tconsole.log(\"Selection of layer '\"+layerName+\"'\")\r\n\t\t}\r\n\t\t\r\n\t\t//layerid\r\n\t\tvar lyr = layerName;\r\n\t\tconsole.log(lyr);\r\n\t\t\r\n\t    //var layer = this_.getLayerByProperty(dataset.entry.pid, 'id');\r\n\t\tvar layer = this_.getLayerByProperty(lyr, 'id');\r\n\t\tvar strategyparams = from_query_form? this_.getStrategyParams(dataset, false) : dataset.queryparams;\r\n\t\tconsole.log(strategyparams);\r\n\t\tvar strategyparams_str = from_query_form? this_.getStrategyParams(dataset, true) : this_.stringifyStrategyParams(dataset, dataset.queryparams);\r\n\t\tconsole.log(\"Strategy params = \" + strategyparams_str);\r\n\t\tvar strategyvariable = from_query_form? this_.getStrategyVariable(dataset): dataset.variable;\r\n\t\tconsole.log(\"Strategy variable = \" + strategyvariable);\r\n\t    var layerTitle = this_.getDatasetViewTitle(dataset, strategyparams, from_query_form);\r\n\t\tvar shortTitle = dataset.entry.title;\r\n\t\t\r\n\t\t//thematic mapping properties\r\n\t\tvar mapType =  from_query_form? $(\"#map-type-selector\").select2('val') : dataset.envmaptype;\r\n\t\tvar classType = from_query_form? $(\"#map-classtype-selector\").select2('val') : dataset.envfun;\r\n\t\tvar colorScheme = from_query_form? $(\"#map-colorscheme-selector\").select2('val') : dataset.envcolscheme;\r\n\t\tvar classNb = from_query_form? $(\"#map-classnb-selector\").select2('val') : (dataset.envparams? dataset.envparams.split(\";\").filter(function(item){if(item!=\"\" && item.startsWith(\"v\")) return item}).length-2 : null);\r\n\t\tvar layerStyle =  from_query_form? ($(\"#map-style-selector\").select2('val')? $(\"#map-style-selector\").select2('val') : this_.buildDynamicStylename(dataset, strategyvariable, mapType, classNb)) : dataset.style;\r\n\r\n\t\tvar geom = from_query_form? this_.getGeometryColumn(dataset.dsd) : dataset.geom;\r\n\t\tvar geomtype = from_query_form? this_.getGeometryType(dataset.dsd) : dataset.geomtype;\r\n\t\tconsole.log(\"Geometry information: \"+geom+\" [\"+geomtype+\"]\");\r\n\t\t\r\n\t\tif(!layer){\r\n\t\t\tconsole.log(\"Adding new layer\");\r\n\t\t    //ADD LAYER\r\n\t\t\t//////////////////////////////////////////////////////////////////////////////////////////\r\n\t\t    switch(dataset.strategy){\r\n\t\t\t case \"ogc_filters\":\r\n\t\t\t\tif(dataset.dsd){\r\n\t\t\t\t\tif(dataset.thematicmapping && typeof strategyvariable != \"undefined\"){\r\n\t\t\t\t\t\tconsole.log(\"Add vector layer with strategy 'ogc_filters' based on Feature Catalogue\");\r\n\t\t\t\t\t\t//thematic mapping\r\n\t\t\t\t\t\tthis_.getDatasetFeatures(baseWfsUrl, wfsVersion, layerName, dataset.strategy, strategyparams_str, ((this_.options.map.thematicmapping_options.thresholding && strategyvariable)? strategyvariable + this_.options.map.thematicmapping_options.threshold : null), (strategyvariable? [strategyvariable] : null )).then(function(features){\r\n\t\t\t\t\t\t\tconsole.log(\"Data series with \"+features.length+\" features\");\r\n\t\t\t\t\t\t\tvar values = undefined;\r\n\t\t\t\t\t\t\tvar breaks = undefined;\r\n\t\t\t\t\t\t\tvar envparams = undefined;\r\n\t\t\t\t\t\t\tvar colors = [];\r\n\t\t\t\t\t\t\tif(strategyvariable) values = this_.getDatasetValues(features, strategyvariable);\r\n\t\t\t\t\t\t\tif(values) if(values.length > 0){\r\n\t\t\t\t\t\t\t\tif(values.length < classNb){\r\n\t\t\t\t\t\t\t\t\tclassNb = values.length;\r\n\t\t\t\t\t\t\t\t\tlayerStyle = from_query_form? this_.buildDynamicStylename(dataset, strategyvariable, mapType, classNb) : dataset.style;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tbreaks = this_.calculateBreaks(values, classType, classNb);\r\n\t\t\t\t\t\t\t\tif(breaks.length == 1) breaks = [0, breaks[0]];\r\n\t\t\t\t\t\t\t\tif(breaks.length == 2) breaks[0] = 0;\r\n\t\t\t\t\t\t\t\tif(colorScheme){\r\n\t\t\t\t\t\t\t\t\tcolors = colorbrewer[colorScheme][classNb];\r\n\t\t\t\t\t\t\t\t\tif(classNb<3) colors = colorbrewer[colorScheme][3].slice(0,classNb);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tenvparams = this_.buildEnvParams(geom, strategyvariable, breaks, colors);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tthis_.selectDatasetView(dataset, lyr);\r\n\t\t\t\t\t\t\tvar layer = this_.addWMSLayer(this_.options.map.mainlayergroup, pid, lyr, layerTitle, shortTitle, baseWmsUrl, wmsVersion, layerName, false, true, true, opacity, tiled, (strategyparams == null)? null : decodeURIComponent(strategyparams_str), layerStyle, null, null, null, classType, envparams, (values? values.length : null));\r\n\t\t\t\t\t\t\tlayer.strategy = dataset.strategy;\r\n\t\t\t\t\t\t\tlayer.dsd = dataset.dsd;\r\n\t\t\t\t\t\t\tlayer.baseDataUrl = baseWfsUrl? baseWfsUrl : null;\r\n\t\t\t\t\t\t\tlayer.variable = strategyvariable;\r\n\t\t\t\t\t\t\tlayer.envfun = classType;\r\n\t\t\t\t\t\t\tlayer.envmaptype = mapType;\r\n\t\t\t\t\t\t\tlayer.envcolscheme = colorScheme;\r\n\t\t\t\t\t\t\tlayer.count = values? values.length : null;\r\n\t\t\t\t\t\t\tlayer.params = layer.getSource().getParams();\r\n\t\t\t\t\t\t\tlayer.geom = geom;\r\n\t\t\t\t\t\t\tlayer.geomtype = geomtype;\r\n\t\t\t\t\t\t\tthis_.registerFeatureInfoLayer(layer);\r\n\t\t\t\t\t\t\tthis_.setLegendGraphic(layer, breaks, colors);\t\r\n\t\t\t\t\t\t\tthis_.map.changed();\r\n\t\t\t\t\t\t\tthis_.renderMapLegend();\r\n\t\t\t\t\t\t\tthis_.showLegendPanel();\r\n\t\t\t\t\t\t\t$(\"#datasetMapper\").bootstrapBtn('reset');\r\n\t\t\t\t\t\t\t$(\"#datasetMapper\").prop('disabled', false);\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t//actions o download buttons\r\n\t\t\t\t\t\t\tthis_.enableQueryFormButtons();\r\n\t\t\t\t\t\t\t$(\"#dsd-ui-export-options\").show();\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t//action on dashboard options\r\n\t\t\t\t\t\t\tthis_.enableDashboardOptions();\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t//action on no data\r\n\t\t\t\t\t\t\tif(values) if(values.length == 0){\r\n\t\t\t\t\t\t\t\tconsole.log(\"Actions on no data\");\r\n\t\t\t\t\t\t\t\t$(\"#datasetMapper\").bootstrapBtn('reset');\r\n\t\t\t\t\t\t\t\t$(\"#datasetMapper\").prop('disabled', false);\r\n\t\t\t\t\t\t\t\t$(\".query-nodata\").show();\r\n\t\t\t\t\t\t\t\t//actions o download buttons\r\n\t\t\t\t\t\t\t\tthis_.disableQueryFormButtons();\r\n\t\t\t\t\t\t\t\t$(\"#dsd-ui-export-options\").hide();\r\n\t\t\t\t\t\t\t\tthis_.disableDashboardOptions();\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}else if(dataset.point_vectorizing){\r\n\t\t\t\t\t\tconsole.log(\"Add vector layer with strategy 'ogc_filters' (vector rendering)\");\r\n\t\t\t\t\t\tthis_.selectDatasetView(dataset, lyr);\r\n\t\t\t\t\t\tvar projection = this_.map.getView().getProjection().getCode();\r\n\t\t\t\t\t\tvar layer = undefined;\r\n\t\t\t\t\t\tthis_.addWFSLayer(this_.options.map.mainlayergroup, pid, lyr, layerTitle, baseWfsUrl, wfsVersion, layerName, dataset.strategy, (strategyparams == null)? null : decodeURIComponent(strategyparams_str), null, projection, dataset.point_clustering).then(function(response){ \r\n\t\t\t\t\t\t\tlayer = response;\r\n\t\t\t\t\t\t\tlayer.strategy = dataset.strategy;\r\n\t\t\t\t\t\t\tlayer.dsd = dataset.dsd;\r\n\t\t\t\t\t\t\tlayer.baseDataUrl = baseWfsUrl? baseWfsUrl : null;\r\n\t\t\t\t\t\t\tthis_.addVectorLayerPopup(layer);\r\n\t\t\t\t\t\t\tlayer.variable = null;\r\n\t\t\t\t\t\t\tlayer.envfun = null;\r\n\t\t\t\t\t\t\tlayer.envmaptype = null;\r\n\t\t\t\t\t\t\tlayer.envcolscheme = null;\r\n\t\t\t\t\t\t\tlayer.count = null;\r\n\t\t\t\t\t\t\tlayer.params = {CQL_FILTER: (strategyparams == null)? null : decodeURIComponent(strategyparams_str)};\r\n\t\t\t\t\t\t\tlayer.geom = geom;\r\n\t\t\t\t\t\t\tlayer.geomtype = geomtype;\r\n\t\t\t\t\t\t\tthis_.setLegendGraphic(layer);\r\n\t\t\t\t\t\t\t//this_.map.changed();\r\n\t\t\t\t\t\t\tthis_.renderMapLegend();\r\n\t\t\t\t\t\t\t$(\"#datasetMapper\").bootstrapBtn('reset');\r\n\t\t\t\t\t\t\t$(\"#datasetMapper\").prop('disabled', false);\r\n\t\t\t\t\t\t\t//actions o download buttons\r\n\t\t\t\t\t\t\tthis_.enableQueryFormButtons();\r\n\t\t\t\t\t\t\t$(\"#dsd-ui-export-options\").show();\r\n\t\t\t\t\t\t\t//action on dashboard options\r\n\t\t\t\t\t\t\tthis_.enableDashboardOptions();\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\t//static styling\r\n\t\t\t\t\t\tconsole.log(\"Add \"+dataset.entry.dataModel+\" layer with strategy 'ogc_filters' (static styling)\");\r\n\t\t\t\t\t\tthis_.selectDatasetView(dataset, lyr);\r\n\t\t\t\t\t\tvar layer = this_.addWMSLayer(this_.options.map.mainlayergroup, pid, lyr, layerTitle, shortTitle, baseWmsUrl, wmsVersion, layerName, false, true, true, opacity, tiled, (strategyparams == null)? null : decodeURIComponent(strategyparams_str), layerStyle);\r\n\t\t\t\t\t\tlayer.strategy = dataset.strategy;\r\n\t\t\t\t\t\tlayer.dsd = dataset.dsd;\r\n\t\t\t\t\t\tlayer.baseDataUrl = baseWfsUrl? baseWfsUrl : null;\r\n\t\t\t\t\t\tthis_.registerFeatureInfoLayer(layer);\r\n\t\t\t\t\t\tlayer.variable = null;\r\n\t\t\t\t\t\tlayer.envfun = null;\r\n\t\t\t\t\t\tlayer.envmaptype = null;\r\n\t\t\t\t\t\tlayer.envcolscheme = null;\r\n\t\t\t\t\t\tlayer.count = null;\r\n\t\t\t\t\t\tlayer.params = layer.getSource().getParams();\r\n\t\t\t\t\t\tlayer.geom = geom;\r\n\t\t\t\t\t\tlayer.geomtype = geomtype;\r\n\t\t\t\t\t\tthis_.registerFeatureInfoLayer(layer);\r\n\t\t\t\t\t\tthis_.setLegendGraphic(layer);\r\n\t\t\t\t\t\tthis_.map.changed();\r\n\t\t\t\t\t\tthis_.renderMapLegend();\r\n\t\t\t\t\t\tthis_.showLegendPanel();\r\n\t\t\t\t\t\t$(\"#datasetMapper\").bootstrapBtn('reset');\r\n\t\t\t\t\t\t$(\"#datasetMapper\").prop('disabled', false);\r\n\t\t\t\t\t\t//actions o download buttons\r\n\t\t\t\t\t\tthis_.enableQueryFormButtons();\r\n\t\t\t\t\t\t$(\"#dsd-ui-export-options\").show();\r\n\t\t\t\t\t\t//action on dashboard options\r\n\t\t\t\t\t\tthis_.enableDashboardOptions();\r\n\r\n\t\t\t\t\t}\r\n\t\t\t\t}else{\r\n\t\t\t\t\tconsole.log(\"Add \"+dataset.entry.dataModel+\" layer with strategy 'ogc_filters' with simple CQL filter\");\r\n\t\t\t\t\tvar cql_filter = null;\r\n\t\t\t\t\tif(strategyparams) if(strategyparams.length >0) cql_filter = strategyparams[0].CQL_FILTER;\r\n\t\t\t\t\tthis_.selectDatasetView(dataset, lyr);\r\n\t\t\t\t\tvar layer = this_.addWMSLayer(this_.options.map.mainlayergroup, pid, lyr, layerTitle, shortTitle, baseWmsUrl, wmsVersion, layerName, false, true, true, opacity, tiled, cql_filter, layerStyle);\r\n\t\t\t\t\tlayer.strategy = dataset.strategy;\r\n\t\t\t\t\tlayer.dsd = false;\r\n\t\t\t\t\tlayer.baseDataUrl = baseWfsUrl? baseWfsUrl : null;\r\n\t\t\t\t\tlayer.variable = null;\r\n\t\t\t\t\tlayer.envfun = null;\r\n\t\t\t\t\tlayer.envmaptype = null;\r\n\t\t\t\t\tlayer.envcolscheme = null;\r\n\t\t\t\t\tlayer.count = null;\r\n\t\t\t\t\tlayer.params = layer.getSource().getParams();\r\n\t\t\t\t\tthis_.registerFeatureInfoLayer(layer);\r\n\t\t\t\t\tthis_.setLegendGraphic(layer);\r\n\t\t\t\t\tthis_.map.changed();\r\n\t\t\t\t\tthis_.renderMapLegend();\r\n\t\t\t\t\tthis_.showLegendPanel();\r\n\t\t\t\t\t$(\"#datasetMapper\").bootstrapBtn('reset');\r\n\t\t\t\t\t$(\"#datasetMapper\").prop('disabled', false);\r\n\t\t\t\t\t//actions o download buttons\r\n\t\t\t\t\tthis_.enableQueryFormButtons();\r\n\t\t\t\t\t$(\"#dsd-ui-export-options\").show();\r\n\t\t\t\t\t//action on dashboard options\r\n\t\t\t\t\tthis_.enableDashboardOptions();\r\n\t\t\t\t\t\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\t\t\r\n\t\t\t case \"ogc_dimensions\":\r\n\t\t\t\t//The strategy 'ogc_dimensions' may target vector or grid datasets\r\n\t\t\t\t//ogc dimensions\r\n\t\t\t\t//TIME\r\n\t\t\t\tvar ogc_time_dimension = null;\r\n\t\t\t\tvar time_dimension = strategyparams.filter(function(item){if(Object.keys(item)==\"TIME\") return item;});\r\n\t\t\t\tif(time_dimension.length > 0) ogc_time_dimension = time_dimension[0].TIME.content[0];\r\n\t\t\t\tvar ogc_elevation_dimension = null;\r\n\t\t\t\tvar elevation_dimension = strategyparams.filter(function(item){if(Object.keys(item)==\"ELEVATION\") return item;});\r\n\t\t\t\tif(elevation_dimension.length > 0) ogc_elevation_dimension = elevation_dimension[0].ELEVATION.content[0];\r\n\t\t\t\t\r\n\t\t\t\tswitch(dataset.entry.dataModel){\r\n\t\t\t\t\tcase \"vector\":\r\n\t\t\t\t\t\t//TODO manage case dynamic (getDatasetFeatures) / static\r\n\t\t\t\t\t\tif(dataset.thematicmapping && strategyvariable){\r\n\t\t\t\t\t\t\tconsole.warn(\"Add vector layer with strategy 'ogc_dimensions' (thematic mapping) - NOT YET IMPLEMENTED\");\r\n\t\t\t\t\t\t}else if(dataset.point_vectorizing){\r\n\t\t\t\t\t\t\tconsole.warn(\"Add vector layer with strategy 'ogc_dimensions' (vector rendering) - NOT YET IMPLEMENTED\");\r\n\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\tconsole.warn(\"Add vector layer with strategy 'ogc_dimensions' (static styling) - NOT YET IMPLEMENTED\");\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"grid\":\r\n\t\t\t\t\t\tconsole.log(\"Add grid layer with strategy 'ogc_dimensions' (static styling)\");\r\n\t\t\t\t\t\t//static styling\r\n\t\t\t\t\t\tthis_.selectDatasetView(dataset, lyr);\r\n\t\t\t\t\t\tvar layer = this_.addWMSLayer(this_.options.map.mainlayergroup, pid, lyr, layerTitle, shortTitle, baseWmsUrl, wmsVersion, layerName, false, true, true, opacity, tiled, null, layerStyle,null, ogc_time_dimension, ogc_elevation_dimension);\r\n\t\t\t\t\t\tlayer.strategy = dataset.strategy;\r\n\t\t\t\t\t\tlayer.dsd = dataset.dsd;\r\n\t\t\t\t\t\tlayer.baseDataUrl = baseWfsUrl? baseWfsUrl : null;\r\n\t\t\t\t\t\tlayer.variable = null;\r\n\t\t\t\t\t\tlayer.envfun = null;\r\n\t\t\t\t\t\tlayer.envmaptype = null;\r\n\t\t\t\t\t\tlayer.envcolscheme = null;\r\n\t\t\t\t\t\tlayer.count = null;\r\n\t\t\t\t\t\tlayer.params = layer.getSource().getParams();\r\n\t\t\t\t\t\tlayer.geom = geom;\r\n\t\t\t\t\t\tlayer.geomtype = geomtype;\r\n\t\t\t\t\t\tthis_.registerFeatureInfoLayer(layer);\r\n\t\t\t\t\t\tthis_.setLegendGraphic(layer);\r\n\t\t\t\t\t\tthis_.map.changed();\r\n\t\t\t\t\t\tthis_.renderMapLegend();\r\n\t\t\t\t\t\tthis_.showLegendPanel();\r\n\t\t\t\t\t\t$(\"#datasetMapper\").bootstrapBtn('reset');\r\n\t\t\t\t\t\t$(\"#datasetMapper\").prop('disabled', false);\r\n\t\t\t\t\t\t//actions o download buttons\r\n\t\t\t\t\t\tthis_.enableQueryFormButtons();\r\n\t\t\t\t\t\t$(\"#dsd-ui-export-options\").show();\r\n\t\t\t\t\t\t//action on dashboard options\r\n\t\t\t\t\t\tthis_.enableDashboardOptions();\r\n\t\t\t\t\t\tbreak;\t\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\t\t\r\n\t\t\t case \"ogc_viewparams\":\r\n\t\t\t\t//The strategy 'ogc_viewparams' will always point to vector/feature datasets\r\n\t\t\t    if(dataset.thematicmapping && strategyvariable){\r\n\t\t\t\t\tconsole.log(\"Add vector layer with strategy 'ogc_viewparams' (thematic mapping)\");\r\n\t\t\t\t\t//thematic mapping\r\n\t\t\t\t\tthis_.getDatasetFeatures(baseWfsUrl, wfsVersion, layerName, dataset.strategy, strategyparams_str, ((this_.options.map.thematicmapping_options.thresholding && strategyvariable)? strategyvariable + this_.options.map.thematicmapping_options.threshold : null), (strategyvariable? [strategyvariable] : null )).then(function(features){\r\n\t\t\t\t\t\tconsole.log(\"Data series features\");\r\n\t\t\t\t\t\tconsole.log(features);\r\n\t\t\t\t\t\tconsole.log(\"Data series values\");\r\n\t\t\t\t\t\tvar values = undefined;\r\n\t\t\t\t\t\tvar breaks = undefined;\r\n\t\t\t\t\t\tvar envparams = undefined;\r\n\t\t\t\t\t\tvar colors = [];\r\n\t\t\t\t\t\tif(strategyvariable) values = this_.getDatasetValues(features, strategyvariable);\r\n\t\t\t\t\t\tif(values) if(values.length > 0){\r\n\t\t\t\t\t\t\tif(values.length < classNb){\r\n\t\t\t\t\t\t\t\tclassNb = values.length;\r\n\t\t\t\t\t\t\t\tlayerStyle = from_query_form? this_.buildDynamicStylename(dataset, strategyvariable, mapType, classNb) : dataset.style\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tvar breaks = this_.calculateBreaks(values, classType, classNb);\r\n\t\t\t\t\t\t\tif(breaks.length == 1) breaks = [0, breaks[0]];\r\n\t\t\t\t\t\t\tif(breaks.length == 2) breaks[0] = 0;\r\n\t\t\t\t\t\t\tif(colorScheme){\r\n\t\t\t\t\t\t\t\tcolors = colorbrewer[colorScheme][classNb];\r\n\t\t\t\t\t\t\t\tif(classNb<3) colors = colorbrewer[colorScheme][3].slice(0,classNb);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tenvparams = this_.buildEnvParams(geom, strategyvariable, breaks, colors);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tthis_.selectDatasetView(dataset, lyr);\r\n\t\t\t\t\t\tvar layer = this_.addWMSLayer(this_.options.map.mainlayergroup, pid, lyr, layerTitle, shortTitle, baseWmsUrl, wmsVersion, layerName, false, true, true, opacity, tiled, null, layerStyle, strategyparams_str, null, null, classType, envparams, (values? values.length : 0));\r\n\t\t\t\t\t\tlayer.strategy = dataset.strategy;\r\n\t\t\t\t\t\tlayer.dsd = dataset.dsd;\r\n\t\t\t\t\t\tlayer.baseDataUrl = baseWfsUrl? baseWfsUrl : null;\r\n\t\t\t\t\t\tlayer.variable = strategyvariable;\r\n\t\t\t\t\t\tlayer.envfun = classType;\r\n\t\t\t\t\t\tlayer.envmaptype = mapType;\r\n\t\t\t\t\t\tlayer.envcolscheme = colorScheme;\r\n\t\t\t\t\t\tlayer.count = values? values.length: null;\r\n\t\t\t\t\t\tlayer.params = layer.getSource().getParams();\r\n\t\t\t\t\t\tlayer.geom = geom;\r\n\t\t\t\t\t\tlayer.geomtype = geomtype;\r\n\t\t\t\t\t\tthis_.registerFeatureInfoLayer(layer);\r\n\t\t\t\t\t\tthis_.setLegendGraphic(layer, breaks, colors);\t\r\n\t\t\t\t\t\tthis_.map.changed();\r\n\t\t\t\t\t\tthis_.renderMapLegend();\r\n\t\t\t\t\t\tthis_.showLegendPanel();\r\n\t\t\t\t\t\t$(\"#datasetMapper\").bootstrapBtn('reset');\r\n\t\t\t\t\t\t$(\"#datasetMapper\").prop('disabled', false);\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t//actions o download buttons\r\n\t\t\t\t\t\tthis_.enableQueryFormButtons();\r\n\t\t\t\t\t\t$(\"#dsd-ui-export-options\").show();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t//action on dashboard options\r\n\t\t\t\t\t\tthis_.enableDashboardOptions();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t//action on no data\r\n\t\t\t\t\t\tif(values) if(values.length == 0){\r\n\t\t\t\t\t\t\tconsole.log(\"Actions on no data\");\r\n\t\t\t\t\t\t\t$(\"#datasetMapper\").bootstrapBtn('reset');\r\n\t\t\t\t\t\t\t$(\"#datasetMapper\").prop('disabled', false);\r\n\t\t\t\t\t\t\t$(\".query-nodata\").show();\r\n\t\t\t\t\t\t\t//actions o download buttons\r\n\t\t\t\t\t\t\tthis_.disableQueryFormButtons();\r\n\t\t\t\t\t\t\t$(\"#dsd-ui-export-options\").hide();\r\n\t\t\t\t\t\t\tthis_.disableDashboardOptions();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}else if(dataset.point_vectorizing){\r\n\t\t\t\t\tconsole.log(\"Add vector layer with strategy 'ogc_viewparams' (vector rendering)\");\r\n\t\t\t\t\tthis_.selectDatasetView(dataset, lyr);\r\n\t\t\t\t\tvar projection = this_.map.getView().getProjection().getCode();\r\n\t\t\t\t\tvar layer = undefined;\r\n\t\t\t\t\tthis_.addWFSLayer(this_.options.map.mainlayergroup, pid, lyr, layerTitle, baseWfsUrl, wfsVersion, layerName, strategyparams_str, null, projection, dataset.point_clustering).then(function(layer){ \r\n\t\t\t\t\t\tlayer = response;\r\n\t\t\t\t\t\tlayer.strategy = dataset.strategy;\r\n\t\t\t\t\t\tlayer.dsd = dataset.dsd;\r\n\t\t\t\t\t\tlayer.baseDataUrl = baseWfsUrl? baseWfsUrl : null;\r\n\t\t\t\t\t\tthis_.addVectorLayerPopup(layer);\r\n\t\t\t\t\t\tlayer.variable = null;\r\n\t\t\t\t\t\tlayer.envfun = null;\r\n\t\t\t\t\t\tlayer.envmaptype = null;\r\n\t\t\t\t\t\tlayer.envcolscheme = null;\r\n\t\t\t\t\t\tlayer.count = null;\r\n\t\t\t\t\t\tlayer.params = {'VIEWPARAMS': strategyparams_str};\r\n\t\t\t\t\t\tlayer.geom = geom;\r\n\t\t\t\t\t\tlayer.geomtype = geomtype;\r\n\t\t\t\t\t\tthis_.setLegendGraphic(layer);\r\n\t\t\t\t\t\t//this_.map.changed();\r\n\t\t\t\t\t\tthis_.renderMapLegend();\r\n\t\t\t\t\t\tthis_.showLegendPanel();\r\n\t\t\t\t\t\t$(\"#datasetMapper\").bootstrapBtn('reset');\r\n\t\t\t\t\t\t$(\"#datasetMapper\").prop('disabled', false);\r\n\t\t\t\t\t\t//actions o download buttons\r\n\t\t\t\t\t\tthis_.enableQueryFormButtons();\r\n\t\t\t\t\t\t$(\"#dsd-ui-export-options\").show();\r\n\t\t\t\t\t\t//action on dashboard options\r\n\t\t\t\t\t\tthis_.enableDashboardOptions();\r\n\t\t\t\t\t});\r\n\t\t\t\t\t\r\n\t\t\t    }else{\r\n\t\t\t\t\tconsole.log(\"Add vector layer with strategy 'ogc_viewparams' (static styling)\");\r\n\t\t\t\t\t//static styling\r\n\t\t\t\t\tthis_.selectDatasetView(dataset, lyr);\r\n\t\t\t\t\tvar layer = this_.addWMSLayer(this_.options.map.mainlayergroup, pid, lyr, layerTitle, shortTitle, baseWmsUrl, wmsVersion, layerName, false, true, true, opacity, tiled, null, null,strategyparams_str);\r\n\t\t\t\t\tlayer.strategy = dataset.strategy;\r\n\t\t\t\t\tlayer.dsd = dataset.dsd;\r\n\t\t\t\t\tlayer.baseDataUrl = baseWfsUrl? baseWfsUrl : null;\r\n\t\t\t\t\tthis_.registerFeatureInfoLayer(layer);\r\n\t\t\t\t\tlayer.variable = null;\r\n\t\t\t\t\tlayer.envfun = null;\r\n\t\t\t\t\tlayer.envmaptype = null;\r\n\t\t\t\t\tlayer.envcolscheme = null;\r\n\t\t\t\t\tlayer.count = null;\r\n\t\t\t\t\tlayer.params = layer.getSource().getParams();\r\n\t\t\t\t\tlayer.geom = geom;\r\n\t\t\t\t\tlayer.geomtype = geomtype;\r\n\t\t\t\t\tthis_.registerFeatureInfoLayer(layer);\r\n\t\t\t\t\tthis_.setLegendGraphic(layer);\r\n\t\t\t\t\tthis_.map.changed();\r\n\t\t\t\t\tthis_.renderMapLegend();\r\n\t\t\t\t\tthis_.showLegendPanel();\r\n\t\t\t\t\t$(\"#datasetMapper\").bootstrapBtn('reset');\r\n\t\t\t\t\t$(\"#datasetMapper\").prop('disabled', false);\r\n\t\t\t\t\t//actions o download buttons\r\n\t\t\t\t\tthis_.enableQueryFormButtons();\r\n\t\t\t\t\t$(\"#dsd-ui-export-options\").show();\r\n\t\t\t\t\t//action on dashboard options\r\n\t\t\t\t\tthis_.enableDashboardOptions();\r\n\t\t\t\t\t\r\n\t\t\t    }\r\n\t\t\t    break;\r\n\t\t\t}    \r\n\t\t}else{ \r\n\t\t\tconsole.log(\"Updating existing layer\");\r\n\t\t    //UPDATE LAYER\r\n\t\t\t//////////////////////////////////////////////////////////////////////////////////////////\r\n\t\t    switch(dataset.strategy){\r\n\t\t\tcase \"ogc_filters\":\r\n\t\t\t\tif(dataset.dsd){\r\n\t\t\t\t\tif(dataset.thematicmapping && strategyvariable){\r\n\t\t\t\t\t\tconsole.log(\"Update \"+dataset.entry.dataModel+\" layer with strategy 'ogc_filters' based on Feature Catalogue (thematic mapping)\");\r\n\t\t\t\t\t\t//thematic mapping\r\n\t\t\t\t\t\tthis_.getDatasetFeatures(baseWfsUrl, wfsVersion, layerName, dataset.strategy, (strategyparams == null)? null :  decodeURIComponent(strategyparams_str), ((this_.options.map.thematicmapping_options.thresholding && strategyvariable)? strategyvariable + this_.options.map.thematicmapping_options.threshold : null), (strategyvariable? [strategyvariable] : null )).then(function(features){\r\n\t\t\t\t\t\t\tconsole.log(\"Data series features\");\r\n\t\t\t\t\t\t\tconsole.log(features);\r\n\t\t\t\t\t\t\tconsole.log(\"Data series values\");\r\n\t\t\t\t\t\t\tvar values = undefined;\r\n\t\t\t\t\t\t\tvar breaks = undefined;\r\n\t\t\t\t\t\t\tvar envparams = undefined;\r\n\t\t\t\t\t\t\tvar colors = [];\r\n\t\t\t\t\t\t\tif(strategyvariable) values = this_.getDatasetValues(features, strategyvariable);\r\n\t\t\t\t\t\t\tif(values) if(values.length > 0){\r\n\t\t\t\t\t\t\t\tif(values.length < classNb){\r\n\t\t\t\t\t\t\t\t\tclassNb = values.length;\r\n\t\t\t\t\t\t\t\t\tlayerStyle = from_query_form? this_.buildDynamicStylename(dataset, strategyvariable, mapType, classNb) : dataset.style;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t//update breaks\r\n\t\t\t\t\t\t\t\tvar breaks = this_.calculateBreaks(values, classType, classNb);\r\n\t\t\t\t\t\t\t\tif(breaks.length == 1) breaks = [0, breaks[0]];\r\n\t\t\t\t\t\t\t\tif(breaks.length == 2) breaks[0] = 0;\r\n\t\t\t\t\t\t\t\tif(colorScheme){\r\n\t\t\t\t\t\t\t\t\tcolors = colorbrewer[colorScheme][classNb];\r\n\t\t\t\t\t\t\t\t\tif(classNb<3) colors = colorbrewer[colorScheme][3].slice(0,classNb);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tenvparams = this_.buildEnvParams(geom, strategyvariable, breaks, colors);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t//update viewparams, envparams & legend\r\n\t\t\t\t\t\t\tlayer.strategy = dataset.strategy;\r\n\t\t\t\t\t\t\tlayer.dsd = dataset.dsd;\r\n\t\t\t\t\t\t\tlayer.baseDataUrl = baseWfsUrl? baseWfsUrl : null;\r\n\t\t\t\t\t\t\tlayer.setProperties({title: layerTitle});\r\n\t\t\t\t\t\t\tif(strategyparams_str != \"\"){\r\n\t\t\t\t\t\t\t\tlayer.getSource().updateParams({'CQL_FILTER' : ((strategyparams == null)? null : decodeURIComponent(strategyparams_str))});\r\n\t\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\t\tlayer.getSource().updateParams({'CQL_FILTER' : 'INCLUDE'});\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tlayer.getSource().updateParams({'STYLES' : layerStyle});\r\n\t\t\t\t\t\t\tif(envparams) layer.getSource().updateParams({'env' : envparams});\r\n\t\t\t\t\t\t\tlayer.variable = strategyvariable;\r\n\t\t\t\t\t\t\tlayer.envfun = classType;\r\n\t\t\t\t\t\t\tlayer.envmaptype = mapType;\r\n\t\t\t\t\t\t\tlayer.envcolscheme = colorScheme;\r\n\t\t\t\t\t\t\tlayer.count = values? values.length : null;\r\n\t\t\t\t\t\t\tlayer.params = layer.getSource().getParams();\r\n\t\t\t\t\t\t\tlayer.geom = geom;\r\n\t\t\t\t\t\t\tlayer.geomtype = geomtype;\r\n\t\t\t\t\t\t\tthis_.setLegendGraphic(layer, breaks, colors);\r\n\t\t\t\t\t\t\tthis_.map.changed();\r\n\t\t\t\t\t\t\tthis_.renderMapLegend();\r\n\t\t\t\t\t\t\tthis_.showLegendPanel();\r\n\t\t\t\t\t\t\t$(\"#datasetMapper\").bootstrapBtn('reset');\r\n\t\t\t\t\t\t\t$(\"#datasetMapper\").prop('disabled', false);\r\n\t\t\t\t\t\t\t//actions o download buttons\r\n\t\t\t\t\t\t\tthis_.enableQueryFormButtons();\r\n\t\t\t\t\t\t\t$(\"#dsd-ui-export-options\").show();\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t//action on dashboard options\r\n\t\t\t\t\t\t\tthis_.enableDashboardOptions();\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t//action on no data\r\n\t\t\t\t\t\t\tif(values) if(values.length==0){\r\n\t\t\t\t\t\t\t\tthis_.removeLayerByProperty(pid, \"id\");\r\n\t\t\t\t\t\t\t\tthis_.map.changed();\r\n\t\t\t\t\t\t\t\tthis_.renderMapLegend();\r\n\t\t\t\t\t\t\t\tthis_.showLegendPanel();\r\n\t\t\t\t\t\t\t\t$(\"#datasetMapper\").bootstrapBtn('reset');\r\n\t\t\t\t\t\t\t\t$(\"#datasetMapper\").prop('disabled', false);\r\n\t\t\t\t\t\t\t\t$(\".query-nodata\").show();\r\n\t\t\t\t\t\t\t\t//actions o download buttons\r\n\t\t\t\t\t\t\t\tthis_.disableQueryFormButtons();\r\n\t\t\t\t\t\t\t\t$(\"#dsd-ui-export-options\").hide();\r\n\t\t\t\t\t\t\t\tthis_.disableDashboardOptions();\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}else if(dataset.point_vectorizing){\r\n\t\t\t\t\t\tconsole.log(\"Update vector layer with strategy 'ogc_filters' based on Feature Catalogue (vector rendering)\");\r\n\t\t\t\t\t\tvar projection = this_.map.getView().getProjection().getCode();\r\n\t\t\t\t\t\tthis_.getDatasetFeatures(baseWfsUrl, wfsVersion, layerName, dataset.strategy, ((strategyparams == null)? null : decodeURIComponent(strategyparams_str)), null, (strategyvariable? [strategyvariable] : null ), 'json', projection).then(function(response){\r\n\t\t\t\t\t\t\tvar format = new olFormat.GeoJSON();\r\n\t\t\t\t\t\t\tvar features = response.map(function(item){\r\n\t\t\t\t\t\t\t\tvar feature = format.readFeature(item);\r\n\t\t\t\t\t\t\t\tfeature.layerid = pid; //hack required to control layer-specific SelectCluster interaction\r\n\t\t\t\t\t\t\t\treturn feature;\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\tconsole.log(features);\r\n\t\t\t\t\t\t\tvar source = new Vector({ projection: projection, features: features });\r\n\t\t\t\t\t\t\t//update viewparams, envparams & legend\r\n\t\t\t\t\t\t\tlayer.strategy = dataset.strategy;\r\n\t\t\t\t\t\t\tlayer.dsd = dataset.dsd;\r\n\t\t\t\t\t\t\tlayer.baseDataUrl = baseWfsUrl? baseWfsUrl : null;\r\n\t\t\t\t\t\t\tlayer.setProperties({title: layerTitle});\r\n\t\t\t\t\t\t\tif(layer.getSource() instanceof Cluster){\r\n\t\t\t\t\t\t\t\tlayer.getSource().setSource(source);\r\n\t\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\t\tlayer.setSource(source);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tlayer.params = {CQL_FILTER: ((strategyparams == null)? null : decodeURIComponent(strategyparams_str))};\r\n\t\t\t\t\t\t\tlayer.geom = geom;\r\n\t\t\t\t\t\t\tlayer.geomtype = geomtype;\r\n\t\t\t\t\t\t\tvar selectCluster = this_.getSelectCluster();\r\n\t\t\t\t\t\t\tif(selectCluster) this_.map.removeInteraction(selectCluster);\r\n\t\t\t\t\t\t\tthis_.configureSelectCluster();\r\n\t\t\t\t\t\t\t//this_.map.changed();\r\n\t\t\t\t\t\t\tthis_.renderMapLegend();\r\n\t\t\t\t\t\t\tthis_.showLegendPanel();\r\n\t\t\t\t\t\t\t$(\"#datasetMapper\").bootstrapBtn('reset');\r\n\t\t\t\t\t\t\t$(\"#datasetMapper\").prop('disabled', false);\r\n\t\t\t\t\t\t\t//actions o download buttons\r\n\t\t\t\t\t\t\tthis_.enableQueryFormButtons();\r\n\t\t\t\t\t\t\t$(\"#dsd-ui-export-options\").show();\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t//action on dashboard options\r\n\t\t\t\t\t\t\tthis_.enableDashboardOptions();\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\tconsole.log(\"Update \"+dataset.entry.dataModel+\" layer with strategy 'ogc_filters' (static styling)\");\r\n\t\t\t\t\t\t//static styling\r\n\t\t\t\t\t\tlayer.setProperties({title: layerTitle});\r\n\t\t\t\t\t\tif(layerStyle){\r\n\t\t\t\t\t\t\tlayer.getSource().updateParams({'STYLES' : layerStyle});\r\n\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\tlayer.getSource().updateParams({'STYLES' : ''});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif(strategyparams_str != \"\"){\r\n\t\t\t\t\t\t\tlayer.getSource().updateParams({'CQL_FILTER' : ((strategyparams == null)? null : decodeURIComponent(strategyparams_str))});\r\n\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\tlayer.getSource().updateParams({'CQL_FILTER' : 'INCLUDE'});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tlayer.strategy = dataset.strategy;\r\n\t\t\t\t\t\tlayer.dsd = dataset.dsd;\r\n\t\t\t\t\t\tlayer.baseDataUrl = baseWfsUrl? baseWfsUrl : null;\r\n\t\t\t\t\t\tlayer.variable = null;\r\n\t\t\t\t\t\tlayer.envfun = null;\r\n\t\t\t\t\t\tlayer.envmaptype = null;\r\n\t\t\t\t\t\tlayer.envcolscheme = null;\r\n\t\t\t\t\t\tlayer.count = null;\r\n\t\t\t\t\t\tlayer.params = layer.getSource().getParams();\r\n\t\t\t\t\t\tlayer.geom = geom;\r\n\t\t\t\t\t\tlayer.geomtype = geomtype;\r\n\t\t\t\t\t\tthis_.setLegendGraphic(layer);\r\n\t\t\t\t\t\tthis_.map.changed();\r\n\t\t\t\t\t\tthis_.renderMapLegend();\r\n\t\t\t\t\t\tthis_.showLegendPanel();\r\n\t\t\t\t\t\t$(\"#datasetMapper\").bootstrapBtn('reset');\r\n\t\t\t\t\t\t$(\"#datasetMapper\").prop('disabled', false);\r\n\t\t\t\t\t\t//actions o download buttons\r\n\t\t\t\t\t\t$(\"#dsd-ui-export-options\").show();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t}\r\n\t\t\t\t}else{\r\n\t\t\t\t\tconsole.log(\"Update \"+dataset.entry.dataModel+\" layer with strategy 'ogc_filters' with simple CQL filter\");\r\n\t\t\t\t\tlayer.strategy = dataset.strategy;\r\n\t\t\t\t\tlayer.dsd = false;\r\n\t\t\t\t\tlayer.baseDataUrl = baseWfsUrl? baseWfsUrl : null;\r\n\t\t\t\t\tlayer.setProperties({title: layerTitle});\r\n\t\t\t\t\tif(strategyparams_str != \"\"){\r\n\t\t\t\t\t\tlayer.getSource().updateParams({'CQL_FILTER' : ((strategyparams == null)? null : decodeURIComponent(strategyparams_str))});\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\tlayer.getSource().updateParams({'CQL_FILTER' : 'INCLUDE'});\r\n\t\t\t\t\t}\r\n\t\t\t\t\tlayer.params = layer.getSource().getParams();\r\n\t\t\t\t\tlayer.geom = geom;\r\n\t\t\t\t\tlayer.geomtype = geomtype;\r\n\t\t\t\t\tthis_.map.changed();\r\n\t\t\t\t\tthis_.renderMapLegend();\r\n\t\t\t\t\tthis_.showLegendPanel();\r\n\t\t\t\t\t$(\"#datasetMapper\").bootstrapBtn('reset');\r\n\t\t\t\t\t$(\"#datasetMapper\").prop('disabled', false);\r\n\t\t\t\t\t//actions o download buttons\r\n\t\t\t\t\tthis_.enableQueryFormButtons();\r\n\t\t\t\t\t$(\"#dsd-ui-export-options\").show();\r\n\t\t\t\t\t//action on dashboard options\r\n\t\t\t\t\tthis_.enableDashboardOptions();\r\n\t\t\t\t}\r\n\t\t\t    break;\r\n\t\t\tcase \"ogc_dimensions\":\r\n\t\t\t    //The strategy 'ogc_dimensions' may target vector or grid datasets\r\n\t\t\t\t//ogc dimensions\r\n\t\t\t\t//TIME\r\n\t\t\t\tvar ogc_time_dimension = null;\r\n\t\t\t\tvar time_dimension = strategyparams.filter(function(item){if(Object.keys(item)==\"TIME\") return item;});\r\n\t\t\t\tif(time_dimension.length > 0) ogc_time_dimension = time_dimension[0].TIME.content[0];\r\n\t\t\t\tvar ogc_elevation_dimension = null;\r\n\t\t\t\tvar elevation_dimension = strategyparams.filter(function(item){if(Object.keys(item)==\"ELEVATION\") return item;});\r\n\t\t\t\tif(elevation_dimension.length > 0) ogc_elevation_dimension = elevation_dimension[0].ELEVATION.content[0];\r\n\t\t\t\t\r\n\t\t\t\tswitch(dataset.entry.dataModel){\r\n\t\t\t\t\tcase \"vector\":\r\n\t\t\t\t\t\t//TODO manage case dynamic (getDatasetFeatures) / static\r\n\t\t\t\t\t\tif(dataset.thematicmapping && strategyvariable){\r\n\t\t\t\t\t\t\tconsole.warn(\"Update vector layer with strategy 'ogc_dimensions' (thematic mapping) - NOT YET IMPLEMENTED\");\r\n\t\t\t\t\t\t}else if(dataset.point_vectorizing){\r\n\t\t\t\t\t\t\tconsole.warn(\"Update vector layer with strategy 'ogc_dimensions' (vector rendering) - NOT YET IMPLEMENTED\");\r\n\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\tconsole.warn(\"Update vector layer with strategy 'ogc_dimensions' (static styling) - NOT YET IMPLEMENTED\");\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"grid\":\r\n\t\t\t\t\t\tconsole.log(\"Update grid layer with strategy 'ogc_dimensions' (static styling)\");\r\n\t\t\t\t\t\t//static styling\r\n\t\t\t\t\t\tlayer.setProperties({title: layerTitle});\r\n\t\t\t\t\t\tif(layerStyle){\r\n\t\t\t\t\t\t\tlayer.getSource().updateParams({'STYLES' : layerStyle});\r\n\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\tlayer.getSource().updateParams({'STYLES' : ''});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif(ogc_time_dimension) layer.getSource().updateParams({'TIME' : ogc_time_dimension});\r\n\t\t\t\t\t\tif(ogc_elevation_dimension) layer.getSource().updateParams({'ELEVATION' : ogc_elevation_dimension});\r\n\t\t\t\t\t\tlayer.strategy = dataset.strategy;\r\n\t\t\t\t\t\tlayer.dsd = dataset.dsd;\r\n\t\t\t\t\t\tlayer.baseDataUrl = baseWfsUrl? baseWfsUrl : null;\r\n\t\t\t\t\t\tlayer.variable = null;\r\n\t\t\t\t\t\tlayer.envfun = null;\r\n\t\t\t\t\t\tlayer.envmaptype = null;\r\n\t\t\t\t\t\tlayer.envcolscheme = null;\r\n\t\t\t\t\t\tlayer.count = null;\r\n\t\t\t\t\t\tlayer.params = layer.getSource().getParams();\r\n\t\t\t\t\t\tlayer.geom = geom;\r\n\t\t\t\t\t\tlayer.geomtype = geomtype;\r\n\t\t\t\t\t\tthis_.setLegendGraphic(layer);\r\n\t\t\t\t\t\tthis_.map.changed();\r\n\t\t\t\t\t\tthis_.renderMapLegend();\r\n\t\t\t\t\t\tthis_.showLegendPanel();\r\n\t\t\t\t\t\t$(\"#datasetMapper\").bootstrapBtn('reset');\r\n\t\t\t\t\t\t$(\"#datasetMapper\").prop('disabled', false);\r\n\t\t\t\t\t\t//actions o download buttons\r\n\t\t\t\t\t\tthis_.enableQueryFormButtons();\r\n\t\t\t\t\t\t$(\"#dsd-ui-export-options\").show();\r\n\t\t\t\t\t\t//action on dashboard options\r\n\t\t\t\t\t\tthis_.enableDashboardOptions();\r\n\t\t\t\t\t\r\n\t\t\t\t}\r\n\t\t\t    break;\r\n\t\t\tcase \"ogc_viewparams\":\r\n\t\t\t    if(dataset.thematicmapping && strategyvariable){\r\n\t\t\t\t\tconsole.log(\"Update vector layer with strategy 'ogc_viewparams' (thematic mapping)\");\r\n\t\t\t\t\t//thematic mapping\r\n\t\t\t\t\tthis_.getDatasetFeatures(baseWfsUrl, wfsVersion, layerName, dataset.strategy, strategyparams_str, ((this_.options.map.thematicmapping_options.thresholding && strategyvariable)? strategyvariable + this_.options.map.thematicmapping_options.threshold : null), (strategyvariable? [strategyvariable] : null )).then(function(features){\r\n\t\t\t\t\t\tconsole.log(\"Data series features\");\r\n\t\t\t\t\t\tconsole.log(features);\r\n\t\t\t\t\t\tconsole.log(\"Data series values\");\r\n\t\t\t\t\t\tvar values = undefined;\r\n\t\t\t\t\t\tvar breaks = undefined;\r\n\t\t\t\t\t\tvar envparams = undefined;\r\n\t\t\t\t\t\tvar colors = [];\r\n\t\t\t\t\t\tif(strategyvariable) values = this_.getDatasetValues(features, strategyvariable);\r\n\t\t\t\t\t\tif(values) if(values.length > 0){\r\n\t\t\t\t\t\t\tif(values.length < classNb){\r\n\t\t\t\t\t\t\t\tclassNb = values.length;\r\n\t\t\t\t\t\t\t\tlayerStyle = from_query_form? this_.buildDynamicStylename(dataset, strategyvariable, mapType, classNb) : dataset.style;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t//update breaks\r\n\t\t\t\t\t\t\tvar breaks = this_.calculateBreaks(values, classType, classNb);\r\n\t\t\t\t\t\t\tif(breaks.length == 1) breaks = [0, breaks[0]];\r\n\t\t\t\t\t\t\tif(breaks.length == 2) breaks[0] = 0;\r\n\t\t\t\t\t\t\tif(colorScheme){\r\n\t\t\t\t\t\t\t\tvar colors = colorbrewer[colorScheme][classNb];\r\n\t\t\t\t\t\t\t\tif(classNb<3) colors = colorbrewer[colorScheme][3].slice(0,classNb);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tenvparams = this_.buildEnvParams(geom, strategyvariable, breaks, colors);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t//update viewparams, envparams & legend\r\n\t\t\t\t\t\tlayer.strategy = dataset.strategy;\r\n\t\t\t\t\t\tlayer.dsd = dataset.dsd;\r\n\t\t\t\t\t\tlayer.baseDataUrl = baseWfsUrl? baseWfsUrl : null;\r\n\t\t\t\t\t\tlayer.setProperties({title: layerTitle});\r\n\t\t\t\t\t\tif(strategyparams_str != \"\"){\r\n\t\t\t\t\t\t\tlayer.getSource().updateParams({'VIEWPARAMS' : strategyparams_str});\r\n\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\tdelete layer.getSource().params_.VIEWPARAMS;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tlayer.getSource().updateParams({'STYLES' : layerStyle});\r\n\t\t\t\t\t\tlayer.variable = strategyvariable;\r\n\t\t\t\t\t\tif(envparams) layer.getSource().updateParams({'env' : envparams});\r\n\t\t\t\t\t\tlayer.envfun = classType;\r\n\t\t\t\t\t\tlayer.envmaptype = mapType;\r\n\t\t\t\t\t\tlayer.envcolscheme = colorScheme;\r\n\t\t\t\t\t\tlayer.count = values? values.length : null;\r\n\t\t\t\t\t\tlayer.params = layer.getSource().getParams();\r\n\t\t\t\t\t\tlayer.geom = geom;\r\n\t\t\t\t\t\tlayer.geomtype = geomtype;\r\n\t\t\t\t\t\tthis_.setLegendGraphic(layer, breaks, colors);\r\n\t\t\t\t\t\tthis_.map.changed();\r\n\t\t\t\t\t\tthis_.renderMapLegend();\r\n\t\t\t\t\t\tthis_.showLegendPanel();\r\n\t\t\t\t\t\t$(\"#datasetMapper\").bootstrapBtn('reset');\r\n\t\t\t\t\t\t$(\"#datasetMapper\").prop('disabled', false);\r\n\t\t\t\t\t\t//actions o download buttons\r\n\t\t\t\t\t\tthis_.enableQueryFormButtons();\r\n\t\t\t\t\t\t$(\"#dsd-ui-export-options\").show();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t//action on dashboard options\r\n\t\t\t\t\t\tthis_.enableDashboardOptions();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t//action on no data\r\n\t\t\t\t\t\tif(values) if(values.length == 0){\r\n\t\t\t\t\t\t\tthis_.removeLayerByProperty(pid, \"id\");\r\n\t\t\t\t\t\t\tthis_.map.changed();\r\n\t\t\t\t\t\t\tthis_.renderMapLegend();\r\n\t\t\t\t\t\t\tthis_.showLegendPanel();\r\n\t\t\t\t\t\t\t$(\"#datasetMapper\").bootstrapBtn('reset');\r\n\t\t\t\t\t\t\t$(\"#datasetMapper\").prop('disabled', false);\r\n\t\t\t\t\t\t\t$(\".query-nodata\").show();\r\n\t\t\t\t\t\t\t//actions o download buttons\r\n\t\t\t\t\t\t\tthis_.disableQueryFormButtons();\r\n\t\t\t\t\t\t\t$(\"#dsd-ui-export-options\").hide();\r\n\t\t\t\t\t\t\tthis_.disableDashboardOptions();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}else if(dataset.point_vectorizing){\r\n\t\t\t\t\tconsole.log(\"Update vector layer with strategy 'ogc_viewparams' (vector rendering)\");\r\n\t\t\t\t\tvar projection = this_.map.getView().getProjection().getCode();\r\n\t\t\t\t\tthis_.getDatasetFeatures(baseWfsUrl, wfsVersion, layerName, dataset.strategy, strategyparams_str, null, (strategyvariable? [strategyvariable] : null ), 'json', projection).then(function(response){\r\n\t\t\t\t\t\tvar format = new olFormat.GeoJSON();\r\n\t\t\t\t\t\tvar features = response.map(function(item){return format.readFeature(item)});\r\n\t\t\t\t\t\tvar source = new Vector({ projection: projection, features: features });\r\n\t\t\t\t\t\t//update viewparams, envparams & legend\r\n\t\t\t\t\t\tlayer.strategy = dataset.strategy;\r\n\t\t\t\t\t\tlayer.dsd = dataset.dsd;\r\n\t\t\t\t\t\tlayer.baseDataUrl = baseWfsUrl? baseWfsUrl : null;\r\n\t\t\t\t\t\tlayer.setProperties({title: layerTitle});\r\n\t\t\t\t\t\tif(layer.getSource() instanceof Cluster){\r\n\t\t\t\t\t\t\tlayer.getSource().setSource(source);\r\n\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\tlayer.setSource(source);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tlayer.params = {'VIEWPARAMS' : strategyparams_str};\r\n\t\t\t\t\t\tlayer.geom = geom;\r\n\t\t\t\t\t\tlayer.geomtype = geomtype;\r\n\t\t\t\t\t\tthis_.map.changed();\r\n\t\t\t\t\t\tthis_.renderMapLegend();\r\n\t\t\t\t\t\tthis_.showLegendPanel();\r\n\t\t\t\t\t\t$(\"#datasetMapper\").bootstrapBtn('reset');\r\n\t\t\t\t\t\t$(\"#datasetMapper\").prop('disabled', false);\r\n\t\t\t\t\t\t//actions o download buttons\r\n\t\t\t\t\t\tthis_.enableQueryFormButtons();\r\n\t\t\t\t\t\t$(\"#dsd-ui-export-options\").show();\r\n\t\t\t\t\t\t//action on dashboard options\r\n\t\t\t\t\t\tthis_.enableDashboardOptions();\r\n\t\t\t\t\t});\r\n\t\t\t    }else{\r\n\t\t\t\t\tconsole.log(\"Update vector layer with strategy 'ogc_viewparams' (static styling)\");\r\n\t\t\t\t\t//static styling\r\n\t\t\t\t\tlayer.setProperties({title: layerTitle});\r\n\t\t\t\t\tif(layerStyle){\r\n\t\t\t\t\t\tlayer.getSource().updateParams({'STYLES' : layerStyle});\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\tlayer.getSource().updateParams({'STYLES' : ''});\r\n\t\t\t\t\t}\r\n\t\t\t\t\tlayer.getSource().updateParams({'VIEWPARAMS' : strategyparams_str});\r\n\t\t\t\t\tlayer.strategy = dataset.strategy;\r\n\t\t\t\t\tlayer.dsd = dataset.dsd;\r\n\t\t\t\t\tlayer.baseDataUrl = baseWfsUrl? baseWfsUrl : null;\r\n\t\t\t\t\tlayer.variable = null;\r\n\t\t\t\t\tlayer.envfun = null;\r\n\t\t\t\t\tlayer.envmaptype = null;\r\n\t\t\t\t\tlayer.envcolscheme = null;\r\n\t\t\t\t\tlayer.count = null;\r\n\t\t\t\t\tlayer.params = layer.getSource().getParams();\r\n\t\t\t\t\tlayer.geom = geom;\r\n\t\t\t\t\tlayer.geomtype = geomtype;\r\n\t\t\t\t\tthis_.setLegendGraphic(layer);\r\n\t\t\t\t\tthis_.map.changed();\r\n\t\t\t\t\tthis_.renderMapLegend();\r\n\t\t\t\t\tthis_.showLegendPanel();\r\n\t\t\t\t\t$(\"#datasetMapper\").bootstrapBtn('reset');\r\n\t\t\t\t\t$(\"#datasetMapper\").prop('disabled', false);\r\n\t\t\t\t\t//actions o download buttons\r\n\t\t\t\t\tthis_.enableQueryFormButtons();\r\n\t\t\t\t\t$(\"#dsd-ui-export-options\").show();\r\n\t\t\t\t\t//action on dashboard options\r\n\t\t\t\t\tthis_.enableDashboardOptions();\r\n\t\t\t\t\t\r\n\t\t\t    }\r\n\t\t\t    break;\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\t//if data dialog is opened then update tabular dataset\r\n\t\tif($(\".data-dialog\").is(\":visible\")){\r\n\t\t\t$('#data-table').DataTable().destroy();\r\n\t\t\tthis_.displayDataTable();\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * getDatasetWFSLink\r\n\t * @param layerUrl\r\n\t * @param serviceVersion\r\n\t * @param layerName\r\n\t * @param strategy\r\n\t * @param strategyparams_str\r\n\t * @param cql_filter a cql filter to filter out the dataset\r\n\t * @param propertyNames\r\n   \t * @param format optional format to be specified, by default it will provide a CSV\r\n\t * @param projection\r\n\t * @return the WFS layer URL\r\n\t */\r\n\tgetDatasetWFSLink(layerUrl, serviceVersion, layerName, strategy, strategyparams_str, cql_filter, propertyNames, format, projection){\t\t\r\n\t\tif(layerUrl) if(layerUrl.indexOf(\"?\")<0) layerUrl += \"?\"\r\n\t\tlayerUrl += \"&version=\" + (serviceVersion? serviceVersion : \"1.0.0\");\r\n\t\tlayerUrl += \"&request=GetFeature\";\r\n\t\tlayerUrl += \"&typeName=\" + layerName;\r\n\t    if(strategyparams_str){\r\n\t\t\tif(strategy == \"ogc_filters\") layerUrl += \"&CQL_FILTER=\" + strategyparams_str;\r\n\t\t\tif(strategy == \"ogc_viewparams\") layerUrl += \"&VIEWPARAMS=\" + strategyparams_str;\r\n\t\t}\r\n\t    if(cql_filter) layerUrl += \"&CQL_FILTER=\" + cql_filter;\r\n\t    if(propertyNames) layerUrl += \"&propertyName=\" + propertyNames.join(\",\");\r\n\t    if(format) layerUrl += \"&outputFormat=\" + format;\r\n\t\tif(projection) layerUrl += \"&srsName=\" + projection;\r\n \t    return layerUrl;\t\r\n\t}\r\n\t\r\n\t/**\r\n\t * triggerExport\r\n\t * @param id\r\n\t *\r\n\t */\r\n\ttriggerExport(id){\r\n\t\tvar export_method = this.options.access.exports.filter(function(item){if(item.id == id) return item;})[0];\r\n\t\tthis._triggerExporthHandler = export_method.handler;\r\n\t\tthis._triggerExporthHandler();\r\n\t\tdelete this._triggerExporthHandler;\r\n\t}\r\n\t\r\n\t/**\r\n\t * exportToWFS\r\n\t */\r\n\t exportToWFS(){\r\n\t\tconsole.log(\"Download dataset as OGC WFS\");\r\n\t\tvar this_ = this;\r\n\t\tvar wfsResources = this.dataset_on_query.entry.wfs;\r\n\t\tvar baseWFS = wfsResources[0];\r\n\t\tvar baseWfsUrl = baseWFS.url;\r\n\t\tvar layerName = baseWFS.name;\r\n\t\tvar wfsVersion = baseWFS.version;\r\n\t\tvar strategy = this.dataset_on_query.strategy;\r\n\t\tvar strategyparams =  this.getStrategyParams(this.dataset_on_query, false);\r\n\t\tvar cql_filter = null;\r\n\t\tvar strategyparams_str = null;\r\n\t\tif(strategyparams){\r\n\t\t\tstrategyparams_str = this.getStrategyParams(this.dataset_on_query, true);\r\n\t\t\tif(strategyparams.length>0) if(strategyparams[0].CQL_FILTER) cql_filter = strategyparams[0].CQL_FILTER;\t\r\n\t\t}\r\n\t\t \r\n\t\tvar wfs_link = this_.getDatasetWFSLink(baseWfsUrl, wfsVersion, layerName, strategy, strategyparams_str, null, null);\r\n\t\twindow.open(wfs_link, '_blank');\r\n\t}\r\n\r\n\t\r\n\t/**\r\n\t * prepareDatasetExportHeader\r\n\t * @param main\r\n\t * @param markdown\r\n\t * @return the R script header as text\r\n\t */\r\n\tprepareDatasetExportHeader(main, markdown){\r\n\t\tvar comment_prefix = markdown? \"\" : \"#\";\r\n\t\tvar b = markdown? \"**\" : \"\";\r\n\t\tvar em = markdown? \"_\" : \"\";\r\n\t\tvar query_url = window.location.href;\r\n\t\tif(markdown) query_url = \"[Link](\"+window.location.href+\")\";\r\n\t\tvar header = \"\";\r\n\t\theader += \"# \"+main+\" generated by OpenFairViewer\\n\";\r\n\t\theader += comment_prefix+\"The following script provides a standard way to get data and metadata handled in a OpenFairViewer application \\n\\n\";\r\n\t\theader += comment_prefix+b+\"Creation date\"+b+\": \"+new Date().toISOString()+\"\\n\\n\";\r\n\t\theader += comment_prefix+b+\"Application details\"+b+\": \\n\";\r\n\t\theader += comment_prefix+\"* \"+em+\"OpenFairViewer Base URL\"+em+\": \" + window.location.href.split(\"?\")[0] + \"\\n\";\r\n\t\theader += comment_prefix+\"* \"+em+\"OGC CSW Catalogue URL\"+em+\": \" + this.config.OGC_CSW_BASEURL + \"\\n\\n\";\r\n\t\theader += comment_prefix+b+\"Dataset details\"+b+\": \\n\";\r\n\t\theader += comment_prefix+\"* \"+em+\"pid\"+em+\": \" + this.dataset_on_query.pid + \"\\n\";\r\n\t\theader += comment_prefix+\"* \"+em+\"title\"+em+\": \"+ this.dataset_on_query.entry.title + \"\\n\";\r\n\t\theader += comment_prefix+\"* \"+em+\"abstract\"+em+\": \"+ this.dataset_on_query.entry._abstract + \"\\n\";\r\n\t\theader += comment_prefix+\"* \"+em+\"OpenFairViewer Query URL\"+em+\": \" + query_url + \"\\n\";\r\n\t\treturn header;\r\n\t}\r\n\t\r\n\t/**\r\n\t * prepareDatasetRScript\r\n\t * @param add_header\r\n\t * @return the R script as text\r\n\t */\r\n\tprepareDatasetRScript(add_header){\r\n\t\tconsole.log(\"Prepare dataset as Rscript...\");\r\n\t\tvar this_ = this;\r\n\t\tvar wfsResources = this.dataset_on_query.entry.wfs;\r\n\t\tvar baseWFS = wfsResources[0];\r\n\t\tvar baseWfsUrl = baseWFS.url;\r\n\t\tvar layerName = baseWFS.name;\r\n\t\tvar serviceVersion = baseWFS.version;\r\n\t\tconsole.log(baseWFS);\r\n\t\tvar strategy = this.dataset_on_query.strategy;\r\n\t\tvar strategyparams =  this.getStrategyParams(this.dataset_on_query, false);\r\n\t\tvar cql_filter = null;\r\n\t\tvar strategyparams_str = null;\r\n\t\tif(strategyparams){\r\n\t\t\tstrategyparams_str = this.getStrategyParams(this.dataset_on_query, true);\r\n\t\t\tif(strategyparams.length>0) if(strategyparams[0].CQL_FILTER) cql_filter = strategyparams[0].CQL_FILTER;\t\r\n\t\t}\r\n\t\t\r\n\t\t//script header\r\n\t\tvar script = \"\";\r\n\t\tif(add_header){\r\n\t\t\tscript += this.prepareDatasetExportHeader(\"R script\", false);\r\n\t\t\tscript += \"#---------------------------------------------------------------------------------------------------------\\n\";\r\n\t\t}\r\n\t\t\r\n\t\t//script body\r\n\t\tscript += \"#packages\\n\";\r\n\t\tscript += \"if(!require(ows4R)){\\n\tinstall.packages(\\\"ows4R\\\")\\n\trequire(ows4R)\\n}\\n\\n\";\r\n\t\tscript += \"if(!require(sp)){\\n\tinstall.packages(\\\"sp\\\")\\n\trequire(sp)\\n}\\n\\n\";\r\n\t\t\r\n\t\tscript += \"#Dataset PID\\n\";\r\n\t\tscript += \"pid <- \\\"\"+this.dataset_on_query.pid+\"\\\"\\n\\n\";\r\n\t\tscript += \"layer <- \\\"\"+layerName+\"\\\"\\n\\n\";\r\n\t\t\r\n\t\tscript += \"#Connect to OGC CSW Catalogue to get METADATA\\n\";\r\n\t\tscript += \"CSW <- CSWClient$new(\\n\";\r\n\t\tscript += \"\turl = \\\"\"+this.config.OGC_CSW_BASEURL + \"\\\",\\n\";\r\n\t\tscript += \"\tserviceVersion = \\\"2.0.2\\\",\\n\";\r\n\t\tscript += \"\tlogger = \\\"INFO\\\"\\n\"\r\n\t\tscript += \")\\n\";\r\n\t\tscript += \"#Get metadata for dataset '\"+this.dataset_on_query.pid+\"'\\n\";\r\n\t\tscript += \"md <- CSW$getRecordById(pid, outputSchema = \\\"http://www.isotc211.org/2005/gmd\\\")\\n\";\r\n\t\tscript += \"fc <- CSW$getRecordById(paste0(pid,\\\"_dsd\\\"), outputSchema = \\\"http://www.isotc211.org/2005/gfc\\\")\\n\";\r\n\t\tscript += \"\\n\";\r\n\t\t\r\n\t\tscript += \"#Connect to OGC WFS to get DATA\\n\";\r\n\t\tvar baseUrl = baseWfsUrl.split(\"?\")[0];\r\n\t\tscript += \"WFS <- WFSClient$new(\\n\";\r\n\t\tscript += \"\turl = \\\"\"+baseUrl + \"\\\",\\n\";\r\n\t\tscript += \"\tserviceVersion = \\\"\"+serviceVersion+\"\\\",\\n\";\r\n\t\tscript += \"\tlogger = \\\"INFO\\\"\\n\"\r\n\t\tscript += \")\\n\";\r\n\t\tscript += \"#Get feature type for dataset '\"+this.dataset_on_query.pid+\"' (layer = '\"+layerName+\"' )\\n\";\r\n\t\tscript += \"ft <- WFS$capabilities$findFeatureTypeByName(layer, exact = FALSE)\\n\";\r\n\t\tscript += \"#Get data features for dataset '\"+this.dataset_on_query.pid+\"' (layer = '\"+layerName+\"' )\\n\";\t\r\n\t\tscript += \"data.sf <- ft$getFeatures(\";\r\n\t\tif(strategyparams_str){\r\n\t\t\tif(strategy == \"ogc_filters\") script += \"cql_filter = gsub(\\\" \\\", \\\"%20\\\", gsub(\\\"''\\\", \\\"%27%27\\\", URLencode(\\\"\" + strategyparams_str + \"\\\")))\";\r\n\t\t\tif(strategy == \"ogc_viewparams\") script += \"viewparams = \\\"\" + strategyparams_str + \"\\\"\";\r\n\t\t}else if(cql_filter){\r\n\t\t\t script += \", cql_filter = gsub(\\\" \\\", \\\"%20\\\", gsub(\\\"''\\\", \\\"%27%27\\\", URLencode(\\\"\" + cql_filter + \"\\\")))\";\r\n\t\t}\r\n\t\tscript += \")\\n\";\r\n\t\tscript += \"data.sp <- as(data.sf, \\\"Spatial\\\")\\n\";\r\n\t\treturn script;\r\n\t}\r\n\t\r\n\t/**\r\n\t * exportToRScript\r\n\t * @return \r\n\t */\r\n\texportToRScript(){\t\r\n\t\t//rscript \r\n\t\tvar script = this.prepareDatasetRScript(true);\r\n\t\t//download\r\n\t\tconsole.log(\"Download dataset as Rscript...\");\r\n\t\tvar fileName = this.dataset_on_query.pid +\"_\"+ this.getDateTimeString(new Date()) + \".R\";\r\n\t\tthis.download(script, fileName, '');\r\n\t}\r\n\t\r\n\t/**\r\n\t * prepareDatasetJupyterNotebook\r\n\t * @param language\r\n\t * @return the Jupyter notebook\r\n\t */\r\n\tprepareDatasetJupyterNotebook(language){\r\n\t\tconsole.log(\"Prepare dataset as Jupyter notebook...\");\r\n\t\tvar notebook = null;\r\n\t\tif(language == \"R\"){\r\n\t\t\tvar header = this.prepareDatasetExportHeader(\"Jupyter notebook\", true);\r\n\t\t\tvar rscript = this.prepareDatasetRScript(false);\r\n\t\t\tnotebook = {\r\n\t\t\t \"cells\": [\r\n\t\t\t  {\r\n\t\t\t   \"cell_type\": \"markdown\",\r\n\t\t\t   \"metadata\": {},\r\n\t\t\t   \"source\": header.split(\"\\n\").map(function(item){return item + \"\\n\"})\r\n\t\t\t  },\r\n\t\t\t  {\r\n\t\t\t   \"cell_type\": \"code\",\r\n\t\t\t   \"execution_count\": null,\r\n\t\t\t   \"metadata\": {},\r\n\t\t\t   \"outputs\": [],\r\n\t\t\t   \"source\": rscript.split(\"\\n\").map(function(item){return item + \"\\n\"})\r\n\t\t\t  }\r\n\t\t\t ],\r\n\t\t\t \"metadata\": {\r\n\t\t\t  \"kernelspec\": {\r\n\t\t\t   \"display_name\": \"R\",\r\n\t\t\t   \"language\": \"R\",\r\n\t\t\t   \"name\": \"ir\"\r\n\t\t\t  },\r\n\t\t\t  \"language_info\": {\r\n\t\t\t   \"codemirror_mode\": \"r\",\r\n\t\t\t   \"file_extension\": \".r\",\r\n\t\t\t   \"mimetype\": \"text/x-r-source\",\r\n\t\t\t   \"name\": \"R\",\r\n\t\t\t   \"pygments_lexer\": \"r\",\r\n\t\t\t   \"version\": \"4.0.2\"\r\n\t\t\t  }\r\n\t\t\t },\r\n\t\t\t \"nbformat\": 4,\r\n\t\t\t \"nbformat_minor\": 4\r\n\t\t\t};\r\n\t\t}else{\r\n\t\t\tconsole.warn(\"Language \"+language+\" is currently not supported as Jupyter notebook export method in OpenFairViewer\");\r\n\t\t}\r\n\t\treturn notebook;\r\n\t}\r\n\t\t\r\n\t/**\r\n\t * exportToJupyterNotebook\r\n\t * @param language\r\n\t * @return\r\n\t */\r\n\texportToJupyterNotebook(language){\r\n\t\t//Jupyter notebook \r\n\t\tvar notebook = this.prepareDatasetJupyterNotebook(language);\r\n\t\t//download\r\n\t\tvar fileName = this.dataset_on_query.pid + \"_\"+ this.getDateTimeString(new Date()) + \".ipynb\";\r\n\t\tthis.download(JSON.stringify(notebook), fileName, '');\r\n\t}\r\n\t\r\n\t/**\r\n\t * exportToRJupyterNotebook\r\n\t * @return\r\n\t */\r\n\texportToRJupyterNotebook(){\r\n\t\tthis.exportToJupyterNotebook(\"R\");\t\r\n\t}\r\n\t \r\n\t\r\n\tgetWFSSupportedFormats(layerUrl, serviceVersion){\r\n\t\tvar deferred = $.Deferred();\r\n\t\tif(layerUrl.indexOf(\"?\")<0) layerUrl += \"?\";\r\n\t\tif(layerUrl.indexOf(\"service=WFS\")<0) layerUrl += \"&service=WFS\";\r\n\t\tlayerUrl += \"&version=\" + (serviceVersion? serviceVersion : \"1.1.0\");\r\n\t\tlayerUrl += \"&request=GetCapabilities\";\r\n\t\t$.ajax({\r\n\t\t\turl: layerUrl,\r\n\t\t\tcrossOrigin: true,\r\n\t\t\ttype: 'GET',\r\n\t\t\tsuccess: function(response){\r\n\t\t\t\tconsole.log(\"WFS get capabilities\");\r\n\t\t\t\tvar caps = $(response); console.log(caps);\r\n\t\t\t\tvar supportedFormats = new Array();\r\n\t\t\t\tdeferred.resolve(caps);\r\n\t\t\t}\r\n\t\t});\r\n\t\t\r\n\t\treturn deferred.promise();\r\n\t}\r\n\t\r\n\t/**\r\n\t *describeFeatureType\r\n\t * @param layerUrl\r\n\t * @param serviceVersion\r\n\t * @param typeName\r\n\t * @return a feature type description\r\n\t */\t\r\n\tdescribeFeatureType(layerUrl, serviceVersion, typeName){\r\n\t\tvar deferred = $.Deferred();\r\n\t\tif(layerUrl.indexOf(\"?\")<0) layerUrl += \"?\";\r\n\t\tif(layerUrl.indexOf(\"service=WFS\")<0) layerUrl += \"&service=WFS\";\r\n\t\tlayerUrl += \"&version=\" + (serviceVersion? serviceVersion : \"1.1.0\");\r\n\t\tlayerUrl += \"&request=DescribeFeatureType\";\r\n\t\tlayerUrl += \"&typeName=\" + typeName;\r\n\t\t$.ajax({\r\n\t\t\turl: layerUrl,\r\n\t\t\tcrossOrigin: true,\r\n\t\t\ttype: 'GET',\r\n\t\t\tsuccess: function(response){\r\n\t\t\t\tconsole.log(\"WFS describe feature type\");\r\n\t\t\t\tvar fc = $(response); console.log(fc);\r\n\t\t\t\tvar featuretype = new Array();\r\n\t\t\t\tvar elems = fc.children().children().filter(function(i,item){if(item.tagName.endsWith(\"complexType\")) return item;})[0].childNodes[1].childNodes[1].childNodes[1].childNodes;\r\n\t\t\t\tfor(var i=0;i<elems.length;i++){\r\n\t\t\t\t\tif(i%2 != 0){\r\n\t\t\t\t\t\tvar elem = $(elems[i]);\r\n\t\t\t\t\t\tfeaturetype.push({\r\n\t\t\t\t\t\t\tmaxOccurs: elem.attr('maxOccurs'), \r\n\t\t\t\t\t\t\tminOccurs: elem.attr('minOccurs'),\r\n\t\t\t\t\t\t\tname: elem.attr('name'),\r\n\t\t\t\t\t\t\tnillable: elem.attr('nillable'),\r\n\t\t\t\t\t\t\ttype: elem.attr('type')\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tdeferred.resolve(featuretype);\r\n\t\t\t}\r\n\t\t});\r\n\t\treturn deferred.promise();\r\n\t}\r\n\r\n\t\r\n\t/**\r\n\t * Simple json2csv util\r\n\t * @param objArray\r\n\t * @returns a string representive the CSV\r\n\t */\r\n\tjson2csv(objArray) {\r\n\t\tvar array = typeof objArray != 'object' ? JSON.parse(objArray) : objArray;\r\n\t\tvar str = '';\r\n\t\tvar line = '';\r\n\r\n\t\t//add colnames\r\n\t\tvar head = array[0];\r\n\t\t\tfor (var index in array[0]) {\r\n\t\t\t\tline += index + ',';\r\n\t\t\t}\r\n\t\tline = line.slice(0, -1);\r\n\t\tstr += line + '\\r\\n';\r\n\t\t\r\n\t\t//add data\r\n\t\tfor (var i = 0; i < array.length; i++) {\r\n\t\t\tvar line = '';\r\n\t\t\t\tfor (var index in array[i]) {\r\n\t\t\tvar val = array[i][index];\r\n\t\t\tif(typeof val == 'string') val = '\"' + val + '\"';\r\n\t\t\t\t\tline += val + ',';\r\n\t\t\t\t}\r\n\t\t\tline = line.slice(0, -1);\r\n\t\t\tstr += line + '\\r\\n';\r\n\t\t}\r\n\t\treturn str;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Download file\r\n\t * @param content\r\n\t * @param fileName\r\n\t * @param mimeType\r\n\t */\r\n\tdownload(content, fileName, mimeType) {\r\n\t\tvar a = document.createElement('a');\r\n\t\tmimeType = mimeType || 'application/octet-stream';\r\n\r\n\t\tif (navigator.msSaveBlob) { // IE10\r\n\t\t\t\tnavigator.msSaveBlob(new Blob([content], {\r\n\t\t\t\t  type: mimeType\r\n\t\t\t\t}), fileName);\r\n\t\t} else if (URL && 'download' in a) { //html5 A[download]\r\n\t\t\t\ta.href = URL.createObjectURL(new Blob([content], {\r\n\t\t\t\t\ttype: mimeType\r\n\t\t\t\t}));\r\n\t\t\t\ta.setAttribute('download', fileName);\r\n\t\t\t\tdocument.body.appendChild(a);\r\n\t\t\t\ta.click();\r\n\t\t\t\tdocument.body.removeChild(a);\r\n\t\t} else {\r\n\t\t\t\tlocation.href = 'data:application/octet-stream,' + encodeURIComponent(content); // only this mime type is supported\r\n\t\t}\r\n\t}\t\r\n\r\n\t/**\r\n\t * Download CSV\r\n\t * @param content csv string\r\n\t * @param fileName\r\n\t */\r\n\tdownloadCSV(content, fileName) {\r\n\t\tthis.download(content, fileName, 'text/csv;charset=utf-8;');\r\n\t}\r\n\t\r\n\t/**\r\n\t * OpenFairViewer.prototype.getateTimeString\r\n\t * @param date\r\n\t */\r\n\tgetDateTimeString(date){\r\n\t\tvar str = date.toISOString();\r\n\t\treturn (str.split(\"T\")[0] + \"\" + str.split(\"T\")[1].split(\".\")[0]).replace(/-/g,\"\").replace(/:/g,\"\");\r\n\t}\r\n\t\r\n\t/**\r\n\t * OpenFairViewer.prototype.exportToCSV\r\n\t */\r\n\texportToCSV(){\r\n\t\t\r\n\t\t//options\r\n\t\tvar add_colnames = $(\"#dataset-export-option-colnames\").prop(\"checked\");\r\n\t\tvar add_labels = $(\"#dataset-export-option-labels\").prop(\"checked\");\r\n\t\t\r\n\t\tvar this_ = this;\r\n\t\tvar wfsResources = this.dataset_on_query.entry.wfs;\r\n\t\tvar baseWFS = wfsResources[0];\r\n\t\tvar baseLayerUrl = baseWFS.url;\r\n\t\tvar layerName = baseWFS.name;\r\n\t\tvar serviceVersion = '1.1.0';//baseWFS.version;\r\n\t\tvar strategyparams =  this.getStrategyParams(this.dataset_on_query, false);\r\n\t\tvar cql_filter = null;\r\n\t\tvar strategyparams_str = null;\r\n\t\tif(strategyparams){\r\n\t\t\tstrategyparams_str = this.getStrategyParams(this.dataset_on_query, true);\r\n\t\t\tif(strategyparams.length>0) if(strategyparams[0].CQL_FILTER) cql_filter = strategyparams[0].CQL_FILTER;\t\r\n\t\t}\r\n\t\tvar layerUrl = this.getDatasetWFSLink(baseLayerUrl, serviceVersion, layerName, this.dataset_on_query.strategy, strategyparams_str, cql_filter, null);\r\n\t\t$.get(layerUrl, function(response){\r\n\t\t\tvar features = new olFormat.WFS().readFeatures(response);\r\n\t\t\tconsole.log(features);\r\n\t\t\tvar featuresToExport = new Array();\r\n\t\t\tfor(var i=0;i<features.length;i++){\r\n\t\t\t\tvar feature = features[i];\r\n\t\t\t\tvar props = feature.getProperties();\r\n\t\t\t\tvar prop_keys = Object.keys(props);\r\n\t\t\t\tvar newprops = new Object();\r\n\t\t\t\tfor(var j=0;j<prop_keys.length;j++){\r\n\t\t\t\t\tvar key = prop_keys[j];\r\n\t\t\t\t\tif(key == \"boundedBy\") continue;\r\n\t\t\t\t\tvar prop_value = props[key];\r\n\t\t\t\t\tif(typeof prop_value == \"object\") prop_value = prop_value[0];\r\n\t\t\t\t\tif(key != feature.getGeometryName()){\r\n\t\t\t\t\t\tvar fieldAttribute = this_.dataset_on_query.dsd.filter(function(item){if(item.primitiveCode == key) return item});\r\n\t\t\t\t\t\tvar keyname = key;\r\n\t\t\t\t\t\tvar labelname = key + \"_label\";\r\n\t\t\t\t\t\tif(add_colnames) if(fieldAttribute.length>0){\r\n\t\t\t\t\t\t\tkeyname = fieldAttribute[0].name + \" [Code]\";\r\n\t\t\t\t\t\t\tlabelname = fieldAttribute[0].name + \" [Label]\";\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tnewprops[keyname] = prop_value;\r\n\t\t\t\t\t\tif(add_labels) if(fieldAttribute.length>0){\r\n\t\t\t\t\t\t\tif(fieldAttribute[0].values){\r\n\t\t\t\t\t\t\t\tvar fieldValue = fieldAttribute[0].values.filter(function(item){if(item.id == prop_value) return item});\r\n\t\t\t\t\t\t\t\tif(fieldValue.length>0) newprops[labelname] = fieldValue[0].text;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tif(feature.getGeometry() != null) {\r\n\t\t\t\t\tnewprops[\"geometry\"] = new olFormat.WKT().writeGeometry(props[feature.getGeometryName()]);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfeaturesToExport.push(newprops);\r\n\t\t\t}\r\n\t\t\tvar csv = this_.json2csv(featuresToExport);\r\n\t\t\tvar fileName = this_.dataset_on_query.pid;\r\n\t\t\tfileName += \"_\"+ this_.getDateTimeString(new Date()) + \".csv\";\r\n\t\t\tthis_.downloadCSV(csv, fileName); \r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * OpenFairViewer.prototype.formatTabularDataset\r\n\t * @param features\r\n\t *\r\n\t */\r\n\tformatTabularDataset(features){\t\r\n\t\tvar this_ = this;\r\n\t\tvar featuresToExport = new Array();\r\n\t\tfor(var i=0;i<features.length;i++){\r\n\t\t\tvar feature = features[i];\r\n\t\t\tvar props = feature.getProperties();\r\n\t\t\tvar prop_keys = Object.keys(props);\r\n\t\t\tvar newprops = new Object();\r\n\t\t\tnewprops[\"fid\"] = feature.getId();\r\n\t\t\tfor(var j=0;j<prop_keys.length;j++){\r\n\t\t\t\tvar key = prop_keys[j];\r\n\t\t\t\tif(key == \"bbox\") continue;\r\n\t\t\t\tif(key != feature.getGeometryName()){\r\n\t\t\t\t\tvar fieldAttribute = null;\r\n\t\t\t\t\tif(this_.dataset_on_query.dsd) fieldAttribute = this_.dataset_on_query.dsd.filter(function(item){if(item.primitiveCode == key) return item});\r\n\t\t\t\t\tvar keyname = key;\r\n\t\t\t\t\tvar labelname = key + \"_label\";\r\n\t\t\t\t\tvar oldkeyname = keyname;\r\n\t\t\t\t\tvar oldlabelname = labelname;\r\n\t\t\t\t\tvar newkeyname = \"\";\r\n\t\t\t\t\tvar newlabelname = \"\";\r\n\t\t\t\t\tif(fieldAttribute != null) if(fieldAttribute.length>0){\r\n\t\t\t\t\t\tnewkeyname = fieldAttribute[0].name + \" [Code]\";\r\n\t\t\t\t\t\tnewlabelname = fieldAttribute[0].name + \" [Label]\";\r\n\t\t\t\t\t\tkeyname = newkeyname;\r\n\t\t\t\t\t\tlabelname = newlabelname;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tnewprops[keyname] = props[key];\r\n\t\t\t\t\tif(fieldAttribute != null) if(fieldAttribute.length>0){\r\n\t\t\t\t\t\tif(fieldAttribute[0].values){\r\n\t\t\t\t\t\t\tvar fieldValue = fieldAttribute[0].values.filter(function(item){if(item.id == props[key]) return item});\r\n\t\t\t\t\t\t\tif(fieldValue.length>0){\r\n\t\t\t\t\t\t\t\tnewprops[labelname] = fieldValue[0].text;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif(feature.getGeometry() != null) {\r\n\t\t\t\tnewprops[\"geometry\"] = new olFormat.WKT().writeGeometry(props[feature.getGeometryName()]);\r\n\t\t\t}\r\n\t\t\tfeaturesToExport.push(newprops);\r\n\t\t}\r\n\t\treturn featuresToExport;\r\n\t}\r\n\t\r\n\t/**\r\n\t * featureTypeToColumns\r\n\t * @param featuretype\r\n\t *\r\n\t */\r\n\tfeatureTypeToColumns(featuretype){\r\n\t\tvar columnsToExport = new Array();\r\n\t\tvar prop_keys = featuretype.map(function(item){return item});\r\n\t\tfor(var j=0;j<prop_keys.length;j++){\r\n\t\t\tvar key = prop_keys[j].name;\r\n\t\t\tvar type = prop_keys[j].type;\r\n\t\t\tif(key == \"bbox\") continue;\r\n\t\t\tif(!type.startsWith('gml')){\r\n\t\t\t\tvar fieldAttribute = null;\r\n\t\t\t\tif(this.dataset_on_query.dsd) fieldAttribute = this.dataset_on_query.dsd.filter(function(item){if(item.primitiveCode == key) return item});\r\n\t\t\t\tvar oldkeyname = key;\r\n\t\t\t\tvar oldlabelname = key + \"_label\";\r\n\t\t\t\tvar newkeyname = \"\";\r\n\t\t\t\tvar newlabelname = \"\";\r\n\t\t\t\tif(fieldAttribute != null) if(fieldAttribute.length>0){\r\n\t\t\t\t\tnewkeyname = fieldAttribute[0].name + \" [Code]\";\r\n\t\t\t\t\tnewlabelname = fieldAttribute[0].name + \" [Label]\";\r\n\t\t\t\t}\r\n\t\t\t\tvar column1 = {id: oldkeyname, title: (newkeyname != \"\"? newkeyname: oldkeyname)}; columnsToExport.push(column1);\r\n\t\t\t\tif(fieldAttribute != null) if(fieldAttribute.length>0){\r\n\t\t\t\t\tif(fieldAttribute[0].values) if(fieldAttribute[0].values.length > 0){\r\n\t\t\t\t\t\tvar column2 = {id: oldlabelname, title: (newlabelname != \"\"? newlabelname : oldlabelname)}; columnsToExport.push(column2);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tvar geom_props = featuretype.filter(function(item){if(item.type.startsWith('gml')) return item});\r\n\t\tif(geom_props.length > 0){\r\n\t\t\tvar geom_prop = geom_props[0];\r\n\t\t\tcolumnsToExport.push({id: geom_prop.name, title: 'geometry'});\r\n\t\t}\r\n\t\treturn columnsToExport;\r\n\t}\r\n\t\r\n\t/**\r\n\t * displayDataTable\r\n\t *\r\n\t */\r\n\tdisplayDataTable(){\r\n\t\t\t\t\r\n\t\tvar pageLength = 5;\r\n\t\t\t\t\r\n\t\tvar this_ = this;\r\n\t\tvar wfsResources = this.dataset_on_query.entry.wfs;\r\n\t\tvar baseWFS = wfsResources[0];\r\n\t\tvar baseLayerUrl = baseWFS.url;\r\n\t\tif(baseLayerUrl.indexOf(\"?\")<0) baseLayerUrl += \"?\";\r\n\t\tvar layerName = baseWFS.name;\r\n\t\tvar serviceVersion = baseWFS.version;\r\n\t\tvar strategyparams =  this.getStrategyParams(this.dataset_on_query, false);\r\n\t\tvar cql_filter = null;\r\n\t\tvar strategyparams_str = null;\r\n\t\tif(strategyparams){\r\n\t\t\tstrategyparams_str = this.getStrategyParams(this.dataset_on_query, true);\r\n\t\t\tif(strategyparams.length>0){\r\n\t\t\t\tif(this_.dataset_on_query.strategy == \"ogc_filters\") cql_filter = strategyparams_str;\r\n\t\t\t\tif(strategyparams[0].CQL_FILTER) cql_filter = strategyparams[0].CQL_FILTER;\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\t//this.getWFSSupportedFormats(baseLayerUrl, '2.0.0');\r\n\t\t\r\n\t\tthis.describeFeatureType(baseLayerUrl, serviceVersion, layerName).then(function(featuretype){\r\n\t\t\t\r\n\t\t\tconsole.log(featuretype);\r\n\t\t\t\r\n\t\t\t//get columns defs from feature type\r\n\t\t\tvar columnsToExport = new Array(); columnsToExport.push({id: \"fid\", title: \"fid\", sTitle: \"fid\"});\r\n\t\t\tvar featureTypeColumns = this_.featureTypeToColumns(featuretype);\r\n\t\t\tfor(var i=0;i<featureTypeColumns.length;i++){ columnsToExport.push(featureTypeColumns[i]) };\r\n\t\t\tvar data_columns = columnsToExport.map(function(item){return item.title});\r\n\t\t\tvar sortablePropertyNames = featuretype.filter(function(item){if(!item.type.startsWith('gml')) return item;});\r\n\t\t\tvar sortByPropertyName = sortablePropertyNames[0].name;\r\n\t\t\t\r\n\t\t\t//wfs params to send to WFS server\r\n\t\t\tvar wfsParams = {\r\n\t\t\t\tservice: 'WFS',\r\n\t\t\t\tserviceVersion: '2.0.0',\r\n\t\t\t\trequest: 'GetFeature',\r\n\t\t\t\ttypeName: layerName,\r\n\t\t\t\toutputFormat: encodeURIComponent(\"application/gml+xml; version=3.2\"),\r\n\t\t\t\t//outputFormat: encodeURIComponent(\"application/json\"),\r\n\t\t\t\tsortBy: sortByPropertyName\r\n\t\t\t}\r\n\t\t\tif(this_.dataset_on_query.strategy == \"ogc_filters\")  wfsParams.cql_filter = cql_filter;\r\n\t\t\tif(this_.dataset_on_query.strategy == \"ogc_viewparams\") wfsParams.viewparams = strategyparams_str;\r\n\t\t\tvar strategyvariable = this_.getStrategyVariable(this_.dataset_on_query);\r\n\t\t\tif(this_.options.map.thematicmapping_options.thresholding && strategyvariable){\r\n\t\t\t\tvar th_cql = strategyvariable + this_.options.map.thematicmapping_options.threshold;\r\n\t\t\t\tif(wfsParams.cql_filter){\r\n\t\t\t\t\twfsParams.cql_filter += \" AND \" + th_cql;\r\n\t\t\t\t}else{\r\n\t\t\t\t\twfsParams.cql_filter = th_cql;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tthis_.closeDashboardDialog();\r\n\t\t\tthis_.openDataDialog();\r\n\t\t\t$('#data-table').empty();\r\n\t\t\t\r\n\t\t\tconsole.log(columnsToExport);\r\n\t\t\tconsole.log(data_columns);\r\n\t\t\t\r\n\t\t\t//DataTables\r\n\t\t\t$('#data-table').DataTable( {\r\n\t\t\t\tprocessing: true,\r\n\t\t\t\tserverSide: true,\r\n\t\t\t\tserverMethod: 'get',\r\n\t\t\t\tajax: function(data, callback){\r\n\t\t\t\t\tvar ajaxParams = Object.assign(wfsParams,{startIndex: data.start, count: data.length});\r\n\t\t\t\t\tvar ajaxUrl = baseLayerUrl + \"&service=\" +ajaxParams.service+ \"&version=\" + ajaxParams.serviceVersion + \"&request=\" + ajaxParams.request + \"&typeName=\"+ajaxParams.typeName;\r\n\t\t\t\t\tif(ajaxParams.cql_filter) ajaxUrl += \"&cql_filter=\"+ajaxParams.cql_filter;\r\n\t\t\t\t\tif(ajaxParams.viewparams) ajaxUrl += \"&viewparams=\"+ajaxParams.viewparams;\r\n\t\t\t\t\tajaxUrl += \"&sortBy=\" +ajaxParams.sortBy + \"&startIndex=\" + ajaxParams.startIndex + \"&count=\" + ajaxParams.count;\r\n\t\t\t\t\tif(wfsParams.outputFormat) ajaxUrl += \"&outputFormat=\" + wfsParams.outputFormat;\r\n\t\t\t\t\t$.get(ajaxUrl, function(response) {\r\n\t\t\t\t\t\tconsole.log($(response));\r\n\t\t\t\t\t\tvar format = new olFormat.WFS({version: '2.0.0'})\r\n\t\t\t\t\t\tif(wfsParams.outputFormat) format = (wfsParams.outputFormat.indexOf(\"gml\")>0)? new olFormat.WFS({version: '2.0.0'}) : new olFormat.GeoJSON();\r\n\t\t\t\t\t\tvar features = format.readFeatures(response);\r\n\t\t\t\t\t\tconsole.log(features);\r\n\t\t\t\t\t\tvar data_export = this_.formatTabularDataset(features);\r\n\t\t\t\t\t\tconsole.log(data_export);\r\n\t\t\t\t\t\tcallback({\r\n\t\t\t\t\t\t\trecordsTotal: response.totalFeatures,\r\n\t\t\t\t\t\t\trecordsFiltered: response.totalFeatures,\r\n\t\t\t\t\t\t\tdata: data_export.map(function(item){return data_columns.map(function(key){return item[key]})}),\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t});\r\n\t\t\t\t},\r\n\t\t\t\t//data: data_series, order: [[0, 'asc']],\r\n\t\t\t\tcolumns: columnsToExport,\r\n\t\t\t\tsearching: false, destroy: true, pageLength: pageLength, lengthMenu: [ 5, 10, 25, 50],\r\n\t\t\t\tscrollY: 200, scrollX: true,\r\n\t\t\t\tcolumnDefs : [ {\r\n\t\t\t\t\ttargets : columnsToExport.map(function(item,idx){return idx;}),\r\n\t\t\t\t\trender : function(data, type, row, meta) {\r\n\t\t\t\t\t\tif(data == null || typeof data == \"undefined\") data = \"-\";\r\n\t\t\t\t\t\t//generic renderer\r\n\t\t\t\t\t\t//case of http(s) links\r\n\t\t\t\t\t\tif(typeof data == \"string\") if(data.indexOf(\"http\")==0){\r\n\t\t\t\t\t\t\tdata = '<a href=\"'+data+'\" target=\"_blank\" style=\"color:#337ab7\">Link</a>';\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t//case of images\r\n\t\t\t\t\t\tvar isBase64 = false; if(typeof data == \"string\") isBase64 = data.startsWith('base64:') || data.startsWith('data:image/png;base64,');\r\n\t\t\t\t\t\tif(isBase64){\r\n\t\t\t\t\t\t\tif(data.startsWith('base64:')) data = 'data:image/png;base64,' + data.split('base64:')[1];\r\n\t\t\t\t\t\t\tdata = '<img src=\"'+data+'\" width=\"100%\" style=\"margin:2px;\" alt=\"'+meta.col+'\" title=\"'+meta.col+'\"/>';\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t//case of geometry\r\n\t\t\t\t\t\tif(meta.col == data_columns.indexOf('geometry')){\r\n\t\t\t\t\t\t\tvar wkt = data;\r\n\t\t\t\t\t\t\tif(wkt != \"–\"){\r\n\t\t\t\t\t\t\t\tvar button_id_zoom = 'zoom_feature-'+row[0];\r\n\t\t\t\t\t\t\t\tvar button_id_disp = 'display_feature'+row[0];\r\n\t\t\t\t\t\t\t\t//button to zoom to feature\r\n\t\t\t\t\t\t\t\tdata = '<button id=\"'+button_id_zoom+'\" class=\"btn btn-xs dataset-button-zoom\" title=\"Zoom to feature\" ';\r\n\t\t\t\t\t\t\t\tdata += 'onclick=\"'+this_.config.OFV_ID+'.zoomToFeature(\\''+wkt.toUpperCase()+'\\')\"><span class=\"glyphicon glyphicon-zoom-in\"></span></button>';\r\n\t\t\t\t\t\t\t\t//button to display feature\r\n\t\t\t\t\t\t\t\tdata += '<button id=\"'+button_id_disp+'\" class=\"btn btn-xs dataset-button-add\" style=\"margin-left:10px\"  title=\"Display feature\" ';\r\n\t\t\t\t\t\t\t\tdata += 'onclick=\"'+this_.config.OFV_ID+'.highlightFeature(\\''+this_.dataset_on_query.lyr+'\\',\\''+row[0]+'\\',\\''+wkt.toUpperCase()+'\\')\"><span class=\"glyphicon glyphicon-map-marker\"></span></button>';\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\treturn data;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t,{\r\n\t\t\t\t\ttargets : [data_columns.indexOf('geometry')],\r\n\t\t\t\t\torderable: false\r\n\t\t\t\t},{\r\n\t\t\t\t\ttargets : [0],\r\n\t\t\t\t\tvisible: false\r\n\t\t\t\t}\r\n\t\t\t\t]\r\n\t\t\t});\r\n\r\n\t\t});\r\n\t}\r\n\t\r\n\t/**\r\n\t * getDashboards\r\n\t */\r\n\tgetDashboards(dataset){\r\n\t\tif(!dataset) return new Array();\r\n\t\tif(this.options.access.dashboard.enabled) if(this.options.access.dashboard.handlers.length > 0){\r\n\t\t\tvar eligible_dashboards = this.options.access.dashboard.handlers.filter(function(item){\r\n\t\t\t\tif(item.targets.filter(function(target){if(dataset.pid.indexOf(target)>=0) return target}).length > 0) return item;\r\n\t\t\t})\r\n\t\t\treturn eligible_dashboards;\r\n\t\t}else{\r\n\t\t\treturn new Array();\r\n\t\t}\r\n\t}\r\n\t\r\n\t/**\r\n\t * hasDashboards\r\n\t *\r\n\t */\r\n\thasDashboards(dataset){\r\n\t\treturn this.getDashboards(dataset).length > 0;\r\n\t}\r\n\r\n\t/**\r\n\t * displayDashboard\r\n\t *\r\n\t */\r\n\tdisplayDashboard(name){\r\n\t\tthis.closeDataDialog();\r\n\t\tthis.openDashboardDialog();\r\n\t\tvar dashboard = null;\r\n\t\tif(name){\r\n\t\t\tdashboard = this.options.access.dashboard.handlers.filter(function(item){if(item.name == name) return item;})[0];\r\n\t\t}else{\r\n\t\t\tdashboard = this.getDashboards(this.dataset_on_query)[0];\r\n\t\t}\r\n\t\tvar dashboard_html = dashboard.handler(this.dataset_on_query);\r\n\t\tif(dashboard_html){\r\n\t\t\t$(\"#datasetDashboard\").html(dashboard_html);\r\n\t\t}else{\r\n\t\t\t$(\"#datasetDashboard\").html(\"<p>No dashboard configured for this layer</p>\");\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\r\n\t/**\r\n\t * processWKT\r\n\t *\r\n\t */\r\n\tprocessWKT(wkt){\r\n\t\tvar format = new olFormat.WKT();\r\n\t\tvar feature = format.readFeature(wkt);\r\n\t\tvar geom = feature.getGeometry();\r\n\t\t//reproject if needed\r\n\t\tvar srs_data = null;\r\n\t\tif(this.dataset_on_query) srs_data = this.dataset_on_query.entry.projection;\r\n\t\tvar srs_map = this.map.getView().getProjection();\r\n\t\tif(srs_data) if(srs_data.getCode() != srs_map.getCode()){\r\n\t\t\tgeom.transform(srs_data, srs_map);\r\n\t\t}\r\n\t\treturn geom;\r\n\t}\r\n\r\n\t/**\r\n\t * utcToLocale\r\n\t *\r\n\t */\r\n\tutcToLocale(str){\t\r\n\t\tvar date = new Date(Date.parse(str));\r\n\t\treturn date.toISOString().split(\"T\")[0] + 'T' + date.toLocaleTimeString();\r\n\t}\r\n\r\n\t/**\r\n\t * drawFeatureFromGeom\r\n\t * @param geom\r\n\t * @param style\r\n\t */\r\n\tdrawFeatureFromGeom(geom, style){\r\n\t\t\r\n\t\tvar this_ = this;\r\n\t\tvar feature_style = style? style : this_.options.find.defaultStyle;\r\n\t\tvar feature = new Feature({ geometry: geom });\r\n\t\tfeature.setId('generic');\r\n\r\n\t\tvar layerId = 'ofv-feature-marker';\r\n\t\tvar layer = this.getLayerByProperty(layerId, 'id');\r\n\t\tvar source = new Vector({ features: [feature] });\r\n\t\tif(!layer){\r\n\t\t\tvar layer = new VectorLayer({\r\n\t\t\t  source: new Vector({\r\n\t\t\t    features: [feature]\r\n\t\t\t  }),\r\n\t\t\t  style : feature_style\r\n\t\t\t});\r\n\t\t\tlayer.id = layerId;\r\n\t\t\tthis_.layers.overlays[this_.options.map.mainlayergroup].getLayers().push(layer);\r\n\t\t}else{\r\n\t\t\tlayer.setSource(source);\r\n\t\t\tif(style) layer.setStyle(style);\r\n\t\t}\r\n\t}\r\n\t\r\n\t/**\r\n\t * drawFeatureFromWKT\r\n\t * @param wkt\r\n\t * @param style\r\n\t */\r\n\tdrawFeatureFromWKT(wkt, style){\r\n\t\tvar this_ = this;\r\n\t\tvar geom = this.processWKT(wkt);\r\n\t\tthis.drawFeatureFromGeom(geom, style);\r\n\t}\r\n\r\n\t/**\r\n\t * drawFeaturesFromGeoJSON\r\n\t * @param json\r\n\t * @param style\r\n\t */\r\n\tdrawFeaturesFromGeoJSON(json, style){\r\n\t\tvar this_ = this;\r\n\t\t\r\n\t\tvar format = new olFormat.GeoJSON();\r\n\t\tif(!json.features) return;\r\n\t\tvar features = json.features.map(function(item){\r\n\t\t\tvar feature = format.readFeature(item,{\r\n\t\t\t\tfeatureProjection: this_.map.getView().getProjection()\r\n\t\t\t});\r\n\t\t\treturn feature;\r\n\t\t});\r\n\t\tvar feature_style = style? style : this_.options.find.defaultStyle;\r\n\t\t\r\n\t\tvar layerId = 'ofv-feature-marker';\r\n\t\tvar layer = this.getLayerByProperty(layerId, 'id');\r\n\t\tvar source = new Vector({ features: features });\r\n\t\tif(!layer){\r\n\t\t\tvar layer = new VectorLayer({\r\n\t\t\t  source: source,\r\n\t\t\t  style : feature_style\r\n\t\t\t});\r\n\t\t\tlayer.id = layerId;\r\n\t\t\tthis_.layers.overlays[this_.options.map.mainlayergroup].getLayers().push(layer);\r\n\t\t}else{\r\n\t\t\tlayer.setSource(source);\r\n\t\t\tif(style) layer.setStyle(style);\r\n\t\t}\r\n\t}\r\n\t\r\n\t/**\r\n\t * zoomToFeature\r\n\t *\r\n\t */\r\n\tzoomToFeature(wkt){\r\n\t\tvar geom = this.processWKT(wkt);\r\n\t\tvar extent = geom.getExtent();\r\n\t\tthis.map.getView().fit(extent,this.map.getSize());\r\n\t}\r\n\r\n\t/**\r\n\t * highlightFeature\r\n\t *\r\n\t */\r\n\thighlightFeature(lyr, id, wkt){\r\n\t\tvar this_ = this;\r\n\t\tvar geom = this.processWKT(wkt);\r\n\t\tthis.drawFeatureFromGeom(geom);\r\n\t\t\r\n\t\t//add popup\r\n\t\tvar target_layer = this_.getLayerByProperty(lyr, \"id\");\r\n\t\tvar coords = olExtent.getCenter(geom.getExtent());\r\n\t\tif(geom instanceof olGeom.LineString ||\r\n\t\t   geom instanceof olGeom.MultiLineString ||\r\n\t \t   geom instanceof olGeom.MultiPoint){\r\n\t\t\tcoords = geom.getCoordinates()[0][Math.floor(geom.getCoordinates()[0].length/2)];\r\n\t\t}\r\n\t\tif(geom instanceof olGeom.Point) coords = geom.getCoordinates();\r\n\t\tthis.map.getView().setCenter(coords);\r\n\t\tif(target_layer instanceof VectorLayer){\r\n\t\t\tvar vectorSource = target_layer.getSource();\r\n\t\t\tif(vectorSource instanceof Cluster) vectorSource = vectorSource.getSource();\r\n\t\t\tfeature = vectorSource.getFeatureById(id);\r\n\t\t\tthis_.getVectorFeatureInfo(target_layer, feature, coords);\r\n\t\t}else{\r\n\t\t\tthis_.getFeatureInfos([lyr], coords);\r\n\t\t}\r\n\t}\r\n\r\n\t\r\n\t/**\r\n\t * OpenFairViewer.prototype.exportToPNG\r\n\t *\r\n\t */\r\n\texportToPNG(){\r\n\t\tvar this_ = this;\r\n\t\tthis.map.once('rendercomplete', function(event) {\r\n\t\t\tvar mapCanvas = document.createElement('canvas');\r\n\t\t\tvar size = this_.map.getSize();\r\n\t\t\tmapCanvas.width = size[0];\r\n\t\t\tmapCanvas.height = size[1];\r\n\t\t\tvar mapContext = mapCanvas.getContext('2d');\r\n\t\t\tArray.prototype.forEach.call(\r\n\t\t\t  document.querySelectorAll('.ol-layer canvas'),\r\n\t\t\t  function (canvas) {\r\n\t\t\t\tif (canvas.width > 0) {\r\n\t\t\t\t  var opacity = canvas.parentNode.style.opacity;\r\n\t\t\t\t  mapContext.globalAlpha = opacity === '' ? 1 : Number(opacity);\r\n\t\t\t\t  var transform = canvas.style.transform;\r\n\t\t\t\t  // Get the transform parameters from the style's transform matrix\r\n\t\t\t\t  var matrix = transform\r\n\t\t\t\t\t.match(/^matrix\\(([^\\(]*)\\)$/)[1]\r\n\t\t\t\t\t.split(',')\r\n\t\t\t\t\t.map(Number);\r\n\t\t\t\t  // Apply the transform to the export map context\r\n\t\t\t\t  CanvasRenderingContext2D.prototype.setTransform.apply(\r\n\t\t\t\t\tmapContext,\r\n\t\t\t\t\tmatrix\r\n\t\t\t\t  );\r\n\t\t\t\t  mapContext.drawImage(canvas, 0, 0);\r\n\t\t\t\t}\r\n\t\t\t  }\r\n\t\t\t);\r\n\t\t\tvar fileName = this_.dataset_on_query.pid +\"_\"+ this_.getDateTimeString(new Date()) + \".png\";\r\n\t\t\tif (navigator.msSaveBlob) {\r\n\t\t\t\tnavigator.msSaveBlob(mapCanvas.msToBlob(), fileName);\r\n\t\t\t} else {\r\n\t\t\t\tmapCanvas.toBlob(function(blob){\r\n\t\t\t\t\tsaveAs(blob, fileName);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t});\r\n        this.map.renderSync();\r\n\t}\r\n\t\r\n\t//===========================================================================================\r\n\t//MAP\r\n\t//===========================================================================================\r\n\t\r\n\t\r\n\t/**\r\n\t * initDataViewer\r\n\t */\r\n\tinitDataViewer(){\r\n\t\tvar this_ = this;\r\n\t\tthis_.initMap('map', true, false);\r\n\t\t\r\n\t\tif(this_.enable_3d){\r\n\t\t\tCesium.Ion.defaultAccessToken = this.options.cesium.defaultAccessToken;\r\n\t\t\tthis_.ol3d = new OLCesium({\r\n\t\t\t  map: this_.map,\r\n\t\t\t  time() {\r\n\t\t\t\treturn Cesium.JulianDate.now();\r\n\t\t\t  }\r\n\t\t\t});\r\n\t\t\tconst scene = this_.ol3d.getCesiumScene();\r\n\t\t\tscene.terrainProvider = Cesium.createWorldTerrain();\r\n\t\t\tthis_.ol3d.setEnabled(this_.options.map.mode == '3D'? true : false);\r\n\t\t\tthis_.ol3d.enableAutoRenderLoop();\r\n\t\t}else{\r\n\t\t\t$(\"#map-olcesium-switcher\").hide();\r\n\t\t}\r\n\t\t\r\n\t\t$($(\"li[data-where='#pageMap']\")).on(\"click\", function(e){\r\n\t\t\t$($(\"#map\").find(\"canvas\")).show();\r\n\t\t});\r\n\r\n\t}\r\n\t\r\n\tinspireWgs84Grid(levels, prefix) {\r\n\t\tvar projection = olProj.get('EPSG:4326');\r\n\r\n\t\tvar projectionExtent = projection.getExtent();\r\n\t\tvar resolution = olExtent.getWidth(projectionExtent) / 512;\r\n\t\t\r\n\t\tvar resolutions = new Array(levels);\r\n\t\tvar matrixIds = new Array(levels);\r\n\t\t\r\n\t\tfor (var z = 0; z < levels; z++) {\r\n\t\t\tresolutions[z] = resolution / Math.pow(2, z);\r\n\t\t\tmatrixIds[z] = z;\r\n\t\t}\r\n\t\t\r\n\t\treturn new WMTSTileGrid({\r\n\t\t\torigin: olExtent.getTopLeft(projectionExtent),\r\n\t\t\tresolutions: resolutions,\r\n\t\t\tmatrixIds: matrixIds\r\n\t\t});\t\t\t\t\r\n\t}\r\n\t\r\n\t/**\r\n\t * switchMapView\r\n\t * Switches from 2D to 3D and vice-versa\r\n\t */\r\n\tswitchMapView(){\r\n\t\tvar this_ = this;\r\n\t\tif(this.ol3d.getEnabled()){\r\n\t\t\tthis.ol3d.setEnabled(false);\r\n\t\t\t$(\"#map-olcesium-switcher-to\").html('3D');\r\n\t\t}else{\r\n\t\t\tthis.ol3d.setEnabled(true);\r\n\t\t\t$(\"#map-olcesium-switcher-to\").html('2D');\r\n\t\t}\r\n\t}\r\n\t\r\n\t/**\r\n\t * initMap\r\n\t * @param {String} id the map target id\r\n\t * @param {Boolean} main\r\n\t * @param {Array} extent\r\n\t */\r\n\tinitMap(id, main, extent){\r\n        \r\n\t\tvar map;\r\n\t\tvar this_ = this;\r\n\t\tthis_.layers = new Object();\r\n\t\t\r\n\t\t//baselayers\r\n\t\tvar baseLayers = [\r\n\t\t\tnew LayerGroup({\r\n\t\t\t\t'title': this_.options.map.baselayergroup.name,\r\n\t\t\t\tfold: this_.options.map.baselayergroup.fold,\r\n\t\t\t\tlayers: this_.options.map.baselayers\r\n\t\t\t})\r\n\t\t];\r\n\r\n\t\t//overlay groups\r\n\t\tvar overlays = new Array();\r\n\t\tfor(var i=0;i< this.options.map.layergroups.length;i++){\r\n\t\t\tvar overlay = new LayerGroup({\r\n\t\t\t\t'title': this_.options.map.layergroups[i].name,\r\n\t\t\t\tfold: this_.options.map.layergroups[i].fold,\r\n\t\t\t\tlayers: [],\r\n\t\t\t});\r\n\t\t\toverlays.push(overlay);\r\n\t\t}\r\n\t\t//special overlay group for coverages\r\n\t\tvar covOverlay = new LayerGroup({\r\n\t\t\tlayers: []\r\n\t\t});\r\n\t\toverlays.push(covOverlay);\r\n\t\t//extent/zoom\r\n\t    var defaultMapExtent = this.options.map.extent;\r\n\t    var defaultMapZoom = this.options.map.zoom;\r\n            \r\n\t\tif(main){\r\n\t\t\tthis.layers.baseLayers = baseLayers;\r\n\t\t\tthis.layers.overlays = overlays;\r\n\t\t\tthis.defaultMapExtent = defaultMapExtent;\r\n\t\t\tthis.defaultMapZoom = defaultMapZoom;\r\n\t\t}     \r\n        \r\n\t    //mapgetLa\r\n\t\tvar mapId = id? id : 'map';\r\n\t    $(\"#\"+mapId).empty();\r\n\t\t\r\n\t\tthis.map = new Map({\r\n\t\t\tid: mapId,\r\n\t\t\ttarget : mapId,\r\n\t\t\tlayers : this_.layers.baseLayers.concat(this_.layers.overlays),\r\n\t\t\tview : new View({\r\n\t\t\t\tprojection: (this_.enable_3d? undefined : this_.options.map.projection),\r\n\t\t\t\tcenter : defaultMapExtent? olExtent.getCenter(defaultMapExtent) : [0,0],\r\n\t\t\t\textent: (this_.enable_3d? undefined : defaultMapExtent),\r\n\t\t\t\tzoom : defaultMapZoom\r\n\t\t\t}),\r\n\t\t\tcontrols: [],\r\n\t\t\tlogo: false\r\n\t\t});\r\n\t\tthis.map.addControl( new MousePosition({\r\n\t\t\tprojection: 'EPSG:4326',\r\n\t\t\tcoordinateFormat: function(coordinate) {\r\n\t\t\t\treturn olCoordinate.format(coordinate, 'Lat: {y} Lon: {x}', 2);\r\n\t\t\t},\r\n\t\t\tundefinedHTML: 'Lat: - Lon: -'\r\n \t\t}));\r\n\t\t\r\n\t\t//layers of interest\r\n\t\tif(this.map){\r\n\t\t\tfor(var i=0;i<this.options.map.overlays.length;i++){\r\n\t\t\t\tvar layerDef = this.options.map.overlays[i];\r\n\t\t\t\tvar wmsVersion = layerDef.wmsVersion? layerDef.wmsVersion : \"1.1.1\";\r\n\t\t\t\tthis.addWMSLayer(\r\n\t\t\t\t\tlayerDef.group, layerDef.pid, layerDef.id, layerDef.title, layerDef.shortTitle, layerDef.wmsUrl, wmsVersion, layerDef.layer, layerDef.hidden,\r\n\t\t\t\t\tlayerDef.visible, layerDef.showLegend, layerDef.opacity, layerDef.tiled, layerDef.cql_filter, layerDef.style\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\t//Loading panel\r\n\t\tthis.map.addControl( new LoadingPanel(this_.options.map.control_options.loadingpanel) );\r\n\t\t\r\n\t\t/*map.addControl( new OverviewMap({\r\n\t\t\tclassName: 'ol-overviewmap ol-custom-overviewmap',\r\n\t\t\tlayers: [ this_.layers.baseLayers[0] ],\r\n\t\t\tview : new View({\r\n\t\t\t\tprojection: this_.options.map.projection,\r\n\t\t\t\tcenter : olExtent.getCenter(defaultMapExtent),\r\n\t\t\t\textent: defaultMapExtent,\r\n\t\t\t\tzoom : defaultMapZoom\r\n\t\t\t}),\r\n\t\t\tcollapseLabel: '\\u00BB',\r\n  \t\t\tlabel: '\\u00AB',\r\n  \t\t\tcollapsed: true\r\n\t\t}) );*/\r\n\t\t\r\n\t\tthis.map.addControl( new Zoom() );\r\n\t\t\r\n\t\tthis.map.addControl( new ZoomToExtent({\r\n\t\t\textent\t: extent? extent : defaultMapExtent,\r\n\t\t\tzoom\t: defaultMapZoom,\r\n\t\t\tlabel : '',\r\n\t\t\ttipLabel: this_.options.labels.fit_to_extent\r\n\t\t}));\r\n\t\t\r\n\t\t//TODO\r\n\t\t//map.addControl( new ol.control.Snapshot({dpi: 300}) );\r\n\r\n\t\tif(main){\r\n\t\t\tthis.map.addControl( new OpenFairLayerSwitcher({\r\n\t\t\t\tactivationMode: 'click',\r\n\t\t\t\ttipLabel: this_.options.labels.legend_title_show, // Optional label for button\r\n\t\t\t\tcollapseTipLabel: this_.options.labels.legend_title_hide, // Optional label for button\r\n\t\t\t\tcollapseLabel: '',\r\n\t\t\t\tdragAndDrop: true\r\n\t\t\t}));\r\n\t\t}      \r\n\t\t\t\t\t\r\n\t\tif(extent){\r\n\t\t   this.map.getView().fit(extent, this.map.getSize());\r\n\t\t}\r\n\t\t\r\n\t\tif(main && this.options.map.zoom){\r\n\t\t\tthis.map.getView().setZoom(this.options.map.zoom);\r\n\t\t}\r\n\t\t\r\n\t\t//Attribution\r\n\t\tif(this.options.map.attribution){\r\n\t\t\t\r\n\t\t\t//create base attribution for handling the watermark\r\n\t\t\tvar baseAttribution = new Attribution({\r\n\t\t\t\tclassName: 'ol-attribution-map',\r\n\t\t\t\tcollapsible: false\r\n\t\t\t});\r\n\t\t\tthis.map.addControl(baseAttribution);\r\n\t\t\t\r\n\t\t\t//manage the display of watermark (logo)\r\n\t\t\tvar attMaps = this.map.getTargetElement().getElementsByClassName(\"ol-attribution-map\");\r\n\t\t\tif( attMaps.length > 0) $(attMaps[0].getElementsByTagName(\"ul\")[0]).append('<li>'+this_.options.map.attribution+'</li>');\r\n\t\t\t\r\n\t\t\t//hack to remove the baselayer attribution that for some reason is also added to the ol-attribution-map\r\n\t\t\t//while explicitely referenced on ol-attribution-baselayer (to investigate if there is a cleaner solution)\r\n\t\t\t//TODO\r\n\t\t\t/*map.on('postrender', function() {\r\n\t\t\t\tvar attMaps = this.getTargetElement().getElementsByClassName(\"ol-attribution-map\");\r\n\t\t\t\tif( attMaps.length > 0){\r\n\t\t\t\t\tvar attLis = attMaps[0].getElementsByTagName(\"li\");\r\n\t\t\t\t\tif( attLis.length > 1) attLis[1].remove();\r\n\t\t\t\t}\r\n\t\t\t});*/\r\n\t\t}\r\n\t\t\r\n\t\t//events\r\n\t\t//------\r\n\t\t//map click (for feature info)\r\n\t\t//configure popup (for popup featureinfo mode)\r\n\t\tvar popup = new Popup({id: 'featureinfos'});\r\n\t\tthis.map.addOverlay(popup);\r\n\t\tthis.layers_with_featureinfo = new Array();\r\n\t\tthis.map.on('singleclick', function(evt) {\r\n\t\t\tthis_.getFeatureInfos(this_.layers_with_featureinfo, evt.coordinate);\r\n\t\t});\r\n\t\t//spatial search\r\n\t\tthis.map.on('moveend', function(evt){\r\n\t\t\tif($(\"#dataset-search-bbox-on-search\").prop(\"checked\") && $(\"#dataset-search-bbox-on-mapinteraction\").prop(\"checked\")){\r\n\t\t\t\tvar bbox = evt.map.getView().calculateExtent(evt.map.getSize());\r\n\t\t\t\tvar maxrecords = parseInt($(\"select[id='datasets_length']\").val());\r\n\t\t\t\tthis_.displayDatasets(maxrecords, bbox); \r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\t\r\n\t/**\r\n\t * renderMapLegend\r\n\t */\r\n\trenderMapLegend(){\r\n\t\tvar control = this.map.getControls().getArray().filter(function(control){if(control instanceof LayerSwitcher) return control});\r\n\t\tif(control.length > 0) control[0].renderPanel();\r\n\t}\r\n\t\r\n\t/**\r\n\t * showLegendPanel\r\n\t */\r\n\tshowLegendPanel(){\r\n\t\tvar control = this.map.getControls().getArray().filter(function(control){if(control instanceof LayerSwitcher) return control});\r\n\t\tif(control.length > 0) control[0].showPanel();\r\n\t}\r\n\t\r\n\t/**\r\n\t * hideLegendPanel\r\n\t */\r\n\thideLegendPanel(){\r\n\t\tvar control = this.map.getControls().getArray().filter(function(control){if(control instanceof LayerSwitcher) return control});\r\n\t\tif(control.length > 0) control[0].hidePanel();\r\n\t}\r\n\t\r\n\t/**\r\n\t * setLegendGraphic Set legend graphic\r\n\t * @param {ol/Layer} lyr layer object\r\n\t * @param {Array} breaks an array of break values\r\n\t * @param {Array} colors\r\n\t */\t \r\n\tsetLegendGraphic(lyr, breaks, colors) {\r\n\t\tvar this_ = this;\r\n\t\tvar source = lyr.getSource();\r\n\t\tif( source instanceof TileWMS | source instanceof ImageWMS ){\r\n\t\t\tconsole.log(\"Adding legend graphic\");\r\n\t\t\tvar params = source.getParams();\r\n\t\t\tvar request = '';\r\n\t\t\tvar wmsUrl = (source instanceof TileWMS? source.getUrls()[0] : source.getUrl());\r\n\t\t\tvar serviceSeparator = (wmsUrl.indexOf(\"wms?\") > 0 || wmsUrl.indexOf(\"ows?\") > 0)? \"&\" : \"?\";\r\n\t\t\trequest += wmsUrl + (wmsUrl.endsWith('?')? '' : serviceSeparator);\r\n\t\t\trequest += 'SERVICE=WMS';\r\n\t\t\trequest += '&VERSION=1.0.0';\r\n\t\t\trequest += '&REQUEST=GetLegendGraphic';\r\n\t\t\trequest += '&LAYER=' + params.LAYERS.split(\",\")[0];\r\n\t\t\trequest += '&STYLE=' + ( (params.STYLES)? params.STYLES : '');\r\n\t\t\trequest += '&LEGEND_OPTIONS=forcelabels:on;forcerule:True;fontSize:12'; //maybe to let as options\r\n\t\t\trequest += '&SCALE=139770286.4465912'; //to investigate\r\n\t\t\trequest += '&FORMAT=image/png';\r\n\t\t\trequest += '&TRANSPARENT=true';\r\n\t\t\trequest += '&WIDTH=30';\r\n\t\t\trequest += '&SLD_VERSION=1.1.0';\r\n\t\t\tif(params.STYLES){\r\n\t\t\t\tvar style_splits = params.STYLES.split('/');\r\n\t\t\t\tif(style_splits.length > 1){\r\n\t\t\t\t\t//detect presence of palette\r\n\t\t\t\t\trequest += '&PALETTE='+style_splits[1];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif(colors){\r\n\t\t\t\trequest += '&env=';\r\n\t\t\t\tvar colreq = '';\r\n\t\t\t\tfor(var i=1;i<=colors.length;i++){\r\n\t\t\t\t\tcolreq += \"c\"+ i +\":\"+ colors[i-1] + \";\";\r\n\t\t\t\t}\r\n\t\t\t\trequest += encodeURIComponent(colreq);\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tconsole.log(request);\r\n\r\n\t\t\t//case of dynamic maps\r\n\t\t \tif(breaks){\r\n\t\t\t\tvar canvas = document.createElement('canvas');\r\n\t\t\t\tdocument.body.appendChild(canvas);\r\n\t\t\t\tvar palYStart = 20;\r\n\t\t\t\tvar canvasHeight = breaks? ((breaks.length-1) * 20 + palYStart) : 100;\r\n\t\t\t\tcanvas.height = String(canvasHeight);\r\n\t\t\t\tcanvas.width = '200';\r\n\t\t\t\tvar ctx = canvas.getContext('2d');\r\n\t\t\t\t\r\n\t\t\t\t//add variable (+uom) header\r\n\t\t\t\tctx.font = \"bold 8pt Arial\";\r\n\t\t\t\tvar variable = lyr.dsd.filter(function(item){if(item.primitiveCode == lyr.variable) return item});\r\n\t\t\t\tif(variable.length > 0) variable = variable[0];\r\n\t\t\t\tvar varLabel = variable.name; \r\n\t\t\t\tif(variable.uom) varLabel = varLabel +' ('+variable.uom + ')';\r\n\t\t\t\tctx.fillText(varLabel, 4, 10);\r\n\t\t\t\tctx.font = \"normal 8pt Arial\";\r\n\t\t\t\t\r\n\t\t\t\t//add palette\r\n\t\t\t\tvar palette = new Image();\r\n\t\t\t\tpalette.crossOrigin = \"anonymous\";\r\n\t\t\t\tpalette.src = request;\r\n\t\t\t\tpalette.onload = function() {\r\n\t\t\t\t    //draw color palette\r\n   \t\t\t\t    ctx.drawImage(palette, 0, palYStart, 32, canvasHeight - palYStart);\r\n\t\t\t\t    //draw break legends\r\n\t\t\t\t    ctx.font = \"9pt Arial\";\r\n\t\t\t\t    var breakPt = 14;\r\n\t\t\t\t    var breakSpace = 6;\r\n\t\t\t\t    var dx = 36;\r\n\t\t\t\t    var dy = breakPt + palYStart;\r\n\t\t\t\t    if(breaks){\r\n\t\t\t\t\t\tvar break_signs = this_.options.map.thematicmapping_options.breaks;\r\n\t\t\t\t\t\tfor(var i=1;i<breaks.length;i++){\r\n\t\t\t\t\t\t\tvar minVal = (Math.round(breaks[i-1] * 100) / 100);\r\n\t\t\t\t\t\t\tvar maxVal = (Math.round(breaks[i] * 100) / 100);\r\n\t\t\t\t\t\t\tvar class_start = break_signs[0];\r\n\t\t\t\t\t\t\tvar class_sep = break_signs[1];\r\n\t\t\t\t\t\t\tvar class_end = break_signs[2];\r\n\t\t\t\t\t\t\tif(i==breaks.length-1){\r\n\t\t\t\t\t\t\t\tif(class_end == \"[\") class_end = \"]\";\r\n\t\t\t\t\t\t\t\tif(class_end == \"(\") class_end = \")\";\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tvar breakLegend = class_start+\" \" + minVal + \" \"+class_sep+\" \" + maxVal + \" \" + class_end;\r\n\t\t\t\t\t\t\tif(lyr.count) if(lyr.count == breaks.length-1){\r\n\t\t\t\t\t\t\t\tbreakLegend = (lyr.count == 1)? maxVal : minVal;\r\n\t\t\t\t\t\t\t} \r\n\t\t\t\t\t\t\tctx.fillText(breakLegend, dx, dy);\r\n\t\t\t\t\t\t\tdy = breakPt*(i+1) + breakSpace*i + palYStart;\r\n\t\t\t\t\t\t} \r\n\t\t\t\t\t\tlyr.legendGraphic = canvas.toDataURL(\"image/png\");\r\n\t\t\t\t\t\tthis_.renderMapLegend();\r\n\t\t\t\t    }\r\n\t\t\t\t};\t\r\n\t\t\t}else{\r\n\t\t\t\tlyr.legendGraphic = request;\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tif( source instanceof Vector){\r\n\t\t\tvar features = source instanceof Cluster? source.source.getFeatures() : source.getFeatures();\r\n\t\t\tif(features.length > 0){\r\n\t\t\t\tvar style = lyr.getStyle();\r\n\t\t\t\tif(typeof style == \"function\") style = style(features[0]);\r\n\t\t\t\tvar img = style.getImage();\r\n\t\t\t\tif(img){\r\n\t\t\t\t\tif(img instanceof Icon){\r\n\t\t\t\t\t\tlyr.legendGraphic = img.getSrc();\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\tvar canvas = img.getImage();\r\n\t\t\t\t\t\tlyr.legendGraphic = canvas.toDataURL(\"image/png\");\r\n\t\t\t\t\t\tthis_.renderMapLegend();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\r\n\t/**\r\n\t * addWMSLayer Adds layer\r\n\t * @param {Integer} mainOverlayGroup\r\n\t * @param {String} pid\r\n\t * @param {String} id\r\n\t * @param {String} title\r\n\t * @param {String} shortTitle\r\n\t * @param {String} wmsUrl\r\n\t * @param {String} wmsVersion\r\n\t * @param {String} layer\r\n\t * @param {String} cql_filter\r\n\t * @param {String} style\r\n\t * @param {String} viewparams\r\n\t * @param {String} time\r\n\t * @param {String} elevation\r\n\t * @param {String} envfun\r\n\t * @param {String} envparams\r\n\t * @param {Number} count\r\n\t */\r\n\taddWMSLayer(\r\n\r\n\t\tmainOverlayGroup, pid, id, title, shortTitle, wmsUrl, wmsVersion, layer,\r\n\t\thidden, visible, showLegend, opacity, tiled, cql_filter, style, \r\n\t\tviewparams, time, elevation, \r\n\t\tenvfun, envparams, count){\r\n\t\t\t\r\n\t\tvar this_ = this;\r\n\t\tvar layerParams = {\r\n\t\t\t\t'LAYERS' : layer,\r\n\t\t\t\t'VERSION': (wmsVersion? wmsVersion : '1.1.1'),\r\n\t\t\t\t'FORMAT' : 'image/png'\r\n\t\t}\r\n\t\tvar olLayerClass = ImageLayer;\r\n\t\tvar olSourceClass = ImageWMS;\r\n\t\tif(tiled){\r\n\t\t\tlayerParams['TILED'] = true;\r\n\t\t\tlayerParams['TILESORIGIN'] = [-180,-90].join(',');\r\n\t\t\tolLayerClass = TileLayer;\r\n\t\t\tolSourceClass = TileWMS;\r\n\t\t}\r\n\t\t\r\n\t\tif(cql_filter){ layerParams['CQL_FILTER'] = cql_filter; }\r\n\t\tif(viewparams){ layerParams['VIEWPARAMS'] = viewparams; }\r\n\t\tif(time) layerParams['TIME'] = time;\r\n\t\tif(elevation) layerParams['ELEVATION'] = elevation;\r\n\t\thidden = hidden? hidden : false;\r\n\t    if(envparams){ layerParams['env'] = envparams; }\r\n\t    if(style) layerParams['STYLES'] = style;\r\n\t\tconsole.log(layerParams);\r\n\t    var layer = new olLayerClass({\r\n\t\t\tid : (hidden? undefined : id),\r\n\t\t\ttitle : (hidden? undefined : title),\r\n\t\t\tsource : new olSourceClass({\r\n\t\t\t\turl : wmsUrl,\r\n\t\t\t\tparams : layerParams,\r\n\t\t\t\twrapX: true,\r\n\t\t\t\tserverType : 'geoserver',\r\n\t\t\t\tcrossOrigin : 'anonymous'\r\n\t\t\t}),\r\n\t\t\topacity : opacity,\r\n\t\t\tvisible: visible\r\n\t    });\r\n            \r\n\t    this.setLegendGraphic(layer);\r\n\t\tif(!pid) pid = id;\r\n\t\tlayer.pid =  pid;\r\n\t\tlayer.id = id;\r\n\t    layer.envfun = envfun;\r\n\t    layer.count = count;\r\n\t    layer.showLegendGraphic = showLegend;\r\n\t\tlayer.shortTitle = shortTitle;\r\n\t\t\t\r\n \t    if(mainOverlayGroup > this.layers.overlays.length-1){\r\n\t\t\talert(\"Overlay group with index \" + mainOverlayGroup + \" doesn't exist\");\r\n\t    }\r\n\t    layer.overlayGroup = this.options.map.layergroups[mainOverlayGroup];\r\n\t\tlayer.setZIndex(this_.layers.overlays[mainOverlayGroup].getLayers().length);\r\n\t    this.layers.overlays[mainOverlayGroup].getLayers().push(layer);\r\n\t    \r\n \t    //inherit properties\r\n\t    layer.csw_server = this.config.OGC_CSW_BASEURL;\r\n\t    layer.csw_version = this.config.OGC_CSW_VERSION;\r\n\t\t\r\n\t\t//update map legend;\r\n\t\tthis.renderMapLegend(layer);\r\n\t    return layer;\r\n\t}\r\n\t\r\n\t/**\r\n\t * addWFSLayer Adds layer\r\n\t * @param {Integer} mainOverlayGroup\r\n\t * @param {String} pid\r\n\t * @param {String} id\r\n\t * @param {String} title\r\n\t * @param {String} wfsUrl\r\n\t * @param {String} wfsVersion\r\n\t * @param {String} layerName\r\n\t * @param {String} strategy\r\n\t * @param {String} cql_filter\r\n\t * @param {String} viewparams\r\n\t * @param {Boolean} clustering\r\n\t */\r\n\taddWFSLayer(mainOverlayGroup, pid, id, title, wfsUrl, wfsVersion, layerName, strategy, viewparams, cql_filter, projection, clustering){\r\n\t\tvar this_ = this;\r\n\t\tvar deferred = $.Deferred();\r\n\t\tthis_.getDatasetFeatures(wfsUrl, wfsVersion, layerName, strategy, viewparams, cql_filter, null, 'json', projection).then(function(response){\r\n\t\t\tconsole.log(\"Get features to set WFS layer\");\r\n\t\t\tvar format = new olFormat.GeoJSON();\r\n\t\t\tvar features = response.map(function(item){\r\n\t\t\t\tvar feature = format.readFeature(item);\r\n\t\t\t\tfeature.pid = pid;\r\n\t\t\t\tfeature.layerid = id; //hack required to control layer-specific SelectCluster interaction\r\n\t\t\t\treturn feature;\r\n\t\t\t})\r\n\t\t\tconsole.log(features);\r\n\t\t\tvar source = new Vector({ projection: (projection? projection : 'EPSG:4326'), features: features });\r\n\t\t\tvar layer = undefined;\r\n\t\t\tif(!clustering){\r\n\t\t\t\t//vectorizing without cluster\r\n\t\t\t\tlayer = new VectorLayer({\r\n\t\t\t\t\tid: id, title: title,\r\n\t\t\t\t\tsource: source,\r\n\t\t\t\t\tvisible: true\r\n\t\t\t\t});\r\n\t\t\t\tlayer.pid = pid;\r\n\t\t\t\tlayer.id = id;\r\n\t\t\t\tlayer.showLegendGraphic = true;\r\n\t\t\t\tlayer.setZIndex(this_.layers.overlays[mainOverlayGroup].getLayers().length);\r\n\t\t\t\tthis_.layers.overlays[mainOverlayGroup].getLayers().push(layer);\r\n\t\t\t\tvar layerPointer = new olInteraction.Select({\r\n\t\t\t\t\tcondition: pointerMove,\r\n\t\t\t\t\tlayers: [layer]\r\n\t\t\t\t});\r\n\r\n\t\t\t\tlayerPointer.on('select', function(evt){\r\n\t\t\t\t\tif(evt.selected) if(evt.selected.length>0){\r\n\t\t\t\t\t\tevt.selected.forEach(function(feature){\r\n\t\t\t\t\t\t\tfeature.setStyle(this_.options.find.hoverStyle);\r\n\t\t\t\t\t\t\t$(\"#\"+feature.getId()).addClass(\"hovered\");\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif(evt.deselected) if(evt.deselected.length>0){\r\n\t\t\t\t\t\tevt.deselected.forEach(function(feature){\r\n\t\t\t\t\t\t\tfeature.setStyle(null);\r\n\t\t\t\t\t\t\t$(\"#\"+feature.getId()).removeClass(\"hovered\");\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\tthis_.map.addInteraction(layerPointer);\r\n\t\t\t}else{\r\n\t\t\t\t//vectorizing with cluster approach\r\n\t\t\t\tvar clusterSource = new Cluster({\r\n\t\t\t\t\tdistance : this_.options.map.point_clustering_options.distance,\r\n\t\t\t\t\tsource : source\r\n\t\t\t\t});\r\n\t\t\t\tconsole.log(clusterSource);\r\n\t\t\t\tlayer = new AnimatedCluster({\r\n\t\t\t\t\tid : id,\r\n\t\t\t\t\ttitle : title,\r\n\t\t\t\t\tsource : clusterSource,\r\n\t\t\t\t\tanimationDuration : this_.options.map.point_clustering_options.animationDuration,\r\n\t\t\t\t\tstyle : this_.options.map.point_clustering_options.style\r\n\t\t\t\t});\t\r\n\t\t\t\tlayer.pid = pid;\r\n\t\t\t\tlayer.id = id;\r\n\t\t\t\tlayer.showLegendGraphic = true;\r\n\t\t\t\tlayer.setZIndex(this_.layers.overlays[mainOverlayGroup].getLayers().length);\r\n\t\t\t\tthis_.layers.overlays[mainOverlayGroup].getLayers().push(layer);\r\n\t\t\t\t\r\n\t\t\t\tvar selectCluster = this_.getSelectCluster();\r\n\t\t\t\tif(!selectCluster) this_.configureSelectCluster();\r\n\t\t\t}\r\n\t\t\tdeferred.resolve(layer);\r\n\t\t});\r\n\t\treturn deferred.promise();\r\n\t}\r\n\t\r\n\t/**\r\n\t * getVectorLayerViewTitle\r\n\t * @param {String} pid\r\n\t * @param {String} id\r\n\t * @param {String} title\r\n\t * @param {String} description\r\n\t */\r\n\tgetVectorLayerViewTitle(pid, id, title, description){\r\n\t\tvar this_ = this;\r\n\t\tvar layerTitle = '<button class=\"btn btn-xs dataset-button dataset-button-remove\" data-pid=\"'+pid+'\" data-lyr=\"'+id+'\" title=\"'+this_.options.labels.dataset_remove+'\" onclick=\"'+this_.config.OFV_ID+'.unselectDatasetView(this)\"> X </button>';\r\n\t\tlayerTitle += '<span>'+title+'</span>';\r\n\t\tlayerTitle += '</br>';\r\n\t\tlayerTitle += '<p style=\"font-weight:normal !important;font-size:90%;\"><span class=\"glyphicon glyphicon-pushpin\"></span><b style=\"margin-left:4px;\">'+this_.options.labels.layer+'</b>: '+description+ ' ['+id+']';\r\n\t\treturn layerTitle;\r\n\t}\r\n\t\r\n\t/**\r\n\t * addVectorLayer Adds a vector layer\r\n\t * @param {Integer} mainOverlayGroup\r\n\t * @param {String} pid\r\n\t * @param {String} id\r\n\t * @param {String} title\r\n\t * @param {String} description\r\n\t * @param {Object} data\r\n\t * @param {Object} style\r\n\t * @param {Boolean} clustering\r\n\t * @param {String} projection\r\n\t * @param {ol/format} format\r\n\t */\r\n\taddVectorLayer(mainOverlayGroup, pid, id, title, description, data, style, clustering, projection, format){\r\n\t\tvar this_ = this;\r\n\t\t\r\n\t\tvar layerTitle = this.getVectorLayerViewTitle(pid, id, title, description);\r\n\r\n\t\tif(!data.features){\r\n\t\t\tconsole.error(\"Invalid GeoJSON data for GeoJSON layer = \"+id);\r\n\t\t}\r\n\t\tvar features = data.features.map(function(item){\r\n\t\t\tvar feature = format.readFeature(item,{\r\n\t\t\t\tfeatureProjection: this_.map.getView().getProjection()\r\n\t\t\t});\r\n\t\t\tif(feature.getProperties()[\"gml_id\"]) feature.setId(feature.getProperties()[\"gml_id\"]);\r\n\t\t\tif(feature.getProperties()[\"id\"]) feature.setId(feature.getProperties()[\"id\"]);\r\n\t\t\tfeature.pid = pid;\r\n\t\t\tfeature.layerid = id; //hack required to control layer-specific SelectCluster interaction\r\n\t\t\treturn feature;\r\n\t\t})\r\n\t\tconsole.log(features);\r\n\t\t\r\n\t\tvar source = new Vector({ projection: (projection? projection : 'EPSG:4326'), features: features });\r\n\t\t\r\n\t\tvar feature_style = style? style : this_.options.find.defaultStyle;\r\n\t\t\r\n\t\tvar layer = undefined;\r\n\t\t\r\n\t\tif(!clustering){\r\n\t\t\t//vectorizing without cluster\r\n\t\t\tlayer = new VectorLayer({\r\n\t\t\t\tid: id, title: layerTitle,\r\n\t\t\t\tsource: source,\r\n\t\t\t\tstyle: feature_style,\r\n\t\t\t\tvisible: true\r\n\t\t\t});\r\n\t\t\tlayer.pid = pid;\r\n\t\t\tlayer.id = id;\r\n\t\t\tlayer.showLegendGraphic = true;\r\n\t\t\tlayer.setZIndex(this_.layers.overlays[mainOverlayGroup].getLayers().length);\r\n\t\t\tthis_.layers.overlays[mainOverlayGroup].getLayers().push(layer);\r\n\t\t\t\r\n\t\t\t//Select interactions\r\n\t\t\t//click\r\n\t\t\tvar layerClick = new olInteraction.Select({layers: [layer] });\r\n\t\t\tlayerClick.on('select', function(evt){\r\n\t\t\t\tif(evt.deselected) if(evt.deselected.length>0){\r\n\t\t\t\t\tevt.deselected.forEach(function(feature){\r\n\t\t\t\t\t\tfeature.setStyle(null);\r\n\t\t\t\t\t\t$(\"#\"+feature.getId()).removeClass(\"selected\");\r\n\t\t\t\t\t\t//popup behaviour\r\n\t\t\t\t\t\tvar popup = this_.map.getOverlayById(layer.id);\r\n\t\t\t\t\t\tpopup.hide();\r\n\t\t\t\t\t\tthis_.popup = {};\r\n\t\t\t\t\t\tthis_.options.map.popup.onclose(layer, [evt.element]);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\tif(evt.selected) if(evt.selected.length>0){\r\n\t\t\t\t\tevt.selected.forEach(function(feature){\r\n\t\t\t\t\t\tfeature.setStyle(this_.options.find.selectStyle);\r\n\t\t\t\t\t\t$(\"#\"+feature.getId()).addClass(\"selected\");\r\n\t\t\t\t\t\t//popup behaviour\r\n\t\t\t\t\t\tthis_.getVectorFeatureInfo(layer, feature);\r\n\t\t\t\t\t});\r\n\t\t\t\t\t\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tthis_.map.addInteraction(layerClick);\r\n\t\t}else{\r\n\t\t\t//vectorizing with cluster approach\r\n\t\t\tvar clusterSource = new Cluster({\r\n\t\t\t\tdistance : this_.options.map.point_clustering_options.distance,\r\n\t\t\t\tsource : source\r\n\t\t\t});\r\n\t\t\tconsole.log(clusterSource);\r\n\t\t\tlayer = new AnimatedCluster({\r\n\t\t\t\tid : id,\r\n\t\t\t\ttitle : title,\r\n\t\t\t\tsource : clusterSource,\r\n\t\t\t\tanimationDuration : this_.options.map.point_clustering_options.animationDuration,\r\n\t\t\t\tstyle : this_.options.map.point_clustering_options.style\r\n\t\t\t});\t\t\t\r\n\t\t\tlayer.id = id;\r\n\t\t\tlayer.showLegendGraphic = true;\r\n\t\t\tlayer.setZIndex(this_.layers.overlays[mainOverlayGroup].getLayers().length);\r\n\t\t\tthis_.layers.overlays[mainOverlayGroup].getLayers().push(layer);\r\n\t\t\t\r\n\t\t\tvar selectCluster = this_.getSelectCluster();\r\n\t\t\tif(!selectCluster) this_.configureSelectCluster();\r\n\t\t}\r\n\t\t\r\n\t\tlayer.strategy = null;\r\n\t\tlayer.dsd = null;\r\n\t\tlayer.baseDataUrl = null;\r\n\t\tthis_.addVectorLayerPopup(layer);\r\n\t\tlayer.variable = null;\r\n\t\tlayer.envfun = null;\r\n\t\tlayer.envmaptype = null;\r\n\t\tlayer.envcolscheme = null;\r\n\t\tlayer.count = null;\r\n\t\tlayer.params = null;\r\n\t\tlayer.geom = null;\r\n\t\tlayer.geomtype = null;\r\n\t\tthis_.setLegendGraphic(layer);\r\n\t\t//this_.map.changed();\r\n\t\tthis_.renderMapLegend();\r\n\t\tthis_.showLegendPanel();\r\n\r\n\t}\r\n\t\r\n\t\r\n\t/**\r\n\t * setVectorLayer Adds a vector layer\r\n\t * @param {Integer} mainOverlayGroup\r\n\t * @param {String} pid\r\n\t * @param {String} id\r\n\t * @param {String} title\r\n\t * @param {String} description\r\n\t * @param {Object} data\r\n\t * @param {Object} style\r\n\t * @param {Boolean} clustering\r\n\t * @param {String} projection\r\n\t * @param {ol/format} format\r\n\t */\r\n\tsetVectorLayer(mainOverlayGroup, pid, id, title, description, data, style, clustering, projection, format){\r\n\t\tvar this_ = this;\r\n\t\tvar layer = this_.getLayerByProperty(id, \"id\");\r\n\t\tif(!layer){\r\n\t\t\tthis.addVectorLayer(mainOverlayGroup, pid, id, title, description, data, style, clustering, projection, format);\r\n\t\t}else{\r\n\t\t\t\r\n\t\t\tvar layerTitle = this.getVectorLayerViewTitle(pid, id, title, description);\r\n\t\t\t\r\n\t\t\tif(!data.features){\r\n\t\t\t\tconsole.error(\"Invalid GeoJSON data for GeoJSON layer = \"+id);\r\n\t\t\t}\r\n\t\t\tvar features = data.features.map(function(item){\r\n\t\t\t\tvar feature = format.readFeature(item,{\r\n\t\t\t\t\tfeatureProjection: this_.map.getView().getProjection()\r\n\t\t\t\t});\r\n\t\t\t\tif(feature.getProperties()[\"gml_id\"]) feature.setId(feature.getProperties()[\"gml_id\"]);\r\n\t\t\t\tif(feature.getProperties()[\"id\"]) feature.setId(feature.getProperties()[\"id\"]);\r\n\t\t\t\tfeature.pid = pid;\r\n\t\t\t\tfeature.layerid = id; //hack required to control layer-specific SelectCluster interaction\r\n\t\t\t\treturn feature;\r\n\t\t\t})\r\n\t\t\tconsole.log(features);\r\n\t\t\t\r\n\t\t\tvar source = new Vector({ projection: (projection? projection : 'EPSG:4326'), features: features });\r\n\t\t\r\n\t\t\tvar feature_style = style? style : this_.options.find.defaultStyle;\r\n\t\t\tlayer.setStyle(feature_style);\r\n\t\t\t\r\n\t\t\t//update viewparams, envparams & legend\r\n\t\t\tlayer.setProperties({title: layerTitle});\r\n\t\t\tif(layer.getSource() instanceof Cluster){\r\n\t\t\t\tlayer.getSource().setSource(source);\r\n\t\t\t\tvar selectCluster = this_.getSelectCluster();\r\n\t\t\t\tif(selectCluster) this_.map.removeInteraction(selectCluster);\r\n\t\t\t\tthis_.configureSelectCluster();\r\n\t\t\t}else{\r\n\t\t\t\tlayer.setSource(source);\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tthis_.renderMapLegend();\r\n\t\t\tthis_.showLegendPanel();\r\n\t\t}\r\n\t}\r\n\t\r\n\t\r\n\t/**\r\n\t * addGeoJSONLayer Adds a vector layer\r\n\t * @param {Integer} mainOverlayGroup\r\n\t * @param {String} pid\r\n\t * @param {String} id\r\n\t * @param {String} title\r\n\t * @param {String} description\r\n\t * @param {Object} data\r\n\t * @param {Object} style\r\n\t * @param {Boolean} clustering\r\n\t * @param {String} projection\r\n\t */\r\n\tsetGeoJSONLayer(mainOverlayGroup, pid, id, title, description, data, style, clustering, projection){\r\n\t\tvar format = new olFormat.GeoJSON();\r\n\t\tthis.setVectorLayer(mainOverlayGroup, pid, id, title, description, data, style, clustering, projection, format);\r\n\t}\r\n\t\r\n\t/**\r\n\t * getSelectCluster\r\n\t */\r\n\tgetSelectCluster(){\r\n\t\tvar selectClusters = this.map.getInteractions().getArray().filter(function(item){if(item instanceof SelectCluster) return item;});\r\n\t\tif(selectClusters.length == 0) return null;\r\n\t\treturn selectClusters[0];\r\n\t}\r\n\t\r\n\t/**\r\n\t * configureSelectCluster\r\n\t * @param layer\r\n\t */\r\n\tconfigureSelectCluster(){\r\n\t\tvar this_ = this;\r\n\t\tvar layerPointer = new SelectCluster({\r\n\t\t\tpointRadius : this_.options.map.point_clustering_options.pointRadius,\r\n\t\t\tradiusFactor: this_.options.map.point_clustering_options.radiusFactor,\r\n\t\t\tspiral : this_.options.map.point_clustering_options.spiral,\r\n\t\t\tcircleMaxObjects : this_.options.map.point_clustering_options.circleMaxObjects,\r\n\t\t\tanimate : this_.options.map.point_clustering_options.animate, \r\n\t\t\tfeatureStyle : this_.options.map.point_clustering_options.selectClusterFeatureStyle,\r\n\t\t\tstyle : this_.options.map.point_clustering_options.selectClusterStyle\r\n\t\t});\r\n\t\tthis_.map.addInteraction(layerPointer);\r\n\t\tlayerPointer.getFeatures().on(['add','remove'], function (e){\r\n\t\t\tvar c = e.element.get('features');\r\n\t\t\tif(e.type == \"add\"){\r\n\t\t\t  var layer = this_.getLayerByProperty(c[0].layerid, \"id\");\r\n\t\t\t  if (c.length==1){\r\n\t\t\t\tvar feature = c[0];\r\n\t\t\t\tthis_.getVectorFeatureInfo(layer, feature);\r\n\t\t\t  } else {\r\n\t\t\t\tconsole.log(\"Cluster (\"+c.length+\" features)\");\r\n\t\t\t\tthis_.options.map.popup.onclose(layer, [e.element]);\r\n\t\t\t  }\r\n\t\t\t}else if(e.type == \"remove\"){\r\n\t\t\t\tvar feature = c[0];\r\n\t\t\t\tvar layer = this_.getLayerByProperty(feature.layerid, \"id\");\r\n\t\t\t\tvar popup = this_.map.getOverlayById(layer.id);\r\n\t\t\t\tpopup.hide();\r\n\t\t\t\tthis_.popup = {};\r\n\t\t\t\tthis_.options.map.popup.onclose(layer, [e.element]);\r\n\r\n\t\t\t\t//in case feature markers are highlighted we remove them\r\n\t\t\t\tvar markersId = 'ofv-feature-marker';\r\n\t\t\t\tvar markers = this_.getLayerByProperty(markersId, 'id');\r\n\t\t\t\tif(markers){\r\n\t\t\t\t\tvar source = new Vector({ features: [] });\r\n\t\t\t\t\tmarkers.setSource(source);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t})\r\n\t}\r\n\t\r\n\t/**\r\n\t * getLayerByProperty Util method to get layer by property\r\n\t * @param layerProperty the property value\r\n\t * @param by the property \r\n\t */\r\n\tgetLayerByProperty(layerProperty, by){\r\n\t\tif(!by) byTitle = false;\r\n\t\tvar target = undefined;\r\n\t\tfor(var i=0;i<this.map.getLayerGroup().getLayersArray().length;i++){\r\n\t\t\tvar layer = this.map.getLayerGroup().getLayersArray()[i];\r\n\t\t\tvar condition  = by? (layer[by] === layerProperty) : (layer.getSource().getParams()[\"LAYERS\"] === layerProperty);\r\n\t\t\tif(condition){\r\n\t\t\t\ttarget = this.map.getLayerGroup().getLayersArray()[i];\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn target;\r\n\t}\r\n\t\r\n\t//===========================================================================================\r\n\t//URL resolvers\r\n\t//===========================================================================================\r\n\r\n\t/**\r\n\t * resolveDatasetForQuery\r\n\t * @param {Object} datasetDef\r\n\t * @param {Boolean} resolveMap\r\n\t */\r\n\tresolveDatasetForQuery(datasetDef, resolveMap){\r\n\t\tvar this_ = this;\r\n\t\tconsole.log(\"Fetching query interface for pid = '\"+datasetDef.pid+\"'\");\r\n\t\tif(datasetDef.query) this_.openAccessDialog();\r\n\t\tthis_.handleQueryForm(datasetDef, !datasetDef.query).then(function(dataset){\t\t\t\t\t\r\n\r\n\t\t\tdatasetDef.dsd = dataset.dsd;\r\n\t\t\tif(datasetDef.query){\r\n\t\t\t\t\r\n\t\t\t\t//Layer\r\n\t\t\t\t$(\"#ui-ogc_layer\").val(datasetDef.lyr).trigger('change');\r\n\t\t\t\t\r\n\t\t\t\t//Filters\r\n\t\t\t\tswitch(datasetDef.strategy){\r\n\t\t\t\t\tcase \"ogc_filters\":\r\n\t\t\t\t\t\tconsole.log(\"Resolve query for dataset '\"+datasetDef.pid+\"' using 'ogc_filters' strategy\");\r\n\t\t\t\t\t\tif(datasetDef.queryparams) for(var i=0;i<datasetDef.queryparams.length;i++){\r\n\t\t\t\t\t\t\tvar key = Object.keys(datasetDef.queryparams[i])[0];\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t//controller over type \"list\" or \"range\"\r\n\t\t\t\t\t\t\tvar clazz = $(\"#dsd-ui-dimension-attribute-\"+key).attr('class');\r\n\t\t\t\t\t\t\tif(clazz){\r\n\t\t\t\t\t\t\t\tvar widget = null;\r\n\t\t\t\t\t\t\t\tif(clazz.indexOf(\"select2\")>0) widget = \"select2\";\r\n\t\t\t\t\t\t\t\tif(clazz.indexOf(\"slider\")>0) widget = \"slider\";\r\n\t\t\t\t\t\t\t\tswitch(widget){\r\n\t\t\t\t\t\t\t\t\tcase \"select2\": datasetDef.queryparams[i][key].type = \"list\"; break;\r\n\t\t\t\t\t\t\t\t\tcase \"slider\":  datasetDef.queryparams[i][key].type = \"range\"; break;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tvar queryparam = datasetDef.queryparams[i];\r\n\t\t\t\t\t\t\tvar component = queryparam[key];\r\n\t\t\t\t\t\t\tvar values = component.content;\r\n\t\t\t\t\t\t\tvalues = values.map(function(item){\r\n\t\t\t\t\t\t\t\tif(item.startsWith(\"'\") && item.endsWith(\"'\")){\r\n\t\t\t\t\t\t\t\t\titem = item.substr(1,item.length-2);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\titem = item.replace(\"''\", \"'\") //need to replace double single quote (in case of cql filter strings containing single quote)\r\n\t\t\t\t\t\t\t\treturn item;\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t//fill values depending on component type\r\n\t\t\t\t\t\t\tif(component.type == \"list\"){\r\n\t\t\t\t\t\t\t\t$(\"#dsd-ui-dimension-attribute-\"+key).val(values).trigger('change');\r\n\t\t\t\t\t\t\t}else if(component.type == \"range\"){\r\n\t\t\t\t\t\t\t\tvar slide = $(\"#dsd-ui-dimension-attribute-\"+key+\"-slider\");\r\n\t\t\t\t\t\t\t\tvalues = values.map(function(item){return parseInt(item)});\r\n\t\t\t\t\t\t\t\tif(values.length > 1){\r\n\t\t\t\t\t\t\t\t\tvar min = Math.min.apply(Math, values);\r\n\t\t\t\t\t\t\t\t\tvar max = Math.max.apply(Math, values);\r\n\t\t\t\t\t\t\t\t\tslide.data('bootstrapSlider').setValue([min, max]);\r\n\t\t\t\t\t\t\t\t\tslide.bootstrapSlider().trigger({type: 'slide', value: [min, max]});\r\n\t\t\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\t\t\tslide.data('bootstrapSlider').setValue(values[0]);\r\n\t\t\t\t\t\t\t\t\tslide.bootstrapSlider().trigger({type: 'slide', value: values[0]});\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}else if(component.type == \"timeinstant\"){\r\n\t\t\t\t\t\t\t\t$(\"#dsd-ui-dimension-time-start-\"+key).val(component.content[0].replace(\"T\", \" \")).trigger('change');\r\n\t\t\t\t\t\t\t}else if(component.type == \"timeperiod\"){\r\n\t\t\t\t\t\t\t\t$(\"#dsd-ui-dimension-time-start-\"+key).val(component.content[0].replace(\"T\", \" \")).trigger('change');\r\n\t\t\t\t\t\t\t\t$(\"#dsd-ui-dimension-time-end-\"+key).val(component.content[1].replace(\"T\",\" \")).trigger('change');\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t//variable\r\n\t\t\t\t\t\t$(\"#dsd-ui-dimension-variable\").val(datasetDef.variable).trigger('change');\r\n\t\t\t\t\t\t//map options\r\n\t\t\t\t\t\tvar envfun = datasetDef.envfun;\r\n\t\t\t\t\t\tif(envfun) $(\"#map-classtype-selector\").val(envfun).trigger('change');\r\n\t\t\t\t\t\tvar envmaptype = datasetDef.envmaptype;\r\n\t\t\t\t\t\tif(envmaptype) $(\"#map-type-selector\").val(envmaptype).trigger('change'); \r\n\t\t\t\t\t\tif(datasetDef.breaks){\r\n\t\t\t\t\t\t\tvar classnb = String(datasetDef.breaks.length-1);\r\n\t\t\t\t\t\t\tif( $(\"#map-classnb-selector\").find('option').map(function() { return $(this).val(); }).get().indexOf(classnb) == -1) classnb = 5;\r\n\t\t\t\t\t\t\t$(\"#map-classnb-selector\").val(classnb).trigger('change');\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tvar envcolscheme = datasetDef.envcolscheme;\r\n\t\t\t\t\t\tif(envcolscheme) $(\"#map-colorscheme-selector\").val(envcolscheme).trigger('change');\r\n\t\t\t\t\t\tvar style = datasetDef.style;\r\n\t\t\t\t\t\tif(style) if($(\"#map-style-selector\").length > 0){\r\n\t\t\t\t\t\t\t$(\"#map-style-selector\").val(style).trigger('change');\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\r\n\t\t\t\t\tcase \"ogc_dimensions\":\r\n\t\t\t\t\t\tconsole.log(\"Resolve query for dataset '\"+datasetDef.pid+\"' using 'ogc_dimensions' strategy\");\r\n\t\t\t\t\t\tif(datasetDef.queryparams){\r\n\t\t\t\t\t\t\t//var timeparams = new Array();\r\n\t\t\t\t\t\t\tfor(var i=0;i<datasetDef.queryparams.length;i++){\r\n\t\t\t\t\t\t\t\tvar key = Object.keys(datasetDef.queryparams[i])[0];\r\n\t\t\t\t\t\t\t\tvar clazz = $(\"#dsd-ui-dimension-attribute-\"+key).attr('class');\r\n\t\t\t\t\t\t\t\tif(clazz){\r\n\t\t\t\t\t\t\t\t\tvar widget = null;\r\n\t\t\t\t\t\t\t\t\tif(clazz.indexOf(\"select2\")>0) widget = \"select2\";\r\n\t\t\t\t\t\t\t\t\tif(clazz.indexOf(\"slider\")>0) widget = \"slider\";\r\n\t\t\t\t\t\t\t\t\tswitch(widget){\r\n\t\t\t\t\t\t\t\t\t\tcase \"select2\": datasetDef.queryparams[i][key].type = \"list\"; break;\r\n\t\t\t\t\t\t\t\t\t\tcase \"slider\":  datasetDef.queryparams[i][key].type = \"range\"; break;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tvar queryparam = datasetDef.queryparams[i];\r\n\t\t\t\t\t\t\t\tvar component = queryparam[key];\r\n\t\t\t\t\t\t\t\tvar values = component.content;\r\n\t\t\t\t\t\t\t\tif(component.type == \"list\"){\r\n\t\t\t\t\t\t\t\t\t$(\"#dsd-ui-dimension-attribute-\"+key).val(values).trigger('change');\r\n\t\t\t\t\t\t\t\t}else if(component.type==\"range\"){\r\n\t\t\t\t\t\t\t\t\tvar slide = $(\"#dsd-ui-dimension-attribute-\"+key+\"-slider\");\r\n\t\t\t\t\t\t\t\t\tif(values.length > 1){\r\n\t\t\t\t\t\t\t\t\t\tvar min = (key == 'TIME')? new Date(values[0]).getTime()/1000 : Math.min.apply(Math, values);\r\n\t\t\t\t\t\t\t\t\t\tvar max = (key == 'TIME')? new Date(values[values.length-1]).getTime()/1000 : Math.max.apply(Math, values);\r\n\t\t\t\t\t\t\t\t\t\tslide.data('bootstrapSlider').setValue([min,max]);\r\n\t\t\t\t\t\t\t\t\t\tslide.bootstrapSlider().trigger({type: 'slide', value: [min,max]});\r\n\t\t\t\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\t\t\t\tvar value = (key == 'TIME')? new Date(values[0]).getTime()/1000 : values[0];\r\n\t\t\t\t\t\t\t\t\t\tconsole.log(key);\r\n\t\t\t\t\t\t\t\t\t\tconsole.log(values[0]);\r\n\t\t\t\t\t\t\t\t\t\tconsole.log(value);\r\n\t\t\t\t\t\t\t\t\t\tconsole.log(slide);\r\n\t\t\t\t\t\t\t\t\t\tslide.data('bootstrapSlider').setValue(value);\r\n\t\t\t\t\t\t\t\t\t\tslide.bootstrapSlider().trigger({type: 'slide', value: value});\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}else if(component.type==\"timeinstant\"){\r\n\t\t\t\t\t\t\t\t\t$(\"#dsd-ui-dimension-time-start-\"+key).val(component.content[0]).trigger('change');\r\n\t\t\t\t\t\t\t\t}else if(component.type == \"timeperiod\"){\r\n\t\t\t\t\t\t\t\t\t$(\"#dsd-ui-dimension-time-start-\"+key).val(component.content[0].replace(\"T\", \" \")).trigger('change');\r\n\t\t\t\t\t\t\t\t\t$(\"#dsd-ui-dimension-time-end-\"+key).val(component.content[1].replace(\"T\",\" \")).trigger('change');\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t//variable\r\n\t\t\t\t\t\t$(\"#dsd-ui-dimension-variable\").val(datasetDef.variable).trigger('change');\r\n\t\t\t\t\t\t//map options\r\n\t\t\t\t\t\tvar envfun = datasetDef.envfun;\r\n\t\t\t\t\t\tif(envfun) $(\"#map-classtype-selector\").val(envfun).trigger('change');\r\n\t\t\t\t\t\tvar envmaptype = datasetDef.envmaptype;\r\n\t\t\t\t\t\tif(envmaptype) $(\"#map-type-selector\").val(envmaptype).trigger('change'); \r\n\t\t\t\t\t\tif(datasetDef.breaks){\r\n\t\t\t\t\t\t\tvar classnb = String(datasetDef.breaks.length-1);\r\n\t\t\t\t\t\t\tif( $(\"#map-classnb-selector\").find('option').map(function() { return $(this).val(); }).get().indexOf(classnb) == -1) classnb = 5;\r\n\t\t\t\t\t\t\t$(\"#map-classnb-selector\").val(classnb).trigger('change');\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tvar envcolscheme = datasetDef.envcolscheme;\r\n\t\t\t\t\t\tif(envcolscheme) $(\"#map-colorscheme-selector\").val(envcolscheme).trigger('change');\r\n\t\t\t\t\t\tvar style = datasetDef.style;\r\n\t\t\t\t\t\tif(style) if($(\"#map-style-selector\").length > 0){\r\n\t\t\t\t\t\t\t$(\"#map-style-selector\").val(style).trigger('change');\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"ogc_viewparams\":\r\n\t\t\t\t\t\tconsole.log(\"Resolve query for dataset '\"+datasetDef.pid+\"' using 'ogc_viewparams' strategy\");\r\n\t\t\t\t\t\tif(datasetDef.queryparams){\r\n\t\t\t\t\t\t\t//var timeparams = new Array();\r\n\t\t\t\t\t\t\tfor(var i=0;i<datasetDef.queryparams.length;i++){\r\n\t\t\t\t\t\t\t\tvar key = Object.keys(datasetDef.queryparams[i])[0];\r\n\t\t\t\t\t\t\t\tvar clazz = $(\"#dsd-ui-dimension-attribute-\"+key).attr('class');\r\n\t\t\t\t\t\t\t\tif(clazz){\r\n\t\t\t\t\t\t\t\t\tvar widget = null;\r\n\t\t\t\t\t\t\t\t\tif(clazz.indexOf(\"select2\")>0) widget = \"select2\";\r\n\t\t\t\t\t\t\t\t\tif(clazz.indexOf(\"slider\")>0) widget = \"slider\";\r\n\t\t\t\t\t\t\t\t\tswitch(widget){\r\n\t\t\t\t\t\t\t\t\t\tcase \"select2\": datasetDef.queryparams[i][key].type = \"list\"; break;\r\n\t\t\t\t\t\t\t\t\t\tcase \"slider\":  datasetDef.queryparams[i][key].type = \"range\"; break;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tvar queryparam = datasetDef.queryparams[i];\r\n\t\t\t\t\t\t\t\tvar component = queryparam[key];\r\n\t\t\t\t\t\t\t\tvar values = component.content;\r\n\t\t\t\t\t\t\t\tif(component.type == \"list\"){\r\n\t\t\t\t\t\t\t\t\t$(\"#dsd-ui-dimension-attribute-\"+key).val(values).trigger('change');\r\n\t\t\t\t\t\t\t\t}else if(component.type==\"range\"){\r\n\t\t\t\t\t\t\t\t\tvar slide = $(\"#dsd-ui-dimension-attribute-\"+key+\"-slider\");\r\n\t\t\t\t\t\t\t\t\tvalues = values.map(function(item){return parseInt(item)});\r\n\t\t\t\t\t\t\t\t\tif(values.length > 1){\r\n\t\t\t\t\t\t\t\t\t\tvar min = Math.min.apply(Math, values);\r\n\t\t\t\t\t\t\t\t\t\tvar max = Math.max.apply(Math, values);\r\n\t\t\t\t\t\t\t\t\t\tslide.data('bootstrapSlider').setValue([min,max]);\r\n\t\t\t\t\t\t\t\t\t\tslide.bootstrapSlider().trigger({type: 'slide', value: [min,max]});\r\n\t\t\t\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\t\t\t\tslide.data('bootstrapSlider').setValue(values[0]);\r\n\t\t\t\t\t\t\t\t\t\tslide.bootstrapSlider().trigger({type: 'slide', value: values[0]});\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}else if(component.type==\"timeinstant\"){\r\n\t\t\t\t\t\t\t\t\t$(\"#dsd-ui-dimension-time-start-\"+key).val(component.content[0]).trigger('change');\r\n\t\t\t\t\t\t\t\t}else if(component.type == \"timeperiod\"){\r\n\t\t\t\t\t\t\t\t\t$(\"#dsd-ui-dimension-time-start-\"+key).val(component.content[0].replace(\"T\", \" \")).trigger('change');\r\n\t\t\t\t\t\t\t\t\t$(\"#dsd-ui-dimension-time-end-\"+key).val(component.content[1].replace(\"T\",\" \")).trigger('change');\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t//variable\r\n\t\t\t\t\t\t$(\"#dsd-ui-dimension-variable\").val(datasetDef.variable).trigger('change');\r\n\t\t\t\t\t\t//map options\r\n\t\t\t\t\t\tvar envfun = datasetDef.envfun;\r\n\t\t\t\t\t\tif(envfun) $(\"#map-classtype-selector\").val(envfun).trigger('change');\r\n\t\t\t\t\t\tvar envmaptype = datasetDef.envmaptype;\r\n\t\t\t\t\t\tif(envmaptype) $(\"#map-type-selector\").val(envmaptype).trigger('change'); \r\n\t\t\t\t\t\tif(datasetDef.breaks){\r\n\t\t\t\t\t\t\tvar classnb = String(datasetDef.breaks.length-1);\r\n\t\t\t\t\t\t\tif( $(\"#map-classnb-selector\").find('option').map(function() { return $(this).val(); }).get().indexOf(classnb) == -1) classnb = 5;\r\n\t\t\t\t\t\t\t$(\"#map-classnb-selector\").val(classnb).trigger('change');\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tvar envcolscheme = datasetDef.envcolscheme;\r\n\t\t\t\t\t\tif(envcolscheme) $(\"#map-colorscheme-selector\").val(envcolscheme).trigger('change'); \r\n\t\t\t\t\t\tvar style = datasetDef.style;\r\n\t\t\t\t\t\tif(style) if($(\"#map-style-selector\").length > 0){\r\n\t\t\t\t\t\t\t$(\"#map-style-selector\").val(style).trigger('change');\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t//update\r\n\t\t\tdatasetDef.title = this_.getDatasetViewTitle(datasetDef, datasetDef.queryparams, false);\r\n\t\t\t\r\n\t\t\t//resolve map\r\n\t\t\tif(resolveMap) this_.resolveDatasetForMap(datasetDef);\r\n\t\t\t\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * resolveDatasetForMap\r\n\t * @param {Object} dataset\r\n\t */\r\n\tresolveDatasetForMap(dataset){\r\n\t\tconsole.log(\"Resolving map for pid = '\"+dataset.pid+\"'\");\r\n\t\tconsole.log(dataset);\r\n\t\tthis.mapDatasetView(dataset, false);\t\t\r\n\t}\r\n\r\n\t/**\r\n\t * resolveViewer\r\n\t * Resolves the map viewer from URL parameters\r\n\t */\r\n\tresolveViewer(){\r\n\t\tvar this_ = this;\r\n\t\t\r\n\t\t//url params\r\n\t\tvar params = this_.getAllUrlParams();\r\n\t\tconsole.log(params);\r\n\t\t\r\n\t\t//mode\r\n\t\tif(params.mode){\r\n\t\t\tif(params.mode != this.options.map.mode){\r\n\t\t\t\tthis.switchMapView();\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\t//baseview\r\n\t\tif(params.baseview){\r\n\t\t\tvar baseviews = this_.map.getLayers().getArray()[0].getLayersArray();\r\n\t\t\tfor(var i=0;i<baseviews.length;i++){\r\n\t\t\t\tif(baseviews[i].get('title') == decodeURIComponent(params.baseview)){\r\n\t\t\t\t\tbaseviews[i].setVisible(true);\r\n\t\t\t\t}else{\r\n\t\t\t\t\tbaseviews[i].setVisible(false);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t//dynamic parameters\r\n\t\t//embedded link feature 'dataset' decoding\r\n\t\tif(params.dataset && !params.views){\r\n\t\t\tvar datasetDef = {pid: params.dataset};\r\n\t\t\tthis_.getCSWRecord(datasetDef.pid).then(function(md_entry){\r\n\t\t\t\tconsole.log(\"we should add the dataset to the selection here\");\r\n\t\t\t\tconsole.log(md_entry);\r\n\t\t\t\tdatasetDef.entry = md_entry;\r\n\t\t\t\tdatasetDef.dsd = md_entry.dsd;\r\n\t\t\t\tdatasetDef.query = true;\r\n\t\t\t\t\r\n\t\t\t\tdatasetDef.strategy = this_.getStrategy(datasetDef);\r\n\t\t\t\tif(this_.selection.map(function(i){return i.pid}).indexOf(pid) == -1){ this_.selection.push(datasetDef.entry);};\r\n\t\t\t\tthis_.resolveDatasetForQuery(datasetDef, false);\t\t\r\n\t\t\t\t\r\n\t\t\t});\r\n\t\t}\r\n\t\t\t\r\n\t\t//embedded link feature 'views'\r\n\t\tif(params.views){\r\n\t\t\tvar encoded_views = JSON.parse(decodeURIComponent(params.views));\r\n\t\t\tconsole.log(encoded_views);\r\n\t\t\tvar encoded_datasets = new Array();\r\n\t\t\tfor(var i=0;i<encoded_views.length;i++){\r\n\t\t\t\tvar encoded_view = encoded_views[i];\r\n\t\t\t\tvar encoded_view_settings = encoded_view.split(/(?!<(?:\\(|\\[)[^)\\]]+),(?![^(\\[]+(?:\\)|\\]))/g).map(function(item){var elems = item.split(\"=\"); var out = new Object(); out[elems[0]] = elems[1]; return out});\r\n\t\t\t\tvar encoded_view_obj = new Object();\r\n\t\t\t\tfor(var j=0;j<encoded_view_settings.length;j++){\r\n\t\t\t\t\tvar setting = encoded_view_settings[j];\r\n\t\t\t\t\tvar setting_key = Object.keys(setting)[0];\r\n\t\t\t\t\tencoded_view_obj[setting_key] = setting[setting_key] != \"undefined\"? setting[setting_key] :  null;\r\n\t\t\t\t}\r\n\t\t\t\tvar pid = encoded_view_obj.pid;\r\n\t\t\t\tvar lyr = encoded_view_obj.lyr;\r\n\t\t\t\tvar strategy = encoded_view_obj.strategy;\r\n\t\t\t\tvar queryparams = encoded_view_obj.par;\r\n\t\t\t\tconsole.log(encoded_view_obj);\r\n\t\t\t\tconsole.log(\"Strategy = \"+strategy);\r\n\t\t\t\tconsole.log(\"Query params = \"+queryparams);\r\n\t\t\t\tif(queryparams){\r\n\t\t\t\t\tswitch(strategy){\r\n\t\t\t\t\t\tcase \"ogc_filters\":\r\n\t\t\t\t\t\t\tqueryparams = queryparams.split(\") AND (\").map(function(item){\r\n\t\t\t\t\t\t\t\tvar out = null;\r\n\t\t\t\t\t\t\t\tif(item.startsWith('(') && item.endsWith(')')) item = item.substr(1, item.length-2);\r\n\t\t\t\t\t\t\t\tif(item.indexOf('IN(') > 0){\r\n\t\t\t\t\t\t\t\t\tvar elems = item.split(\" IN(\");\r\n\t\t\t\t\t\t\t\t\tvar attribute = elems[0];\r\n\t\t\t\t\t\t\t\t\tvar values = elems[1].split(\")\")[0].split(/(?!'),(?![^'])/g);\r\n\t\t\t\t\t\t\t\t\tif(values.length=1) values = values[0].split(\",\");\r\n\t\t\t\t\t\t\t\t\tvalues = values.map(function(item){return item}); //replace double single quote for cql filter text with single quote\r\n\t\t\t\t\t\t\t\t\tvalues = values.map(function(item){return decodeURIComponent(item)});\r\n\t\t\t\t\t\t\t\t\tout = new Object();\r\n\t\t\t\t\t\t\t\t\tout[attribute] = {\r\n\t\t\t\t\t\t\t\t\t\ttype: \"list\", \r\n\t\t\t\t\t\t\t\t\t\tcontent: values\r\n\t\t\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t\t\t}else if(item.indexOf('BEFORE')>0 && item.indexOf('AFTER')){\r\n\t\t\t\t\t\t\t\t\tvar elems = item.split(\" AND \");\r\n\t\t\t\t\t\t\t\t\tvar time_filter_start = elems[0].split(\" AFTER \");\r\n\t\t\t\t\t\t\t\t\tvar time_filter_end = elems[1].split(\" BEFORE \");\r\n\t\t\t\t\t\t\t\t\tvar attribute = time_filter_start[0];\r\n\t\t\t\t\t\t\t\t\tvar values = [time_filter_start[1], time_filter_end[1]];\r\n\t\t\t\t\t\t\t\t\tout = new Object();\r\n\t\t\t\t\t\t\t\t\tout[attribute] = {\r\n\t\t\t\t\t\t\t\t\t\ttype: \"timeperiod\",\r\n\t\t\t\t\t\t\t\t\t\tcontent: values\r\n\t\t\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\treturn out;\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\tif(queryparams.length == 1 && queryparams[0] == null) queryparams = new Array();\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase \"ogc_dimensions\": \r\n\t\t\t\t\t\t\tqueryparams = queryparams.split(\";\").map(function(item){\r\n\t\t\t\t\t\t\t\tvar dimension = item.split(\":\")[0]; \r\n\t\t\t\t\t\t\t\tvar values = [decodeURIComponent(item.split(dimension+\":\")[1])];\r\n\t\t\t\t\t\t\t\tvar out = new Object(); \r\n\t\t\t\t\t\t\t\tout[dimension] = {\r\n\t\t\t\t\t\t\t\t\ttype: ( (!isNaN(Date.parse(values[0])) & values[0].length >= 10)? \"range\" : \"list\"), //list by default for arrays then resolved to 'slider' eventually with UI\r\n\t\t\t\t\t\t\t\t\tcontent: values\r\n\t\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t\t\treturn out;\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\tconsole.log(queryparams);\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase \"ogc_viewparams\": \r\n\t\t\t\t\t\t\tqueryparams = queryparams.split(\";\").map(function(item){\r\n\t\t\t\t\t\t\t\tvar elems = item.split(\":\"); \r\n\t\t\t\t\t\t\t\tvar attribute = elems[0];\r\n\t\t\t\t\t\t\t\tvar values = elems[1].split('+');\r\n\t\t\t\t\t\t\t\tvalues = values.map(function(item){return decodeURIComponent(item)});\r\n\t\t\t\t\t\t\t\tvar out = new Object(); \r\n\t\t\t\t\t\t\t\tout[attribute] = {\r\n\t\t\t\t\t\t\t\t\ttype: ( (!isNaN(Date.parse(values[0])) & values[0].length >= 10)? \"timeinstant\" : \"list\"), //list by default for arrays then resolved to 'slider' eventually with UI\r\n\t\t\t\t\t\t\t\t\tcontent: values\r\n\t\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t\t\treturn out;\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\t\r\n\t\t\t\tconsole.log(encoded_view_obj);\r\n\t\t\t\tvar variable = encoded_view_obj[\"var\"];\r\n\t\t\t\tvar envfun = encoded_view_obj.fun;\r\n\t\t\t\tvar envmaptype = encoded_view_obj.maptype;\r\n\t\t\t\tvar envparams = encoded_view_obj.env;\r\n\t\t\t\tvar envcolscheme = encoded_view_obj.cs;\r\n\t\t\t\tvar count = encoded_view_obj.count;\r\n\t\t\t\tvar style = encoded_view_obj.style;\t\r\n\t\t\t\tvar query = encoded_view_obj.q == \"true\";\r\n\t\t\t\tvar breaks = undefined;\r\n\t\t\t\tif(envparams){\r\n\t\t\t\t\tbreaks = envparams.split(\";\"); breaks.splice(-1,1); breaks.splice(0,2);\r\n\t\t\t\t\tbreaks = breaks.map(function(key){return parseFloat(key.split(\":\")[1])});\r\n\t\t\t\t}\r\n\t\t\t\tvar pt = \"false\";\r\n\t\t\t\tif(encoded_view_obj.geomtype) if(encoded_view_obj.geomtype == \"gml:PointPropertyType\") pt = \"true\";\r\n\t\t\t\tencoded_datasets.push({\r\n\t\t\t\t\tpid: pid, lyr : lyr, strategy: strategy, queryparams : queryparams, \r\n\t\t\t\t\tvariable: variable, envfun: envfun, envmaptype: envmaptype, envparams: envparams, envcolscheme: envcolscheme, \r\n\t\t\t\t\tcount : count, breaks: breaks, style: style, query: query, \r\n\t\t\t\t\tthematicmapping: (variable? true : false),\r\n\t\t\t\t\tpoint_vectorizing: this_.options.map.point_vectorizing && pt,\r\n\t\t\t\t\tpoint_clustering: this_.options.map.point_vectorizing && this_.options.map.point_clustering && pt\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tvar metadata_promises = new Array();\r\n\t\t\tconsole.log(encoded_datasets);\r\n\t\t\tfor(var i=0;i<encoded_datasets.length;i++){\r\n\t\t\t\tmetadata_promises.push( this_.getCSWRecord(encoded_datasets[i].pid) );\r\n\t\t\t}\r\n\t\t\tconsole.log(encoded_datasets);\r\n\t\t\tconsole.log(\"Sending \"+metadata_promises.length+\" metadata record request(s)...\");\r\n\t\t\tmetadata_promises.forEach(function(promise, i){\r\n\t\t\t\t$.when(promise).then(function(md_entry) {\r\n\t\t\t\t\tvar encoded_dataset = encoded_datasets[i];\r\n\t\t\t\t\tencoded_dataset.entry = md_entry;\r\n\t\t\t\t\tif(!encoded_dataset.lyr) encoded_dataset.lyr = encoded_dataset.entry.wms[0].name; //set for backward-compatibility in case no lyr in url\r\n\t\t\t\t\t//encoded_dataset.title = this_.getDatasetViewTitle(encoded_dataset, encoded_dataset.queryparams, false);\r\n\t\t\t\t\tencoded_dataset.dsd = encoded_dataset.entry.dsd;\r\n\t\t\t\t\tconsole.log(encoded_dataset);\r\n\t\t\t\t\tthis_.selection.push(encoded_dataset);\t\r\n\t\t\t\t\t\r\n\t\t\t\t\t\r\n\t\t\t\t\t//if it was the last dataset queried by user we fill the query interface with param values\r\n\t\t\t\t\t//otherwise DSD (if existing) will be fetched but no html markup will be managed\r\n\t\t\t\t\tthis_.resolveDatasetForQuery(encoded_dataset, true);\r\n\t\t\t\t\t/*if(encoded_dataset.query){\r\n\t\t\t\t\t\tthis_.resolveDatasetForQuery(encoded_dataset, true);\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\tthis_.resolveDatasetForMap(encoded_dataset);\t\r\n\t\t\t\t\t}*/\r\n\r\n\t\t\t\t\t//popup coords\r\n\t\t\t\t\tif(params.popup_id) if(params.popup_id == encoded_dataset.pid) {\r\n\t\t\t\t\t\tif(params.popup_coords){\r\n\t\t\t\t\t\t\ttriggerPopup = function(){\r\n\t\t\t\t\t\t\t\tvar layer = this_.getLayerByProperty(encoded_dataset.pid, \"id\");\r\n\t\t\t\t\t\t\t\tvar coords = params.popup_coords.split(\",\").map(function(coord,i){return parseFloat(coord)});\r\n\t\t\t\t\t\t\t\tthis_.getFeatureInfos([layer.id], coords);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\twindow.setTimeout(triggerPopup, 1000); //TO TEST, IF LAYER IS LOW TO RENDER THIS FAILS\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tthis_.map.changed();\r\n\t\t\t\t\tthis_.showLegendPanel();\r\n\t\t\t\t\tthis_.renderMapLegend();\r\n\t\t\t\t});\r\n\t\t\t});\r\n\r\n\t\t}\r\n\t\t\r\n\t\t//extent, center, zoom\r\n\t\tif(params.extent){\r\n\t\t\tvar extent = params.extent.split(\",\")\r\n\t\t\tfor (var i=0; i<extent.length; i++) { extent[i] = parseFloat(extent[i]); }\r\n\t\t\tthis.map.getView().fit(extent, this.map.getSize());\r\n\t\t}\r\n\t\tif(params.center){\r\n\t\t\tvar center = params.center.split(\",\");\r\n\t\t\tcenter[0] = parseFloat(center[0]);\r\n\t\t\tcenter[1] = parseFloat(center[1]);\r\n\t\t\tthis.map.getView().setCenter(center);\r\n\t\t}\r\n\t\tif(params.zoom) this.map.getView().setZoom(parseInt(params.zoom));\r\n\t\t\r\n\t}\r\n\t\r\n\t/**\r\n\t * enableMessageListener\r\n\t */\r\n\tenableMessageListener(){\r\n\t\t//testing messaging between children (Shiny popups) and parent (OFV)\r\n\t\t// Create IE + others compatible event handler\r\n\t\tvar eventMethod = window.addEventListener ? \"addEventListener\" : \"attachEvent\";\r\n\t\tvar eventer = window[eventMethod];\r\n\t\tvar messageEvent = eventMethod == \"attachEvent\" ? \"onmessage\" : \"message\";\r\n\r\n\t\t// Listen to message from child window\r\n\t\teventer(messageEvent,function(e) {\r\n\t\t  console.log('parent received message! = ', e.data);\r\n\t\t  eval(e.data);\r\n\t\t},false);\r\n\t}\r\n\t\r\n\t//===========================================================================================\r\n\t//Widgets UIs\r\n\t//===========================================================================================\r\n    \r\n\t/**\r\n     * initDialog Init dialoginitDialog\r\n\t */\r\n\tinitDialog(id, title, classes, position, liIdx, onopen, onclose, draggable, resizable){\r\n\t\t\r\n\t\tvar is_draggable = draggable? draggable : false;\r\n\t\tvar is_resizable = resizable? resizable : false;\r\n\t\t\r\n\t\tvar this_ = this;\r\n\t\tif(!classes){\r\n\t\t\tclasses  = {\r\n\t\t\t  \"ui-dialog\": \"ui-corner-all\",\r\n\t\t\t  \"ui-dialog-titlebar\": \"ui-corner-all\",\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(!position){\r\n\t\t\tposition = { my: \"center\", at: \"top\", of: window };\r\n\t\t}\r\n\t\t$( \"#\" + id ).dialog({\r\n\t\t\twidth: ((id=='accessDialog')? ((this_.options.access.columns * 400)+'px') : undefined),\r\n\t\t\tautoOpen: false,\r\n\t\t\tdraggable: is_draggable,\r\n\t\t\tresizable: is_resizable,\r\n\t\t\ttitle: title,\r\n\t\t\tclasses: classes,\r\n\t\t\tposition: position,\r\n\t\t\tshow: {\r\n\t\t\t\teffect: \"fade\",\r\n\t\t\t\tduration: 300\r\n\t\t\t},\r\n\t\t\thide: {\r\n\t\t\t\teffect: \"fade\",\r\n\t\t\t\tduration: 300\r\n\t\t\t},\r\n\t\t\topen: function( event, ui ) {\r\n\t\t\t\t$($(\"nav li\")[liIdx]).addClass(\"active\");\r\n\t\t\t\tif(onopen) onopen();\r\n\t\t\t},\r\n\t\t\tclose: function( event, ui ) {\r\n\t\t\t\t$($(\"nav li\")[liIdx]).removeClass(\"active\");\r\n\t\t\t\tif(onclose) onclose();\r\n\t\t\t}\r\n\t\t});\r\n    }\r\n   \r\n\t/**\r\n\t * openDialog Open dialog\r\n\t */\r\n\topenDialog(id){\r\n\t\tif(!$(\"#\" + id).dialog(\"isOpen\")){\r\n\t\t\t$(\"#\" + id).dialog(\"open\");\r\n\t\t}\r\n\t}\r\n   \r\n\t/**\r\n\t * closeDialog Close dialog\r\n\t */\r\n\tcloseDialog(id){\r\n\t\tif($(\"#\" + id).dialog(\"isOpen\")){\r\n\t\t\t$(\"#\" + id).dialog(\"close\");\r\n\t\t}\r\n\t}\r\n\t\r\n\t/**\r\n\t * openAboutDialog Open 'About' dialog\r\n\t */\r\n\topenAboutDialog(){\r\n\t\tthis.closeFindDialog();\r\n\t\tthis.closeAccessDialog();\r\n\t\tthis.openDialog(\"aboutDialog\");\r\n\t}\r\n\t\r\n\t/**\r\n\t * closeAboutDialog Close 'About' dialog\r\n\t */\r\n\tcloseAboutDialog(){\r\n\t\tthis.closeDialog(\"aboutDialog\");\r\n\t}\r\n   \r\n    \t/**\r\n\t * openFindDialog Open 'Data' dialog\r\n\t */\r\n\topenFindDialog(){\r\n\t\tthis.closeAboutDialog();\r\n\t\tthis.closeAccessDialog();\r\n\t\tthis.openDialog(\"findDialog\");\r\n\t}\r\n   \r\n    \t/**\r\n\t* closeFindDialog Close 'Data' dialog\r\n\t*/\r\n\tcloseFindDialog(){\r\n\t\tthis.closeDialog(\"findDialog\");\r\n\t}\r\n\t\r\n\t/**\r\n\t* openAccessDialog Open 'Query' dialog\r\n\t*/\r\n\topenAccessDialog(){\r\n\t\tthis.closeAboutDialog();\r\n\t\tthis.closeFindDialog();\r\n\t\tthis.openDialog(\"accessDialog\");\r\n\t}\r\n   \r\n   \t/**\r\n\t* closeAccessDialog Close 'Query' dialog\r\n\t*/\r\n\tcloseAccessDialog(){\r\n\t\tthis.closeDialog(\"accessDialog\");\r\n\t}\r\n\t\r\n\t/**\r\n\t* openInfoDialog Open 'Info' dialog\r\n\t*/\r\n\topenInfoDialog(){\r\n\t\tthis.openDialog(\"infoDialog\");\r\n\t}\r\n   \r\n   \t/**\r\n\t* closeInfoDialog Close 'Info' dialog\r\n\t*/\r\n\tcloseInfoDialog(){\r\n\t\tthis.closeDialog(\"infoDialog\");\r\n\t}\r\n\r\n\t/**\r\n\t* openDataDialog Open 'Data' dialog\r\n\t*/\r\n\topenDataDialog(){\r\n\t\tthis.openDialog(\"dataDialog\");\r\n\t}\r\n   \r\n   \t/**\r\n\t* closeDataDialog Close 'Data' dialog\r\n\t*/\r\n\tcloseDataDialog(){\r\n\t\tthis.closeDialog(\"dataDialog\");\r\n\t}\r\n\r\n\r\n   \t/**\r\n\t* closeInfoDialog Close 'Info' dialog\r\n\t*/\r\n\tcloseInfoDialog(){\r\n\t\tthis.closeDialog(\"infoDialog\");\r\n\t}\r\n\r\n\t/**\r\n\t* openDashboardDialog Open 'Dashboard' dialog\r\n\t*/\r\n\topenDashboardDialog(){\r\n\t\tthis.openDialog(\"dashboardDialog\");\r\n\t}\r\n   \r\n   \t/**\r\n\t* closeDashboardDialog Close 'Dashboard' dialog\r\n\t*/\r\n\tcloseDashboardDialog(){\r\n\t\tthis.closeDialog(\"dashboardDialog\");\r\n\t}\r\n\t\r\n\t/**\r\n\t* openFeatureDialog Open 'Feature' dialog\r\n\t*/\r\n\topenFeatureDialog(){\r\n\t\tthis.openDialog(\"featureDialog\");\r\n\t}\r\n   \r\n   \t/**\r\n\t* closeFeatureDialog Close 'Feature' dialog\r\n\t*/\r\n\tcloseFeatureDialog(){\r\n\t\tthis.closeDialog(\"featureDialog\");\r\n\t}\r\n\t\r\n  \t/**\r\n\t*\r\n\t*/\r\n\t_copyright(){\r\n\t\t$(\"body\").append(\"<footer><a href='https://doi.org/10.5281/zenodo.2249305'>&copy; OpenFairViewer <small>(version \"+this.versioning.VERSION+\")</small</a></footer>\")\r\n\t}\r\n\t\r\n};\r\n\r\nexport default OpenFairViewer;\r\n","import jquery from 'jquery';\r\nexport default (window.$ = window.jQuery = jquery);","import {Jsonix} from 'jsonix/jsonix';\r\nexport default (window.Jsonix = Jsonix);","import './vendor/jsonix/GeoJSON.js'; export default (window.GML_V_3_1_1 = GML_V_3_1_1);","GML_V_3_1_1 = {};\r\nGML_V_3_1_1.GeoJSON = {};\r\n\r\nGML_V_3_1_1.GeoJSON.AbstractForwardGeometryConverter = Jsonix.Class({\r\n\tinitialize : function() {\r\n\t},\r\n\tcreateGeometry:function(geometry) {\r\n\t\tJsonix.Util.Ensure.ensureObject(geometry);\r\n\t\tvar result = this.doCreateGeometry(geometry);\r\n\t\t// getSridConverter().convert(locator, geometryType, geometry);\r\n\t\treturn result;\r\n\t},\r\n\tdoCreateGeometry: function(geometry)\r\n\t{\r\n\t\tthrow 'Abstract method.';\r\n\t},\r\n\tcreateGeometryFromProperty: function(property)\r\n\t{\r\n\t\tthrow 'Abstract method.';\r\n\t},\r\n\tcreateGeometryFromElement: function(geometryElement) {\r\n\t\tJsonix.Util.Ensure.ensureObject(geometryElement);\r\n\t\tJsonix.Util.Ensure.ensureObject(geometryElement.name);\r\n\t\tJsonix.Util.Ensure.ensureObject(geometryElement.value);\r\n\t\treturn this.createGeometry(geometryElement.value);\r\n\t},\r\n\tCLASS_NAME : \"GML_V_3_1_1.GeoJSON.AbstractForwardGeometryConverter\"\r\n});\r\n\r\nGML_V_3_1_1.GeoJSON.AbstractInverseGeometryConverter = Jsonix.Class({\r\n\tinitialize : function() {\r\n\t},\r\n\tcreateGeometryType:function(geometry)\r\n\t{\r\n\t\tvar target = this.doCreateGeometryType(geometry);\r\n\t    //getSrsReferenceGroupConverter().convert(geometry, target);\r\n\t\treturn target;\r\n\t},\r\n\tdoCreateGeometryType: function(geometry)\r\n\t{\r\n\t\tthrow 'Abstract method';\r\n\t},\r\n\tcreatePropertyType: function(geometry)\r\n\t{\r\n\t\tthrow 'Abstract method';\r\n\t},\r\n\tcreateElement: function(geometry)\r\n\t{\r\n\t\tthrow 'Abstract method';\r\n\t},\r\n\tCLASS_NAME : \"GML_V_3_1_1.GeoJSON.AbstractInverseGeometryConverter\"\r\n});\r\n\r\nGML_V_3_1_1.GeoJSON.ForwardCoordinateConverter = Jsonix.Class({\r\n\tinitialize : function() {\r\n\t},\r\n\tcreateCoordinateFromDirectPositionType: function(directPositionType) {\r\n\t\tvar value = directPositionType.value;\r\n\t\tvar count = value.length;\r\n\t\tif (count == 2) {\r\n\t\t\tvar x0 = value[0];\r\n\t\t\tvar y0 = value[1];\r\n\t\t\treturn [x0, y0];\r\n\t\t} else if (count == 3) {\r\n\t\t\tvar x1 = value[0];\r\n\t\t\tvar y1 = value[1];\r\n\t\t\tvar z1 = value[2];\r\n\t\t\treturn [x1, y1, z1];\r\n\r\n\t\t} else {\r\n\t\t\tthrow \"Direct position type is expected to have 2 or 3 items.\";\r\n\t\t}\r\n\t},\r\n\tcreateCoordinatesFromDirectPositionListType: function(directPositionListType) {\r\n\t\tvar dimensions = Jsonix.Util.Type.isNumber(directPositionListType.srsDimension) ? directPositionListType.srsDimension : 2;\r\n\r\n\t\tif (dimensions < 2 || dimensions > 3) {\r\n\t\t\tthrow \"Only two- or three-dimensional coordinates are supported.\";\r\n\t\t}\r\n\t\tvar values = directPositionListType.value;\r\n\t\tif (values.length % dimensions !== 0) {\r\n\t\t\tthrow 'Wrong number of entries [' + values.length + '] in the list.';\r\n\t\t}\r\n\r\n\t\tvar coordinates = [];\r\n\t\tfor (var index = 0; index < values.length / dimensions; index++) {\r\n\t\t\tif (dimensions == 2) {\r\n\t\t\t\tcoordinates.push([values[index * dimensions], values[index * dimensions + 1]]);\r\n\t\t\t} else if (dimensions == 3) {\r\n\t\t\t\tcoordinates.push([values[index * dimensions], values[index * dimensions + 1], values[index * dimensions + 2]]);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn coordinates;\r\n\r\n\t},\r\n\tcreateCoordinateFromCoordType: function(coordType) {\r\n\t\tJsonix.Util.Ensure.ensureObject(coordType);\r\n\t\tif (Jsonix.Util.Type.exists(coordType.x) && Jsonix.Util.Type.exists(coordType.y) && !Jsonix.Util.Type.exists(coordType.z)) {\r\n\t\t\tJsonix.Util.Ensure.ensureNumber(coordType.x);\r\n\t\t\tJsonix.Util.Ensure.ensureNumber(coordType.y);\r\n\t\t\treturn [coordType.x, coordType.y];\r\n\t\t} else if (Jsonix.Util.Type.exists(coordType.x) && Jsonix.Util.Type.exists(coordType.y) && Jsonix.Util.Type.exists(coordType.z)) {\r\n\t\t\tJsonix.Util.Ensure.ensureNumber(coordType.x);\r\n\t\t\tJsonix.Util.Ensure.ensureNumber(coordType.y);\r\n\t\t\tJsonix.Util.Ensure.ensureNumber(coordType.z);\r\n\t\t\treturn [coordType.x, coordType.y, coordType.z];\r\n\r\n\t\t} else {\r\n\t\t\tthrow 'Either X, Y or X, Y, Z values are required.';\r\n\t\t}\r\n\t},\r\n\tcreateCoordinatesFromCoordinatesType: function(coordinates) {\r\n\t\tJsonix.Util.Ensure.ensureObject(coordinates);\r\n\t\tvar coords = this.createCoordinates(\r\n\t\t\t\tcoordinates.value, coordinates.decimal,\r\n\t\t\t\tcoordinates.cs, coordinates.ts);\r\n\t\treturn coords;\r\n\t},\r\n\tcreateCoordinates: function(value, ds, cs, ts) {\r\n\t\tJsonix.Util.Ensure.ensureString(value);\r\n\r\n\t\tvar tupleSeparator = Jsonix.Util.Type.isString(ts) ? ts : ' ';\r\n\r\n\t\tvar tuples = value.split(tupleSeparator);\r\n\r\n\t\tvar coordinates = [];\r\n\t\tfor (var index = 0; index < tuples.length; index++) {\r\n\t\t\tcoordinates.push(this.createCoordinate(tuples[index], ds, cs));\r\n\t\t}\r\n\t\treturn coordinates;\r\n\t},\r\n\tcreateCoordinate: function(value, ds, cs) {\r\n\t\tJsonix.Util.Ensure.ensureString(value);\r\n\r\n\t\tvar coordinateSeparator = Jsonix.Util.Type.isString(cs) ? cs : ',';\r\n\r\n\t\tvar coordinates = value.split(coordinateSeparator);\r\n\t\t\r\n\t\tvar coordinateComponents = [];\r\n\t\tfor (var index = 0; index < coordinates.length; index++) {\r\n\t\t\tcoordinateComponents.push(this.createCoordinateComponent(\r\n\t\t\t\t\tcoordinates[index], ds));\r\n\t\t}\r\n\t\tif (coordinateComponents.length == 2) {\r\n\t\t\treturn [coordinateComponents[0],\r\n\t\t\t\t\tcoordinateComponents[1]];\r\n\t\t} else if (coordinateComponents.length == 3) {\r\n\t\t\treturn [coordinateComponents[0],\r\n\t\t\t\t\tcoordinateComponents[1], coordinateComponents[2]];\r\n\r\n\t\t} else {\r\n\t\t\tthrow 'Expected two or three coordinates in [' + value + '].';\r\n\t\t}\r\n\t},\r\n\tcreateCoordinateComponent: function(value, ds) {\r\n\t\tJsonix.Util.Ensure.ensureString(value);\r\n\t\tvar decimalSeparator = Jsonix.Util.Type.isString(ds) ? ds : '.';\r\n\t\tvar decimalSeparatorIndex = value.indexOf(decimalSeparator);\r\n\t\tvar text;\r\n\t\tif (decimalSeparatorIndex < 0)\r\n\t\t{\r\n\t\t\ttext = value;\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\ttext = value.substring(0, decimalSeparatorIndex) + '.' + value.substring(decimalSeparatorIndex + decimalSeparator.length);\r\n\t\t}\r\n\t\tvar n = Number(text);\r\n\t\treturn n;\r\n\t},\r\n\tCLASS_NAME : \"GML_V_3_1_1.GeoJSON.ForwardCoordinateConverter\"\r\n});\r\n\r\nGML_V_3_1_1.GeoJSON.ForwardGeometryConverter = Jsonix.Class(GML_V_3_1_1.GeoJSON.AbstractForwardGeometryConverter, {\r\n\tcoordinateConverter: null,\r\n\tpointConverter: null,\r\n\tlineStringConverter: null,\r\n\tlinearRingConverter: null,\r\n\tpolygonConverter: null,\r\n\tmultiPointConverter: null,\r\n\tmultiLineStringConverter: null,\r\n\tmultiPolygonConverter: null,\r\n\tmultiGeometryConverter: null,\r\n\tproperties: null,\r\n\tpropertyConverters: null,\r\n\telementConverters: null,\r\n\tinitialize : function(options) {\r\n\t\tGML_V_3_1_1.GeoJSON.AbstractForwardGeometryConverter.prototype.initialize.apply(this, arguments);\r\n\t\t\r\n\t\tthis.coordinateConverter = new GML_V_3_1_1.GeoJSON.ForwardCoordinateConverter();\r\n    \tthis.pointConverter = new GML_V_3_1_1.GeoJSON.ForwardPointConverter({coordinateConverter:this.coordinateConverter});\r\n    \tthis.lineStringConverter = new GML_V_3_1_1.GeoJSON.ForwardLineStringConverter({coordinateConverter:this.coordinateConverter, pointConverter: this.pointConverter});\r\n    \tthis.linearRingConverter = new GML_V_3_1_1.GeoJSON.ForwardLinearRingConverter({coordinateConverter:this.coordinateConverter, pointConverter: this.pointConverter});\r\n    \tthis.polygonConverter = new GML_V_3_1_1.GeoJSON.ForwardPolygonConverter({linearRingConverter:this.linearRingConverter});\r\n\t\tthis.multiPointConverter = new GML_V_3_1_1.GeoJSON.ForwardMultiPointConverter({pointConverter:this.pointConverter});\r\n\t\tthis.multiLineStringConverter = new GML_V_3_1_1.GeoJSON.ForwardMultiLineStringConverter({lineStringConverter:this.lineStringConverter});\r\n\t\tthis.multiPolygonConverter = new GML_V_3_1_1.GeoJSON.ForwardMultiPolygonConverter({polygonConverter:this.polygonConverter});\r\n\t\tthis.multiGeometryConverter = new GML_V_3_1_1.GeoJSON.ForwardMultiGeometryConverter({geometryConverter:this});\r\n\t\tthis.properties = ['point', 'lineString', 'polygon', 'multiPoint', 'multiLineString', 'multiPolygon', 'geometricAggregate'];\r\n\t\tthis.propertyConverters = \r\n\t\t{\r\n\t\t\t'point' : this.pointConverter,\r\n\t\t\t'lineString' : this.lineStringConverter,\r\n\t\t\t'polygon' : this.polygonConverter,\r\n\t\t\t'multiPoint' : this.multiPointConverter,\r\n\t\t\t'multiLineString' : this.multiLineStringConverter,\r\n\t\t\t'multiPolygon' : this.multiPolygonConverter,\r\n\t\t\t'geometricAggregate': this.multiGeometryConverter\r\n\t\t};\r\n\t\tthis.elementConverters = \r\n\t\t{\r\n\t\t\t'{http://www.opengis.net/gml}Point' : this.pointConverter,\r\n\t\t\t'{http://www.opengis.net/gml}LineString' : this.lineStringConverter,\r\n\t\t\t'{http://www.opengis.net/gml}Polygon' : this.polygonConverter,\r\n\t\t\t'{http://www.opengis.net/gml}MultiPoint' : this.multiPointConverter,\r\n\t\t\t'{http://www.opengis.net/gml}MultiLineString' : this.multiLineStringConverter,\r\n\t\t\t'{http://www.opengis.net/gml}MultiPolygon' : this.multiPolygonConverter,\r\n\t\t\t'{http://www.opengis.net/gml}MultiGeometry' : this.multiGeometryConverter\r\n\t\t};\r\n\t},\r\n\tdoCreateGeometry: function(geometry) {\r\n\t\tif (Jsonix.Util.Type.exists(geometry.pos) ||\r\n\t\t\tJsonix.Util.Type.exists(geometry.coordinates) ||\r\n\t\t\tJsonix.Util.Type.exists(geometry.coords)) {\r\n\t\t\treturn this.pointConverter.createGeometry(geometry);\r\n\t\t} else if (Jsonix.Util.Type.exists(geometry.posOrPointPropertyOrPointRep) ||\r\n\t\t\tJsonix.Util.Type.exists(geometry.posList) ||\r\n\t\t\tJsonix.Util.Type.exists(geometry.coordinates)) {\r\n\t\t\treturn this.lineStringConverter.createGeometry(geometry);\r\n\t\t} else if (Jsonix.Util.Type.exists(geometry.exterior) ||\r\n\t\t\tJsonix.Util.Type.exists(geometry.interior)) {\r\n\t\t\treturn this.polygonConverter.createGeometry(geometry);\r\n\t\t} else if (Jsonix.Util.Type.exists(geometry.pointMember) ||\r\n\t\t\tJsonix.Util.Type.exists(geometry.pointMembers)) {\r\n\t\t\treturn this.multiPointConverter.createGeometry(geometry);\r\n\t\t} else if (Jsonix.Util.Type.exists(geometry.lineStringMember) ||\r\n\t\t\tJsonix.Util.Type.exists(geometry.lineStringMembers)) {\r\n\t\t\treturn this.multiLineStringConverter.createGeometry(geometry);\r\n\t\t} else if (Jsonix.Util.Type.exists(geometry.polygonMember) ||\r\n\t\t\tJsonix.Util.Type.exists(geometry.polygonMembers)) {\r\n\t\t\treturn this.multiPolygonConverter.createGeometry(geometry);\r\n\t\t} else if (Jsonix.Util.Type.exists(geometry.geometryMember) ||\r\n\t\t\tJsonix.Util.Type.exists(geometry.geometryMembers)) {\r\n\t\t\treturn this.multiGeometryConverter.createGeometry(geometry);\r\n\t\t} else\t{\r\n\t\t\tthrow \"Geometry [\" + geometry + \"] was not recognized.\";\r\n\t\t}\r\n\t},\r\n\tcreateGeometryFromProperty: function(geometryProperty) {\r\n\t\tJsonix.Util.Ensure.ensureObject(geometryProperty);\r\n\t\tif (Jsonix.Util.Type.exists(geometryProperty.geometry))\r\n\t\t{\r\n\t\t\treturn this.createGeometryFromElement(geometryProperty.geometry);\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tfor (var index1 = 0; index1 < this.properties.length; index1++) {\r\n\t\t\t\tvar p = this.properties[index1];\r\n\t\t\t\tif (Jsonix.Util.Type.exists(geometryProperty[p]))\r\n\t\t\t\t{\r\n\t\t\t\t\tvar converter0 = this.propertyConverters[p];\r\n\t\t\t\t\treturn converter0.createGeometryFromProperty(geometryProperty);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tthrow \"Geometry property [\" + geometryProperty + \"] is not supported.\";\r\n\t\t}\r\n\t},\r\n\tcreateGeometryFromElement: function(geometryElement) {\r\n\t\tJsonix.Util.Ensure.ensureObject(geometryElement);\r\n\t\tJsonix.Util.Ensure.ensureObject(geometryElement.name);\r\n\t\tJsonix.Util.Ensure.ensureObject(geometryElement.value);\r\n\t\tvar key = Jsonix.XML.QName.fromObject(geometryElement.name).key;\r\n\t\tvar converter1 = this.elementConverters[key];\r\n\t\tif (Jsonix.Util.Type.exists(converter1)) {\r\n\t\t\treturn converter1.createGeometryFromElement(geometryElement);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthrow \"Geometry element [\" + key + \"] is not supported.\";\r\n\t\t}\r\n\t},\t\r\n\tCLASS_NAME : \"GML_V_3_1_1.GeoJSON.ForwardGeometryConverter\"\r\n});\r\n\r\nGML_V_3_1_1.GeoJSON.ForwardLineStringConverter = Jsonix.Class(GML_V_3_1_1.GeoJSON.AbstractForwardGeometryConverter, {\r\n\tcoordinateConverter: null,\r\n\tpointConverter: null,\r\n\tinitialize : function(options) {\r\n\t\tJsonix.Util.Ensure.ensureObject(options);\r\n\t\tGML_V_3_1_1.GeoJSON.AbstractForwardGeometryConverter.prototype.initialize.apply(this, [ options ]);\r\n\t\tJsonix.Util.Ensure.ensureObject(options.coordinateConverter);\r\n\t\tthis.coordinateConverter = options.coordinateConverter;\r\n\t\tJsonix.Util.Ensure.ensureObject(options.pointConverter);\r\n\t\tthis.pointConverter = options.pointConverter;\r\n\t},\r\n\tdoCreateGeometry: function(lineString) {\r\n\t\tif (Jsonix.Util.Type.exists(lineString.posOrPointPropertyOrPointRep)) {\r\n\t\t\tJsonix.Util.Ensure.ensureArray(lineString.posOrPointPropertyOrPointRep);\r\n\t\t\tvar coordinates0 = [];\r\n\t\t\tfor (var index = 0; index < lineString.posOrPointPropertyOrPointRep.length; index++) {\r\n\t\t\t\tvar item = lineString.posOrPointPropertyOrPointRep[index];\r\n\t\t\t\tvar name = item.name;\r\n\t\t\t\tvar value = item.value;\r\n\t\t\t\tif (name.namespaceURI === 'http://www.opengis.net/gml' && (name.localPart === 'pointProperty'||name.localPart === 'pointRep')) {\r\n\t\t\t\t\tcoordinates0.push(this.pointConverter.createGeometryFromProperty(value).coordinates);\r\n\t\t\t\t} else if (name.namespaceURI === 'http://www.opengis.net/gml' && name.localPart === 'coord') {\r\n\t\t\t\t\tcoordinates0.push(this.coordinateConverter.createCoordinateFromCoordType(value));\r\n\t\t\t\t} else if (name.namespaceURI === 'http://www.opengis.net/gml' && name.localPart === 'pos') {\r\n\t\t\t\t\tcoordinates0.push(this.coordinateConverter.createCoordinateFromDirectPositionType(value));\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthrow \"Expected Unexpected type.\";\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn { type: 'LineString', coordinates : coordinates0 };\r\n\t\t} else if (Jsonix.Util.Type.exists(lineString.posList)) {\r\n\t\t\tvar coordinates1 = this.coordinateConverter.createCoordinatesFromDirectPositionListType(lineString.posList);\r\n\t\t\treturn { type: 'LineString', coordinates : coordinates1 };\r\n\t\t} else if (Jsonix.Util.Type.exists(lineString.coordinates)) {\r\n\t\t\tvar coordinates2 = this.coordinateConverter.createCoordinatesFromCoordinatesType(lineString.coordinates);\r\n\t\t\treturn { type: 'LineString', coordinates : coordinates2 };\r\n\t\t} else {\r\n\t\t\tthrow \"Either [pos], [pointProperty], [pointRep], [coord] or [coordinates] elements are expected.\";\r\n\t\t}\r\n\t},\r\n\tcreateGeometryFromProperty: function(lineStringProperty) {\r\n\t\tif (Jsonix.Util.Type.exists(lineStringProperty.lineString)) {\r\n\t\t\treturn this.createGeometry(lineStringProperty.lineString);\r\n\t\t} else {\r\n\t\t\tthrow \"Expected [LineString] element.\";\r\n\t\t}\r\n\t},\t\r\n\tCLASS_NAME : \"GML_V_3_1_1.GeoJSON.ForwardLineStringConverter\"\r\n});\r\n\r\nGML_V_3_1_1.GeoJSON.ForwardLinearRingConverter = Jsonix.Class(GML_V_3_1_1.GeoJSON.ForwardLineStringConverter, {\r\n\tinitialize : function(options) {\r\n\t\tJsonix.Util.Ensure.ensureObject(options);\r\n\t\tGML_V_3_1_1.GeoJSON.ForwardLineStringConverter.prototype.initialize.apply(this, [ options ]);\r\n\t},\r\n\tcreateGeometryFromProperty: function(linearRingProperty) {\r\n\t\tif (Jsonix.Util.Type.exists(linearRingProperty.linearRing)) {\r\n\t\t\treturn { type: 'LineString', coordinates : this.createGeometry(linearRingProperty.linearRing).coordinates };\r\n\t\t} else {\r\n\t\t\tthrow \"Expected [LinearRing] element.\";\r\n\t\t}\r\n\t},\r\n\t\r\n\tCLASS_NAME : \"GML_V_3_1_1.GeoJSON.ForwardLinearRingConverter\"\r\n});\r\n\r\nGML_V_3_1_1.GeoJSON.ForwardMultiGeometryConverter = Jsonix.Class(GML_V_3_1_1.GeoJSON.AbstractForwardGeometryConverter, {\r\n\tgeometryConverter: null,\r\n\tinitialize : function(options) {\r\n\t\tJsonix.Util.Ensure.ensureObject(options);\r\n\t\tGML_V_3_1_1.GeoJSON.AbstractForwardGeometryConverter.prototype.initialize.apply(this, [ options ]);\r\n\t\tJsonix.Util.Ensure.ensureObject(options.geometryConverter);\r\n\t\tthis.geometryConverter = options.geometryConverter;\r\n\t},\r\n\tdoCreateGeometry: function(multiGeometry) {\r\n\t\tvar geometries = [];\r\n\t\tif (Jsonix.Util.Type.exists(multiGeometry.geometryMember)) {\r\n\t\t\tJsonix.Util.Ensure.ensureArray(multiGeometry.geometryMember);\r\n\t\t\tfor (var index0 = 0; index0 < multiGeometry.geometryMember.length; index0++)\r\n\t\t\t{\r\n\t\t\t\tgeometries.push(this.geometryConverter.createGeometryFromProperty(multiGeometry.geometryMember[index0]));\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (Jsonix.Util.Type.exists(multiGeometry.geometryMembers)) {\r\n\t\t\tJsonix.Util.Ensure.ensureObject(multiGeometry.geometryMembers);\r\n\t\t\tJsonix.Util.Ensure.ensureArray(multiGeometry.geometryMembers.geometry);\r\n\t\t\tfor (var index1 = 0; index1 < multiGeometry.geometryMembers.geometry.length; index1++)\r\n\t\t\t{\r\n\t\t\t\tgeometries.push(this.geometryConverter.createGeometryFromElement(multiGeometry.geometryMembers.geometry[index1]));\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn { type : 'GeometryCollection', geometries : geometries};\r\n\t},\r\n\tcreateGeometryFromProperty: function(multiGeometryProperty) {\r\n\t\tif (Jsonix.Util.Type.exists(multiGeometryProperty.geometricAggregate)) {\r\n\t\t\treturn this.createGeometryFromElement(multiGeometryProperty.geometricAggregate);\r\n\t\t} else {\r\n\t\t\tthrow \"Expected [_GeometricAggregate] element.\";\r\n\t\t}\r\n\t},\t\r\n\tCLASS_NAME : \"GML_V_3_1_1.GeoJSON.ForwardMultiPolygonConverter\"\r\n});\r\n\r\nGML_V_3_1_1.GeoJSON.ForwardMultiLineStringConverter = Jsonix.Class(GML_V_3_1_1.GeoJSON.AbstractForwardGeometryConverter, {\r\n\tlineStringConverter: null,\r\n\tinitialize : function(options) {\r\n\t\tJsonix.Util.Ensure.ensureObject(options);\r\n\t\tGML_V_3_1_1.GeoJSON.AbstractForwardGeometryConverter.prototype.initialize.apply(this, [ options ]);\r\n\t\tJsonix.Util.Ensure.ensureObject(options.lineStringConverter);\r\n\t\tthis.lineStringConverter = options.lineStringConverter;\r\n\t},\r\n\tdoCreateGeometry: function(multiLineString) {\r\n\t\tvar coordinates = [];\r\n\t\tif (Jsonix.Util.Type.exists(multiLineString.lineStringMember)) {\r\n\t\t\tJsonix.Util.Ensure.ensureArray(multiLineString.lineStringMember);\r\n\t\t\tfor (var index0 = 0; index0 < multiLineString.lineStringMember.length; index0++)\r\n\t\t\t{\r\n\t\t\t\tcoordinates.push(this.lineStringConverter.createGeometryFromProperty(multiLineString.lineStringMember[index0]).coordinates);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn { type : 'MultiLineString', coordinates : coordinates};\r\n\t},\r\n\tcreateGeometryFromProperty: function(multiLineStringProperty) {\r\n\t\tif (Jsonix.Util.Type.exists(multiLineStringProperty.multiLineString)) {\r\n\t\t\treturn this.createGeometry(multiLineStringProperty.multiLineString);\r\n\t\t} else {\r\n\t\t\tthrow \"Expected [MultiLineString] element.\";\r\n\t\t}\r\n\t},\t\r\n\tCLASS_NAME : \"GML_V_3_1_1.GeoJSON.ForwardMultiLineStringConverter\"\r\n});\r\n\r\nGML_V_3_1_1.GeoJSON.ForwardMultiPointConverter = Jsonix.Class(GML_V_3_1_1.GeoJSON.AbstractForwardGeometryConverter, {\r\n\tpointConverter: null,\r\n\tinitialize : function(options) {\r\n\t\tJsonix.Util.Ensure.ensureObject(options);\r\n\t\tGML_V_3_1_1.GeoJSON.AbstractForwardGeometryConverter.prototype.initialize.apply(this, [ options ]);\r\n\t\tJsonix.Util.Ensure.ensureObject(options.pointConverter);\r\n\t\tthis.pointConverter = options.pointConverter;\r\n\t},\r\n\tdoCreateGeometry: function(multiPoint) {\r\n\t\tvar coordinates = [];\r\n\t\tif (Jsonix.Util.Type.exists(multiPoint.pointMember)) {\r\n\t\t\tJsonix.Util.Ensure.ensureArray(multiPoint.pointMember);\r\n\t\t\tfor (var index0 = 0; index0 < multiPoint.pointMember.length; index0++)\r\n\t\t\t{\r\n\t\t\t\tcoordinates.push(this.pointConverter.createGeometryFromProperty(multiPoint.pointMember[index0]).coordinates);\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (Jsonix.Util.Type.exists(multiPoint.pointMembers)) {\r\n\t\t\tJsonix.Util.Ensure.ensureObject(multiPoint.pointMembers);\r\n\t\t\tJsonix.Util.Ensure.ensureArray(multiPoint.pointMembers.point);\r\n\t\t\tfor (var index1 = 0; index1 < multiPoint.pointMembers.point.length; index1++)\r\n\t\t\t{\r\n\t\t\t\tcoordinates.push(this.pointConverter.createGeometry(multiPoint.pointMembers.point[index1]).coordinates);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn { type: 'MultiPoint', coordinates: coordinates };\r\n\t},\r\n\tcreateGeometryFromProperty: function(multiPointProperty) {\r\n\t\tif (Jsonix.Util.Type.exists(multiPointProperty.multiPoint)) {\r\n\t\t\treturn this.createGeometry(multiPointProperty.multiPoint);\r\n\t\t} else {\r\n\t\t\tthrow \"Expected [MultiPoint] element.\";\r\n\t\t}\r\n\t},\t\r\n\tCLASS_NAME : \"GML_V_3_1_1.GeoJSON.ForwardMultiPointConverter\"\r\n});\r\n\r\nGML_V_3_1_1.GeoJSON.ForwardMultiPolygonConverter = Jsonix.Class(GML_V_3_1_1.GeoJSON.AbstractForwardGeometryConverter, {\r\n\tpolygonConverter: null,\r\n\tinitialize : function(options) {\r\n\t\tJsonix.Util.Ensure.ensureObject(options);\r\n\t\tGML_V_3_1_1.GeoJSON.AbstractForwardGeometryConverter.prototype.initialize.apply(this, [ options ]);\r\n\t\tJsonix.Util.Ensure.ensureObject(options.polygonConverter);\r\n\t\tthis.polygonConverter = options.polygonConverter;\r\n\t},\r\n\tdoCreateGeometry: function(multiPolygon) {\r\n\t\tvar coordinates = [];\r\n\t\tif (Jsonix.Util.Type.exists(multiPolygon.polygonMember)) {\r\n\t\t\tJsonix.Util.Ensure.ensureArray(multiPolygon.polygonMember);\r\n\t\t\tfor (var index0 = 0; index0 < multiPolygon.polygonMember.length; index0++)\r\n\t\t\t{\r\n\t\t\t\tcoordinates.push(this.polygonConverter.createGeometryFromProperty(multiPolygon.polygonMember[index0]).coordinates);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn { type : 'MultiPolygon', coordinates : coordinates};\r\n\t},\r\n\tcreateGeometryFromProperty: function(multiPolygonProperty) {\r\n\t\tif (Jsonix.Util.Type.exists(multiPolygonProperty.multiPolygon)) {\r\n\t\t\treturn this.createGeometry(multiPolygonProperty.multiPolygon);\r\n\t\t} else {\r\n\t\t\tthrow \"Expected [MultiPolygon] element.\";\r\n\t\t}\r\n\t},\t\r\n\tCLASS_NAME : \"GML_V_3_1_1.GeoJSON.ForwardMultiPolygonConverter\"\r\n});\r\n\r\nGML_V_3_1_1.GeoJSON.ForwardPointConverter = Jsonix.Class(GML_V_3_1_1.GeoJSON.AbstractForwardGeometryConverter, {\r\n\tcoordinateConverter: null,\r\n\tinitialize : function(options) {\r\n\t\tJsonix.Util.Ensure.ensureObject(options);\r\n\t\tGML_V_3_1_1.GeoJSON.AbstractForwardGeometryConverter.prototype.initialize.apply(this, [ options ]);\r\n\t\tJsonix.Util.Ensure.ensureObject(options.coordinateConverter);\r\n\t\tthis.coordinateConverter = options.coordinateConverter;\r\n\t},\r\n\tdoCreateGeometry: function(point) {\r\n\t\tif (Jsonix.Util.Type.exists(point.pos)) {\r\n\t\t\treturn { type: 'Point', coordinates : this.coordinateConverter.createCoordinateFromDirectPositionType(point.pos) };\r\n\t\t} else if (Jsonix.Util.Type.exists(point.coordinates)) {\r\n\t\t\tvar coords = this.coordinateConverter.createCoordinatesFromCoordinatesType(point.coordinates);\r\n\t\t\tif (coords.length != 1) {\r\n\t\t\t\tthrow \"Expected exactly one coordinate.\";\r\n\t\t\t} else {\r\n\t\t\t\treturn { type: 'Point', coordinates : coords[0]};\r\n\t\t\t}\r\n\t\t} else if (Jsonix.Util.Type.exists(point.coord)) {\r\n\t\t\treturn { type: 'Point', coordinates : this.coordinateConverter.createCoordinateFromCoordType(point.coord) };\r\n\t\t} else {\r\n\t\t\tthrow \"Either [pos], [coordinates] or [coord] elements are expected.\";\r\n\t\t}\r\n\t},\r\n\tcreateGeometryFromProperty: function(pointProperty) {\r\n\t\tif (Jsonix.Util.Type.exists(pointProperty.point)) {\r\n\t\t\treturn this.createGeometry(pointProperty.point);\r\n\t\t} else {\r\n\t\t\tthrow \"Expected [Point] element.\";\r\n\t\t}\r\n\t},\t\r\n\tCLASS_NAME : \"GML_V_3_1_1.GeoJSON.ForwardPointConverter\"\r\n});\r\n\r\nGML_V_3_1_1.GeoJSON.ForwardPolygonConverter = Jsonix.Class(GML_V_3_1_1.GeoJSON.AbstractForwardGeometryConverter, {\r\n\tlinearRingConverter: null,\r\n\tinitialize : function(options) {\r\n\t\tJsonix.Util.Ensure.ensureObject(options);\r\n\t\tGML_V_3_1_1.GeoJSON.AbstractForwardGeometryConverter.prototype.initialize.apply(this, [ options ]);\r\n\t\tJsonix.Util.Ensure.ensureObject(options.linearRingConverter);\r\n\t\tthis.linearRingConverter = options.linearRingConverter;\r\n\t},\r\n\tdoCreateGeometry: function(polygon) {\r\n\t\tvar coordinates = [];\r\n\t\tif (Jsonix.Util.Type.exists(polygon.exterior)) {\r\n\t\t\tJsonix.Util.Ensure.ensureObject(polygon.exterior);\r\n\t\t\tJsonix.Util.Ensure.ensureObject(polygon.exterior.value);\r\n\t\t\tvar shell = polygon.exterior.value;\r\n\t\t\tif (Jsonix.Util.Type.exists(shell.ring)) {\r\n\t\t\t\tJsonix.Util.Ensure.ensureObject(shell.ring);\r\n\t\t\t\tJsonix.Util.Ensure.ensureObject(shell.ring.value);\r\n\t\t\t\tcoordinates.push(this.linearRingConverter\r\n\t\t\t\t\t\t.createGeometry(shell.ring.value).coordinates);\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tthrow \"The [_Ring] element is expected.\";\r\n\t\t\t}\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tthrow \"The [exterior] element is expected.\";\r\n\t\t}\r\n\t\tif (Jsonix.Util.Type.exists(polygon.interior)) {\r\n\t\t\tJsonix.Util.Ensure.ensureArray(polygon.interior);\r\n\t\t\tvar hole;\r\n\t\t\tfor (var index = 0; index < polygon.interior.length; index++)\r\n\t\t\t{\r\n\t\t\t\tJsonix.Util.Ensure.ensureObject(polygon.interior[index]);\r\n\t\t\t\tJsonix.Util.Ensure.ensureObject(polygon.interior[index].value);\r\n\t\t\t\thole = polygon.interior[index].value;\r\n\t\t\t\tif (Jsonix.Util.Type.exists(hole.ring)) {\r\n\t\t\t\t\tJsonix.Util.Ensure.ensureObject(hole.ring);\r\n\t\t\t\t\tJsonix.Util.Ensure.ensureObject(hole.ring.value);\r\n\t\t\t\t\tcoordinates.push(this.linearRingConverter\r\n\t\t\t\t\t\t\t.createGeometry(hole.ring.value).coordinates);\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\tthrow \"The [_Ring] element is expected.\";\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn {type: 'Polygon', coordinates: coordinates};\r\n\t},\r\n\tcreateGeometryFromProperty: function(polygonProperty) {\r\n\t\tif (Jsonix.Util.Type.exists(polygonProperty.polygon)) {\r\n\t\t\treturn this.createGeometry(polygonProperty.polygon);\r\n\t\t} else {\r\n\t\t\tthrow \"Expected [Polygon] element.\";\r\n\t\t}\r\n\t},\t\r\n\tCLASS_NAME : \"GML_V_3_1_1.GeoJSON.ForwardPolygonConverter\"\r\n});\r\n\r\nGML_V_3_1_1.GeoJSON.InverseCoordinateConverter = Jsonix.Class({\r\n\tinitialize : function() {\r\n\t},\r\n\tconvertCoordinate: function(coordinate) {\r\n\t\tJsonix.Util.Ensure.ensureArray(coordinate);\r\n\t\tif (coordinate.length < 2 || coordinate.length > 3)\r\n\t\t{\r\n\t\t\tthrow 'Coordinate must contain two or three components.';\r\n\t\t}\r\n\t\tJsonix.Util.Ensure.ensureNumber(coordinate[0]);\r\n\t\tJsonix.Util.Ensure.ensureNumber(coordinate[1]);\r\n\t\tif (coordinate.length > 2)\r\n\t\t{\r\n\t\t\tJsonix.Util.Ensure.ensureNumber(coordinate[2]);\r\n\t\t\treturn { value: [coordinate[0], coordinate[1], coordinate[2]]};\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\treturn { value: [coordinate[0], coordinate[1]]};\r\n\t\t}\r\n\t},\r\n\tconvertCoordinates: function(coordinates) {\r\n\t\tJsonix.Util.Ensure.ensureArray(coordinates);\r\n\t\tvar directPositions = [];\r\n\t\tif (coordinates.length > 0)\r\n\t\t{\r\n\t\t\tvar firstCoordinate = this.convertCoordinate(coordinates[0]);\r\n\t\t\tvar dimension = firstCoordinate.value.length;\r\n\t\t\tvar index, jndex;\r\n\t\t\tvar coordinate;\r\n\t\t\tfor (index = 0; index < coordinates.length; index++) {\r\n\t\t\t\tcoordinate = this.convertCoordinate(coordinates[index]);\r\n\t\t\t\tif (coordinate.value.length !== dimension) {\r\n\t\t\t\t\tthrow 'Not all of the coordinates have the same number of components [' + dimension + '].';\r\n\t\t\t\t} \r\n\t\t\t\tfor (jndex = 0; jndex < dimension; jndex++)\t{\r\n\t\t\t\t\tdirectPositions.push(coordinate.value[jndex]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn {\r\n\t\t\t\tvalue: directPositions,\r\n\t\t\t\tsrsDimension: dimension\r\n\t\t\t}; \r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\treturn {\r\n\t\t\t\tvalue: [] \r\n\t\t\t};\t\t\r\n\t\t}\r\n\t},\r\n\tCLASS_NAME : \"GML_V_3_1_1.GeoJSON.InverseCoordinateConverter\"\r\n});\r\n\r\nGML_V_3_1_1.GeoJSON.InversePointConverter = Jsonix.Class(GML_V_3_1_1.GeoJSON.AbstractInverseGeometryConverter, {\r\n\tcoordinateConverter: null,\r\n\tinitialize : function(options) {\r\n\t\tJsonix.Util.Ensure.ensureObject(options);\r\n\t\tGML_V_3_1_1.GeoJSON.AbstractInverseGeometryConverter.prototype.initialize.apply(this, [ options ]);\r\n\t\tJsonix.Util.Ensure.ensureObject(options.coordinateConverter);\r\n\t\tthis.coordinateConverter = options.coordinateConverter;\r\n\t},\r\n\tdoCreateGeometryType: function(point) {\r\n\t\tJsonix.Util.Ensure.ensureObject(point);\r\n\t\tJsonix.Util.Ensure.ensureArray(point.coordinates);\r\n\t\tvar resultPoint = {};\r\n\t\tvar directPosition = this.coordinateConverter\r\n\t\t\t\t\t.convertCoordinate(point.coordinates);\r\n\t\tresultPoint.pos = directPosition;\r\n\t\treturn resultPoint;\r\n\t},\r\n\tcreatePropertyType: function(point) {\r\n\t\tvar pointPropertyType = {};\r\n\t\tpointPropertyType.point = this.createGeometryType(point);\r\n\t\treturn pointPropertyType;\r\n\t},\r\n\tcreateElement: function(point) {\r\n\t\treturn {\r\n\t\t\tname : new Jsonix.XML.QName(\"http://www.opengis.net/gml\", \"Point\"),\r\n\t\t\tvalue : this.createGeometryType(point)\r\n\t\t};\r\n\t},\r\n\tCLASS_NAME : \"GML_V_3_1_1.GeoJSON.InversePointConverter\"\r\n});\r\n\r\nGML_V_3_1_1.GeoJSON.InverseGeometryConverter = Jsonix.Class(GML_V_3_1_1.GeoJSON.AbstractInverseGeometryConverter, {\r\n\tcoordinateConverter: null,\r\n\tpointConverter: null,\r\n\tlineStringConverter: null,\r\n\tlinearRingConverter: null,\r\n\tpolygonConverter: null,\r\n\tmultiPointConverter: null,\r\n\tmultiLineStringConverter: null,\r\n\tmultiPolygonConverter: null,\r\n\tmultiGeometryConverter: null,\r\n\tconverters: null,\r\n\tinitialize : function() {\r\n\t\tGML_V_3_1_1.GeoJSON.AbstractInverseGeometryConverter.prototype.initialize.apply(this, arguments);\r\n\t\t\r\n\t\tthis.coordinateConverter = new GML_V_3_1_1.GeoJSON.InverseCoordinateConverter();\r\n    \tthis.pointConverter = new GML_V_3_1_1.GeoJSON.InversePointConverter({coordinateConverter:this.coordinateConverter});\r\n    \tthis.lineStringConverter = new GML_V_3_1_1.GeoJSON.InverseLineStringConverter({coordinateConverter:this.coordinateConverter, pointConverter: this.pointConverter});\r\n    \tthis.linearRingConverter = new GML_V_3_1_1.GeoJSON.InverseLinearRingConverter({coordinateConverter:this.coordinateConverter, pointConverter: this.pointConverter});\r\n    \tthis.polygonConverter = new GML_V_3_1_1.GeoJSON.InversePolygonConverter({linearRingConverter:this.linearRingConverter});\r\n\t\tthis.multiPointConverter = new GML_V_3_1_1.GeoJSON.InverseMultiPointConverter({pointConverter:this.pointConverter});\r\n\t\tthis.multiLineStringConverter = new GML_V_3_1_1.GeoJSON.InverseMultiLineStringConverter({lineStringConverter:this.lineStringConverter});\r\n\t\tthis.multiPolygonConverter = new GML_V_3_1_1.GeoJSON.InverseMultiPolygonConverter({polygonConverter:this.polygonConverter});\r\n\t\tthis.multiGeometryConverter = new GML_V_3_1_1.GeoJSON.InverseMultiGeometryConverter({geometryConverter:this});\r\n\t\tthis.converters = \r\n\t\t{\r\n\t\t\t'Point' : this.pointConverter,\r\n\t\t\t'LineString' : this.lineStringConverter,\r\n\t\t\t'Polygon' : this.polygonConverter,\r\n\t\t\t'MultiPoint' : this.multiPointConverter,\r\n\t\t\t'MultiLineString' : this.multiLineStringConverter,\r\n\t\t\t'MultiPolygon' : this.multiPolygonConverter,\r\n\t\t\t'GeometryCollection' : this.multiGeometryConverter\r\n\t\t};\r\n\t},\r\n\tdoCreateGeometryType: function(geometry) {\r\n\t\tJsonix.Util.Ensure.ensureObject(geometry);\r\n\t\tJsonix.Util.Ensure.ensureString(geometry.type);\r\n\t\tvar converter0 = this.converters[geometry.type];\r\n\t\tif (Jsonix.Util.Type.exists(converter0)) {\r\n\t\t\treturn converter0.createGeometryType(geometry);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthrow \"Geometry type [\" + geometry.type + \"] is not supported.\";\r\n\t\t}\r\n\t},\r\n\tcreatePropertyType: function(geometry) {\r\n\t\tvar geometryPropertyType = {};\r\n\t\tgeometryPropertyType.geometry = this.createElement(geometry);\r\n\t\treturn geometryPropertyType;\r\n\t},\r\n\tcreateElement: function(geometry) {\r\n\t\tJsonix.Util.Ensure.ensureObject(geometry);\r\n\t\tJsonix.Util.Ensure.ensureString(geometry.type);\r\n\t\tvar converter1 = this.converters[geometry.type];\r\n\t\tif (Jsonix.Util.Type.exists(converter1)) {\r\n\t\t\treturn converter1.createElement(geometry);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthrow \"Geometry type [\" + geometry.type + \"] is not supported.\";\r\n\t\t}\r\n\t},\r\n\tCLASS_NAME : \"GML_V_3_1_1.GeoJSON.InverseGeometryConverter\"\r\n});\r\n\r\nGML_V_3_1_1.GeoJSON.InverseLinearRingConverter = Jsonix.Class(GML_V_3_1_1.GeoJSON.InverseLineStringConverter, {\r\n\tinitialize : function(options) {\r\n\t\tJsonix.Util.Ensure.ensureObject(options);\r\n\t\tGML_V_3_1_1.GeoJSON.InverseLineStringConverter.prototype.initialize.apply(this, [ options ]);\r\n\t},\r\n\tcreateElement: function(linearRing) {\r\n\t\treturn {\r\n\t\t\tname : new Jsonix.XML.QName(\"http://www.opengis.net/gml\", \"LinearRing\"),\r\n\t\t\tvalue : this.createGeometryType(linearRing)\r\n\t\t};\r\n\t},\r\n\tCLASS_NAME : \"GML_V_3_1_1.GeoJSON.InverseLinearRingConverter\"\r\n});\r\n\r\nGML_V_3_1_1.GeoJSON.InverseLineStringConverter = Jsonix.Class(GML_V_3_1_1.GeoJSON.AbstractInverseGeometryConverter, {\r\n\tcoordinateConverter: null,\r\n\tinitialize : function(options) {\r\n\t\tJsonix.Util.Ensure.ensureObject(options);\r\n\t\tGML_V_3_1_1.GeoJSON.AbstractInverseGeometryConverter.prototype.initialize.apply(this, [ options ]);\r\n\t\tJsonix.Util.Ensure.ensureObject(options.coordinateConverter);\r\n\t\tthis.coordinateConverter = options.coordinateConverter;\r\n\t},\r\n\tdoCreateGeometryType: function(lineString) {\r\n\t\tJsonix.Util.Ensure.ensureObject(lineString);\r\n\t\tJsonix.Util.Ensure.ensureArray(lineString.coordinates);\r\n\t\tvar resultLineString = {\r\n\t\t\tposList: this.coordinateConverter.convertCoordinates(lineString.coordinates)\r\n\t\t};\r\n\t\treturn resultLineString;\r\n\t},\r\n\tcreatePropertyType: function(lineString) {\r\n\t\tvar lineStringPropertyType = {};\r\n\t\tlineStringPropertyType.lineString = this.createGeometryType(lineString);\r\n\t\treturn lineStringPropertyType;\r\n\t},\r\n\tcreateElement: function(lineString) {\r\n\t\treturn {\r\n\t\t\tname : new Jsonix.XML.QName(\"http://www.opengis.net/gml\", \"LineString\"),\r\n\t\t\tvalue : this.createGeometryType(lineString)\r\n\t\t};\r\n\t},\r\n\tCLASS_NAME : \"GML_V_3_1_1.GeoJSON.InverseLineStringConverter\"\r\n});\r\n\r\nGML_V_3_1_1.GeoJSON.InverseMultiGeometryConverter = Jsonix.Class(GML_V_3_1_1.GeoJSON.AbstractInverseGeometryConverter, {\r\n\tgeometryConverter: null,\r\n\tinitialize : function(options) {\r\n\t\tJsonix.Util.Ensure.ensureObject(options);\r\n\t\tGML_V_3_1_1.GeoJSON.AbstractInverseGeometryConverter.prototype.initialize.apply(this, [ options ]);\r\n\t\tJsonix.Util.Ensure.ensureObject(options.geometryConverter);\r\n\t\tthis.geometryConverter = options.geometryConverter;\r\n\t},\r\n\tdoCreateGeometryType: function(multiGeometry) {\r\n\t\tJsonix.Util.Ensure.ensureObject(multiGeometry);\r\n\t\tJsonix.Util.Ensure.ensureArray(multiGeometry.geometries);\r\n\t\tvar resultMultiGeometry = {\r\n\t\t\tgeometryMember : []\r\n\t\t};\r\n\t\tfor (var index = 0; index < multiGeometry.geometries.length; index++) {\r\n\t\t\tresultMultiGeometry.geometryMember.push(this.geometryConverter.createPropertyType(multiGeometry.geometries[index]));\r\n\t\t}\r\n\t\treturn resultMultiGeometry;\r\n\t},\r\n\tcreatePropertyType: function(multiGeometry) {\r\n\t\tvar multiGeometryPropertyType = {};\r\n\t\tmultiGeometryPropertyType.multiGeometry = this.createGeometryType(multiGeometry);\r\n\t\treturn multiGeometryPropertyType;\r\n\t},\r\n\tcreateElement: function(multiGeometry) {\r\n\t\treturn {\r\n\t\t\tname : new Jsonix.XML.QName(\"http://www.opengis.net/gml\", \"MultiGeometry\"),\r\n\t\t\tvalue : this.createGeometryType(multiGeometry)\r\n\t\t};\r\n\t},\r\n\tCLASS_NAME : \"GML_V_3_1_1.GeoJSON.InverseMultiGeometryConverter\"\r\n});\r\n\r\nGML_V_3_1_1.GeoJSON.InverseMultiLineStringConverter = Jsonix.Class(GML_V_3_1_1.GeoJSON.AbstractInverseGeometryConverter, {\r\n\tlineStringConverter: null,\r\n\tinitialize : function(options) {\r\n\t\tJsonix.Util.Ensure.ensureObject(options);\r\n\t\tGML_V_3_1_1.GeoJSON.AbstractInverseGeometryConverter.prototype.initialize.apply(this, [ options ]);\r\n\t\tJsonix.Util.Ensure.ensureObject(options.lineStringConverter);\r\n\t\tthis.lineStringConverter = options.lineStringConverter;\r\n\t},\r\n\tdoCreateGeometryType: function(multiLineString) {\r\n\t\tJsonix.Util.Ensure.ensureObject(multiLineString);\r\n\t\tJsonix.Util.Ensure.ensureArray(multiLineString.coordinates);\r\n\t\tvar resultMultiLineString = {\r\n\t\t\tlineStringMember : []\r\n\t\t};\r\n\t\tfor (var index = 0; index < multiLineString.coordinates.length; index++) {\r\n\t\t\tresultMultiLineString.lineStringMember.push(this.lineStringConverter.createPropertyType({type: 'LineString', coordinates: multiLineString.coordinates[index]}))\r\n\t\t}\r\n\t\treturn resultMultiLineString;\r\n\t},\r\n\tcreatePropertyType: function(multiLineString) {\r\n\t\tvar multiLineStringPropertyType = {};\r\n\t\tmultiLineStringPropertyType.multiLineString = this.createGeometryType(multiLineString);\r\n\t\treturn multiLineStringPropertyType;\r\n\t},\r\n\tcreateElement: function(multiLineString) {\r\n\t\treturn {\r\n\t\t\tname : new Jsonix.XML.QName(\"http://www.opengis.net/gml\", \"MultiLineString\"),\r\n\t\t\tvalue : this.createGeometryType(multiLineString)\r\n\t\t};\r\n\t},\r\n\tCLASS_NAME : \"GML_V_3_1_1.GeoJSON.InverseMultiLineStringConverter\"\r\n});\r\n\r\nGML_V_3_1_1.GeoJSON.InverseMultiPointConverter = Jsonix.Class(GML_V_3_1_1.GeoJSON.AbstractInverseGeometryConverter, {\r\n\tpointConverter: null,\r\n\tinitialize : function(options) {\r\n\t\tJsonix.Util.Ensure.ensureObject(options);\r\n\t\tGML_V_3_1_1.GeoJSON.AbstractInverseGeometryConverter.prototype.initialize.apply(this, [ options ]);\r\n\t\tJsonix.Util.Ensure.ensureObject(options.pointConverter);\r\n\t\tthis.pointConverter = options.pointConverter;\r\n\t},\r\n\tdoCreateGeometryType: function(multiPoint) {\r\n\t\tJsonix.Util.Ensure.ensureObject(multiPoint);\r\n\t\tJsonix.Util.Ensure.ensureArray(multiPoint.coordinates);\r\n\t\tvar resultMultiPoint = {\r\n\t\t\tpointMember : []\r\n\t\t};\r\n\t\tfor (var index = 0; index < multiPoint.coordinates.length; index++) {\r\n\t\t\tresultMultiPoint.pointMember.push(this.pointConverter.createPropertyType({type: 'Point', coordinates: multiPoint.coordinates[index]}))\r\n\t\t}\r\n\t\treturn resultMultiPoint;\r\n\t},\r\n\tcreatePropertyType: function(multiPoint) {\r\n\t\tvar multiPointPropertyType = {};\r\n\t\tmultiPointPropertyType.multiPoint = this.createGeometryType(multiPoint);\r\n\t\treturn multiPointPropertyType;\r\n\t},\r\n\tcreateElement: function(multiPoint) {\r\n\t\treturn {\r\n\t\t\tname : new Jsonix.XML.QName(\"http://www.opengis.net/gml\", \"MultiPoint\"),\r\n\t\t\tvalue : this.createGeometryType(multiPoint)\r\n\t\t};\r\n\t},\r\n\tCLASS_NAME : \"GML_V_3_1_1.GeoJSON.InverseMultiPointConverter\"\r\n});\r\n\r\nGML_V_3_1_1.GeoJSON.InverseMultiPolygonConverter = Jsonix.Class(GML_V_3_1_1.GeoJSON.AbstractInverseGeometryConverter, {\r\n\tpolygonConverter: null,\r\n\tinitialize : function(options) {\r\n\t\tJsonix.Util.Ensure.ensureObject(options);\r\n\t\tGML_V_3_1_1.GeoJSON.AbstractInverseGeometryConverter.prototype.initialize.apply(this, [ options ]);\r\n\t\tJsonix.Util.Ensure.ensureObject(options.polygonConverter);\r\n\t\tthis.polygonConverter = options.polygonConverter;\r\n\t},\r\n\tdoCreateGeometryType: function(multiPolygon) {\r\n\t\tJsonix.Util.Ensure.ensureObject(multiPolygon);\r\n\t\tJsonix.Util.Ensure.ensureArray(multiPolygon.coordinates);\r\n\t\tvar resultMultiPolygon = {\r\n\t\t\tpolygonMember : []\r\n\t\t};\r\n\t\tfor (var index = 0; index < multiPolygon.coordinates.length; index++) {\r\n\t\t\tresultMultiPolygon.polygonMember.push(this.polygonConverter.createPropertyType({type: 'Polygon', coordinates: multiPolygon.coordinates[index]}))\r\n\t\t}\r\n\t\treturn resultMultiPolygon;\r\n\t},\r\n\tcreatePropertyType: function(multiPolygon) {\r\n\t\tvar multiPolygonPropertyType = {};\r\n\t\tmultiPolygonPropertyType.multiPolygon = this.createGeometryType(multiPolygon);\r\n\t\treturn multiPolygonPropertyType;\r\n\t},\r\n\tcreateElement: function(multiPolygon) {\r\n\t\treturn {\r\n\t\t\tname : new Jsonix.XML.QName(\"http://www.opengis.net/gml\", \"MultiPolygon\"),\r\n\t\t\tvalue : this.createGeometryType(multiPolygon)\r\n\t\t};\r\n\t},\r\n\tCLASS_NAME : \"GML_V_3_1_1.GeoJSON.InverseMultiPolygonConverter\"\r\n});\r\n\r\n\r\nGML_V_3_1_1.GeoJSON.InversePolygonConverter = Jsonix.Class(GML_V_3_1_1.GeoJSON.AbstractInverseGeometryConverter, {\r\n\tlinearRingConverter: null,\r\n\tinitialize : function(options) {\r\n\t\tJsonix.Util.Ensure.ensureObject(options);\r\n\t\tGML_V_3_1_1.GeoJSON.AbstractInverseGeometryConverter.prototype.initialize.apply(this, [ options ]);\r\n\t\tJsonix.Util.Ensure.ensureObject(options.linearRingConverter);\r\n\t\tthis.linearRingConverter = options.linearRingConverter;\r\n\t},\r\n\tdoCreateGeometryType: function(polygon) {\r\n\t\tJsonix.Util.Ensure.ensureObject(polygon);\r\n\t\tJsonix.Util.Ensure.ensureArray(polygon.coordinates);\r\n\t\tif (polygon.coordinates.length < 0)\r\n\t\t{\r\n\t\t\tthrow \"At least one element (shell) is expected in the coordinates array.\";\r\n\t\t}\r\n\t\t\r\n\t\tvar resultPolygon = {};\r\n\t\tJsonix.Util.Ensure.ensureArray(polygon.coordinates[0]);\r\n\t\t\r\n\t\tresultPolygon.exterior = {};\r\n\t\t\r\n\t\tresultPolygon.exterior = {\r\n\t\t\t\tname : new Jsonix.XML.QName(\"http://www.opengis.net/gml\", \"exterior\"),\r\n\t\t\t\tvalue: {\r\n\t\t\t\t\tring: this.linearRingConverter.createElement({type: 'LinearRing', coordinates: polygon.coordinates[0]})\r\n\t\t\t\t} \r\n\t\t};\r\n\t\t\r\n\t\tif (polygon.coordinates.length > 1)\r\n\t\t{\r\n\t\t\tresultPolygon.interior = [];\r\n\t\t\tfor (var index = 1; index < polygon.coordinates.length; index++)\r\n\t\t\t{\r\n\t\t\t\tresultPolygon.interior.push(\r\n\t\t\t\t{\r\n\t\t\t\t\tname : new Jsonix.XML.QName(\"http://www.opengis.net/gml\", \"interior\"),\r\n\t\t\t\t\tvalue: {\r\n\t\t\t\t\t\tring: this.linearRingConverter.createElement({type: 'LinearRing', coordinates: polygon.coordinates[index]})\r\n\t\t\t\t\t} \r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn resultPolygon;\r\n\t},\r\n\tcreatePropertyType: function(polygon) {\r\n\t\tvar polygonPropertyType = {};\r\n\t\tpolygonPropertyType.polygon = this.createGeometryType(polygon);\r\n\t\treturn polygonPropertyType;\r\n\t},\r\n\tcreateElement: function(polygon) {\r\n\t\treturn {\r\n\t\t\tname : new Jsonix.XML.QName(\"http://www.opengis.net/gml\", \"Polygon\"),\r\n\t\t\tvalue : this.createGeometryType(polygon)\r\n\t\t};\r\n\t},\r\n\tCLASS_NAME : \"GML_V_3_1_1.GeoJSON.InversePolygonConverter\"\r\n});\r\n\r\n\r\nGML_V_3_1_1.GeoJSON.GeometryAdapter = Jsonix.Class({\r\n\tforwardGeometryConverter: null,\r\n\tinverseGeometryConverter: null,\r\n\tinitialize : function(options) {\r\n\t\tthis.forwardGeometryConverter = new GML_V_3_1_1.GeoJSON.ForwardGeometryConverter();\r\n\t\tthis.inverseGeometryConverter = new GML_V_3_1_1.GeoJSON.InverseGeometryConverter();\r\n\t},\r\n\tunmarshal: function(context, input, typeInfo)\r\n\t{\r\n\t\tvar name = Jsonix.XML.QName.fromObject(input.getName());\r\n\t\tvar value = typeInfo.unmarshal(context, input);\r\n\t\tvar geometryElement = {\r\n\t\t\tname : name,\r\n\t\t\tvalue : value\r\n\t\t};\r\n\t\tvar geometry = this.forwardGeometryConverter.createGeometryFromElement(geometryElement);\r\n\t\treturn geometry;\r\n\t},\r\n\tmarshal: function(context, geometry, output, typeInfo)\r\n\t{\r\n\t\tvar geometryElement = this.inverseGeometryConverter.createElement(geometry);\r\n\t\ttypeInfo.marshal(context, geometryElement.value, output);\r\n\t},\t\r\n\tCLASS_NAME : \"GML_V_3_1_1.GeoJSON.GeometryAdapter\"\r\n});\r\nGML_V_3_1_1.GeoJSON.GeometryAdapter.INSTANCE = new GML_V_3_1_1.GeoJSON.GeometryAdapter();\r\n\r\n","import {XLink_1_0} from 'w3c-schemas/lib/XLink_1_0'; \r\nexport default (window.XLink_1_0 = XLink_1_0);","import {OWS_1_0_0} from 'ogc-schemas/lib/OWS_1_0_0'; window.OWS_1_0_0 = OWS_1_0_0;\r\nimport {OWS_1_1_0} from 'ogc-schemas/lib/OWS_1_1_0'; window.OWS_1_1_0 = OWS_1_1_0;\r\nimport {OWS_2_0} from 'ogc-schemas/lib/OWS_2_0'; window.OWS_2_0 = OWS_2_0;\r\nimport {DC_1_1} from 'ogc-schemas/lib/DC_1_1'; window.DC_1_1 = DC_1_1;\r\nimport {DCT} from 'ogc-schemas/lib/DCT'; window.DCT = DCT;\r\nimport {CSW_2_0_2} from 'ogc-schemas/lib/CSW_2_0_2_Full'; window.CSW_2_0_2 = CSW_2_0_2;\r\nimport {WMS_1_1_1} from 'ogc-schemas/lib/WMS_1_1_1'; window.WMS_1_1_1 = WMS_1_1_1;\r\nimport {WMS_1_3_0} from 'ogc-schemas/lib/WMS_1_3_0'; window.WMS_1_3_0 = WMS_1_3_0;\r\nimport {Filter_1_1_0} from 'ogc-schemas/lib/Filter_1_1_0'; window.Filter_1_1_0 = Filter_1_1_0;\r\nimport {GML_3_1_1} from 'ogc-schemas/lib/GML_3_1_1'; window.GML_3_1_1 = GML_3_1_1;\r\nimport {GML_3_2_0} from 'ogc-schemas/lib/GML_3_2_0'; window.GML_3_2_0 = GML_3_2_0;\r\nimport {GML_3_2_1} from 'ogc-schemas/lib/GML_3_2_1'; window.GML_3_2_1 = GML_3_2_1;\r\nimport {SMIL_2_0_Language}  from 'ogc-schemas/lib/SMIL_2_0_Language'; window.SMIL_2_0_Language = SMIL_2_0_Language;\r\nimport {SMIL_2_0} from 'ogc-schemas/lib/SMIL_2_0'; window.SMIL_2_0 = SMIL_2_0;\r\nimport {ISO19139_GCO_20060504} from 'ogc-schemas/lib/ISO19139_GCO_20060504'; window.ISO19139_GCO_20060504 = ISO19139_GCO_20060504;\r\nimport {ISO19139_GMD_20060504} from 'ogc-schemas/lib/ISO19139_GMD_20060504'; window.ISO19139_GMD_20060504 = ISO19139_GMD_20060504;\r\nimport {ISO19139_GTS_20060504}  from 'ogc-schemas/lib/ISO19139_GTS_20060504'; window.ISO19139_GTS_20060504 = ISO19139_GTS_20060504;\r\nimport {ISO19139_GSS_20060504} from 'ogc-schemas/lib/ISO19139_GSS_20060504'; window.ISO19139_GSS_20060504 = ISO19139_GSS_20060504;\r\nimport {ISO19139_GSR_20060504} from 'ogc-schemas/lib/ISO19139_GSR_20060504'; window.ISO19139_GSR_20060504 = ISO19139_GSR_20060504;\r\nimport {ISO19139_GMX_20060504} from 'ogc-schemas/lib/ISO19139_GMX_20060504'; window.ISO19139_GMX_20060504 = ISO19139_GMX_20060504;\r\nimport {ISO19139_SRV_20060504} from 'ogc-schemas/lib/ISO19139_SRV_20060504'; window.ISO19139_SRV_20060504 = ISO19139_SRV_20060504;\r\nimport {ISO19139_GCO_20070417} from 'ogc-schemas/lib/ISO19139_GCO_20070417'; window.ISO19139_GCO_20070417 = ISO19139_GCO_20070417;\r\nimport {ISO19139_GMD_20070417} from 'ogc-schemas/lib/ISO19139_GMD_20070417'; window.ISO19139_GMD_20070417 = ISO19139_GMD_20070417;\r\nimport {ISO19139_GTS_20070417} from 'ogc-schemas/lib/ISO19139_GTS_20070417'; window.ISO19139_GTS_20070417 = ISO19139_GTS_20070417;\r\nimport {ISO19139_GSS_20070417} from 'ogc-schemas/lib/ISO19139_GSS_20070417'; window.ISO19139_GSS_20070417 = ISO19139_GSS_20070417;\r\nimport {ISO19139_GSR_20070417} from 'ogc-schemas/lib/ISO19139_GSR_20070417'; window.ISO19139_GSR_20070417 = ISO19139_GSR_20070417;\r\nimport {ISO19139_GMX_20070417} from 'ogc-schemas/lib/ISO19139_GMX_20070417'; window.ISO19139_GMX_20070417 = ISO19139_GMX_20070417;\r\nimport {ISO19139_2_GMI_1_0} from 'ogc-schemas/lib/ISO19139_2_GMI_1_0'; window.ISO19139_2_GMI_1_0 = ISO19139_2_GMI_1_0; ","\r\nclass CSWConstraint {\r\n\t\r\n\tconstructor(version, filter){\r\n\t\tvar owsVersion = null;\r\n\t\tswitch(version){\r\n\t\t\tcase \"2.0.2\": owsVersion = \"1.1.0\"; break;\r\n\t\t\tcase \"3.0.0\": owsVersion = \"2.0\"; break;\r\n\t\t}\r\n\t\tthis.TYPE_NAME = \"CSW_\"+version.replaceAll('.', '_')+\".QueryConstraintType\";\r\n\t\tthis.version = owsVersion;\r\n\t\tthis.filter = filter.get();\r\n\t}\r\n\t\r\n}\r\n\r\nexport default CSWConstraint;","\r\nclass CSWQuery {\r\n\r\n\tconstructor(version, elementSetName, constraint){\r\n\t\tthis['csw:Query'] = {\r\n\t\t\tTYPE_NAME: \"CSW_\"+version.replaceAll('.','_')+\".QueryType\",\r\n\t\t\telementSetName : {\r\n\t\t\t\tTYPE_NAME: \"CSW_\"+version.replaceAll('.','_')+\".ElementSetNameType\",\r\n\t\t\t\tvalue: elementSetName\r\n\t\t\t},\r\n\t\t\ttypeNames : [\r\n\t\t\t\t{\r\n\t\t\t\t\tkey: \"{http://www.opengis.net/cat/csw/\"+version+\"}Record\",\r\n\t\t\t\t\tlocalPart: \"Record\",\r\n\t\t\t\t\tnamespaceURI: \"http://www.opengis.net/cat/csw/\"+version,\r\n\t\t\t\t\tprefix: \"csw\",\r\n\t\t\t\t\tstring: \"{http://www.opengis.net/cat/csw/\"+version+\"}csw:Record\"\r\n\t\t\t\t}\r\n\t\t\t]\r\n\t\t};\r\n\t\tif (constraint){\r\n\t\t\tthis['csw:Query'].constraint = constraint;\r\n\t\t\tconsole.log(this);\r\n\t\t}\r\n\t}\r\n\r\n}\r\n\r\nexport default CSWQuery;"," \r\nclass Filter {\r\n\t\r\n\tconstructor(version, schemas){\r\n\t\t\r\n\t\tthis.version = version;\r\n\t\tthis.object = new Object();\r\n\t\tthis.object['ogc:Filter'] = {\r\n\t\t\tTYPE_NAME : \"Filter_\"+this.version.replaceAll('.','_')+\".FilterType\"\r\n\t\t};\r\n\t\t\r\n\t\tvar contextSchemas = [\r\n\t\t\tOWS_1_0_0,\r\n\t\t\tDC_1_1,\r\n\t\t\tDCT,\r\n\t\t\tXLink_1_0,\r\n\t\t\tSMIL_2_0,\r\n\t\t\tSMIL_2_0_Language,\r\n\t\t\tGML_3_1_1\r\n\t\t];\r\n\t\tswitch(this.version){\r\n\t\t\tcase \"1.1.0\":\r\n\t\t\t\tcontextSchemas.push(Filter_1_1_0);\r\n\t\t\t\tfor(var i=0;i<schemas.length;i++) contextSchemas.push(schemas[i]);\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"2.0\":\r\n\t\t\t\tcontextSchemas.push(Filter_2_0);\r\n\t\t\t\tfor(var i=0;i<schemas.length;i++) contextSchemas.push(schemas[i]);\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t\t\r\n\t\tthis.jsonixContext = new Jsonix.Context(\r\n\t\t\tcontextSchemas,\r\n\t\t\t{\r\n\t\t\t\tnamespacePrefixes: {\r\n\t\t\t\t\t'http://www.opengis.net/cat/csw/2.0.2': 'csw',\r\n\t\t\t\t\t\"http://www.opengis.net/ogc\": 'ogc',\r\n\t\t\t\t\t\"http://www.opengis.net/gml\": \"gml\"\r\n\t\t\t\t},\r\n\t\t\t\tmappingStyle : 'simplified'\r\n\t\t\t}\r\n\t\t)\r\n\t\t\t\r\n\t}\r\n\t\r\n\tget(){\r\n\t\treturn this.object;\r\n\t}\r\n\t\r\n\tgetJsonixContext(){\r\n\t\treturn this.jsonixContext;\r\n\t}\r\n\r\n\tgetXML(){\r\n\t\tvar doc;\r\n\t\tvar marshaller= this.getJsonixContext().createMarshaller();\r\n\t\tdoc = marshaller.marshalDocument(this);\r\n\t\treturn doc;\r\n\t}\t\r\n\t\r\n\tgetBasicFilterFromXML(xml){\r\n\t\tvar unmarshaller = this.getJsonixContext().createUnmarshaller();\r\n\t\treturn unmarshaller.unmarshalDocument(xml);\r\n\t}\r\n\t\r\n\tstatic getOperator(filter){\r\n\t\tvar operator;\r\n\t\tif (typeof filter.object['ogc:Filter'].comparisonOps !== 'undefined') {\r\n\t\t\t// Only has one previous filter and it is a comparison operator.\r\n\t\t\toperator = filter.object['ogc:Filter'].comparisonOps;\r\n\t\t} else if (typeof filter.object['ogc:Filter'].spatialOps !== 'undefined'){\r\n\t\t\t// Only has one previous filter and it is a spatial operator.\r\n\t\t\toperator = filter.object['ogc:Filter'].spatialOps;\r\n\t\t} else if (typeof filter.object['ogc:Filter'].logicOps !== 'undefined') {\r\n\t\t\toperator = filter.object['ogc:Filter'].logicOps;\r\n\t\t} else {\r\n\t\t\tconsole.error(filter);\r\n\t\t\tthrow 'Not Implemented yet, another operators';\r\n\t\t}\r\n\t\treturn operator;\r\n\t}\r\n\t\t\t\t\r\n}\r\n\r\nexport default Filter;\r\n ","import Filter from './Filter.js';\r\n\r\nclass IsLike extends Filter {\r\n\tconstructor(version, schemas, propertyName, literal){\r\n\t\tsuper(version, schemas);\r\n\t\tthis.object['ogc:Filter'].comparisonOps = {\r\n\t\t\t'ogc:PropertyIsLike' : {\r\n\t\t\t\tTYPE_NAME: \"Filter_\"+version.replaceAll('.','_')+\".PropertyIsLikeType\",\r\n\t\t\t\tescapeChar: \"\",\r\n\t\t\t\tsingleChar: \"_\",\r\n\t\t\t\twildCard: \"%\",\r\n\t\t\t\tliteral: {\r\n\t\t\t\t\tTYPE_NAME: \"Filter_\"+version.replaceAll('.','_')+\".LiteralType\",\r\n\t\t\t\t\tcontent: [literal]\r\n\t\t\t\t},\r\n\t\t\t\tpropertyName: {\r\n\t\t\t\t\tTYPE_NAME: \"Filter_\"+version.replaceAll('.','_')+\".PropertyNameType\",\r\n\t\t\t\t\tcontent: [propertyName]\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\t}\r\n}\r\n\r\nexport default IsLike;","import Filter from './Filter.js';\r\n\r\nclass IsEqualTo extends Filter {\r\n\tconstructor(version, schemas, propertyName, literal, matchCase){\r\n\t\tsuper(version, schemas);\r\n\t\tthis.object['ogc:Filter'].comparisonOps = {\r\n\t\t\t'ogc:PropertyIsEqualTo' : {\r\n\t\t\t\tTYPE_NAME: \"Filter_\"+version.replaceAll('.','_')+\".PropertyIsEqualTo\",\r\n\t\t\t\tmatchCase: (matchCase? matchCase : false),\r\n\t\t\t\texpression: [{\r\n\t\t\t\t\t'ogc:Literal': {\r\n\t\t\t\t\t\tTYPE_NAME: \"Filter_\"+version.replaceAll('.','_')+\".LiteralType\",\r\n\t\t\t\t\t\tcontent: [literal]\r\n\t\t\t\t\t}\r\n\t\t\t\t},{\r\n\t\t\t\t\t'ogc:PropertyName': {\r\n\t\t\t\t\t\tTYPE_NAME: \"Filter_\"+version.replaceAll('.','_')+\".PropertyNameType\",\r\n\t\t\t\t\t\tcontent: [propertyName]\r\n\t\t\t\t\t}\r\n\t\t\t\t}]\r\n\t\t\t}\r\n\t\t};\r\n\t}\r\n}\r\n\r\nexport default IsEqualTo;","import Filter from './Filter.js';\r\n\r\nclass IsNotEqualTo extends Filter {\r\n\tconstructor(version, schemas, propertyName, literal){\r\n\t\tsuper(version, schemas);\r\n\t\tthis.object['ogc:Filter'].comparisonOps = {\r\n\t\t\t'ogc:PropertyIsNotEqualTo' : {\r\n\t\t\t\tTYPE_NAME: \"Filter_\"+version.replaceAll('.','_')+\".PropertyIsNotEqualTo\",\r\n\t\t\t\texpression: [{\r\n\t\t\t\t\t'ogc:Literal': {\r\n\t\t\t\t\t\tTYPE_NAME: \"Filter_\"+version.replaceAll('.','_')+\".LiteralType\",\r\n\t\t\t\t\t\tcontent: [literal]\r\n\t\t\t\t\t}\r\n\t\t\t\t},{\r\n\t\t\t\t\t'ogc:PropertyName': {\r\n\t\t\t\t\t\tTYPE_NAME: \"Filter_\"+version.replaceAll('.','_')+\".PropertyNameType\",\r\n\t\t\t\t\t\tcontent: [propertyName]\r\n\t\t\t\t\t}\r\n\t\t\t\t}]\r\n\t\t\t}\r\n\t\t};\r\n\t}\r\n}\r\n\r\nexport default IsNotEqualTo;","import Filter from './Filter.js';\r\n\r\nclass IsLessThan extends Filter {\r\n\tconstructor(version, schemas, propertyName, literal){\r\n\t\tsuper(version, schemas);\r\n\t\tthis.object['ogc:Filter'].comparisonOps = {\r\n\t\t\t'ogc:PropertyIsLessThan' : {\r\n\t\t\t\tTYPE_NAME: \"Filter_\"+version.replaceAll('.','_')+\".PropertyIsLessThan\",\r\n\t\t\t\texpression: [{\r\n\t\t\t\t\t'ogc:Literal': {\r\n\t\t\t\t\t\tTYPE_NAME: \"Filter_\"+version.replaceAll('.','_')+\".LiteralType\",\r\n\t\t\t\t\t\tcontent: [literal]\r\n\t\t\t\t\t}\r\n\t\t\t\t},{\r\n\t\t\t\t\t'ogc:PropertyName': {\r\n\t\t\t\t\t\tTYPE_NAME: \"Filter_\"+version.replaceAll('.','_')+\".PropertyNameType\",\r\n\t\t\t\t\t\tcontent: [propertyName]\r\n\t\t\t\t\t}\r\n\t\t\t\t}]\r\n\t\t\t}\r\n\t\t};\r\n\t}\r\n}\r\n\r\nexport default IsLessThan;","import Filter from './Filter.js';\r\n\r\nclass IsLessThanOrEqualTo extends Filter {\r\n\tconstructor(version, schemas, propertyName, literal){\r\n\t\tsuper(version, schemas);\r\n\t\tthis.object['ogc:Filter'].comparisonOps = {\r\n\t\t\t'ogc:PropertyIsLessThanOrEqualTo' : {\r\n\t\t\t\tTYPE_NAME: \"Filter_\"+version.replaceAll('.','_')+\".PropertyIsLessThanOrEqualTo\",\r\n\t\t\t\texpression: [{\r\n\t\t\t\t\t'ogc:Literal': {\r\n\t\t\t\t\t\tTYPE_NAME: \"Filter_\"+version.replaceAll('.','_')+\".LiteralType\",\r\n\t\t\t\t\t\tcontent: [literal]\r\n\t\t\t\t\t}\r\n\t\t\t\t},{\r\n\t\t\t\t\t'ogc:PropertyName': {\r\n\t\t\t\t\t\tTYPE_NAME: \"Filter_\"+version.replaceAll('.','_')+\".PropertyNameType\",\r\n\t\t\t\t\t\tcontent: [propertyName]\r\n\t\t\t\t\t}\r\n\t\t\t\t}]\r\n\t\t\t}\r\n\t\t};\r\n\t}\r\n}\r\n\r\nexport default IsLessThanOrEqualTo;","import Filter from './Filter.js';\r\n\r\nclass IsGreaterThan extends Filter {\r\n\tconstructor(version, schemas, propertyName, literal){\r\n\t\tsuper(version, schemas);\r\n\t\tthis.object['ogc:Filter'].comparisonOps = {\r\n\t\t\t'ogc:PropertyIsGreaterThan' : {\r\n\t\t\t\tTYPE_NAME: \"Filter_\"+version.replaceAll('.','_')+\".PropertyIsGreaterThan\",\r\n\t\t\t\texpression: [{\r\n\t\t\t\t\t'ogc:Literal': {\r\n\t\t\t\t\t\tTYPE_NAME: \"Filter_\"+version.replaceAll('.','_')+\".LiteralType\",\r\n\t\t\t\t\t\tcontent: [literal]\r\n\t\t\t\t\t}\r\n\t\t\t\t},{\r\n\t\t\t\t\t'ogc:PropertyName': {\r\n\t\t\t\t\t\tTYPE_NAME: \"Filter_\"+version.replaceAll('.','_')+\".PropertyNameType\",\r\n\t\t\t\t\t\tcontent: [propertyName]\r\n\t\t\t\t\t}\r\n\t\t\t\t}]\r\n\t\t\t}\r\n\t\t};\r\n\t}\r\n}\r\n\r\nexport default IsGreaterThan;","import Filter from './Filter.js';\r\n\r\nclass IsGreaterThanOrEqualTo extends Filter {\r\n\tconstructor(version, schemas, propertyName, literal){\r\n\t\tsuper(version, schemas);\r\n\t\tthis.object['ogc:Filter'].comparisonOps = {\r\n\t\t\t'ogc:PropertyIsGreaterThanOrEqualTo' : {\r\n\t\t\t\tTYPE_NAME: \"Filter_\"+version.replaceAll('.','_')+\".PropertyIsGreaterThanOrEqualTo\",\r\n\t\t\t\texpression: [{\r\n\t\t\t\t\t'ogc:Literal': {\r\n\t\t\t\t\t\tTYPE_NAME: \"Filter_\"+version.replaceAll('.','_')+\".LiteralType\",\r\n\t\t\t\t\t\tcontent: [literal]\r\n\t\t\t\t\t}\r\n\t\t\t\t},{\r\n\t\t\t\t\t'ogc:PropertyName': {\r\n\t\t\t\t\t\tTYPE_NAME: \"Filter_\"+version.replaceAll('.','_')+\".PropertyNameType\",\r\n\t\t\t\t\t\tcontent: [propertyName]\r\n\t\t\t\t\t}\r\n\t\t\t\t}]\r\n\t\t\t}\r\n\t\t};\r\n\t}\r\n}\r\n\r\nexport default IsGreaterThanOrEqualTo;","import Filter from './Filter.js';\r\n\r\nclass BBOX extends Filter {\r\n\tconstructor(version, llat, llon, ulat, ulon, srsName) {\r\n\t\tsuper(version);\r\n\t\tthis.object['ogc:Filter'].spatialOps = {\r\n\t\t\t'ogc:BBOX' : {\r\n\t\t\t\tTYPE_NAME: \"Filter_\"+version.replaceAll('.','_')+\".BBOXType\",\r\n\t\t\t\tenvelope :{\r\n\t\t\t\t\t'gml:Envelope' : {\r\n\t\t\t\t\t\tTYPE_NAME: \"GML_3_1_1.EnvelopeType\",\r\n\t\t\t\t\t\tlowerCorner: {\r\n\t\t\t\t\t\t\tTYPE_NAME: \"GML_3_1_1.DirectPositionType\",\r\n\t\t\t\t\t\t\tvalue : [llat, llon]\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tupperCorner : {\r\n\t\t\t\t\t\t\tTYPE_NAME: \"GML_3_1_1.DirectPositionType\",\r\n\t\t\t\t\t\t\tvalue : [ulat, ulon]\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tsrsName: srsName\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\t}\r\n}\r\n\r\nexport default BBOX;","import Filter from './Filter.js';\r\n\r\nclass And extends Filter {\r\n\tconstructor(version, schemas, filters){\r\n\t\tsuper(version, schemas);\r\n\t\tthis.object['ogc:Filter'].logicOps = {\r\n            'ogc:And':{\r\n                TYPE_NAME: \"Filter_1_1_0.BinaryLogicOpType\",\r\n            }\r\n        };\r\n\t\tthis.object['ogc:Filter'].logicOps['ogc:And'].ops = filters.map(function(filter){return Filter.getOperator(filter);});\r\n\t}\r\n}\r\n\r\nexport default And;","import Filter from './Filter.js';\r\n\r\nclass Or extends Filter {\r\n\tconstructor(version, schemas, filters){\r\n\t\tsuper(version, schemas);\r\n\t\tthis.object['ogc:Filter'].logicOps = {\r\n            'ogc:Or':{\r\n                TYPE_NAME: \"Filter_1_1_0.BinaryLogicOpType\",\r\n            }\r\n        };\r\n\t\tthis.object['ogc:Filter'].logicOps['ogc:Or'].ops = filters.map(function(filter){return Filter.getOperator(filter);});\r\n\t}\r\n}\r\n\r\nexport default Or;","import Filter from './Filter.js';\r\n\r\nclass Not extends Filter {\r\n\t\r\n\tconstructor(version, schemas, filter){\r\n\t\tsuper(version, schemas);\r\n\t\tthis.object['ogc:Filter'].logicOps = {\r\n            'ogc:Not': {\r\n                TYPE_NAME: \"Filter_1_1_0.UnaryLogicOpType\"\r\n            }\r\n        };\r\n\t\tconsole.log(Filter.getOperator(filter));\r\n\t\tvar filters = new Array()\r\n\t\tfilters.push(Filter.getOperator(filter));\r\n\t\tthis.object['ogc:Filter'].logicOps['ogc:Not'].comparisonOps = Filter.getOperator(filter);\r\n\t}\r\n\t\r\n}\r\n\r\nexport default Not;","import '../../import-jsonix';\r\nimport '../../import-ogc-schemas';\r\nimport OWS from './OWS.js';\r\nimport CSWCapabilities from './CSWCapabilities.js';\r\nimport CSWGetRecords from './CSWGetRecords.js';\r\nimport CSWGetRecordById from './CSWGetRecordById.js';\r\nimport CSWGetDomain from './CSWGetDomain.js';\r\nimport CSWConstraint from './CSWConstraint.js';\r\nimport CSWQuery from './CSWQuery.js';\r\nimport Filter from './Filter.js';\r\nimport IsLike from './IsLike.js';\r\nimport IsEqualTo from './IsEqualTo.js';\r\nimport IsNotEqualTo from './IsNotEqualTo.js';\r\nimport IsLessThan from './IsLessThan.js';\r\nimport IsLessThanOrEqualTo from './IsLessThanOrEqualTo.js';\r\nimport IsGreaterThan from './IsGreaterThan.js';\r\nimport IsGreaterThanOrEqualTo from './IsGreaterThanOrEqualTo.js';\r\nimport BBOX from './BBOX.js';\r\nimport And from './And.js';\r\nimport Or from './Or.js';\r\n\r\nclass CSW extends OWS {\r\n\t\r\n\tconstructor(url, version, config) {\r\n\t\t\r\n\t\tvar owsVersion = null;\r\n\t\tswitch(version){\r\n\t\t\tcase \"2.0.2\": owsVersion = \"1.1.0\"; break;\r\n\t\t\tcase \"3.0.0\": owsVersion = \"2.0\"; break;\r\n\t\t}\r\n\t\t\r\n\t\tsuper(url, owsVersion, config);\r\n\t\tthis.version = version;\r\n\t\t/**\r\n\t\t * Jsonix Configuration\r\n\t\t * */\r\n\t\tif (config == null){\r\n\t\t\tthrow 'Missing Configuration! It is a must to CSW to know the profile';\r\n\t\t} else if (config[2] != undefined){\r\n\t\t\tthis.credentials = config[2];\r\n\t\t}\r\n\t\tthis.jsonnixContext = new Jsonix.Context(config[0], config[1]);\r\n\t\t// init by doing a GetCapabilities and parsing metadata\r\n\t\tthis.url = url;\r\n\t}\r\n\t\r\n\tGetCapabilities(){\r\n\t\tvar getCapabilities = new CSWCapabilities(this.owsVersion, this.version);\r\n\t\t// XML to Post.\r\n\t\tvar myXML = this.marshalDocument(getCapabilities);\r\n\t\tvar this_ = this;\r\n\t\treturn this.httpPost(this.url, \"application/xml\", myXML, this.credentials).then(function(responseXML){\r\n\t\t\tvar capabilities = this_.unmarshalDocument(responseXML);\r\n\t\t\tconsole.log(capabilities);\r\n\t\t\treturn capabilities;\r\n\t\t});\r\n\t}\r\n\t\r\n\tGetDomain(propertyName){\r\n\t\tvar this_ = this;\r\n\t\tvar getdomainAction = new GetDomain(this.owsVersion, this.version, propertyName);\r\n\t\tvar myXML = this.marshalDocument(getdomainAction);\r\n\t\treturn Ows4js.Util.httpPost(this.url, \"application/xml\", myXML, this.credentials).then(function(responseXML){\r\n\t\t\treturn this_.unmarshalDocument(responseXML);\r\n\t\t});\r\n\t}\r\n\t\r\n\tGetRecords(startPosition, maxRecords, filter, outputSchema) {\r\n\t\tvar this_ = this;\r\n\t\tvar query;\r\n\t\tif (filter === undefined || filter === null) {\r\n\t\t\tquery = new CSWQuery(this.version, 'full');\r\n\t\t} else {\r\n\t\t\t// Create Query\r\n\t\t\tquery = new CSWQuery(this.version, 'full', new CSWConstraint(this.version, filter));\r\n\t\t}\r\n\t\t// Create de GetRecords Action.\r\n\t\tvar recordAction = new CSWGetRecords(\r\n\t\t\tthis.owsVersion, this.version,\r\n\t\t\tstartPosition, maxRecords, query, outputSchema\r\n\t\t);\r\n\t\t\r\n\t\t// XML to Post.\r\n\t\tvar myXML = this.marshalDocument(recordAction);\r\n\t\tconsole.log(recordAction);\r\n\t\tconsole.log(myXML);\r\n\t\t// Post XML\r\n\t\treturn this.httpPost(this.url, \"application/xml\", myXML, this.credentials).then(function(responseXML){\r\n\t\t\tvar records = this_.unmarshalDocument(responseXML);\r\n\t\t\tconsole.log(records);\r\n\t\t\treturn records;\r\n\t\t});\r\n\r\n\t}\r\n\t\r\n\tGetRecordById(ids, outputSchema) {\r\n\t\tvar this_ = this;\r\n\t\tvar byIdAction = new CSWGetRecordById(this.owsVersion, this.version, ids, outputSchema);\r\n\t\t\r\n\t\t//console.log(byIdAction);\r\n\t\tvar myXML = this.marshalDocument(byIdAction);\r\n\t\t//console.log(myXML);\r\n\t\treturn this.httpPost(this.url, \"application/xml\", myXML, this.credentials).then(function(responseXML){\r\n\t\t\tvar records = this_.unmarshalDocument(responseXML);\r\n\t\t\tconsole.log(records);\r\n\t\t\treturn records;\r\n\t\t});\r\n\t};\r\n\t\r\n\t\r\n};\r\n\r\nexport default CSW;\r\n","import '../../import-jsonix';\r\nimport '../../import-ogc-schemas';\r\n\r\nclass OWS {\r\n\t\r\n\tconstructor(url, owsVersion, config) {\r\n\t\tthis.url = url;\r\n\t\tthis.owsVersion = owsVersion;\r\n\t\tthis.config = config;\r\n\t}\r\n\t\r\n\thttpGet(url) {\r\n\t\treturn new Promise(function(fulfill, reject){\r\n\t\t\tvar httpRequest;\r\n\t\t\ttry {\r\n\t\t\t\ttry {\r\n\t\t\t\t\thttpRequest = new ActiveXObject('Microsoft.XMLHTTP');\r\n\t\t\t\t} catch (e) {\r\n\t\t\t\t\thttpRequest = new XMLHttpRequest();\r\n\t\t\t\t}\r\n\t\t\t\thttpRequest.onreadystatechange=function() {\r\n\t\t\t\t\tif (httpRequest.readyState==4 && httpRequest.status==200) {\r\n\t\t\t\t\t\tfulfill(httpRequest.responseXML);\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\t\t\t\thttpRequest.open('GET', url, true);\r\n\t\t\t\thttpRequest.send(null);\r\n\t\t\t\treturn httpRequest;\r\n\t\t\t} catch (e) {\r\n\t\t\t\tthrow e;\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\t\r\n\thttpPost(url, lang, request, credentials) {\r\n\t\treturn new Promise(function(fulfill, reject){\r\n\t\t\tvar httpRequest = new XMLHttpRequest();\r\n\t\t\thttpRequest.onreadystatechange=function() {\r\n\t\t\t\tif (httpRequest.readyState==4 && httpRequest.status==200) {\r\n\t\t\t\t\tconsole.log(request);\r\n\t\t\t\t\tfulfill(httpRequest.responseXML);\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t\thttpRequest.open('POST', url, true);\r\n\t\t\thttpRequest.setRequestHeader('Accept-Language',lang);\r\n\t\t\tif (credentials != undefined && credentials.user != undefined && credentials.pass != undefined){\r\n\t\t\t\thttpRequest.setRequestHeader(\"Authorization\", \"Basic \" + btoa(credentials.user + \":\" + credentials.pass));\r\n\t\t\t}\r\n\t\t\thttpRequest.send(request);\r\n\t\t});\r\n\t}\r\n\t\r\n\tbuildUrl(url, params) {\r\n\t\tvar kvps = [];\r\n\r\n\t\tfor (var key in params) {\r\n\t\t\tif (params[key] !== null) {\r\n\t\t\t\tkvps.push(key+'='+params[key]);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn url + '?' + kvps.join('&');\r\n\t}\r\n\t\r\n\tmarshalDocument(object){\r\n\t\treturn this.jsonnixContext.createMarshaller().marshalDocument(object);\r\n\t}\r\n\r\n\tunmarshalDocument(xml){\r\n\t\treturn this.jsonnixContext.createUnmarshaller().unmarshalDocument(xml);\r\n\t}\r\n\t\r\n\txmlToObject(xml){\r\n\t\treturn this.unmarshalDocument(xml);\r\n\t}\r\n\r\n\tobjectToXML(object){\r\n\t\treturn this.marshalDocument(object);\r\n\t}\r\n\r\n\tunmarshalString(string){\r\n\t\treturn this.jsonnixContext.createUnmarshaller().unmarshalString(string);\r\n\t}\r\n\r\n\r\n}\r\n\r\nexport default OWS;","\r\nclass CSWCapabilities {\r\n\r\n\tconstructor(owsVersion, version){\r\n\t\tthis[\"csw:GetCapabilities\"] = {\r\n\t\t\t\"TYPE_NAME\":\"CSW_\" + version.replaceAll('.', '_') + \".GetCapabilitiesType\",\r\n\t\t\t\"service\":\"CSW\",\r\n\t\t\t\"acceptVersions\": {\r\n\t\t\t\t\"TYPE_NAME\":\"OWS_\" + owsVersion.replaceAll('.', '_') + \".AcceptVersionsType\",\r\n\t\t\t\t\"version\":[version]\r\n\t\t\t},\r\n\t\t\t\"acceptFormats\": {\r\n\t\t\t\t\"TYPE_NAME\": \"OWS_\" + owsVersion.replaceAll('.', '_') + \".AcceptFormatsType\",\r\n\t\t\t\t\"outputFormat\":[\"application/xml\"]\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n}\r\n\r\nexport default CSWCapabilities;","\r\nclass CSWGetRecords {\r\n\r\n\tconstructor(owsVersion, version, startPosition, maxRecords, query, outputSchema){\r\n\t\tthis['csw:GetRecords'] = {\r\n\t\t\tTYPE_NAME: \"CSW_\"+version.replaceAll('.', '_')+\".GetRecordsType\",\r\n\t\t\tabstractQuery: query,\r\n\t\t\tstartPosition: startPosition,\r\n\t\t\tmaxRecords: maxRecords,\r\n\t\t\tresultType: \"results\",\r\n\t\t\tservice: \"CSW\",\r\n\t\t\tversion: version\r\n\t\t}\r\n\t\t\r\n\t\tif (outputSchema){\r\n\t\t\tthis['csw:GetRecords'].outputSchema = outputSchema;\r\n\t\t}\r\n\t}\r\n\t\r\n}\r\n\r\nexport default CSWGetRecords;","\r\n\r\nclass CSWGetRecordById {\r\n\t\r\n\tconstructor(owsVersion, version, ids, outputSchema){\r\n\t\tthis['csw:GetRecordById'] = {\r\n\t\t\tTYPE_NAME: \"CSW_\"+version.replaceAll('.', '_')+\".GetRecordByIdType\",\r\n\t\t\telementSetName: {\r\n\t\t\t\tObjectTYPE_NAME: \"CSW_\"+version.replaceAll('.', '_')+\".ElementSetNameType\",\r\n\t\t\t\tvalue: \"full\"\r\n\t\t\t},\r\n\t\t\tid: ids,\r\n\t\t\tservice :  \"CSW\",\r\n\t\t\tversion : version\r\n\t\t};\r\n\t\t\r\n\t\tif (outputSchema){\r\n\t\t\tthis['csw:GetRecordById'].outputSchema = outputSchema;\r\n\t\t}\r\n\t}\r\n\t\r\n}\r\n\r\nexport default CSWGetRecordById;","\r\nclass CSWGetDomain {\r\n\t\r\n\tconstructor(owsVersion, version, propertyName){\r\n\t\tthis['csw:GetDomain'] ={\r\n\t\t\tTYPE_NAME: \"CSW_\"+version.replaceAll('.','_')+\".GetDomainType\",\r\n\t\t\tpropertyName: propertyName,\r\n\t\t\tservice: \"CSW\",\r\n\t\t\tversion: version\r\n\t\t};\r\n\t}\r\n\r\n}\r\n\r\nexport default CSWGetDomain;","import '../../import-jsonix';\r\nimport '../../import-ogc-schemas';\r\nimport OWS from './OWS.js';\r\n\r\nclass WMS extends OWS {\r\n\t\r\n\tconstructor(url, version, config) {\r\n\t\t\r\n\t\tvar owsVersion = null;\r\n\t\tswitch(version){\r\n\t\t\tcase \"1.1.1\": owsVersion = \"1.1.0\"; break;\r\n\t\t\tcase \"1.3.0\": owsVersion = \"1.1.0\"; break;\r\n\t\t}\r\n\t\t\r\n\t\tsuper(url, owsVersion, config);\r\n\t\tthis.version = version;\r\n\t\t/**\r\n\t\t * Jsonix Configuration\r\n\t\t * */\r\n\t\tif (config == null){\r\n\t\t\tthrow 'Missing Configuration! It is a must to WMS to know the profile';\r\n\t\t} else if (config[2] != undefined){\r\n\t\t\tthis.credentials = config[2];\r\n\t\t}\r\n\t\tthis.jsonnixContext = new Jsonix.Context(config[0], config[1]);\r\n\t\t// init by doing a GetCapabilities and parsing metadata\r\n\t\tthis.url = url;\r\n\t}\r\n\t\r\n\tGetCapabilities(){\r\n\t\tvar this_ = this;\r\n\t\treturn this.httpGet(this.buildUrl(this.url, {service: 'WMS', request: 'GetCapabilities', version: this.version}), \"application/xml\", this.credentials).then(function(responseXML){\r\n\t\t\tvar capabilities = this_.unmarshalDocument(responseXML);\r\n\t\t\tconsole.log(capabilities);\r\n\t\t\treturn capabilities;\r\n\t\t});\r\n\t}\r\n\t\r\n};\r\n\r\nexport default WMS;\r\n","import Control from 'ol/control/Control';\r\nimport { unByKey } from 'ol/Observable';\r\nimport {Group as LayerGroup} from 'ol/layer';\r\nimport LayerSwitcher from 'ol-layerswitcher';\r\nimport 'ol-layerswitcher/dist/ol-layerswitcher.css';\r\n\r\nvar CSS_PREFIX = 'layer-switcher-';\r\n\r\nexport default class OpenFairLayerSwitcher extends LayerSwitcher {\r\n\t\r\n\tconstructor(opt_options){\r\n\t\tsuper(opt_options);\r\n\t\tvar options = opt_options || {};\r\n\t\tthis.reverse = options.reverse !== false;\r\n\t\tthis.dragAndDrop = options.dragAndDrop !== false;\r\n\t\tthis.dragSrcEl = null;\r\n\t}\r\n\r\n\t/**\r\n\t * Render a legend graphic for an extended OFV OL layer object\r\n\t * @private \r\n\t * @param {Layer} lyr Layer for which the legend should be rendered.\r\n\t */\r\n\tstatic renderLegendGraphic_(lyr, li) {\r\n\t\tif(lyr.get('type') != 'base' && lyr.showLegendGraphic){\r\n\t\t\tvar imgSrc = (lyr.legendGraphic)? lyr.legendGraphic : false;\r\n\t\t\tif(imgSrc){\r\n\t\t\t\tvar legend = document.createElement('div');\r\n\t\t\t\tvar legendId = lyr.get('title').replace(' ', '-') + \"_legend\";\r\n\t\t\t\tlegend.id = legendId;\r\n\t\t\t\tvar img = new Image();\r\n\t\t\t\timg.src = imgSrc;\r\n\t\t\t\tvar smallLegend = img.width <= 32 && img.height <= 20;\r\n\t\t\t\tvar legendCss = 'margin-left:40px;max-height:250px;';\r\n\t\t\t\t//var smallLegendCss = smallLegend? 'margin-right:10px;float:right;' : 'margin-left:40px;';\r\n\t\t\t\tlegend.style.display = (lyr.getVisible()? (smallLegend? \"block\": \"table\") : \"none\");\r\n\t\t\t\tvar img = '<img src=\"'+imgSrc+'\" style=\"'+legendCss+'\"/>';\r\n\t\t\t\tlegend.innerHTML = img;\r\n\t\t\t\tli.appendChild(legend);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\r\n\t/**\r\n\t * Toggles a layer legend (hide/show legend image)\r\n\t * @private\r\n\t * @param {ol.layer.Base} lyr Layer for which the legend should be rendered\r\n\t */\r\n\tstatic toggleLegendGraphic_(lyr) {\r\n\t\tvar legendId = lyr.get('title').replace(' ', '-') + \"_legend\";\r\n\t\tvar legend = document.getElementById(legendId);\r\n\t\tlegend.style.display = (lyr.getVisible()? \"block\" : \"none\");\r\n\t}\t\r\n\t\r\n\t/**\r\n\t * Render a layer opacity slider for an extended OFV OL layer object\r\n\t * @private\r\n\t * @param {Layer} lyr Layer for which the opacity should be changed\r\n\t */\r\n\tstatic renderOpacitySlider_(lyr, li) {\r\n\t\tif(lyr.get('type') != 'base'){\r\n\t\t\tvar layer_id = lyr.id + \"_op\";\r\n\t\t\tvar layer_slider = lyr.id + \"_opslider\";\r\n\t\t\tvar layer_slider_html = document.createElement('p');\r\n\t\t\tlayer_slider_html.id = layer_id;\r\n\t\t\tlayer_slider_html.className = \"not-draggable\";\r\n\t\t\tlayer_slider_html.style = \"margin-left:32px;font-weight:normal !important;font-size:90%;overflow-wrap:break-word;\";\r\n\t\t\tlayer_slider_html.style.display = lyr.getVisible()? \"table\" : \"none\";\r\n\t\t\t//input\r\n\t\t\tvar layer_slider_input = document.createElement('input');\r\n\t\t\tconsole.log(layer_slider_input);\r\n\t\t\tlayer_slider_input.id = layer_slider;\r\n\t\t\tlayer_slider_input.name = layer_slider;\r\n\t\t\tlayer_slider_input.type = \"range\";\r\n\t\t\tlayer_slider_input.step = \"0.1\";\r\n\t\t\tlayer_slider_input.min = \"0\";\r\n\t\t\tlayer_slider_input.max = \"1\";\r\n\t\t\tlayer_slider_input.setAttribute(\"value\", String(lyr.getOpacity()));\r\n\t\t\tlayer_slider_input.style = \"width:75%;margin-left:35px;margin-top:5px;margin-bottom:10px;height:5px;\";\r\n\t\t\tlayer_slider_input.className = \"not-draggable\";\r\n\t\t\tlayer_slider_html.append(layer_slider_input);\r\n\t\t\tlayer_slider_html.innerHTML = layer_slider_html.innerHTML + '<span class=\"glyphicon glyphicon-eye-close\"></span>';\r\n\t\t\tli.append(layer_slider_html);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Toggles a layer opacity slider (hide/show opacity slider)\r\n\t * @private\r\n\t * @param {ol.layer.Base} lyr Layer for which the legend should be rendered\r\n\t */\t\r\n\tstatic toggleOpacitySlider_(lyr) {\r\n\t\tvar layerOpId = lyr.id + \"_op\";\r\n\t\tvar layerOp = document.getElementById(layerOpId);\r\n\t\tlayerOp.style.display = (lyr.getVisible()? \"block\" : \"none\");\r\n\t}\r\n\t\r\n\t\r\n\t/** LayerSwitcher Overwritten methods  **/\r\n\t \r\n\trenderPanel() {\r\n\t\tthis.dispatchEvent({ type: 'render' });\r\n\t\tOpenFairLayerSwitcher.renderPanel(this.getMap(), this.panel, {\r\n\t\t  groupSelectStyle: this.groupSelectStyle,\r\n\t\t  reverse: this.reverse,\r\n\t\t  dragAndDrop: this.dragAndDrop\r\n\t\t});\r\n\t\tthis.dispatchEvent({ type: 'rendercomplete' });\r\n\t} \r\n\t \r\n\t \r\n\t/**\r\n\t * **Static** Re-draw the layer panel to represent the current state of the layers.\r\n\t * @param {ol/Map~Map} map The OpenLayers Map instance to render layers for\r\n\t * @param {Element} panel The DOM Element into which the layer tree will be rendered\r\n\t * @param {Object} options Options for panel, group, and layers\r\n\t * @param {String} options.groupSelectStyle either `'none'` - groups don't get a checkbox,\r\n\t *   `'children'` (default) groups have a checkbox and affect child visibility or\r\n\t *   `'group'` groups have a checkbox but do not alter child visibility (like QGIS).\r\n\t * @param {boolean} options.reverse Reverse the layer order. Defaults to true.\r\n\t */\r\n\tstatic renderPanel(map, panel, options) {\r\n\t\t// Create the event.\r\n\t\tvar render_event = new Event('render');\r\n\t\t// Dispatch the event.\r\n\t\tpanel.dispatchEvent(render_event);\r\n\r\n\t\toptions = options || {};\r\n\r\n\t\toptions.groupSelectStyle = LayerSwitcher.getGroupSelectStyle(\r\n\t\t  options.groupSelectStyle\r\n\t\t);\r\n\r\n\t\tLayerSwitcher.ensureTopVisibleBaseLayerShown(map);\r\n\r\n\t\twhile (panel.firstChild) {\r\n\t\t  panel.removeChild(panel.firstChild);\r\n\t\t}\r\n\r\n\t\t// Reset indeterminate state for all layers and groups before\r\n\t\t// applying based on groupSelectStyle\r\n\t\tLayerSwitcher.forEachRecursive(map, function (l, idx, a) {\r\n\t\t  l.set('indeterminate', false);\r\n\t\t});\r\n\r\n\t\tif (\r\n\t\t  options.groupSelectStyle === 'children' ||\r\n\t\t  options.groupSelectStyle === 'none'\r\n\t\t) {\r\n\t\t  // Set visibile and indeterminate state of groups based on\r\n\t\t  // their children's visibility\r\n\t\t  LayerSwitcher.setGroupVisibility(map);\r\n\t\t} else if (options.groupSelectStyle === 'group') {\r\n\t\t  // Set child indetermiate state based on their parent's visibility\r\n\t\t  LayerSwitcher.setChildVisibility(map);\r\n\t\t}\r\n\r\n\t\tvar ul = document.createElement('ul');\r\n\t\tpanel.appendChild(ul);\r\n\t\t// passing two map arguments instead of lyr as we're passing the map as the root of the layers tree\r\n\t\tOpenFairLayerSwitcher.renderLayers_(map, map, ul, options, function render(\r\n\t\t  changedLyr\r\n\t\t) {\r\n\t\t  // console.log('render');\r\n\t\t  OpenFairLayerSwitcher.renderPanel(map, panel, options);\r\n\t\t});\r\n\r\n\t\t// Create the event.\r\n\t\tvar rendercomplete_event = new Event('rendercomplete');\r\n\t\t// Dispatch the event.\r\n\t\tpanel.dispatchEvent(rendercomplete_event);\r\n\t\t\r\n\t\t//refresh layer tree\r\n\t\tif(options.dragAndDrop){\r\n\t\t\tOpenFairLayerSwitcher.refreshLayerTree_(map, panel, options, function render(\r\n\t\t\t  changedLyr\r\n\t\t\t) {\r\n\t\t\t  // console.log('render');\r\n\t\t\t  OpenFairLayerSwitcher.renderPanel(map, panel, options);\r\n\t\t\t});\r\n\t\t}\r\n\t }\r\n\r\n\t  \r\n\t/**\r\n\t * **Static** Render all layers that are children of a group.\r\n\t * @private\r\n\t * @param {ol/Map~Map} map The map instance.\r\n\t * @param {ol/layer/Base~BaseLayer} lyr Layer to be rendered (should have a title property).\r\n\t * @param {Object} options Options for groups and layers\r\n\t * @param {String} options.groupSelectStyle either `'none'` - groups don't get a checkbox,\r\n\t *   `'children'` (default) groups have a checkbox and affect child visibility or\r\n\t *   `'group'` groups have a checkbox but do not alter child visibility (like QGIS).\r\n\t * @param {boolean} options.reverse Reverse the layer order. Defaults to true.\r\n\t * @param {Function} render Callback for change event on layer\r\n\t * @returns {HTMLElement} List item containing layer control markup\r\n\t */\r\n\tstatic renderLayer_(map, lyr, options, render) {\r\n\t\tvar li = document.createElement('li');\r\n\r\n\t\tvar lyrTitle = lyr.get('title');\r\n\r\n\t\tvar checkboxId = LayerSwitcher.uuid();\r\n\t\t\r\n\t\tvar label = document.createElement('label');\r\n\r\n\t\tif (lyr.getLayers && !lyr.get('combine')) {\r\n\t\t  const isBaseGroup = LayerSwitcher.isBaseGroup(lyr);\r\n\r\n\t\t  li.classList.add('group');\r\n\t\t  if (isBaseGroup) {\r\n\t\t\tli.classList.add(CSS_PREFIX + 'base-group');\r\n\t\t  }\r\n\r\n\t\t  // Group folding\r\n\t\t  if (lyr.get('fold')) {\r\n\t\t\tli.classList.add(CSS_PREFIX + 'fold');\r\n\t\t\tli.classList.add(CSS_PREFIX + lyr.get('fold'));\r\n\t\t\tconst btn = document.createElement('button');\r\n\t\t\tbtn.onclick = function (e) {\r\n\t\t\t  e = e || window.event;\r\n\t\t\t  LayerSwitcher.toggleFold_(lyr, li);\r\n\t\t\t  e.preventDefault();\r\n\t\t\t};\r\n\t\t\tli.appendChild(btn);\r\n\t\t  }\r\n\r\n\t\t  if (!isBaseGroup && options.groupSelectStyle != 'none') {\r\n\t\t\tconst input = document.createElement('input');\r\n\t\t\tinput.type = 'checkbox';\r\n\t\t\tinput.id = checkboxId;\r\n\t\t\tinput.checked = lyr.getVisible();\r\n\t\t\tinput.indeterminate = lyr.get('indeterminate');\r\n\t\t\tinput.onchange = function (e) {\r\n\t\t\t  e.target.parentElement.setAttribute(\"data-checked\", e.target.checked);\r\n\t\t\t  LayerSwitcher.setVisible_(\r\n\t\t\t\tmap,\r\n\t\t\t\tlyr,\r\n\t\t\t\te.target.checked,\r\n\t\t\t\toptions.groupSelectStyle\r\n\t\t\t  );\r\n\t\t\t  render(lyr);\r\n\t\t\t};\r\n\t\t\tli.setAttribute(\"data-checked\", lyr.get('visible'));\r\n\t\t\tli.appendChild(input);\r\n\t\t\tlabel.htmlFor = checkboxId;\r\n\t\t  }\r\n\r\n\t\t  label.innerHTML = lyrTitle;\r\n\t\t  li.appendChild(label);\r\n\t\t  var ul = document.createElement('ul');\r\n\t\t  li.appendChild(ul);\r\n\r\n\t\t  OpenFairLayerSwitcher.renderLayers_(map, lyr, ul, options, render);\r\n\t\t} else {\r\n\t\t  li.className = 'layer';\r\n\t\t  var input = document.createElement('input');\r\n\t\t  if (lyr.get('type') === 'base') {\r\n\t\t\tinput.type = 'radio';\r\n\t\t\tinput.name = 'base';\r\n\t\t  } else {\r\n\t\t\tinput.type = 'checkbox';\r\n\t\t  }\r\n\t\t  input.id = checkboxId;\r\n\t\t  input.checked = lyr.get('visible');\r\n\t\t  input.indeterminate = lyr.get('indeterminate');\r\n\t\t  input.onchange = function (e) {\r\n\t\t\te.target.parentElement.setAttribute(\"data-checked\", e.target.checked);\r\n\t\t\tLayerSwitcher.setVisible_(\r\n\t\t\t  map,\r\n\t\t\t  lyr,\r\n\t\t\t  e.target.checked,\r\n\t\t\t  options.groupSelectStyle\r\n\t\t\t);\r\n\t\t\tOpenFairLayerSwitcher.toggleLegendGraphic_(lyr);\r\n\t\t\tOpenFairLayerSwitcher.toggleOpacitySlider_(lyr);\r\n\t\t\trender(lyr);\r\n\t\t  };\r\n\t\t  li.setAttribute(\"data-pid\", lyr.id);\r\n\t\t  li.setAttribute(\"data-checked\", lyr.get('visible'));\r\n\t\t  li.appendChild(input);\r\n\r\n\t\t  label.htmlFor = checkboxId;\r\n\t\t  label.innerHTML = lyrTitle;\r\n\r\n\t\t  var rsl = map.getView().getResolution();\r\n\t\t  if (rsl > lyr.getMaxResolution() || rsl < lyr.getMinResolution()) {\r\n\t\t\tlabel.className += ' disabled';\r\n\t\t  }\r\n\r\n\t\t  li.appendChild(label);\r\n\t\t  \r\n\t\t  //handling layer opacity slider for overlays\r\n\t\t  OpenFairLayerSwitcher.renderOpacitySlider_(lyr, li);\r\n\t\t  \r\n\t\t  //handling legend graphic for overlays\r\n\t\t  OpenFairLayerSwitcher.renderLegendGraphic_(lyr, li);\r\n\t\t  \r\n\t\t}\r\n\r\n\t\treturn li;\r\n\t}\r\n\r\n\t/**\r\n\t * **Static** Render all layers that are children of a group.\r\n\t * @private\r\n\t * @param {ol/Map~Map} map The map instance.\r\n\t * @param {ol/layer/Group~LayerGroup} lyr Group layer whose children will be rendered.\r\n\t * @param {Element} elm DOM element that children will be appended to.\r\n\t * @param {Object} options Options for groups and layers\r\n\t * @param {String} options.groupSelectStyle either `'none'` - groups don't get a checkbox,\r\n\t *   `'children'` (default) groups have a checkbox and affect child visibility or\r\n\t *   `'group'` groups have a checkbox but do not alter child visibility (like QGIS).\r\n\t * @param {boolean} options.reverse Reverse the layer order. Defaults to true.\r\n\t * @param {Function} render Callback for change event on layer\r\n\t */\r\n\tstatic renderLayers_(map, lyr, elm, options, render) {\r\n\t\tvar lyrs = lyr.getLayers().getArray().slice();\r\n\t\tif (options.reverse) lyrs = lyrs.reverse();\r\n\t\tif (options.dragAndDrop){\r\n\t\t\tif(lyrs[0]) if(!(lyrs[0] instanceof LayerGroup)) if(lyrs[0].getZIndex()!=NaN){\r\n\t\t\t\tlyrs.sort((a, b) => { \r\n\t\t\t\t\treturn ((a.getZIndex() - b.getZIndex()) > 0 ? -1 : 1); \r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\t\tfor (var i = 0, l; i < lyrs.length; i++) {\r\n\t\t  l = lyrs[i];\r\n\t\t  if (l.get('title')) {\r\n\t\t\telm.appendChild(OpenFairLayerSwitcher.renderLayer_(map, l, options, render));\r\n\t\t  }\r\n\t\t}\r\n\t}\r\n\t\r\n\t/**\r\n\t * **Static** .\r\n\t * @private\r\n\t * @param {ol/Map~Map} map The map instance.\r\n\t * @param {Element} panel The DOM Element into which the layer tree will be rendered\r\n\t * @param {Object} options Options for panel, group, and layers\r\n\t */\r\n\tstatic refreshLayerTree_(map, panel, options, render){\r\n\t\tvar this_ = this;\r\n\r\n\t\t\r\n\r\n\t\tvar addDragAndDropLayerEvents = function(el) {\r\n\t\t\t\r\n\t\t\tvar dragAuth = function (target) {\r\n\t\t\t\treturn target.className !== \"not-draggable\";\r\n\t\t\t};\r\n\t\t\t \r\n\t\t\tvar dragLayerStart = function(e) {\r\n\t\t\t\t//this.style.opacity = '0.4';\r\n\t\t\t\tvar draggable = dragAuth(e.target);\r\n\t\t\t\tthis_.dragSrcEl = this;\r\n\t\t\t\tif(draggable){\r\n\t\t\t\t\te.dataTransfer.effectAllowed = 'move';\r\n\t\t\t\t\te.dataTransfer.setData('text/html', this.outerHTML);\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t\t \r\n\t\t\tvar dragLayerEnter = function(e) {\r\n\t\t\t\tvar draggable = dragAuth(e.target);\r\n\t\t\t\tif(draggable) this.classList.add('draggable-layer-over');\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\r\n\t\t\tvar dragLayerLeave = function(e) {\r\n\t\t\t  this.style.backgroundColor = \"transparent\";\r\n\t\t\t  e.stopPropagation();\r\n\t\t\t  this.classList.remove('draggable-layer-over');\r\n\t\t\t}\r\n\r\n\t\t\tvar dragLayerOver = function(e) {\r\n\t\t\t\tvar draggable = dragAuth(e.srcElement);\r\n\t\t\t\tif(draggable){\r\n\t\t\t\t\tthis.style.backgroundColor = \"#DCDCDC\";\r\n\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\te.dataTransfer.dropEffect = 'move';\r\n\t\t\t\t}\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\r\n\t\t\tvar dragLayerDrop = function(e) {\r\n\t\t\t\tthis.style.backgroundColor = \"transparent\";\r\n\t\t\t  //this.style.opacity = '1';\r\n\t\t\t  var draggable = dragAuth(e.srcElement);\r\n\t\t\t  if(draggable) if(this_.dragSrcEl) if (this_.dragSrcEl != this) {\r\n\t\t\t\tthis_.dragSrcEl.outerHTML = this.outerHTML;\r\n\t\t\t\tthis.outerHTML = e.dataTransfer.getData('text/html');\r\n\t\t\t\tthis_.refreshLayerTree_(map, panel, options, render);\r\n\t\t\t\tthis_.renderPanel(map, panel, options);\r\n\t\t\t  }\r\n\t\t\t  return false;\r\n\t\t\t}\r\n\r\n\t\t\tvar dragLayerEnd = function(e) {\r\n\t\t\t  var listItens = document.querySelectorAll('.draggable-layer');\r\n\t\t\t  [].forEach.call(listItens, function(item) {\r\n\t\t\t\titem.childNodes[0].checked = item.getAttribute('data-checked') === \"true\";\r\n\t\t\t\titem.classList.remove('draggable-layer-over');\r\n\t\t\t  });\r\n\t\t\t  this.style.opacity = '1';\r\n\t\t\t}\r\n\t\t\r\n\t\t\tel.addEventListener('dragstart', dragLayerStart, false);\r\n\t\t\tel.addEventListener('dragenter', dragLayerEnter, false);\r\n\t\t\tel.addEventListener('dragover', dragLayerOver, false);\r\n\t\t\tel.addEventListener('dragleave', dragLayerLeave, false);\r\n\t\t\tel.addEventListener('drop', dragLayerDrop, false);\r\n\t\t\tel.addEventListener('dragend', dragLayerEnd, false);\r\n\t\t}\r\n\t\t\r\n\t\tvar mapLayerGroups = new Array();\r\n\t\tvar total = 0;\r\n\t\tmap.getLayers().getArray().forEach(function(item){mapLayerGroups.push(item)});\r\n\t\tmapLayerGroups.shift(); //not applied on baselayers\r\n\t\t$($(\".group\")\r\n\t\t\t.filter(function(i, item){if($(item).prop('class').indexOf('base')==-1) return item;})\r\n\t\t\t.get().reverse())\r\n\t\t\t.each(function(i, layergroup){\r\n\t\t\t\t\r\n\t\t\t\tvar mapLayerGroup = mapLayerGroups[i];\r\n\t\t\t\tvar mapLayers = mapLayerGroup.getLayers().getArray().filter(function(item){if(item.id != \"ofv-csw-spatial-coverages\") return item;});\r\n\t\t\t\tvar layers = $(layergroup).find(\".layer\").get().reverse();\r\n\t\t\t\t$(layers).each(function(j,item){\r\n\t\t\t\t\t$(item).prop(\"draggable\",\"true\");\r\n\t\t\t\t\t$(item).addClass(\"draggable-layer\");\r\n\t\t\t\t\t$(item).attr(\"data-order\",total + j);\r\n\t\t\t\t\taddDragAndDropLayerEvents(item);\r\n\t\t\t\t});\r\n\t\t\t\ttotal += mapLayers.length;\r\n\t\t\t});\r\n\t\t\t\r\n\t\t$($(\".group\")\r\n\t\t\t.filter(function(i, item){if($(item).prop('class').indexOf('base')==-1) return item;})\r\n\t\t\t.get().reverse())\r\n\t\t\t.each(function(i, layergroup){\r\n\t\t\t\tvar mapLayerGroup = mapLayerGroups[i];\r\n\t\t\t\tvar mapLayers = mapLayerGroup.getLayers().getArray().filter(function(item){if(item.id != \"ofv-csw-spatial-coverages\") return item;});\r\n\t\t\t\tvar layers = $(layergroup).find(\".layer\").get().reverse();\r\n\t\t\t\t$(layers).each(function(j,item){\r\n\t\t\t\t\tvar mapLayer = OpenFairLayerSwitcher.getLayerByProperty(map, $(item).attr(\"data-pid\"), 'id');\r\n\t\t\t\t\tmapLayer.setZIndex(parseInt($(item).attr(\"data-order\")));\r\n\t\t\t\t\t\r\n\t\t\t\t\t//activate opacity slider for each layer\r\n\t\t\t\t\tvar layer_slider = mapLayer.id + \"_opslider\";\r\n\t\t\t\t\tvar slider = document.getElementById(layer_slider);\r\n\t\t\t\t\tslider.draggable = \"true\";\r\n\t\t\t\t\tslider.oninput = function(e) {\r\n\t\t\t\t\t  this.title = this.value;\r\n\t\t\t\t\t  mapLayer.setOpacity(Number(this.value));\r\n\t\t\t\t\t  //e.preventDefault();\r\n                      //e.stopPropagation();\r\n\t\t\t\t\t};\t\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t}\r\n\t\r\n\tstatic getLayerByProperty(map, layerProperty, by){\r\n\t\tvar target = undefined;\r\n\t\tfor(var i=0;i<map.getLayerGroup().getLayersArray().length;i++){\r\n\t\t\tvar layer = map.getLayerGroup().getLayersArray()[i];\r\n\t\t\tvar condition  = by? (layer[by] === layerProperty) : (layer.getSource().getParams()[\"LAYERS\"] === layerProperty);\r\n\t\t\tif(condition){\r\n\t\t\t\ttarget = map.getLayerGroup().getLayersArray()[i];\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn target;\r\n\t}\r\n\t\r\n}\r\n","/**\r\n * OpenFairViewer - a FAIR, ISO and OGC (meta)data compliant GIS data viewer\r\n * Copyright (c) 2018 Emmanuel Blondel\r\n * \r\n * Permission is hereby granted, free of charge, to any person obtaining a copy of this software \r\n * and associated documentation files (the \"Software\"), to deal in the Software without restriction, \r\n * including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, \r\n * and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, \r\n * subject to the following conditions:\r\n * \r\n * The above copyright notice and this permission notice shall be included in all copies or substantial \r\n * portions of the Software.\r\n * \r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT\r\n * LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. \r\n * IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, \r\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE \r\n * OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\r\n *\t\t   \r\n */\r\n\r\n \r\nexport default class OpenFairShiny {\r\n\r\n\t/**\r\n\t * popupHandler\r\n\t * @param {String} shinyAppUrl\r\n\t * @param {Layer} openlayers layer object extended within OpenFairViewer\r\n\t * @param {Feature} openlayers feature object\r\n\t * @param {Boolean} withGeom \r\n\t */\r\n\tstatic popupHandler(shinyAppUrl, layer, feature, withGeom){\r\n\t\tconsole.log(\"Custom popup handler with Shiny app\");\r\n\t\tconsole.log(layer);\r\n\t\tconsole.log(feature);\r\n\t\tvar pid = layer.id;\r\n\t\tvar layername = layer.getSource().getParams().LAYERS;\r\n\t\tvar shinyapp_url = shinyAppUrl + \"?\";\r\n\t\tshinyapp_url += \"pid=\" + pid;\r\n\t\tshinyapp_url += \"&layer=\" + layername;\r\n\t\tshinyapp_url += \"&csw_server=\" + layer.csw_server;\r\n\t\tshinyapp_url += \"&csw_version=\" + layer.csw_version;\r\n\t\tshinyapp_url += \"&wfs_server=\" + layer.baseDataUrl.split('?')[0];\r\n\t\tshinyapp_url += \"&wfs_version=1.0.0\";\r\n\t\tshinyapp_url += \"&wms_server=\" + (layer.getSource().getUrl? layer.getSource().getUrl() : layer.getSource().getUrls()[0]).replace('ows?service=WMS','wms');\r\n\t\tshinyapp_url += \"&wms_version=\" + layer.getSource().getParams().VERSION;\r\n\t\tshinyapp_url += \"&feature_geom=\" + withGeom;\r\n\t\tshinyapp_url += \"&strategy=\" + layer.strategy;\r\n\t\tvar params = null;\r\n\t\tswitch(layer.strategy){\r\n\t\t\tcase \"ogc_filters\": params = layer.getSource().getParams().CQL_FILTER; break;\r\n\t\t\tcase \"ogc_viewparams\": params = layer.getSource().getParams().VIEWPARAMS; break;\r\n\t\t}\r\n\t\tif(params) shinyapp_url += \"&par=\" + params;\r\n\t\tshinyapp_url += \"&geom=\" + feature.geometry_column;\r\n\t\tshinyapp_url += \"&x=\" + feature.info.x;\r\n\t\tshinyapp_url += \"&y=\" + feature.info.y;\r\n\t\tshinyapp_url += \"&width=\" + feature.info.width;\r\n\t\tshinyapp_url += \"&height=\" + feature.info.height;\r\n\t\tshinyapp_url += \"&bbox=\" + feature.info.bbox;\r\n\t\tshinyapp_url += \"&srs=EPSG:4326\";\r\n\r\n\t\tif(layer.dsd){\r\n\t\t\tvar dsd_small = layer.dsd.map(function(item){ \r\n\t\t\t\tvar newItem = item; \r\n\t\t\t\tdelete newItem.values; \r\n\t\t\t\tif(newItem.definition) if(newItem.definition.length == 0) newItem.definition = null ; \r\n\t\t\t\treturn newItem\r\n\t\t\t});\r\n\t\t\tconsole.log(JSON.stringify(dsd_small));\r\n\t\t\tshinyapp_url += \"&dsd=\"+ encodeURI(JSON.stringify(dsd_small));\r\n\t\t}\r\n\r\n\t\tvar html = '<iframe src =\"' + shinyapp_url + '\" width=\"400\" height=\"400\" frameborder=\"0\" marginheight=\"0\"></iframe>';\r\n\t\treturn html;\r\n\t}\r\n\r\n\t/**\r\n\t * dashboardHandler\r\n\t * @param {String} shinyAppUrl\r\n\t * @param {Layer} openlayers layer object extended within OpenFairViewer\r\n\t * @param {Boolean} withGeom \r\n\t */\r\n\tstatic dashboardHandler(shinyAppUrl, layer, withGeom){\r\n\t\tconsole.log(\"Custom dashboard handler with Shiny app\");\r\n\t\tvar pid = layer.id;\r\n\t\tvar layername = layer.getSource().getParams().LAYERS;\r\n\t\tvar shinyapp_url = shinyAppUrl + \"?\";\r\n\t\tshinyapp_url += \"pid=\" + pid;\r\n\t\tshinyapp_url += \"&layer=\" + layername;\r\n\t\tshinyapp_url += \"&csw_server=\" + layer.csw_server;\r\n\t\tshinyapp_url += \"&csw_version=\" + layer.csw_version;\r\n\t\tshinyapp_url += \"&wfs_server=\" + layer.baseDataUrl.split('?')[0];\r\n\t\tshinyapp_url += \"&wfs_version=1.0.0\";\r\n\t\tshinyapp_url += \"&feature_geom=\" + withGeom;\r\n\t\tshinyapp_url += \"&strategy=\" + layer.strategy;\r\n\t\tvar params = null;\r\n\t\tswitch(layer.strategy){\r\n\t\t\tcase \"ogc_filters\": params = layer.getSource().getParams().CQL_FILTER; break;\r\n\t\t\tcase \"ogc_viewparams\": params = layer.getSource().getParams().VIEWPARAMS; break;\r\n\t\t}\r\n\t\tif(params) shinyapp_url += \"&par=\" + params;\r\n\t\tshinyapp_url += \"&srs=EPSG:4326\";\r\n\r\n\t\tif(layer.dsd){\r\n\t\t\tvar dsd_small = layer.dsd.map(function(item){ \r\n\t\t\t\tvar newItem = item; \r\n\t\t\t\tdelete newItem.values; \r\n\t\t\t\tif(newItem.definition) if(newItem.definition.length == 0) newItem.definition = null ; \r\n\t\t\t\treturn newItem\r\n\t\t\t});\r\n\t\t\tconsole.log(JSON.stringify(dsd_small));\r\n\t\t\tshinyapp_url += \"&dsd=\"+ encodeURI(JSON.stringify(dsd_small));\r\n\t\t}\r\n\r\n\t\tvar html = '<iframe src =\"' + shinyapp_url + '\" width=\"100%\" height=\"100%\" frameborder=\"0\" marginheight=\"0\"></iframe>';\r\n\t\treturn html;\r\n\t}\r\n\t\t\r\n\r\n}"],"names":[],"version":3,"file":"OpenFairViewer.js.map"}